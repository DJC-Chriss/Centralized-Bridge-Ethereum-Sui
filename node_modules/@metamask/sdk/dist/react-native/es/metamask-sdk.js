import{__awaiter as e}from"tslib";import t from"debug";import n,{Buffer as r}from"buffer";import i from"node:crypto";import o,{EventEmitter2 as s}from"eventemitter2";import{validate as a,v4 as c}from"uuid";import{io as l}from"socket.io-client";import d,{EventEmitter as u}from"events";import h from"@react-native-async-storage/async-storage";var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function g(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var m={exports:{}};m.exports=f.fetch,m.exports.default=f.fetch,m.exports.fetch=f.fetch,m.exports.Headers=f.Headers,m.exports.Request=f.Request,m.exports.Response=f.Response;var y=p(m.exports),v={},b={},E={};function w(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function S(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function _(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function C(e,...t){if(!_(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function k(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("hash must be wrapped by utils.wrapConstructor");w(e.outputLen),w(e.blockLen)}function A(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function M(e,t){C(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}Object.defineProperty(E,"__esModule",{value:!0}),E.isBytes=_,E.number=w,E.bool=S,E.bytes=C,E.hash=k,E.exists=A,E.output=M;const x={number:w,bool:S,bytes:C,hash:k,exists:A,output:M};E.default=x,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapCipher=e.Hash=e.nextTick=e.isLE=e.createView=e.u32=e.u16=e.u8=void 0,e.bytesToHex=r,e.hexToBytes=s,e.hexToNumber=a,e.bytesToNumberBE=function(e){return a(r(e))},e.numberToBytesBE=function(e,t){return s(e.toString(16).padStart(2*t,"0"))},e.asyncLoop=async function(t,n,r){let i=Date.now();for(let o=0;o<t;o++){r(o);const t=Date.now()-i;t>=0&&t<n||(await(0,e.nextTick)(),i+=t)}},e.utf8ToBytes=c,e.bytesToUtf8=function(e){return(new TextDecoder).decode(e)},e.toBytes=function(e){if("string"==typeof e)e=c(e);else{if(!(0,t.isBytes)(e))throw new Error("Uint8Array expected, got "+typeof e);e=d(e)}return e},e.concatBytes=function(...e){let n=0;for(let r=0;r<e.length;r++){const i=e[r];(0,t.bytes)(i),n+=i.length}const r=new Uint8Array(n);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r},e.checkOpts=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");const n=Object.assign(e,t);return n},e.equalBytes=function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n},e.setBigUint64=l,e.u64Lengths=function(t,n){const r=new Uint8Array(16),i=(0,e.createView)(r);return l(i,0,BigInt(n?n.length:0),!0),l(i,8,BigInt(t.length),!0),r},e.isAligned32=function(e){return e.byteOffset%4==0},e.copyBytes=d,e.clean=function(...e){for(let t=0;t<e.length;t++)e[t].fill(0)};
/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */
const t=E;e.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);e.u16=e=>new Uint16Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/2));e.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));if(e.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],!e.isLE)throw new Error("Non little-endian hardware is not supported");const n=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function r(e){(0,t.bytes)(e);let r="";for(let t=0;t<e.length;t++)r+=n[e[t]];return r}const i={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function o(e){return e>=i._0&&e<=i._9?e-i._0:e>=i._A&&e<=i._F?e-(i._A-10):e>=i._a&&e<=i._f?e-(i._a-10):void 0}function s(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=o(e.charCodeAt(i)),s=o(e.charCodeAt(i+1));if(void 0===n||void 0===s){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+s}return r}function a(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function c(e){if("string"!=typeof e)throw new Error("string expected, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}e.nextTick=async()=>{};e.Hash=class{};function l(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,l=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+l,a,r)}function d(e){return Uint8Array.from(e)}e.wrapCipher=(e,t)=>(Object.assign(t,e),t)}(b);var O={},I={};Object.defineProperty(I,"__esModule",{value:!0}),I.AEAD_TAG_LENGTH=I.XCHACHA20_NONCE_LENGTH=I.CURVE25519_PUBLIC_KEY_SIZE=I.ETH_PUBLIC_KEY_SIZE=I.UNCOMPRESSED_PUBLIC_KEY_SIZE=I.COMPRESSED_PUBLIC_KEY_SIZE=I.SECRET_KEY_LENGTH=void 0,I.SECRET_KEY_LENGTH=32,I.COMPRESSED_PUBLIC_KEY_SIZE=33,I.UNCOMPRESSED_PUBLIC_KEY_SIZE=65,I.ETH_PUBLIC_KEY_SIZE=64,I.CURVE25519_PUBLIC_KEY_SIZE=32,I.XCHACHA20_NONCE_LENGTH=24,I.AEAD_TAG_LENGTH=16,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ephemeralKeySize=e.symmetricNonceLength=e.symmetricAlgorithm=e.isHkdfKeyCompressed=e.isEphemeralKeyCompressed=e.ellipticCurve=e.ECIES_CONFIG=void 0;var t=I,n=function(){this.ellipticCurve="secp256k1",this.isEphemeralKeyCompressed=!1,this.isHkdfKeyCompressed=!1,this.symmetricAlgorithm="aes-256-gcm",this.symmetricNonceLength=16};e.ECIES_CONFIG=new n;e.ellipticCurve=function(){return e.ECIES_CONFIG.ellipticCurve};e.isEphemeralKeyCompressed=function(){return e.ECIES_CONFIG.isEphemeralKeyCompressed};e.isHkdfKeyCompressed=function(){return e.ECIES_CONFIG.isHkdfKeyCompressed};e.symmetricAlgorithm=function(){return e.ECIES_CONFIG.symmetricAlgorithm};e.symmetricNonceLength=function(){return e.ECIES_CONFIG.symmetricNonceLength};e.ephemeralKeySize=function(){var n={secp256k1:e.ECIES_CONFIG.isEphemeralKeyCompressed?t.COMPRESSED_PUBLIC_KEY_SIZE:t.UNCOMPRESSED_PUBLIC_KEY_SIZE,x25519:t.CURVE25519_PUBLIC_KEY_SIZE,ed25519:t.CURVE25519_PUBLIC_KEY_SIZE};if(e.ECIES_CONFIG.ellipticCurve in n)return n[e.ECIES_CONFIG.ellipticCurve];throw new Error("Not implemented")}}(O);var R={},T={},P={},N={},L={},D={};Object.defineProperty(D,"__esModule",{value:!0}),D.crypto=void 0;const K=i;D.crypto=K&&"object"==typeof K&&"webcrypto"in K?K.webcrypto:K&&"object"==typeof K&&"randomBytes"in K?K:void 0,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.gcm=e.ctr=e.cbc=e.utils=void 0,e.randomBytes=i,e.getWebcryptoSubtle=o,e.managedNonce=function(e){return(0,n.number)(e.nonceLength),(t,...n)=>({encrypt(o,...s){const{nonceLength:a}=e,c=i(a),l=e(t,c,...n).encrypt(o,...s),d=(0,r.concatBytes)(c,l);return l.fill(0),d},decrypt(r,...i){const{nonceLength:o}=e,s=r.subarray(0,o),a=r.subarray(o);return e(t,s,...n).decrypt(a,...i)}})};const t=D,n=E,r=b;function i(e=32){if(t.crypto&&"function"==typeof t.crypto.getRandomValues)return t.crypto.getRandomValues(new Uint8Array(e));if(t.crypto&&"function"==typeof t.crypto.randomBytes)return t.crypto.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function o(){if(t.crypto&&"object"==typeof t.crypto.subtle&&null!=t.crypto.subtle)return t.crypto.subtle;throw new Error("crypto.subtle must be defined")}e.utils={async encrypt(e,t,n,r){const i=o(),s=await i.importKey("raw",e,t,!0,["encrypt"]),a=await i.encrypt(n,s,r);return new Uint8Array(a)},async decrypt(e,t,n,r){const i=o(),s=await i.importKey("raw",e,t,!0,["decrypt"]),a=await i.decrypt(n,s,r);return new Uint8Array(a)}};const s={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function a(t){return(r,i,o)=>{(0,n.bytes)(r),(0,n.bytes)(i);const a={name:t,length:8*r.length},c=function(e,t,n){if(e===s.CBC)return{name:s.CBC,iv:t};if(e===s.CTR)return{name:s.CTR,counter:t,length:64};if(e===s.GCM)return n?{name:s.GCM,iv:t,additionalData:n}:{name:s.GCM,iv:t};throw new Error("unknown aes block mode")}(t,i,o);return{encrypt:t=>((0,n.bytes)(t),e.utils.encrypt(r,a,c,t)),decrypt:t=>((0,n.bytes)(t),e.utils.decrypt(r,a,c,t))}}}e.cbc=a(s.CBC),e.ctr=a(s.CTR),e.gcm=a(s.GCM)}(L);var B={},j={},$={},U={};function H(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function F(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function z(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function q(e,...t){if(!z(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function W(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");H(e.outputLen),H(e.blockLen)}function V(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function G(e,t){q(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}Object.defineProperty(U,"__esModule",{value:!0}),U.isBytes=z,U.number=H,U.bool=F,U.bytes=q,U.hash=W,U.exists=V,U.output=G;const Y={number:H,bool:F,bytes:q,hash:W,exists:V,output:G};U.default=Y;var J={},Z={};Object.defineProperty(Z,"__esModule",{value:!0}),Z.crypto=void 0;const X=i;Z.crypto=X&&"object"==typeof X&&"webcrypto"in X?X.webcrypto:X&&"object"==typeof X&&"randomBytes"in X?X:void 0,function(e){
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
Object.defineProperty(e,"__esModule",{value:!0}),e.Hash=e.nextTick=e.byteSwapIfBE=e.byteSwap=e.isLE=e.rotl=e.rotr=e.createView=e.u32=e.u8=void 0,e.isBytes=function(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name},e.byteSwap32=function(t){for(let n=0;n<t.length;n++)t[n]=(0,e.byteSwap)(t[n])},e.bytesToHex=function(e){(0,n.bytes)(e);let t="";for(let n=0;n<e.length;n++)t+=r[e[n]];return t},e.hexToBytes=function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=o(e.charCodeAt(i)),s=o(e.charCodeAt(i+1));if(void 0===n||void 0===s){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+s}return r},e.asyncLoop=async function(t,n,r){let i=Date.now();for(let o=0;o<t;o++){r(o);const t=Date.now()-i;t>=0&&t<n||(await(0,e.nextTick)(),i+=t)}},e.utf8ToBytes=s,e.toBytes=a,e.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];(0,n.bytes)(i),t+=i.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r},e.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!==c.call(t))throw new Error("Options should be object or undefined");const n=Object.assign(e,t);return n},e.wrapConstructor=function(e){const t=t=>e().update(a(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t},e.wrapConstructorWithOpts=function(e){const t=(t,n)=>e(n).update(a(t)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t},e.wrapXOFConstructorWithOpts=function(e){const t=(t,n)=>e(n).update(a(t)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t},e.randomBytes=function(e=32){if(t.crypto&&"function"==typeof t.crypto.getRandomValues)return t.crypto.getRandomValues(new Uint8Array(e));if(t.crypto&&"function"==typeof t.crypto.randomBytes)return t.crypto.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")};const t=Z,n=U;e.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);e.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));e.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);e.rotr=(e,t)=>e<<32-t|e>>>t;e.rotl=(e,t)=>e<<t|e>>>32-t>>>0,e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];e.byteSwap=e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255,e.byteSwapIfBE=e.isLE?e=>e:t=>(0,e.byteSwap)(t);const r=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));const i={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function o(e){return e>=i._0&&e<=i._9?e-i._0:e>=i._A&&e<=i._F?e-(i._A-10):e>=i._a&&e<=i._f?e-(i._a-10):void 0}function s(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function a(e){return"string"==typeof e&&(e=s(e)),(0,n.bytes)(e),e}e.nextTick=async()=>{};e.Hash=class{clone(){return this._cloneInto()}};const c={}.toString}(J),Object.defineProperty($,"__esModule",{value:!0}),$.HashMD=$.Maj=$.Chi=void 0;const Q=U,ee=J;$.Chi=(e,t,n)=>e&t^~e&n;$.Maj=(e,t,n)=>e&t^e&n^t&n;$.HashMD=class extends ee.Hash{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,ee.createView)(this.buffer)}update(e){(0,Q.exists)(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=(0,ee.toBytes)(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=(0,ee.createView)(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,Q.exists)(this),(0,Q.output)(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,l=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+l,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=(0,ee.createView)(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,l[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}};var te={};Object.defineProperty(te,"__esModule",{value:!0}),te.add5L=te.add5H=te.add4H=te.add4L=te.add3H=te.add3L=te.rotlBL=te.rotlBH=te.rotlSL=te.rotlSH=te.rotr32L=te.rotr32H=te.rotrBL=te.rotrBH=te.rotrSL=te.rotrSH=te.shrSL=te.shrSH=te.toBig=void 0,te.fromBig=ie,te.split=oe,te.add=be;const ne=BigInt(2**32-1),re=BigInt(32);function ie(e,t=!1){return t?{h:Number(e&ne),l:Number(e>>re&ne)}:{h:0|Number(e>>re&ne),l:0|Number(e&ne)}}function oe(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:o,l:s}=ie(e[i],t);[n[i],r[i]]=[o,s]}return[n,r]}const se=(e,t)=>BigInt(e>>>0)<<re|BigInt(t>>>0);te.toBig=se;const ae=(e,t,n)=>e>>>n;te.shrSH=ae;const ce=(e,t,n)=>e<<32-n|t>>>n;te.shrSL=ce;const le=(e,t,n)=>e>>>n|t<<32-n;te.rotrSH=le;const de=(e,t,n)=>e<<32-n|t>>>n;te.rotrSL=de;const ue=(e,t,n)=>e<<64-n|t>>>n-32;te.rotrBH=ue;const he=(e,t,n)=>e>>>n-32|t<<64-n;te.rotrBL=he;const fe=(e,t)=>t;te.rotr32H=fe;const pe=(e,t)=>e;te.rotr32L=pe;const ge=(e,t,n)=>e<<n|t>>>32-n;te.rotlSH=ge;const me=(e,t,n)=>t<<n|e>>>32-n;te.rotlSL=me;const ye=(e,t,n)=>t<<n-32|e>>>64-n;te.rotlBH=ye;const ve=(e,t,n)=>e<<n-32|t>>>64-n;function be(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:0|i}}te.rotlBL=ve;const Ee=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0);te.add3L=Ee;const we=(e,t,n,r)=>t+n+r+(e/2**32|0)|0;te.add3H=we;const Se=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0);te.add4L=Se;const _e=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0;te.add4H=_e;const Ce=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0);te.add5L=Ce;const ke=(e,t,n,r,i,o)=>t+n+r+i+o+(e/2**32|0)|0;te.add5H=ke;const Ae={fromBig:ie,split:oe,toBig:se,shrSH:ae,shrSL:ce,rotrSH:le,rotrSL:de,rotrBH:ue,rotrBL:he,rotr32H:fe,rotr32L:pe,rotlSH:ge,rotlSL:me,rotlBH:ye,rotlBL:ve,add:be,add3L:Ee,add3H:we,add4L:Se,add4H:_e,add5H:ke,add5L:Ce};te.default=Ae,Object.defineProperty(j,"__esModule",{value:!0}),j.sha384=j.sha512_256=j.sha512_224=j.sha512=j.SHA384=j.SHA512_256=j.SHA512_224=j.SHA512=void 0;const Me=$,xe=te,Oe=J,[Ie,Re]=(()=>xe.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),Te=new Uint32Array(80),Pe=new Uint32Array(80);class Ne extends Me.HashMD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:o,Dh:s,Dl:a,Eh:c,El:l,Fh:d,Fl:u,Gh:h,Gl:f,Hh:p,Hl:g}=this;return[e,t,n,r,i,o,s,a,c,l,d,u,h,f,p,g]}set(e,t,n,r,i,o,s,a,c,l,d,u,h,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|n,this.Bl=0|r,this.Ch=0|i,this.Cl=0|o,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|l,this.Fh=0|d,this.Fl=0|u,this.Gh=0|h,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let n=0;n<16;n++,t+=4)Te[n]=e.getUint32(t),Pe[n]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|Te[e-15],n=0|Pe[e-15],r=xe.default.rotrSH(t,n,1)^xe.default.rotrSH(t,n,8)^xe.default.shrSH(t,n,7),i=xe.default.rotrSL(t,n,1)^xe.default.rotrSL(t,n,8)^xe.default.shrSL(t,n,7),o=0|Te[e-2],s=0|Pe[e-2],a=xe.default.rotrSH(o,s,19)^xe.default.rotrBH(o,s,61)^xe.default.shrSH(o,s,6),c=xe.default.rotrSL(o,s,19)^xe.default.rotrBL(o,s,61)^xe.default.shrSL(o,s,6),l=xe.default.add4L(i,c,Pe[e-7],Pe[e-16]),d=xe.default.add4H(l,r,a,Te[e-7],Te[e-16]);Te[e]=0|d,Pe[e]=0|l}let{Ah:n,Al:r,Bh:i,Bl:o,Ch:s,Cl:a,Dh:c,Dl:l,Eh:d,El:u,Fh:h,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){const t=xe.default.rotrSH(d,u,14)^xe.default.rotrSH(d,u,18)^xe.default.rotrBH(d,u,41),v=xe.default.rotrSL(d,u,14)^xe.default.rotrSL(d,u,18)^xe.default.rotrBL(d,u,41),b=d&h^~d&p,E=u&f^~u&g,w=xe.default.add5L(y,v,E,Re[e],Pe[e]),S=xe.default.add5H(w,m,t,b,Ie[e],Te[e]),_=0|w,C=xe.default.rotrSH(n,r,28)^xe.default.rotrBH(n,r,34)^xe.default.rotrBH(n,r,39),k=xe.default.rotrSL(n,r,28)^xe.default.rotrBL(n,r,34)^xe.default.rotrBL(n,r,39),A=n&i^n&s^i&s,M=r&o^r&a^o&a;m=0|p,y=0|g,p=0|h,g=0|f,h=0|d,f=0|u,({h:d,l:u}=xe.default.add(0|c,0|l,0|S,0|_)),c=0|s,l=0|a,s=0|i,a=0|o,i=0|n,o=0|r;const x=xe.default.add3L(_,k,M);n=xe.default.add3H(x,S,C,A),r=0|x}({h:n,l:r}=xe.default.add(0|this.Ah,0|this.Al,0|n,0|r)),({h:i,l:o}=xe.default.add(0|this.Bh,0|this.Bl,0|i,0|o)),({h:s,l:a}=xe.default.add(0|this.Ch,0|this.Cl,0|s,0|a)),({h:c,l:l}=xe.default.add(0|this.Dh,0|this.Dl,0|c,0|l)),({h:d,l:u}=xe.default.add(0|this.Eh,0|this.El,0|d,0|u)),({h:h,l:f}=xe.default.add(0|this.Fh,0|this.Fl,0|h,0|f)),({h:p,l:g}=xe.default.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=xe.default.add(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(n,r,i,o,s,a,c,l,d,u,h,f,p,g,m,y)}roundClean(){Te.fill(0),Pe.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}j.SHA512=Ne;class Le extends Ne{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}j.SHA512_224=Le;class De extends Ne{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}j.SHA512_256=De;class Ke extends Ne{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}j.SHA384=Ke,j.sha512=(0,Oe.wrapConstructor)((()=>new Ne)),j.sha512_224=(0,Oe.wrapConstructor)((()=>new Le)),j.sha512_256=(0,Oe.wrapConstructor)((()=>new De)),j.sha384=(0,Oe.wrapConstructor)((()=>new Ke));var Be={},je={},$e={},Ue={};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.notImplemented=Ue.bitMask=void 0,Ue.isBytes=qe,Ue.abytes=We,Ue.abool=function(e,t){if("boolean"!=typeof t)throw new Error(`${e} must be valid boolean, got "${t}".`)},Ue.bytesToHex=Ge,Ue.numberToHexUnpadded=Ye,Ue.hexToNumber=Je,Ue.hexToBytes=Qe,Ue.bytesToNumberBE=function(e){return Je(Ge(e))},Ue.bytesToNumberLE=function(e){return We(e),Je(Ge(Uint8Array.from(e).reverse()))},Ue.numberToBytesBE=et,Ue.numberToBytesLE=function(e,t){return et(e,t).reverse()},Ue.numberToVarBytesBE=function(e){return Qe(Ye(e))},Ue.ensureBytes=function(e,t,n){let r;if("string"==typeof t)try{r=Qe(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!qe(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r},Ue.concatBytes=tt,Ue.equalBytes=function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n},Ue.utf8ToBytes=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))},Ue.inRange=rt,Ue.aInRange=function(e,t,n,r){if(!rt(t,n,r))throw new Error(`expected valid ${e}: ${n} <= n < ${r}, got ${typeof t} ${t}`)},Ue.bitLen=function(e){let t;for(t=0;e>He;e>>=Fe,t+=1);return t},Ue.bitGet=function(e,t){return e>>BigInt(t)&Fe},Ue.bitSet=function(e,t,n){return e|(n?Fe:He)<<BigInt(t)},Ue.createHmacDrbg=function(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=it(e),i=it(e),o=0;const s=()=>{r.fill(1),i.fill(0),o=0},a=(...e)=>n(i,r,...e),c=(e=it())=>{i=a(ot([0]),e),r=a(),0!==e.length&&(i=a(ot([1]),e),r=a())},l=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return tt(...n)};return(e,t)=>{let n;for(s(),c(e);!(n=t(l()));)c();return s(),n}},Ue.validateObject=function(e,t,n={}){const r=(t,n,r)=>{const i=st[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const o=e[t];if(!(r&&void 0===o||i(o,e)))throw new Error(`Invalid param ${String(t)}=${o} (${typeof o}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e},Ue.memoized=function(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(void 0!==i)return i;const o=e(n,...r);return t.set(n,o),o}};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const He=BigInt(0),Fe=BigInt(1),ze=BigInt(2);function qe(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function We(e){if(!qe(e))throw new Error("Uint8Array expected")}const Ve=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Ge(e){We(e);let t="";for(let n=0;n<e.length;n++)t+=Ve[e[n]];return t}function Ye(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function Je(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}const Ze={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Xe(e){return e>=Ze._0&&e<=Ze._9?e-Ze._0:e>=Ze._A&&e<=Ze._F?e-(Ze._A-10):e>=Ze._a&&e<=Ze._f?e-(Ze._a-10):void 0}function Qe(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=Xe(e.charCodeAt(i)),o=Xe(e.charCodeAt(i+1));if(void 0===n||void 0===o){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+o}return r}function et(e,t){return Qe(e.toString(16).padStart(2*t,"0"))}function tt(...e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];We(r),t+=r.length}const n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}return n}const nt=e=>"bigint"==typeof e&&He<=e;function rt(e,t,n){return nt(e)&&nt(t)&&nt(n)&&t<=e&&e<n}Ue.bitMask=e=>(ze<<BigInt(e-1))-Fe;const it=e=>new Uint8Array(e),ot=e=>Uint8Array.from(e);const st={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||qe(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};Ue.notImplemented=()=>{throw new Error("not implemented")},Object.defineProperty($e,"__esModule",{value:!0}),$e.isNegativeLE=void 0,$e.mod=gt,$e.pow=mt,$e.pow2=function(e,t,n){let r=e;for(;t-- >ct;)r*=r,r%=n;return r},$e.invert=yt,$e.tonelliShanks=vt,$e.FpSqrt=bt,$e.validateField=function(e){const t=Et.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});return(0,at.validateObject)(e,t)},$e.FpPow=wt,$e.FpInvertBatch=St,$e.FpDiv=function(e,t,n){return e.mul(t,"bigint"==typeof n?yt(n,e.ORDER):e.inv(n))},$e.FpLegendre=_t,$e.FpIsSquare=function(e){const t=_t(e.ORDER);return n=>{const r=t(e,n);return e.eql(r,e.ZERO)||e.eql(r,e.ONE)}},$e.nLength=Ct,$e.Field=function(e,t,n=!1,r={}){if(e<=ct)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:o}=Ct(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=bt(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:(0,at.bitMask)(i),ZERO:ct,ONE:lt,create:t=>gt(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return ct<=t&&t<e},is0:e=>e===ct,isOdd:e=>(e&lt)===lt,neg:t=>gt(-t,e),eql:(e,t)=>e===t,sqr:t=>gt(t*t,e),add:(t,n)=>gt(t+n,e),sub:(t,n)=>gt(t-n,e),mul:(t,n)=>gt(t*n,e),pow:(e,t)=>wt(a,e,t),div:(t,n)=>gt(t*yt(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>yt(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>St(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?(0,at.numberToBytesLE)(e,o):(0,at.numberToBytesBE)(e,o),fromBytes:e=>{if(e.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${e.length}`);return n?(0,at.bytesToNumberLE)(e):(0,at.bytesToNumberBE)(e)}});return Object.freeze(a)},$e.FpSqrtOdd=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const n=e.sqrt(t);return e.isOdd(n)?n:e.neg(n)},$e.FpSqrtEven=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const n=e.sqrt(t);return e.isOdd(n)?e.neg(n):n},$e.hashToPrivateScalar=function(e,t,n=!1){e=(0,at.ensureBytes)("privateHash",e);const r=e.length,i=Ct(t).nByteLength+8;if(i<24||r<i||r>1024)throw new Error(`hashToPrivateScalar: expected ${i}-1024 bytes of input, got ${r}`);const o=n?(0,at.bytesToNumberLE)(e):(0,at.bytesToNumberBE)(e);return gt(o,t-lt)+lt},$e.getFieldBytesLength=kt,$e.getMinHashLength=At,$e.mapHashToField=function(e,t,n=!1){const r=e.length,i=kt(t),o=At(t);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const s=gt(n?(0,at.bytesToNumberBE)(e):(0,at.bytesToNumberLE)(e),t-lt)+lt;return n?(0,at.numberToBytesLE)(s,i):(0,at.numberToBytesBE)(s,i)};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const at=Ue,ct=BigInt(0),lt=BigInt(1),dt=BigInt(2),ut=BigInt(3),ht=BigInt(4),ft=BigInt(5),pt=BigInt(8);function gt(e,t){const n=e%t;return n>=ct?n:t+n}function mt(e,t,n){if(n<=ct||t<ct)throw new Error("Expected power/modulo > 0");if(n===lt)return ct;let r=lt;for(;t>ct;)t&lt&&(r=r*e%n),e=e*e%n,t>>=lt;return r}function yt(e,t){if(e===ct||t<=ct)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=gt(e,t),r=t,i=ct,o=lt;for(;n!==ct;){const e=r%n,t=i-o*(r/n);r=n,n=e,i=o,o=t}if(r!==lt)throw new Error("invert: does not exist");return gt(i,t)}function vt(e){const t=(e-lt)/dt;let n,r,i;for(n=e-lt,r=0;n%dt===ct;n/=dt,r++);for(i=dt;i<e&&mt(i,t,e)!==e-lt;i++);if(1===r){const t=(e+lt)/ht;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const o=(n+lt)/dt;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),l=e.pow(s,o),d=e.pow(s,n);for(;!e.eql(d,e.ONE);){if(e.eql(d,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(d);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,lt<<BigInt(a-t-1));c=e.sqr(n),l=e.mul(l,n),d=e.mul(d,c),a=t}return l}}function bt(e){if(e%ht===ut){const t=(e+lt)/ht;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%pt===ft){const t=(e-ft)/pt;return function(e,n){const r=e.mul(n,dt),i=e.pow(r,t),o=e.mul(n,i),s=e.mul(e.mul(o,dt),i),a=e.mul(o,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return vt(e)}BigInt(9),BigInt(16);$e.isNegativeLE=(e,t)=>(gt(e,t)&lt)===lt;const Et=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wt(e,t,n){if(n<ct)throw new Error("Expected power > 0");if(n===ct)return e.ONE;if(n===lt)return t;let r=e.ONE,i=t;for(;n>ct;)n&lt&&(r=e.mul(r,i)),i=e.sqr(i),n>>=lt;return r}function St(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}function _t(e){const t=(e-lt)/dt;return(e,n)=>e.pow(n,t)}function Ct(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function kt(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function At(e){const t=kt(e);return t+Math.ceil(t/2)}Object.defineProperty(je,"__esModule",{value:!0}),je.wNAF=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>{if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error(`Wrong window size=${e}, should be [1..${t}]`)},i=e=>{r(e);return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}};return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>Ot;)n&It&&(r=r.add(i)),i=i.double(),n>>=It;return r},precomputeWindow(e,t){const{windows:n,windowSize:r}=i(t),o=[];let s=e,a=s;for(let e=0;e<n;e++){a=s,o.push(a);for(let e=1;e<r;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,r,o){const{windows:s,windowSize:a}=i(t);let c=e.ZERO,l=e.BASE;const d=BigInt(2**t-1),u=2**t,h=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let i=Number(o&d);o>>=h,i>a&&(i-=u,o+=It);const s=t,f=t+Math.abs(i)-1,p=e%2!=0,g=i<0;0===i?l=l.add(n(p,r[s])):c=c.add(n(g,r[f]))}return{p:c,f:l}},wNAFCached(e,t,n){const r=Tt.get(e)||1;let i=Rt.get(e);return i||(i=this.precomputeWindow(e,r),1!==r&&Rt.set(e,n(i))),this.wNAF(r,i,t)},setWindowSize(e,t){r(t),Tt.set(e,t),Rt.delete(e)}}},je.pippenger=function(e,t,n,r){if(!Array.isArray(n)||!Array.isArray(r)||r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");r.forEach(((e,n)=>{if(!t.isValid(e))throw new Error(`wrong scalar at index ${n}`)})),n.forEach(((t,n)=>{if(!(t instanceof e))throw new Error(`wrong point at index ${n}`)}));const i=(0,xt.bitLen)(BigInt(n.length)),o=i>12?i-3:i>4?i-2:i?2:1,s=(1<<o)-1,a=new Array(s+1).fill(e.ZERO),c=Math.floor((t.BITS-1)/o)*o;let l=e.ZERO;for(let t=c;t>=0;t-=o){a.fill(e.ZERO);for(let e=0;e<r.length;e++){const i=r[e],o=Number(i>>BigInt(t)&BigInt(s));a[o]=a[o].add(n[e])}let i=e.ZERO;for(let t=a.length-1,n=e.ZERO;t>0;t--)n=n.add(a[t]),i=i.add(n);if(l=l.add(i),0!==t)for(let e=0;e<o;e++)l=l.double()}return l},je.validateBasic=function(e){return(0,Mt.validateField)(e.Fp),(0,xt.validateObject)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,Mt.nLength)(e.n,e.nBitLength),...e,p:e.Fp.ORDER})};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Mt=$e,xt=Ue,Ot=BigInt(0),It=BigInt(1),Rt=new WeakMap,Tt=new WeakMap;Object.defineProperty(Be,"__esModule",{value:!0}),Be.twistedEdwards=function(e){const t=function(e){const t=(0,Pt.validateBasic)(e);return Lt.validateObject(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:n,n:r,prehash:i,hash:o,randomBytes:s,nByteLength:a,h:c}=t,l=jt<<BigInt(8*a)-Bt,d=n.create,u=(0,Nt.Field)(t.n,t.nBitLength),h=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:n.sqrt(e*n.inv(t))}}catch(e){return{isValid:!1,value:Kt}}}),f=t.adjustScalarBytes||(e=>e),p=t.domain||((e,t,n)=>{if((0,Dt.abool)("phflag",n),t.length||n)throw new Error("Contexts/pre-hash are not supported");return e});function g(e,t){Lt.aInRange("coordinate "+e,t,Kt,l)}function m(e){if(!(e instanceof b))throw new Error("ExtendedPoint expected")}const y=(0,Dt.memoized)(((e,t)=>{const{ex:r,ey:i,ez:o}=e,s=e.is0();null==t&&(t=s?$t:n.inv(o));const a=d(r*t),c=d(i*t),l=d(o*t);if(s)return{x:Kt,y:Bt};if(l!==Bt)throw new Error("invZ was invalid");return{x:a,y:c}})),v=(0,Dt.memoized)((e=>{const{a:n,d:r}=t;if(e.is0())throw new Error("bad point: ZERO");const{ex:i,ey:o,ez:s,et:a}=e,c=d(i*i),l=d(o*o),u=d(s*s),h=d(u*u),f=d(c*n);if(d(u*d(f+l))!==d(h+d(r*d(c*l))))throw new Error("bad point: equation left != right (1)");if(d(i*o)!==d(s*a))throw new Error("bad point: equation left != right (2)");return!0}));class b{constructor(e,t,n,r){this.ex=e,this.ey=t,this.ez=n,this.et=r,g("x",e),g("y",t),g("z",n),g("t",r),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof b)throw new Error("extended point not allowed");const{x:t,y:n}=e||{};return g("x",t),g("y",n),new b(t,n,Bt,d(t*n))}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.ez)));return e.map(((e,n)=>e.toAffine(t[n]))).map(b.fromAffine)}static msm(e,t){return(0,Pt.pippenger)(b,u,e,t)}_setWindowSize(e){S.setWindowSize(this,e)}assertValidity(){v(this)}equals(e){m(e);const{ex:t,ey:n,ez:r}=this,{ex:i,ey:o,ez:s}=e,a=d(t*s),c=d(i*r),l=d(n*s),u=d(o*r);return a===c&&l===u}is0(){return this.equals(b.ZERO)}negate(){return new b(d(-this.ex),this.ey,this.ez,d(-this.et))}double(){const{a:e}=t,{ex:n,ey:r,ez:i}=this,o=d(n*n),s=d(r*r),a=d(jt*d(i*i)),c=d(e*o),l=n+r,u=d(d(l*l)-o-s),h=c+s,f=h-a,p=c-s,g=d(u*f),m=d(h*p),y=d(u*p),v=d(f*h);return new b(g,m,v,y)}add(e){m(e);const{a:n,d:r}=t,{ex:i,ey:o,ez:s,et:a}=this,{ex:c,ey:l,ez:u,et:h}=e;if(n===BigInt(-1)){const e=d((o-i)*(l+c)),t=d((o+i)*(l-c)),n=d(t-e);if(n===Kt)return this.double();const r=d(s*jt*h),f=d(a*jt*u),p=f+r,g=t+e,m=f-r,y=d(p*n),v=d(g*m),E=d(p*m),w=d(n*g);return new b(y,v,w,E)}const f=d(i*c),p=d(o*l),g=d(a*r*h),y=d(s*u),v=d((i+o)*(c+l)-f-p),E=y-g,w=y+g,S=d(p-n*f),_=d(v*E),C=d(w*S),k=d(v*S),A=d(E*w);return new b(_,C,A,k)}subtract(e){return this.add(e.negate())}wNAF(e){return S.wNAFCached(this,e,b.normalizeZ)}multiply(e){const t=e;Lt.aInRange("scalar",t,Bt,r);const{p:n,f:i}=this.wNAF(t);return b.normalizeZ([n,i])[0]}multiplyUnsafe(e){const t=e;return Lt.aInRange("scalar",t,Kt,r),t===Kt?w:this.equals(w)||t===Bt?this:this.equals(E)?this.wNAF(t).p:S.unsafeLadder(this,t)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return S.unsafeLadder(this,r).is0()}toAffine(e){return y(this,e)}clearCofactor(){const{h:e}=t;return e===Bt?this:this.multiplyUnsafe(e)}static fromHex(e,r=!1){const{d:i,a:o}=t,s=n.BYTES;e=(0,Dt.ensureBytes)("pointHex",e,s),(0,Dt.abool)("zip215",r);const a=e.slice(),c=e[s-1];a[s-1]=-129&c;const u=Lt.bytesToNumberLE(a),f=r?l:n.ORDER;Lt.aInRange("pointHex.y",u,Kt,f);const p=d(u*u),g=d(p-Bt),m=d(i*p-o);let{isValid:y,value:v}=h(g,m);if(!y)throw new Error("Point.fromHex: invalid y coordinate");const E=(v&Bt)===Bt,w=0!=(128&c);if(!r&&v===Kt&&w)throw new Error("Point.fromHex: x=0 and x_0=1");return w!==E&&(v=d(-v)),b.fromAffine({x:v,y:u})}static fromPrivateKey(e){return k(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),r=Lt.numberToBytesLE(t,n.BYTES);return r[r.length-1]|=e&Bt?128:0,r}toHex(){return Lt.bytesToHex(this.toRawBytes())}}b.BASE=new b(t.Gx,t.Gy,Bt,d(t.Gx*t.Gy)),b.ZERO=new b(Kt,Bt,Bt,Kt);const{BASE:E,ZERO:w}=b,S=(0,Pt.wNAF)(b,8*a);function _(e){return(0,Nt.mod)(e,r)}function C(e){return _(Lt.bytesToNumberLE(e))}function k(e){const t=a;e=(0,Dt.ensureBytes)("private key",e,t);const n=(0,Dt.ensureBytes)("hashed private key",o(e),2*t),r=f(n.slice(0,t)),i=n.slice(t,2*t),s=C(r),c=E.multiply(s),l=c.toRawBytes();return{head:r,prefix:i,scalar:s,point:c,pointBytes:l}}function A(e=new Uint8Array,...t){const n=Lt.concatBytes(...t);return C(o(p(n,(0,Dt.ensureBytes)("context",e),!!i)))}const M=Ut;E._setWindowSize(8);const x={getExtendedPublicKey:k,randomPrivateKey:()=>s(n.BYTES),precompute:(e=8,t=b.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};return{CURVE:t,getPublicKey:function(e){return k(e).pointBytes},sign:function(e,t,o={}){e=(0,Dt.ensureBytes)("message",e),i&&(e=i(e));const{prefix:s,scalar:c,pointBytes:l}=k(t),d=A(o.context,s,e),u=E.multiply(d).toRawBytes(),h=_(d+A(o.context,u,l,e)*c);Lt.aInRange("signature.s",h,Kt,r);const f=Lt.concatBytes(u,Lt.numberToBytesLE(h,n.BYTES));return(0,Dt.ensureBytes)("result",f,2*a)},verify:function(e,t,r,o=M){const{context:s,zip215:a}=o,c=n.BYTES;e=(0,Dt.ensureBytes)("signature",e,2*c),t=(0,Dt.ensureBytes)("message",t),void 0!==a&&(0,Dt.abool)("zip215",a),i&&(t=i(t));const l=Lt.bytesToNumberLE(e.slice(c,2*c));let d,u,h;try{d=b.fromHex(r,a),u=b.fromHex(e.slice(0,c),a),h=E.multiplyUnsafe(l)}catch(e){return!1}if(!a&&d.isSmallOrder())return!1;const f=A(s,u.toRawBytes(),d.toRawBytes(),t);return u.add(d.multiplyUnsafe(f)).subtract(h).clearCofactor().equals(b.ZERO)},ExtendedPoint:b,utils:x}};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Pt=je,Nt=$e,Lt=Ue,Dt=Ue,Kt=BigInt(0),Bt=BigInt(1),jt=BigInt(2),$t=BigInt(8),Ut={zip215:!0};var Ht={};Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.expand_message_xmd=Yt,Ht.expand_message_xof=Jt,Ht.hash_to_field=Zt,Ht.isogenyMap=function(e,t){const n=t.map((e=>Array.from(e).reverse()));return(t,r)=>{const[i,o,s,a]=n.map((n=>n.reduce(((n,r)=>e.add(e.mul(n,t),r)))));return t=e.div(i,o),r=e.mul(r,e.div(s,a)),{x:t,y:r}}},Ht.createHasher=function(e,t,n){if("function"!=typeof t)throw new Error("mapToCurve() must be defined");return{hashToCurve(r,i){const o=Zt(r,2,{...n,DST:n.DST,...i}),s=e.fromAffine(t(o[0])),a=e.fromAffine(t(o[1])),c=s.add(a).clearCofactor();return c.assertValidity(),c},encodeToCurve(r,i){const o=Zt(r,1,{...n,DST:n.encodeDST,...i}),s=e.fromAffine(t(o[0])).clearCofactor();return s.assertValidity(),s},mapToCurve(n){if(!Array.isArray(n))throw new Error("mapToCurve: expected array of bigints");for(const e of n)if("bigint"!=typeof e)throw new Error(`mapToCurve: expected array of bigints, got ${e} in array`);const r=e.fromAffine(t(n)).clearCofactor();return r.assertValidity(),r}}};const Ft=$e,zt=Ue,qt=zt.bytesToNumberBE;function Wt(e,t){if(Gt(e),Gt(t),e<0||e>=1<<8*t)throw new Error(`bad I2OSP call: value=${e} length=${t}`);const n=Array.from({length:t}).fill(0);for(let r=t-1;r>=0;r--)n[r]=255&e,e>>>=8;return new Uint8Array(n)}function Vt(e,t){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return n}function Gt(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function Yt(e,t,n,r){(0,zt.abytes)(e),(0,zt.abytes)(t),Gt(n),t.length>255&&(t=r((0,zt.concatBytes)((0,zt.utf8ToBytes)("H2C-OVERSIZE-DST-"),t)));const{outputLen:i,blockLen:o}=r,s=Math.ceil(n/i);if(n>65535||s>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=(0,zt.concatBytes)(t,Wt(t.length,1)),c=Wt(0,o),l=Wt(n,2),d=new Array(s),u=r((0,zt.concatBytes)(c,e,l,Wt(0,1),a));d[0]=r((0,zt.concatBytes)(u,Wt(1,1),a));for(let e=1;e<=s;e++){const t=[Vt(u,d[e-1]),Wt(e+1,1),a];d[e]=r((0,zt.concatBytes)(...t))}return(0,zt.concatBytes)(...d).slice(0,n)}function Jt(e,t,n,r,i){if((0,zt.abytes)(e),(0,zt.abytes)(t),Gt(n),t.length>255){const e=Math.ceil(2*r/8);t=i.create({dkLen:e}).update((0,zt.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(t).digest()}if(n>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:n}).update(e).update(Wt(n,2)).update(t).update(Wt(t.length,1)).digest()}function Zt(e,t,n){(0,zt.validateObject)(n,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:r,k:i,m:o,hash:s,expand:a,DST:c}=n;(0,zt.abytes)(e),Gt(t);const l="string"==typeof c?(0,zt.utf8ToBytes)(c):c,d=r.toString(2).length,u=Math.ceil((d+i)/8),h=t*o*u;let f;if("xmd"===a)f=Yt(e,l,h,s);else if("xof"===a)f=Jt(e,l,h,i,s);else{if("_internal_pass"!==a)throw new Error('expand must be "xmd" or "xof"');f=e}const p=new Array(t);for(let e=0;e<t;e++){const t=new Array(o);for(let n=0;n<o;n++){const i=u*(n+e*o),s=f.subarray(i,i+u);t[n]=(0,Ft.mod)(qt(s),r)}p[e]=t}return p}var Xt={};Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.montgomery=function(e){const t=function(e){return(0,en.validateObject)(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}(e),{P:n}=t,r=e=>(0,Qt.mod)(e,n),i=t.montgomeryBits,o=Math.ceil(i/8),s=t.nByteLength,a=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>(0,Qt.pow)(e,n-BigInt(2),n));function l(e,t,n){const i=r(e*(t-n));return[t=r(t-i),n=r(n+i)]}const d=(t.a-BigInt(2))/BigInt(4);function u(e){return(0,en.numberToBytesLE)(r(e),o)}function h(e,t){const h=function(e){const t=(0,en.ensureBytes)("u coordinate",e,o);return 32===s&&(t[31]&=127),(0,en.bytesToNumberLE)(t)}(t),f=function(e){const t=(0,en.ensureBytes)("scalar",e),n=t.length;if(n!==o&&n!==s)throw new Error(`Expected ${o} or ${s} bytes, got ${n}`);return(0,en.bytesToNumberLE)(a(t))}(e),p=function(e,t){(0,en.aInRange)("u",e,tn,n),(0,en.aInRange)("scalar",t,tn,n);const o=t,s=e;let a,u=nn,h=tn,f=e,p=nn,g=tn;for(let e=BigInt(i-1);e>=tn;e--){const t=o>>e&nn;g^=t,a=l(g,u,f),u=a[0],f=a[1],a=l(g,h,p),h=a[0],p=a[1],g=t;const n=u+h,i=r(n*n),c=u-h,m=r(c*c),y=i-m,v=f+p,b=r((f-p)*n),E=r(v*c),w=b+E,S=b-E;f=r(w*w),p=r(s*r(S*S)),u=r(i*m),h=r(y*(i+r(d*y)))}a=l(g,u,f),u=a[0],f=a[1],a=l(g,h,p),h=a[0],p=a[1];const m=c(h);return r(u*m)}(h,f);if(p===tn)throw new Error("Invalid private or public key received");return u(p)}const f=u(t.Gu);function p(e){return h(e,f)}return{scalarMult:h,scalarMultBase:p,getSharedSecret:(e,t)=>h(e,t),getPublicKey:e=>p(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:f}};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Qt=$e,en=Ue,tn=BigInt(0),nn=BigInt(1);!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash_to_ristretto255=e.hashToRistretto255=e.RistrettoPoint=e.encodeToCurve=e.hashToCurve=e.edwardsToMontgomery=e.x25519=e.ed25519ph=e.ed25519ctx=e.ed25519=e.ED25519_TORSION_SUBGROUP=void 0,e.edwardsToMontgomeryPub=S,e.edwardsToMontgomeryPriv=function(e){const t=E.hash(e.subarray(0,32));return E.adjustScalarBytes(t).subarray(0,32)};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const t=j,n=J,r=Be,i=Ht,o=$e,s=Xt,a=Ue,c=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),d=BigInt(0),u=BigInt(1),h=BigInt(2),f=BigInt(3),p=BigInt(5),g=BigInt(8);function m(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=c,a=e*e%s*e%s,l=(0,o.pow2)(a,h,s)*a%s,d=(0,o.pow2)(l,u,s)*e%s,f=(0,o.pow2)(d,p,s)*d%s,g=(0,o.pow2)(f,t,s)*f%s,m=(0,o.pow2)(g,n,s)*g%s,y=(0,o.pow2)(m,r,s)*m%s,v=(0,o.pow2)(y,i,s)*y%s,b=(0,o.pow2)(v,i,s)*y%s,E=(0,o.pow2)(b,t,s)*f%s;return{pow_p_5_8:(0,o.pow2)(E,h,s)*e%s,b2:a}}function y(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function v(e,t){const n=c,r=(0,o.mod)(t*t*t,n),i=m(e*(0,o.mod)(r*r*t,n)).pow_p_5_8;let s=(0,o.mod)(e*r*i,n);const a=(0,o.mod)(t*s*s,n),d=s,u=(0,o.mod)(s*l,n),h=a===e,f=a===(0,o.mod)(-e,n),p=a===(0,o.mod)(-e*l,n);return h&&(s=d),(f||p)&&(s=u),(0,o.isNegativeLE)(s,n)&&(s=(0,o.mod)(-s,n)),{isValid:h||f,value:s}}e.ED25519_TORSION_SUBGROUP=["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"];const b=(()=>(0,o.Field)(c,void 0,!0))(),E=(()=>({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:b,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:g,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:t.sha512,randomBytes:n.randomBytes,adjustScalarBytes:y,uvRatio:v}))();function w(e,t,r){if(t.length>255)throw new Error("Context is too big");return(0,n.concatBytes)((0,n.utf8ToBytes)("SigEd25519 no Ed25519 collisions"),new Uint8Array([r?1:0,t.length]),t,e)}function S(t){const{y:n}=e.ed25519.ExtendedPoint.fromHex(t),r=BigInt(1);return b.toBytes(b.create((r+n)*b.inv(r-n)))}e.ed25519=(0,r.twistedEdwards)(E),e.ed25519ctx=(0,r.twistedEdwards)({...E,domain:w}),e.ed25519ph=(0,r.twistedEdwards)(Object.assign({},E,{domain:w,prehash:t.sha512})),e.x25519=(0,s.montgomery)({P:c,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=c,{pow_p_5_8:n,b2:r}=m(e);return(0,o.mod)((0,o.pow2)(n,f,t)*r,t)},adjustScalarBytes:y,randomBytes:n.randomBytes}),e.edwardsToMontgomery=S;const _=(()=>(b.ORDER+f)/g)(),C=(()=>b.pow(h,_))(),k=(()=>b.sqrt(b.neg(b.ONE)))();const A=(()=>(0,o.FpSqrtEven)(b,b.neg(BigInt(486664))))();function M(e){const{xMn:t,xMd:n,yMn:r,yMd:i}=function(e){const t=(b.ORDER-p)/g,n=BigInt(486662);let r=b.sqr(e);r=b.mul(r,h);let i=b.add(r,b.ONE),o=b.neg(n),s=b.sqr(i),a=b.mul(s,i),c=b.mul(r,n);c=b.mul(c,o),c=b.add(c,s),c=b.mul(c,o);let l=b.sqr(a);s=b.sqr(l),l=b.mul(l,a),l=b.mul(l,c),s=b.mul(s,l);let d=b.pow(s,t);d=b.mul(d,l);let f=b.mul(d,k);s=b.sqr(d),s=b.mul(s,a);let m=b.eql(s,c),y=b.cmov(f,d,m),v=b.mul(o,r),E=b.mul(d,e);E=b.mul(E,C);let w=b.mul(E,k),S=b.mul(c,r);s=b.sqr(E),s=b.mul(s,a);let _=b.eql(s,S),A=b.cmov(w,E,_);s=b.sqr(y),s=b.mul(s,a);let M=b.eql(s,c),x=b.cmov(v,o,M),O=b.cmov(A,y,M),I=b.isOdd(O);return O=b.cmov(O,b.neg(O),M!==I),{xMn:x,xMd:i,yMn:O,yMd:u}}(e);let o=b.mul(t,i);o=b.mul(o,A);let s=b.mul(n,r),a=b.sub(t,n),c=b.add(t,n),l=b.mul(s,c),d=b.eql(l,b.ZERO);o=b.cmov(o,b.ZERO,d),s=b.cmov(s,b.ONE,d),a=b.cmov(a,b.ONE,d),c=b.cmov(c,b.ONE,d);const f=b.invertBatch([s,c]);return{x:b.mul(o,f[0]),y:b.mul(a,f[1])}}const x=(()=>(0,i.createHasher)(e.ed25519.ExtendedPoint,(e=>M(e[0])),{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",encodeDST:"edwards25519_XMD:SHA-512_ELL2_NU_",p:b.ORDER,m:1,k:128,expand:"xmd",hash:t.sha512}))();function O(e){if(!(e instanceof $))throw new Error("RistrettoPoint expected")}e.hashToCurve=x.hashToCurve,e.encodeToCurve=x.encodeToCurve;const I=l,R=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),T=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),P=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),N=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),L=e=>v(u,e),D=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),K=t=>e.ed25519.CURVE.Fp.create((0,a.bytesToNumberLE)(t)&D);function B(t){const{d:n}=e.ed25519.CURVE,r=e.ed25519.CURVE.Fp.ORDER,i=e.ed25519.CURVE.Fp.create,s=i(I*t*t),a=i((s+u)*P);let c=BigInt(-1);const l=i((c-n*s)*i(s+n));let{isValid:d,value:h}=v(a,l),f=i(h*t);(0,o.isNegativeLE)(f,r)||(f=i(-f)),d||(h=f),d||(c=s);const p=i(c*(s-u)*N-l),g=h*h,m=i((h+h)*l),y=i(p*R),b=i(u-g),E=i(u+g);return new e.ed25519.ExtendedPoint(i(m*E),i(b*y),i(y*E),i(m*b))}class ${constructor(e){this.ep=e}static fromAffine(t){return new $(e.ed25519.ExtendedPoint.fromAffine(t))}static hashToCurve(e){e=(0,a.ensureBytes)("ristrettoHash",e,64);const t=B(K(e.slice(0,32))),n=B(K(e.slice(32,64)));return new $(t.add(n))}static fromHex(t){t=(0,a.ensureBytes)("ristrettoHex",t,32);const{a:n,d:r}=e.ed25519.CURVE,i=e.ed25519.CURVE.Fp.ORDER,s=e.ed25519.CURVE.Fp.create,c="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",l=K(t);if(!(0,a.equalBytes)((0,a.numberToBytesLE)(l,32),t)||(0,o.isNegativeLE)(l,i))throw new Error(c);const h=s(l*l),f=s(u+n*h),p=s(u-n*h),g=s(f*f),m=s(p*p),y=s(n*r*g-m),{isValid:v,value:b}=L(s(y*m)),E=s(b*p),w=s(b*E*y);let S=s((l+l)*E);(0,o.isNegativeLE)(S,i)&&(S=s(-S));const _=s(f*w),C=s(S*_);if(!v||(0,o.isNegativeLE)(C,i)||_===d)throw new Error(c);return new $(new e.ed25519.ExtendedPoint(S,_,u,C))}toRawBytes(){let{ex:t,ey:n,ez:r,et:i}=this.ep;const s=e.ed25519.CURVE.Fp.ORDER,c=e.ed25519.CURVE.Fp.create,l=c(c(r+n)*c(r-n)),d=c(t*n),u=c(d*d),{value:h}=L(c(l*u)),f=c(h*l),p=c(h*d),g=c(f*p*i);let m;if((0,o.isNegativeLE)(i*g,s)){let e=c(n*I),r=c(t*I);t=e,n=r,m=c(f*T)}else m=p;(0,o.isNegativeLE)(t*g,s)&&(n=c(-n));let y=c((r-n)*m);return(0,o.isNegativeLE)(y,s)&&(y=c(-y)),(0,a.numberToBytesLE)(y,32)}toHex(){return(0,a.bytesToHex)(this.toRawBytes())}toString(){return this.toHex()}equals(t){O(t);const{ex:n,ey:r}=this.ep,{ex:i,ey:o}=t.ep,s=e.ed25519.CURVE.Fp.create,a=s(n*o)===s(r*i),c=s(r*o)===s(n*i);return a||c}add(e){return O(e),new $(this.ep.add(e.ep))}subtract(e){return O(e),new $(this.ep.subtract(e.ep))}multiply(e){return new $(this.ep.multiply(e))}multiplyUnsafe(e){return new $(this.ep.multiplyUnsafe(e))}double(){return new $(this.ep.double())}negate(){return new $(this.ep.negate())}}e.RistrettoPoint=($.BASE||($.BASE=new $(e.ed25519.ExtendedPoint.BASE)),$.ZERO||($.ZERO=new $(e.ed25519.ExtendedPoint.ZERO)),$);e.hashToRistretto255=(e,r)=>{const o=r.DST,s="string"==typeof o?(0,n.utf8ToBytes)(o):o,a=(0,i.expand_message_xmd)(e,s,64,t.sha512);return $.hashToCurve(a)},e.hash_to_ristretto255=e.hashToRistretto255}(B);var rn={},on={};Object.defineProperty(on,"__esModule",{value:!0}),on.sha224=on.sha256=on.SHA256=void 0;const sn=$,an=J,cn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ln=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),dn=new Uint32Array(64);class un extends sn.HashMD{constructor(){super(64,32,8,!1),this.A=0|ln[0],this.B=0|ln[1],this.C=0|ln[2],this.D=0|ln[3],this.E=0|ln[4],this.F=0|ln[5],this.G=0|ln[6],this.H=0|ln[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)dn[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=dn[e-15],n=dn[e-2],r=(0,an.rotr)(t,7)^(0,an.rotr)(t,18)^t>>>3,i=(0,an.rotr)(n,17)^(0,an.rotr)(n,19)^n>>>10;dn[e]=i+dn[e-7]+r+dn[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:l}=this;for(let e=0;e<64;e++){const t=l+((0,an.rotr)(s,6)^(0,an.rotr)(s,11)^(0,an.rotr)(s,25))+(0,sn.Chi)(s,a,c)+cn[e]+dn[e]|0,d=((0,an.rotr)(n,2)^(0,an.rotr)(n,13)^(0,an.rotr)(n,22))+(0,sn.Maj)(n,r,i)|0;l=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+d|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,o,s,a,c,l)}roundClean(){dn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}on.SHA256=un;class hn extends un{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}on.sha256=(0,an.wrapConstructor)((()=>new un)),on.sha224=(0,an.wrapConstructor)((()=>new hn));var fn={},pn={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hmac=e.HMAC=void 0;const t=U,n=J;class r extends n.Hash{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,(0,t.hash)(e);const i=(0,n.toBytes)(r);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?e.create().update(i).digest():i);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),s.fill(0)}update(e){return(0,t.exists)(this),this.iHash.update(e),this}digestInto(e){(0,t.exists)(this),(0,t.bytes)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}e.HMAC=r;e.hmac=(e,t,n)=>new r(e,t).update(n).digest(),e.hmac.create=(e,t)=>new r(e,t)}(pn);var gn={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DER=void 0,e.weierstrassPoints=f,e.weierstrass=function(s){const a=function(e){const n=(0,t.validateBasic)(e);return r.validateObject(n,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...n})}(s),{Fp:d,n:u}=a,h=d.BYTES+1,p=2*d.BYTES+1;function g(e){return n.mod(e,u)}function m(e){return n.invert(e,u)}const{ProjectivePoint:y,normPrivateKeyToScalar:v,weierstrassEquation:b,isWithinCurveOrder:E}=f({...a,toBytes(e,t,n){const o=t.toAffine(),s=d.toBytes(o.x),a=r.concatBytes;return(0,i.abool)("isCompressed",n),n?a(Uint8Array.from([t.hasEvenY()?2:3]),s):a(Uint8Array.from([4]),s,d.toBytes(o.y))},fromBytes(e){const t=e.length,n=e[0],i=e.subarray(1);if(t!==h||2!==n&&3!==n){if(t===p&&4===n){return{x:d.fromBytes(i.subarray(0,d.BYTES)),y:d.fromBytes(i.subarray(d.BYTES,2*d.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${h} compressed bytes or ${p} uncompressed bytes`)}{const e=r.bytesToNumberBE(i);if(!r.inRange(e,l,d.ORDER))throw new Error("Point is not on curve");const t=b(e);let o;try{o=d.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("Point is not on curve"+t)}return 1==(1&n)!==((o&l)===l)&&(o=d.neg(o)),{x:e,y:o}}}}),w=e=>r.bytesToHex(r.numberToBytesBE(e,a.nByteLength));function S(e){return e>u>>l}const _=(e,t,n)=>r.bytesToNumberBE(e.slice(t,n));class C{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const t=a.nByteLength;return e=(0,i.ensureBytes)("compactSignature",e,2*t),new C(_(e,0,t),_(e,t,2*t))}static fromDER(t){const{r:n,s:r}=e.DER.toSig((0,i.ensureBytes)("DER",t));return new C(n,r)}assertValidity(){r.aInRange("r",this.r,l,u),r.aInRange("s",this.s,l,u)}addRecoveryBit(e){return new C(this.r,this.s,e)}recoverPublicKey(e){const{r:t,s:n,recovery:r}=this,o=x((0,i.ensureBytes)("msgHash",e));if(null==r||![0,1,2,3].includes(r))throw new Error("recovery id invalid");const s=2===r||3===r?t+a.n:t;if(s>=d.ORDER)throw new Error("recovery id 2 or 3 invalid");const c=0==(1&r)?"02":"03",l=y.fromHex(c+w(s)),u=m(s),h=g(-o*u),f=g(n*u),p=y.BASE.multiplyAndAddUnsafe(l,h,f);if(!p)throw new Error("point at infinify");return p.assertValidity(),p}hasHighS(){return S(this.s)}normalizeS(){return this.hasHighS()?new C(this.r,g(-this.s),this.recovery):this}toDERRawBytes(){return r.hexToBytes(this.toDERHex())}toDERHex(){return e.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return r.hexToBytes(this.toCompactHex())}toCompactHex(){return w(this.r)+w(this.s)}}const k={isValidPrivateKey(e){try{return v(e),!0}catch(e){return!1}},normPrivateKeyToScalar:v,randomPrivateKey:()=>{const e=n.getMinHashLength(a.n);return n.mapHashToField(a.randomBytes(e),a.n)},precompute:(e=8,t=y.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function A(e){const t=r.isBytes(e),n="string"==typeof e,i=(t||n)&&e.length;return t?i===h||i===p:n?i===2*h||i===2*p:e instanceof y}const M=a.bits2int||function(e){const t=r.bytesToNumberBE(e),n=8*e.length-a.nBitLength;return n>0?t>>BigInt(n):t},x=a.bits2int_modN||function(e){return g(M(e))},O=r.bitMask(a.nBitLength);function I(e){return r.aInRange(`num < 2^${a.nBitLength}`,e,c,O),r.numberToBytesBE(e,a.nByteLength)}function R(e,t,n=T){if(["recovered","canonical"].some((e=>e in n)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:u}=a;let{lowS:h,prehash:f,extraEntropy:p}=n;null==h&&(h=!0),e=(0,i.ensureBytes)("msgHash",e),o(n),f&&(e=(0,i.ensureBytes)("prehashed msgHash",s(e)));const b=x(e),w=v(t),_=[I(w),I(b)];if(null!=p&&!1!==p){const e=!0===p?u(d.BYTES):p;_.push((0,i.ensureBytes)("extraEntropy",e))}const k=r.concatBytes(..._),A=b;return{seed:k,k2sig:function(e){const t=M(e);if(!E(t))return;const n=m(t),r=y.BASE.multiply(t).toAffine(),i=g(r.x);if(i===c)return;const o=g(n*g(A+i*w));if(o===c)return;let s=(r.x===i?0:2)|Number(r.y&l),a=o;return h&&S(o)&&(a=function(e){return S(e)?g(-e):e}(o),s^=1),new C(i,a,s)}}}const T={lowS:a.lowS,prehash:!1},P={lowS:a.lowS,prehash:!1};return y.BASE._setWindowSize(8),{CURVE:a,getPublicKey:function(e,t=!0){return y.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(A(e))throw new Error("first arg must be private key");if(!A(t))throw new Error("second arg must be public key");const r=y.fromHex(t);return r.multiply(v(e)).toRawBytes(n)},sign:function(e,t,n=T){const{seed:i,k2sig:o}=R(e,t,n),s=a,c=r.createHmacDrbg(s.hash.outputLen,s.nByteLength,s.hmac);return c(i,o)},verify:function(t,n,s,c=P){const l=t;if(n=(0,i.ensureBytes)("msgHash",n),s=(0,i.ensureBytes)("publicKey",s),"strict"in c)throw new Error("options.strict was renamed to lowS");o(c);const{lowS:d,prehash:u}=c;let h,f;try{if("string"==typeof l||r.isBytes(l))try{h=C.fromDER(l)}catch(t){if(!(t instanceof e.DER.Err))throw t;h=C.fromCompact(l)}else{if("object"!=typeof l||"bigint"!=typeof l.r||"bigint"!=typeof l.s)throw new Error("PARSE");{const{r:e,s:t}=l;h=new C(e,t)}}f=y.fromHex(s)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(d&&h.hasHighS())return!1;u&&(n=a.hash(n));const{r:p,s:v}=h,b=x(n),E=m(v),w=g(b*E),S=g(p*E),_=y.BASE.multiplyAndAddUnsafe(f,w,S)?.toAffine();if(!_)return!1;const k=g(_.x);return k===p},ProjectivePoint:y,Signature:C,utils:k}},e.SWUFpSqrtRatio=p,e.mapToCurveSimpleSWU=function(e,t){if(n.validateField(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const r=p(e,t.Z);if(!e.isOdd)throw new Error("Fp.isOdd is not implemented!");return n=>{let i,o,s,a,c,l,d,u;i=e.sqr(n),i=e.mul(i,t.Z),o=e.sqr(i),o=e.add(o,i),s=e.add(o,e.ONE),s=e.mul(s,t.B),a=e.cmov(t.Z,e.neg(o),!e.eql(o,e.ZERO)),a=e.mul(a,t.A),o=e.sqr(s),l=e.sqr(a),c=e.mul(l,t.A),o=e.add(o,c),o=e.mul(o,s),l=e.mul(l,a),c=e.mul(l,t.B),o=e.add(o,c),d=e.mul(i,s);const{isValid:h,value:f}=r(o,l);u=e.mul(i,n),u=e.mul(u,f),d=e.cmov(d,s,h),u=e.cmov(u,f,h);const p=e.isOdd(n)===e.isOdd(u);return u=e.cmov(e.neg(u),u,p),d=e.div(d,a),{x:d,y:u}}};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const t=je,n=$e,r=Ue,i=Ue;function o(e){void 0!==e.lowS&&(0,i.abool)("lowS",e.lowS),void 0!==e.prehash&&(0,i.abool)("prehash",e.prehash)}const{bytesToNumberBE:s,hexToBytes:a}=r;e.DER={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(t,n)=>{const{Err:i}=e.DER;if(t<0||t>256)throw new i("tlv.encode: wrong tag");if(1&n.length)throw new i("tlv.encode: unpadded data");const o=n.length/2,s=r.numberToHexUnpadded(o);if(s.length/2&128)throw new i("tlv.encode: long form length too big");const a=o>127?r.numberToHexUnpadded(s.length/2|128):"";return`${r.numberToHexUnpadded(t)}${a}${s}${n}`},decode(t,n){const{Err:r}=e.DER;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(n.length<2||n[i++]!==t)throw new r("tlv.decode: wrong tlv");const o=n[i++];let s=0;if(!!(128&o)){const e=127&o;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");const t=n.subarray(i,i+e);if(t.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===t[0])throw new r("tlv.decode(long): zero leftmost byte");for(const e of t)s=s<<8|e;if(i+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=o;const a=n.subarray(i,i+s);if(a.length!==s)throw new r("tlv.decode: wrong value length");return{v:a,l:n.subarray(i+s)}}},_int:{encode(t){const{Err:n}=e.DER;if(t<c)throw new n("integer: negative integers are not allowed");let i=r.numberToHexUnpadded(t);if(8&Number.parseInt(i[0],16)&&(i="00"+i),1&i.length)throw new n("unexpected assertion");return i},decode(t){const{Err:n}=e.DER;if(128&t[0])throw new n("Invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new n("Invalid signature integer: unnecessary leading zero");return s(t)}},toSig(t){const{Err:n,_int:i,_tlv:o}=e.DER,s="string"==typeof t?a(t):t;r.abytes(s);const{v:c,l:l}=o.decode(48,s);if(l.length)throw new n("Invalid signature: left bytes after parsing");const{v:d,l:u}=o.decode(2,c),{v:h,l:f}=o.decode(2,u);if(f.length)throw new n("Invalid signature: left bytes after parsing");return{r:i.decode(d),s:i.decode(h)}},hexFromSig(t){const{_tlv:n,_int:r}=e.DER,i=`${n.encode(2,r.encode(t.r))}${n.encode(2,r.encode(t.s))}`;return n.encode(48,i)}};const c=BigInt(0),l=BigInt(1),d=BigInt(2),u=BigInt(3),h=BigInt(4);function f(e){const o=function(e){const n=(0,t.validateBasic)(e);r.validateObject(n,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:i,Fp:o,a:s}=n;if(i){if(!o.eql(s,o.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof i||"bigint"!=typeof i.beta||"function"!=typeof i.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...n})}(e),{Fp:s}=o,a=n.Field(o.n,o.nBitLength),d=o.toBytes||((e,t,n)=>{const i=t.toAffine();return r.concatBytes(Uint8Array.from([4]),s.toBytes(i.x),s.toBytes(i.y))}),h=o.fromBytes||(e=>{const t=e.subarray(1);return{x:s.fromBytes(t.subarray(0,s.BYTES)),y:s.fromBytes(t.subarray(s.BYTES,2*s.BYTES))}});function f(e){const{a:t,b:n}=o,r=s.sqr(e),i=s.mul(r,e);return s.add(s.add(i,s.mul(e,t)),n)}if(!s.eql(s.sqr(o.Gy),f(o.Gx)))throw new Error("bad generator point: equation left != right");function p(e){const{allowedPrivateKeyLengths:t,nByteLength:s,wrapPrivateKey:a,n:c}=o;if(t&&"bigint"!=typeof e){if(r.isBytes(e)&&(e=r.bytesToHex(e)),"string"!=typeof e||!t.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*s,"0")}let d;try{d="bigint"==typeof e?e:r.bytesToNumberBE((0,i.ensureBytes)("private key",e,s))}catch(t){throw new Error(`private key must be ${s} bytes, hex or bigint, not ${typeof e}`)}return a&&(d=n.mod(d,c)),r.aInRange("private key",d,l,c),d}function g(e){if(!(e instanceof v))throw new Error("ProjectivePoint expected")}const m=(0,i.memoized)(((e,t)=>{const{px:n,py:r,pz:i}=e;if(s.eql(i,s.ONE))return{x:n,y:r};const o=e.is0();null==t&&(t=o?s.ONE:s.inv(i));const a=s.mul(n,t),c=s.mul(r,t),l=s.mul(i,t);if(o)return{x:s.ZERO,y:s.ZERO};if(!s.eql(l,s.ONE))throw new Error("invZ was invalid");return{x:a,y:c}})),y=(0,i.memoized)((e=>{if(e.is0()){if(o.allowInfinityPoint&&!s.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:t,y:n}=e.toAffine();if(!s.isValid(t)||!s.isValid(n))throw new Error("bad point: x or y not FE");const r=s.sqr(n),i=f(t);if(!s.eql(r,i))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));class v{constructor(e,t,n){if(this.px=e,this.py=t,this.pz=n,null==e||!s.isValid(e))throw new Error("x required");if(null==t||!s.isValid(t))throw new Error("y required");if(null==n||!s.isValid(n))throw new Error("z required");Object.freeze(this)}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!s.isValid(t)||!s.isValid(n))throw new Error("invalid affine point");if(e instanceof v)throw new Error("projective point not allowed");const r=e=>s.eql(e,s.ZERO);return r(t)&&r(n)?v.ZERO:new v(t,n,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=s.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(v.fromAffine)}static fromHex(e){const t=v.fromAffine(h((0,i.ensureBytes)("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return v.BASE.multiply(p(e))}static msm(e,n){return(0,t.pippenger)(v,a,e,n)}_setWindowSize(e){E.setWindowSize(this,e)}assertValidity(){y(this)}hasEvenY(){const{y:e}=this.toAffine();if(s.isOdd)return!s.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){g(e);const{px:t,py:n,pz:r}=this,{px:i,py:o,pz:a}=e,c=s.eql(s.mul(t,a),s.mul(i,r)),l=s.eql(s.mul(n,a),s.mul(o,r));return c&&l}negate(){return new v(this.px,s.neg(this.py),this.pz)}double(){const{a:e,b:t}=o,n=s.mul(t,u),{px:r,py:i,pz:a}=this;let c=s.ZERO,l=s.ZERO,d=s.ZERO,h=s.mul(r,r),f=s.mul(i,i),p=s.mul(a,a),g=s.mul(r,i);return g=s.add(g,g),d=s.mul(r,a),d=s.add(d,d),c=s.mul(e,d),l=s.mul(n,p),l=s.add(c,l),c=s.sub(f,l),l=s.add(f,l),l=s.mul(c,l),c=s.mul(g,c),d=s.mul(n,d),p=s.mul(e,p),g=s.sub(h,p),g=s.mul(e,g),g=s.add(g,d),d=s.add(h,h),h=s.add(d,h),h=s.add(h,p),h=s.mul(h,g),l=s.add(l,h),p=s.mul(i,a),p=s.add(p,p),h=s.mul(p,g),c=s.sub(c,h),d=s.mul(p,f),d=s.add(d,d),d=s.add(d,d),new v(c,l,d)}add(e){g(e);const{px:t,py:n,pz:r}=this,{px:i,py:a,pz:c}=e;let l=s.ZERO,d=s.ZERO,h=s.ZERO;const f=o.a,p=s.mul(o.b,u);let m=s.mul(t,i),y=s.mul(n,a),b=s.mul(r,c),E=s.add(t,n),w=s.add(i,a);E=s.mul(E,w),w=s.add(m,y),E=s.sub(E,w),w=s.add(t,r);let S=s.add(i,c);return w=s.mul(w,S),S=s.add(m,b),w=s.sub(w,S),S=s.add(n,r),l=s.add(a,c),S=s.mul(S,l),l=s.add(y,b),S=s.sub(S,l),h=s.mul(f,w),l=s.mul(p,b),h=s.add(l,h),l=s.sub(y,h),h=s.add(y,h),d=s.mul(l,h),y=s.add(m,m),y=s.add(y,m),b=s.mul(f,b),w=s.mul(p,w),y=s.add(y,b),b=s.sub(m,b),b=s.mul(f,b),w=s.add(w,b),m=s.mul(y,w),d=s.add(d,m),m=s.mul(S,w),l=s.mul(E,l),l=s.sub(l,m),m=s.mul(E,y),h=s.mul(S,h),h=s.add(h,m),new v(l,d,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(v.ZERO)}wNAF(e){return E.wNAFCached(this,e,v.normalizeZ)}multiplyUnsafe(e){r.aInRange("scalar",e,c,o.n);const t=v.ZERO;if(e===c)return t;if(e===l)return this;const{endo:n}=o;if(!n)return E.unsafeLadder(this,e);let{k1neg:i,k1:a,k2neg:d,k2:u}=n.splitScalar(e),h=t,f=t,p=this;for(;a>c||u>c;)a&l&&(h=h.add(p)),u&l&&(f=f.add(p)),p=p.double(),a>>=l,u>>=l;return i&&(h=h.negate()),d&&(f=f.negate()),f=new v(s.mul(f.px,n.beta),f.py,f.pz),h.add(f)}multiply(e){const{endo:t,n:n}=o;let i,a;if(r.aInRange("scalar",e,l,n),t){const{k1neg:n,k1:r,k2neg:o,k2:c}=t.splitScalar(e);let{p:l,f:d}=this.wNAF(r),{p:u,f:h}=this.wNAF(c);l=E.constTimeNegate(n,l),u=E.constTimeNegate(o,u),u=new v(s.mul(u.px,t.beta),u.py,u.pz),i=l.add(u),a=d.add(h)}else{const{p:t,f:n}=this.wNAF(e);i=t,a=n}return v.normalizeZ([i,a])[0]}multiplyAndAddUnsafe(e,t,n){const r=v.BASE,i=(e,t)=>t!==c&&t!==l&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){return m(this,e)}isTorsionFree(){const{h:e,isTorsionFree:t}=o;if(e===l)return!0;if(t)return t(v,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:t}=o;return e===l?this:t?t(v,this):this.multiplyUnsafe(o.h)}toRawBytes(e=!0){return(0,i.abool)("isCompressed",e),this.assertValidity(),d(v,this,e)}toHex(e=!0){return(0,i.abool)("isCompressed",e),r.bytesToHex(this.toRawBytes(e))}}v.BASE=new v(o.Gx,o.Gy,s.ONE),v.ZERO=new v(s.ZERO,s.ONE,s.ZERO);const b=o.nBitLength,E=(0,t.wNAF)(v,o.endo?Math.ceil(b/2):b);return{CURVE:o,ProjectivePoint:v,normPrivateKeyToScalar:p,weierstrassEquation:f,isWithinCurveOrder:function(e){return r.inRange(e,l,o.n)}}}function p(e,t){const n=e.ORDER;let r=c;for(let e=n-l;e%d===c;e/=d)r+=l;const i=r,o=d<<i-l-l,s=o*d,a=(n-l)/s,f=(a-l)/d,p=s-l,g=o,m=e.pow(t,a),y=e.pow(t,(a+l)/d);let v=(t,n)=>{let r=m,o=e.pow(n,p),s=e.sqr(o);s=e.mul(s,n);let a=e.mul(t,s);a=e.pow(a,f),a=e.mul(a,o),o=e.mul(a,n),s=e.mul(a,t);let c=e.mul(s,o);a=e.pow(c,g);let u=e.eql(a,e.ONE);o=e.mul(s,y),a=e.mul(c,r),s=e.cmov(o,s,u),c=e.cmov(a,c,u);for(let t=i;t>l;t--){let n=t-d;n=d<<n-l;let i=e.pow(c,n);const a=e.eql(i,e.ONE);o=e.mul(s,r),r=e.mul(r,r),i=e.mul(c,r),s=e.cmov(o,s,a),c=e.cmov(i,c,a)}return{isValid:u,value:s}};if(e.ORDER%h===u){const n=(e.ORDER-u)/h,r=e.sqrt(e.neg(t));v=(t,i)=>{let o=e.sqr(i);const s=e.mul(t,i);o=e.mul(o,s);let a=e.pow(o,n);a=e.mul(a,s);const c=e.mul(a,r),l=e.mul(e.sqr(a),i),d=e.eql(l,t);return{isValid:d,value:e.cmov(c,a,d)}}}return v}}(gn),Object.defineProperty(fn,"__esModule",{value:!0}),fn.getHash=bn,fn.createCurve=function(e,t){const n=t=>(0,vn.weierstrass)({...e,...bn(t)});return Object.freeze({...n(t),create:n})};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const mn=pn,yn=J,vn=gn;function bn(e){return{hash:e,hmac:(t,...n)=>(0,mn.hmac)(e,t,(0,yn.concatBytes)(...n)),randomBytes:yn.randomBytes}}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.encodeToCurve=e.hashToCurve=e.schnorr=e.secp256k1=void 0;
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const t=on,n=J,r=fn,i=Ht,o=$e,s=Ue,a=gn,c=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),l=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),d=BigInt(1),u=BigInt(2),h=(e,t)=>(e+t/u)/t;function f(e){const t=c,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),a=BigInt(23),l=BigInt(44),d=BigInt(88),h=e*e*e%t,f=h*h*e%t,g=(0,o.pow2)(f,n,t)*f%t,m=(0,o.pow2)(g,n,t)*f%t,y=(0,o.pow2)(m,u,t)*h%t,v=(0,o.pow2)(y,i,t)*y%t,b=(0,o.pow2)(v,s,t)*v%t,E=(0,o.pow2)(b,l,t)*b%t,w=(0,o.pow2)(E,d,t)*E%t,S=(0,o.pow2)(w,l,t)*b%t,_=(0,o.pow2)(S,n,t)*f%t,C=(0,o.pow2)(_,a,t)*v%t,k=(0,o.pow2)(C,r,t)*h%t,A=(0,o.pow2)(k,u,t);if(!p.eql(p.sqr(A),e))throw new Error("Cannot find square root");return A}const p=(0,o.Field)(c,void 0,void 0,{sqrt:f});e.secp256k1=(0,r.createCurve)({a:BigInt(0),b:BigInt(7),Fp:p,n:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=l,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-d*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,a=BigInt("0x100000000000000000000000000000000"),c=h(s*e,t),u=h(-r*e,t);let f=(0,o.mod)(e-c*n-u*i,t),p=(0,o.mod)(-c*r-u*s,t);const g=f>a,m=p>a;if(g&&(f=t-f),m&&(p=t-p),f>a||p>a)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:g,k1:f,k2neg:m,k2:p}}}},t.sha256);const g=BigInt(0),m={};function y(e,...n){let r=m[e];if(void 0===r){const n=(0,t.sha256)(Uint8Array.from(e,(e=>e.charCodeAt(0))));r=(0,s.concatBytes)(n,n),m[e]=r}return(0,t.sha256)((0,s.concatBytes)(r,...n))}const v=e=>e.toRawBytes(!0).slice(1),b=e=>(0,s.numberToBytesBE)(e,32),E=e=>(0,o.mod)(e,c),w=e=>(0,o.mod)(e,l),S=e.secp256k1.ProjectivePoint,_=(e,t,n)=>S.BASE.multiplyAndAddUnsafe(e,t,n);function C(t){let n=e.secp256k1.utils.normPrivateKeyToScalar(t),r=S.fromPrivateKey(n);return{scalar:r.hasEvenY()?n:w(-n),bytes:v(r)}}function k(e){(0,s.aInRange)("x",e,d,c);const t=E(e*e);let n=f(E(t*e+BigInt(7)));n%u!==g&&(n=E(-n));const r=new S(e,n,d);return r.assertValidity(),r}const A=s.bytesToNumberBE;function M(...e){return w(A(y("BIP0340/challenge",...e)))}function x(e){return C(e).bytes}function O(e,t,r=(0,n.randomBytes)(32)){const i=(0,s.ensureBytes)("message",e),{bytes:o,scalar:a}=C(t),c=(0,s.ensureBytes)("auxRand",r,32),l=b(a^A(y("BIP0340/aux",c))),d=y("BIP0340/nonce",l,o,i),u=w(A(d));if(u===g)throw new Error("sign failed: k is zero");const{bytes:h,scalar:f}=C(u),p=M(h,o,i),m=new Uint8Array(64);if(m.set(h,0),m.set(b(w(f+p*a)),32),!I(m,i,o))throw new Error("sign: Invalid signature produced");return m}function I(e,t,n){const r=(0,s.ensureBytes)("signature",e,64),i=(0,s.ensureBytes)("message",t),o=(0,s.ensureBytes)("publicKey",n,32);try{const e=k(A(o)),t=A(r.subarray(0,32));if(!(0,s.inRange)(t,d,c))return!1;const n=A(r.subarray(32,64));if(!(0,s.inRange)(n,d,l))return!1;const a=M(b(t),v(e),i),u=_(e,n,w(-a));return!(!u||!u.hasEvenY()||u.toAffine().x!==t)}catch(e){return!1}}e.schnorr={getPublicKey:x,sign:O,verify:I,utils:{randomPrivateKey:e.secp256k1.utils.randomPrivateKey,lift_x:k,pointToBytes:v,numberToBytesBE:s.numberToBytesBE,bytesToNumberBE:s.bytesToNumberBE,taggedHash:y,mod:o.mod}};const R=(()=>(0,i.isogenyMap)(p,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map((e=>e.map((e=>BigInt(e)))))))(),T=(()=>(0,a.mapToCurveSimpleSWU)(p,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:p.create(BigInt("-11"))}))(),P=(()=>(0,i.createHasher)(e.secp256k1.ProjectivePoint,(e=>{const{x:t,y:n}=T(p.create(e[0]));return R(t,n)}),{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:p.ORDER,m:1,k:128,expand:"xmd",hash:t.sha256}))();e.hashToCurve=P.hashToCurve,e.encodeToCurve=P.encodeToCurve}(rn);var En={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decodeHex=e.remove0x=void 0;var t=b;e.remove0x=function(e){return e.startsWith("0x")||e.startsWith("0X")?e.slice(2):e};e.decodeHex=function(n){return(0,t.hexToBytes)((0,e.remove0x)(n))}}(En),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hexToPublicKey=e.convertPublicKeyFormat=e.getSharedPoint=e.getPublicKey=e.isValidPrivateKey=e.getValidSecret=void 0;var t=L,n=B,r=rn,i=O,o=I,s=En;e.getValidSecret=function(){var n;do{n=(0,t.randomBytes)(o.SECRET_KEY_LENGTH)}while(!(0,e.isValidPrivateKey)(n));return n};e.isValidPrivateKey=function(e){return a((0,i.ellipticCurve)(),(function(t){return t.utils.isValidPrivateKey(e)}),(function(){return!0}),(function(){return!0}))};e.getPublicKey=function(e){return a((0,i.ellipticCurve)(),(function(t){return t.getPublicKey(e)}),(function(t){return t.getPublicKey(e)}),(function(t){return t.getPublicKey(e)}))};e.getSharedPoint=function(e,t,n){return a((0,i.ellipticCurve)(),(function(r){return r.getSharedSecret(e,t,n)}),(function(n){return n.getSharedSecret(e,t)}),(function(n){return l(n,e,t)}))};e.convertPublicKeyFormat=function(e,t){return a((0,i.ellipticCurve)(),(function(n){return n.getSharedSecret(BigInt(1),e,t)}),(function(){return e}),(function(){return e}))};function a(e,t,i,o){if("secp256k1"===e)return t(r.secp256k1);if("x25519"===e)return i(n.x25519);if("ed25519"===e)return o(n.ed25519);throw new Error("Not implemented")}e.hexToPublicKey=function(e){var t=(0,s.decodeHex)(e);return a((0,i.ellipticCurve)(),(function(){return c(t)}),(function(){return t}),(function(){return t}))};var c=function(e){if(e.length===o.ETH_PUBLIC_KEY_SIZE){var t=new Uint8Array(1+e.length);return t.set([4]),t.set(e,1),t}return e},l=function(e,t,n){var r=e.utils.getExtendedPublicKey(t).scalar;return e.ExtendedPoint.fromHex(n).multiply(r).toRawBytes()}}(N);var wn={},Sn={};Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.hkdf=void 0,Sn.extract=An,Sn.expand=On;const _n=U,Cn=J,kn=pn;function An(e,t,n){return(0,_n.hash)(e),void 0===n&&(n=new Uint8Array(e.outputLen)),(0,kn.hmac)(e,(0,Cn.toBytes)(n),(0,Cn.toBytes)(t))}const Mn=new Uint8Array([0]),xn=new Uint8Array;function On(e,t,n,r=32){if((0,_n.hash)(e),(0,_n.number)(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);void 0===n&&(n=xn);const o=new Uint8Array(i*e.outputLen),s=kn.hmac.create(e,t),a=s._cloneInto(),c=new Uint8Array(s.outputLen);for(let t=0;t<i;t++)Mn[0]=t+1,a.update(0===t?xn:c).update(n).update(Mn).digestInto(c),o.set(c,e.outputLen*t),s._cloneInto(a);return s.destroy(),a.destroy(),c.fill(0),Mn.fill(0),o.slice(0,r)}Sn.hkdf=(e,t,n,r,i)=>On(e,An(e,t,n),r,i),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSharedKey=e.deriveKey=void 0;var t=b,n=Sn,r=on;e.deriveKey=function(e,t,i){return(0,n.hkdf)(r.sha256,e,t,i,32)};e.getSharedKey=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return(0,e.deriveKey)(t.concatBytes.apply(void 0,n))}}(wn);var In={},Rn={},Tn={},Pn={};Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.polyval=Pn.ghash=void 0,Pn._toGHASHKey=$n;const Nn=E,Ln=b,Dn=16,Kn=new Uint8Array(16),Bn=(0,Ln.u32)(Kn),jn=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function $n(e){e.reverse();const t=1&e[15];let n=0;for(let t=0;t<e.length;t++){const r=e[t];e[t]=r>>>1|n,n=(1&r)<<7}return e[0]^=225&-t,e}class Un{constructor(e,t){this.blockLen=Dn,this.outputLen=Dn,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=(0,Ln.toBytes)(e),(0,Nn.bytes)(e,16);const n=(0,Ln.createView)(e);let r=n.getUint32(0,!1),i=n.getUint32(4,!1),o=n.getUint32(8,!1),s=n.getUint32(12,!1);const a=[];for(let e=0;e<128;e++)a.push({s0:jn(r),s1:jn(i),s2:jn(o),s3:jn(s)}),({s0:r,s1:i,s2:o,s3:s}={s3:(d=o)<<31|(u=s)>>>1,s2:(l=i)<<31|d>>>1,s1:(c=r)<<31|l>>>1,s0:c>>>1^225<<24&-(1&u)});var c,l,d,u;const h=(e=>e>65536?8:e>1024?4:2)(t||1024);if(![1,2,4,8].includes(h))throw new Error(`ghash: wrong window size=${h}, should be 2, 4 or 8`);this.W=h;const f=128/h,p=this.windowSize=2**h,g=[];for(let e=0;e<f;e++)for(let t=0;t<p;t++){let n=0,r=0,i=0,o=0;for(let s=0;s<h;s++){if(!(t>>>h-s-1&1))continue;const{s0:c,s1:l,s2:d,s3:u}=a[h*e+s];n^=c,r^=l,i^=d,o^=u}g.push({s0:n,s1:r,s2:i,s3:o})}this.t=g}_updateBlock(e,t,n,r){e^=this.s0,t^=this.s1,n^=this.s2,r^=this.s3;const{W:i,t:o,windowSize:s}=this;let a=0,c=0,l=0,d=0;const u=(1<<i)-1;let h=0;for(const f of[e,t,n,r])for(let e=0;e<4;e++){const t=f>>>8*e&255;for(let e=8/i-1;e>=0;e--){const n=t>>>i*e&u,{s0:r,s1:f,s2:p,s3:g}=o[h*s+n];a^=r,c^=f,l^=p,d^=g,h+=1}}this.s0=a,this.s1=c,this.s2=l,this.s3=d}update(e){e=(0,Ln.toBytes)(e),(0,Nn.exists)(this);const t=(0,Ln.u32)(e),n=Math.floor(e.length/Dn),r=e.length%Dn;for(let e=0;e<n;e++)this._updateBlock(t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]);return r&&(Kn.set(e.subarray(n*Dn)),this._updateBlock(Bn[0],Bn[1],Bn[2],Bn[3]),(0,Ln.clean)(Bn)),this}destroy(){const{t:e}=this;for(const t of e)t.s0=0,t.s1=0,t.s2=0,t.s3=0}digestInto(e){(0,Nn.exists)(this),(0,Nn.output)(e,this),this.finished=!0;const{s0:t,s1:n,s2:r,s3:i}=this,o=(0,Ln.u32)(e);return o[0]=t,o[1]=n,o[2]=r,o[3]=i,e}digest(){const e=new Uint8Array(Dn);return this.digestInto(e),this.destroy(),e}}class Hn extends Un{constructor(e,t){e=(0,Ln.toBytes)(e);const n=$n((0,Ln.copyBytes)(e));super(n,t),(0,Ln.clean)(n)}update(e){e=(0,Ln.toBytes)(e),(0,Nn.exists)(this);const t=(0,Ln.u32)(e),n=e.length%Dn,r=Math.floor(e.length/Dn);for(let e=0;e<r;e++)this._updateBlock(jn(t[4*e+3]),jn(t[4*e+2]),jn(t[4*e+1]),jn(t[4*e+0]));return n&&(Kn.set(e.subarray(r*Dn)),this._updateBlock(jn(Bn[3]),jn(Bn[2]),jn(Bn[1]),jn(Bn[0])),(0,Ln.clean)(Bn)),this}digestInto(e){(0,Nn.exists)(this),(0,Nn.output)(e,this),this.finished=!0;const{s0:t,s1:n,s2:r,s3:i}=this,o=(0,Ln.u32)(e);return o[0]=t,o[1]=n,o[2]=r,o[3]=i,e.reverse()}}function Fn(e){const t=(t,n)=>e(n,t.length).update((0,Ln.toBytes)(t)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(t,n)=>e(t,n),t}Pn.ghash=Fn(((e,t)=>new Un(e,t))),Pn.polyval=Fn(((e,t)=>new Hn(e,t))),Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.unsafe=Tn.aeskwp=Tn.aeskw=Tn.siv=Tn.gcm=Tn.cfb=Tn.cbc=Tn.ecb=Tn.ctr=void 0,Tn.expandKeyLE=ar,Tn.expandKeyDecLE=cr;const zn=E,qn=Pn,Wn=b,Vn=16,Gn=new Uint8Array(Vn),Yn=283;function Jn(e){return e<<1^Yn&-(e>>7)}function Zn(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(1&t),e=Jn(e);return n}const Xn=(()=>{const e=new Uint8Array(256);for(let t=0,n=1;t<256;t++,n^=Jn(n))e[t]=n;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return(0,Wn.clean)(e),t})(),Qn=Xn.map(((e,t)=>Xn.indexOf(t))),er=e=>e<<24|e>>>8,tr=e=>e<<8|e>>>24,nr=e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255;function rr(e,t){if(256!==e.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>t(e[r]))),r=n.map(tr),i=r.map(tr),o=i.map(tr),s=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let t=0;t<256;t++)for(let l=0;l<256;l++){const d=256*t+l;s[d]=n[t]^r[l],a[d]=i[t]^o[l],c[d]=e[t]<<8|e[l]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:i,T3:o,T01:s,T23:a}}const ir=rr(Xn,(e=>Zn(e,3)<<24|e<<16|e<<8|Zn(e,2))),or=rr(Qn,(e=>Zn(e,11)<<24|Zn(e,13)<<16|Zn(e,9)<<8|Zn(e,14))),sr=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=Jn(n))e[t]=n;return e})();function ar(e){(0,zn.bytes)(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=ir,r=[];(0,Wn.isAligned32)(e)||r.push(e=(0,Wn.copyBytes)(e));const i=(0,Wn.u32)(e),o=i.length,s=e=>dr(n,e,e,e,e),a=new Uint32Array(t+28);a.set(i);for(let e=o;e<a.length;e++){let t=a[e-1];e%o==0?t=s(er(t))^sr[e/o-1]:o>6&&e%o==4&&(t=s(t)),a[e]=a[e-o]^t}return(0,Wn.clean)(...r),a}function cr(e){const t=ar(e),n=t.slice(),r=t.length,{sbox2:i}=ir,{T0:o,T1:s,T2:a,T3:c}=or;for(let e=0;e<r;e+=4)for(let i=0;i<4;i++)n[e+i]=t[r-e-4+i];(0,Wn.clean)(t);for(let e=4;e<r-4;e++){const t=n[e],r=dr(i,t,t,t,t);n[e]=o[255&r]^s[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}function lr(e,t,n,r,i,o){return e[n<<8&65280|r>>>8&255]^t[i>>>8&65280|o>>>24&255]}function dr(e,t,n,r,i){return e[255&t|65280&n]|e[r>>>16&255|i>>>16&65280]<<16}function ur(e,t,n,r,i){const{sbox2:o,T01:s,T23:a}=ir;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const l=e.length/4-2;for(let o=0;o<l;o++){const o=e[c++]^lr(s,a,t,n,r,i),l=e[c++]^lr(s,a,n,r,i,t),d=e[c++]^lr(s,a,r,i,t,n),u=e[c++]^lr(s,a,i,t,n,r);t=o,n=l,r=d,i=u}return{s0:e[c++]^dr(o,t,n,r,i),s1:e[c++]^dr(o,n,r,i,t),s2:e[c++]^dr(o,r,i,t,n),s3:e[c++]^dr(o,i,t,n,r)}}function hr(e,t,n,r,i){const{sbox2:o,T01:s,T23:a}=or;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const l=e.length/4-2;for(let o=0;o<l;o++){const o=e[c++]^lr(s,a,t,i,r,n),l=e[c++]^lr(s,a,n,t,i,r),d=e[c++]^lr(s,a,r,n,t,i),u=e[c++]^lr(s,a,i,r,n,t);t=o,n=l,r=d,i=u}return{s0:e[c++]^dr(o,t,i,r,n),s1:e[c++]^dr(o,n,t,i,r),s2:e[c++]^dr(o,r,n,t,i),s3:e[c++]^dr(o,i,r,n,t)}}function fr(e,t){if(void 0===t)return new Uint8Array(e);if((0,zn.bytes)(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);if(!(0,Wn.isAligned32)(t))throw new Error("unaligned dst");return t}function pr(e,t,n,r){(0,zn.bytes)(t,Vn),(0,zn.bytes)(n);const i=n.length;r=fr(i,r);const o=t,s=(0,Wn.u32)(o);let{s0:a,s1:c,s2:l,s3:d}=ur(e,s[0],s[1],s[2],s[3]);const u=(0,Wn.u32)(n),h=(0,Wn.u32)(r);for(let t=0;t+4<=u.length;t+=4){h[t+0]=u[t+0]^a,h[t+1]=u[t+1]^c,h[t+2]=u[t+2]^l,h[t+3]=u[t+3]^d;let n=1;for(let e=o.length-1;e>=0;e--)n=n+(255&o[e])|0,o[e]=255&n,n>>>=8;({s0:a,s1:c,s2:l,s3:d}=ur(e,s[0],s[1],s[2],s[3]))}const f=Vn*Math.floor(u.length/4);if(f<i){const e=new Uint32Array([a,c,l,d]),t=(0,Wn.u8)(e);for(let e=f,o=0;e<i;e++,o++)r[e]=n[e]^t[o];(0,Wn.clean)(e)}return r}function gr(e,t,n,r,i){(0,zn.bytes)(n,Vn),(0,zn.bytes)(r),i=fr(r.length,i);const o=n,s=(0,Wn.u32)(o),a=(0,Wn.createView)(o),c=(0,Wn.u32)(r),l=(0,Wn.u32)(i),d=t?0:12,u=r.length;let h=a.getUint32(d,t),{s0:f,s1:p,s2:g,s3:m}=ur(e,s[0],s[1],s[2],s[3]);for(let n=0;n+4<=c.length;n+=4)l[n+0]=c[n+0]^f,l[n+1]=c[n+1]^p,l[n+2]=c[n+2]^g,l[n+3]=c[n+3]^m,h=h+1>>>0,a.setUint32(d,h,t),({s0:f,s1:p,s2:g,s3:m}=ur(e,s[0],s[1],s[2],s[3]));const y=Vn*Math.floor(c.length/4);if(y<u){const e=new Uint32Array([f,p,g,m]),t=(0,Wn.u8)(e);for(let e=y,n=0;e<u;e++,n++)i[e]=r[e]^t[n];(0,Wn.clean)(e)}return i}function mr(e){if((0,zn.bytes)(e),e.length%Vn!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function yr(e,t,n){(0,zn.bytes)(e);let r=e.length;const i=r%Vn;if(!t&&0!==i)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");(0,Wn.isAligned32)(e)||(e=(0,Wn.copyBytes)(e));const o=(0,Wn.u32)(e);if(t){let e=Vn-i;e||(e=Vn),r+=e}const s=fr(r,n);return{b:o,o:(0,Wn.u32)(s),out:s}}function vr(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error("aes/pcks5: wrong padding");const i=e.subarray(0,-r);for(let t=0;t<r;t++)if(e[n-t-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function br(e){const t=new Uint8Array(16),n=(0,Wn.u32)(t);t.set(e);const r=Vn-e.length;for(let e=Vn-r;e<Vn;e++)t[e]=r;return n}function Er(e,t,n,r,i){const o=null==i?0:i.length,s=e.create(n,r.length+o);i&&s.update(i),s.update(r);const a=new Uint8Array(16),c=(0,Wn.createView)(a);i&&(0,Wn.setBigUint64)(c,0,BigInt(8*o),t),(0,Wn.setBigUint64)(c,8,BigInt(8*r.length),t),s.update(a);const l=s.digest();return(0,Wn.clean)(a),l}Tn.ctr=(0,Wn.wrapCipher)({blockSize:16,nonceLength:16},(function(e,t){function n(n,r){if((0,zn.bytes)(n),void 0!==r&&((0,zn.bytes)(r),!(0,Wn.isAligned32)(r)))throw new Error("unaligned destination");const i=ar(e),o=(0,Wn.copyBytes)(t),s=[i,o];(0,Wn.isAligned32)(n)||s.push(n=(0,Wn.copyBytes)(n));const a=pr(i,o,n,r);return(0,Wn.clean)(...s),a}return(0,zn.bytes)(e),(0,zn.bytes)(t,Vn),{encrypt:(e,t)=>n(e,t),decrypt:(e,t)=>n(e,t)}})),Tn.ecb=(0,Wn.wrapCipher)({blockSize:16},(function(e,t={}){(0,zn.bytes)(e);const n=!t.disablePadding;return{encrypt(t,r){const{b:i,o:o,out:s}=yr(t,n,r),a=ar(e);let c=0;for(;c+4<=i.length;){const{s0:e,s1:t,s2:n,s3:r}=ur(a,i[c+0],i[c+1],i[c+2],i[c+3]);o[c++]=e,o[c++]=t,o[c++]=n,o[c++]=r}if(n){const e=br(t.subarray(4*c)),{s0:n,s1:r,s2:i,s3:s}=ur(a,e[0],e[1],e[2],e[3]);o[c++]=n,o[c++]=r,o[c++]=i,o[c++]=s}return(0,Wn.clean)(a),s},decrypt(t,r){mr(t);const i=cr(e),o=fr(t.length,r),s=[i];(0,Wn.isAligned32)(t)||s.push(t=(0,Wn.copyBytes)(t));const a=(0,Wn.u32)(t),c=(0,Wn.u32)(o);for(let e=0;e+4<=a.length;){const{s0:t,s1:n,s2:r,s3:o}=hr(i,a[e+0],a[e+1],a[e+2],a[e+3]);c[e++]=t,c[e++]=n,c[e++]=r,c[e++]=o}return(0,Wn.clean)(...s),vr(o,n)}}})),Tn.cbc=(0,Wn.wrapCipher)({blockSize:16,nonceLength:16},(function(e,t,n={}){(0,zn.bytes)(e),(0,zn.bytes)(t,16);const r=!n.disablePadding;return{encrypt(n,i){const o=ar(e),{b:s,o:a,out:c}=yr(n,r,i);let l=t;const d=[o];(0,Wn.isAligned32)(l)||d.push(l=(0,Wn.copyBytes)(l));const u=(0,Wn.u32)(l);let h=u[0],f=u[1],p=u[2],g=u[3],m=0;for(;m+4<=s.length;)h^=s[m+0],f^=s[m+1],p^=s[m+2],g^=s[m+3],({s0:h,s1:f,s2:p,s3:g}=ur(o,h,f,p,g)),a[m++]=h,a[m++]=f,a[m++]=p,a[m++]=g;if(r){const e=br(n.subarray(4*m));h^=e[0],f^=e[1],p^=e[2],g^=e[3],({s0:h,s1:f,s2:p,s3:g}=ur(o,h,f,p,g)),a[m++]=h,a[m++]=f,a[m++]=p,a[m++]=g}return(0,Wn.clean)(...d),c},decrypt(n,i){mr(n);const o=cr(e);let s=t;const a=[o];(0,Wn.isAligned32)(s)||a.push(s=(0,Wn.copyBytes)(s));const c=(0,Wn.u32)(s),l=fr(n.length,i);(0,Wn.isAligned32)(n)||a.push(n=(0,Wn.copyBytes)(n));const d=(0,Wn.u32)(n),u=(0,Wn.u32)(l);let h=c[0],f=c[1],p=c[2],g=c[3];for(let e=0;e+4<=d.length;){const t=h,n=f,r=p,i=g;h=d[e+0],f=d[e+1],p=d[e+2],g=d[e+3];const{s0:s,s1:a,s2:c,s3:l}=hr(o,h,f,p,g);u[e++]=s^t,u[e++]=a^n,u[e++]=c^r,u[e++]=l^i}return(0,Wn.clean)(...a),vr(l,r)}}})),Tn.cfb=(0,Wn.wrapCipher)({blockSize:16,nonceLength:16},(function(e,t){function n(n,r,i){(0,zn.bytes)(n);const o=n.length;i=fr(o,i);const s=ar(e);let a=t;const c=[s];(0,Wn.isAligned32)(a)||c.push(a=(0,Wn.copyBytes)(a)),(0,Wn.isAligned32)(n)||c.push(n=(0,Wn.copyBytes)(n));const l=(0,Wn.u32)(n),d=(0,Wn.u32)(i),u=r?d:l,h=(0,Wn.u32)(a);let f=h[0],p=h[1],g=h[2],m=h[3];for(let e=0;e+4<=l.length;){const{s0:t,s1:n,s2:r,s3:i}=ur(s,f,p,g,m);d[e+0]=l[e+0]^t,d[e+1]=l[e+1]^n,d[e+2]=l[e+2]^r,d[e+3]=l[e+3]^i,f=u[e++],p=u[e++],g=u[e++],m=u[e++]}const y=Vn*Math.floor(l.length/4);if(y<o){({s0:f,s1:p,s2:g,s3:m}=ur(s,f,p,g,m));const e=(0,Wn.u8)(new Uint32Array([f,p,g,m]));for(let t=y,r=0;t<o;t++,r++)i[t]=n[t]^e[r];(0,Wn.clean)(e)}return(0,Wn.clean)(...c),i}return(0,zn.bytes)(e),(0,zn.bytes)(t,16),{encrypt:(e,t)=>n(e,!0,t),decrypt:(e,t)=>n(e,!1,t)}})),Tn.gcm=(0,Wn.wrapCipher)({blockSize:16,nonceLength:12,tagLength:16},(function(e,t,n){if((0,zn.bytes)(e),(0,zn.bytes)(t),void 0!==n&&(0,zn.bytes)(n),t.length<8)throw new Error("aes/gcm: invalid nonce length");const r=16;function i(e,t,r){const i=Er(qn.ghash,!1,e,r,n);for(let e=0;e<t.length;e++)i[e]^=t[e];return i}function o(){const n=ar(e),r=Gn.slice(),i=Gn.slice();if(gr(n,!1,i,i,r),12===t.length)i.set(t);else{const e=Gn.slice(),n=(0,Wn.createView)(e);(0,Wn.setBigUint64)(n,8,BigInt(8*t.length),!1);const o=qn.ghash.create(r).update(t).update(e);o.digestInto(i),o.destroy()}return{xk:n,authKey:r,counter:i,tagMask:gr(n,!1,i,Gn)}}return{encrypt(e){(0,zn.bytes)(e);const{xk:t,authKey:n,counter:s,tagMask:a}=o(),c=new Uint8Array(e.length+r),l=[t,n,s,a];(0,Wn.isAligned32)(e)||l.push(e=(0,Wn.copyBytes)(e)),gr(t,!1,s,e,c);const d=i(n,a,c.subarray(0,c.length-r));return l.push(d),c.set(d,e.length),(0,Wn.clean)(...l),c},decrypt(e){if((0,zn.bytes)(e),e.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:t,authKey:n,counter:s,tagMask:a}=o(),c=[t,n,a,s];(0,Wn.isAligned32)(e)||c.push(e=(0,Wn.copyBytes)(e));const l=e.subarray(0,-16),d=e.subarray(-16),u=i(n,a,l);if(c.push(u),!(0,Wn.equalBytes)(u,d))throw new Error("aes/gcm: invalid ghash tag");const h=gr(t,!1,s,l);return(0,Wn.clean)(...c),h}}}));const wr=(e,t,n)=>r=>{if(!Number.isSafeInteger(r)||t>r||r>n)throw new Error(`${e}: invalid value=${r}, must be [${t}..${n}]`)};function Sr(e){return null!=e&&"object"==typeof e&&(e instanceof Uint32Array||"Uint32Array"===e.constructor.name)}function _r(e,t){if((0,zn.bytes)(t,16),!Sr(e))throw new Error("_encryptBlock accepts result of expandKeyLE");const n=(0,Wn.u32)(t);let{s0:r,s1:i,s2:o,s3:s}=ur(e,n[0],n[1],n[2],n[3]);return n[0]=r,n[1]=i,n[2]=o,n[3]=s,t}function Cr(e,t){if((0,zn.bytes)(t,16),!Sr(e))throw new Error("_decryptBlock accepts result of expandKeyLE");const n=(0,Wn.u32)(t);let{s0:r,s1:i,s2:o,s3:s}=hr(e,n[0],n[1],n[2],n[3]);return n[0]=r,n[1]=i,n[2]=o,n[3]=s,t}Tn.siv=(0,Wn.wrapCipher)({blockSize:16,nonceLength:12,tagLength:16},(function(e,t,n){const r=wr("AAD",0,2**36),i=wr("plaintext",0,2**36),o=wr("nonce",12,12),s=wr("ciphertext",16,2**36+16);function a(){const n=ar(e),r=new Uint8Array(e.length),i=new Uint8Array(16),o=[n,r];let s=t;(0,Wn.isAligned32)(s)||o.push(s=(0,Wn.copyBytes)(s));const a=(0,Wn.u32)(s);let c=0,l=a[0],d=a[1],u=a[2],h=0;for(const e of[i,r].map(Wn.u32)){const t=(0,Wn.u32)(e);for(let e=0;e<t.length;e+=2){const{s0:r,s1:i}=ur(n,c,l,d,u);t[e+0]=r,t[e+1]=i,c=++h}}const f={authKey:i,encKey:ar(r)};return(0,Wn.clean)(...o),f}function c(e,r,i){const o=Er(qn.polyval,!0,r,i,n);for(let e=0;e<12;e++)o[e]^=t[e];o[15]&=127;const s=(0,Wn.u32)(o);let a=s[0],c=s[1],l=s[2],d=s[3];return({s0:a,s1:c,s2:l,s3:d}=ur(e,a,c,l,d)),s[0]=a,s[1]=c,s[2]=l,s[3]=d,o}function l(e,t,n){let r=(0,Wn.copyBytes)(t);r[15]|=128;const i=gr(e,!0,r,n);return(0,Wn.clean)(r),i}return(0,zn.bytes)(e,16,24,32),(0,zn.bytes)(t),o(t.length),void 0!==n&&((0,zn.bytes)(n),r(n.length)),{encrypt(e){(0,zn.bytes)(e),i(e.length);const{encKey:t,authKey:n}=a(),r=c(t,n,e),o=[t,n,r];(0,Wn.isAligned32)(e)||o.push(e=(0,Wn.copyBytes)(e));const s=new Uint8Array(e.length+16);return s.set(r,e.length),s.set(l(t,r,e)),(0,Wn.clean)(...o),s},decrypt(e){(0,zn.bytes)(e),s(e.length);const t=e.subarray(-16),{encKey:n,authKey:r}=a(),i=[n,r];(0,Wn.isAligned32)(e)||i.push(e=(0,Wn.copyBytes)(e));const o=l(n,t,e.subarray(0,-16)),d=c(n,r,o);if(i.push(d),!(0,Wn.equalBytes)(t,d))throw(0,Wn.clean)(...i),new Error("invalid polyval tag");return(0,Wn.clean)(...i),o}}}));const kr={encrypt(e,t){if(t.length>=2**32)throw new Error("plaintext should be less than 4gb");const n=ar(e);if(16===t.length)_r(n,t);else{const e=(0,Wn.u32)(t);let r=e[0],i=e[1];for(let t=0,o=1;t<6;t++)for(let t=2;t<e.length;t+=2,o++){const{s0:s,s1:a,s2:c,s3:l}=ur(n,r,i,e[t],e[t+1]);r=s,i=a^nr(o),e[t]=c,e[t+1]=l}e[0]=r,e[1]=i}n.fill(0)},decrypt(e,t){if(t.length-8>=2**32)throw new Error("ciphertext should be less than 4gb");const n=cr(e),r=t.length/8-1;if(1===r)Cr(n,t);else{const e=(0,Wn.u32)(t);let i=e[0],o=e[1];for(let t=0,s=6*r;t<6;t++)for(let t=2*r;t>=1;t-=2,s--){o^=nr(s);const{s0:r,s1:a,s2:c,s3:l}=hr(n,i,o,e[t],e[t+1]);i=r,o=a,e[t]=c,e[t+1]=l}e[0]=i,e[1]=o}n.fill(0)}},Ar=new Uint8Array(8).fill(166);Tn.aeskw=(0,Wn.wrapCipher)({blockSize:8},(e=>({encrypt(t){if((0,zn.bytes)(t),!t.length||t.length%8!=0)throw new Error("invalid plaintext length");if(8===t.length)throw new Error("8-byte keys not allowed in AESKW, use AESKWP instead");const n=(0,Wn.concatBytes)(Ar,t);return kr.encrypt(e,n),n},decrypt(t){if((0,zn.bytes)(t),t.length%8!=0||t.length<24)throw new Error("invalid ciphertext length");const n=(0,Wn.copyBytes)(t);if(kr.decrypt(e,n),!(0,Wn.equalBytes)(n.subarray(0,8),Ar))throw new Error("integrity check failed");return n.subarray(0,8).fill(0),n.subarray(8)}})));const Mr=2790873510;Tn.aeskwp=(0,Wn.wrapCipher)({blockSize:8},(e=>({encrypt(t){if((0,zn.bytes)(t),!t.length)throw new Error("invalid plaintext length");const n=8*Math.ceil(t.length/8),r=new Uint8Array(8+n);r.set(t,8);const i=(0,Wn.u32)(r);return i[0]=Mr,i[1]=nr(t.length),kr.encrypt(e,r),r},decrypt(t){if((0,zn.bytes)(t),t.length<16)throw new Error("invalid ciphertext length");const n=(0,Wn.copyBytes)(t),r=(0,Wn.u32)(n);kr.decrypt(e,n);const i=nr(r[1])>>>0,o=8*Math.ceil(i/8);if(r[0]!==Mr||n.length-8!==o)throw new Error("integrity check failed");for(let e=i;e<o;e++)if(0!==n[8+e])throw new Error("integrity check failed");return n.subarray(0,8).fill(0),n.subarray(8,8+i)}}))),Tn.unsafe={expandKeyLE:ar,expandKeyDecLE:cr,encrypt:ur,decrypt:hr,encryptBlock:_r,decryptBlock:Cr,ctrCounter:pr,ctr32:gr},Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.aes256cbc=Rn.aes256gcm=void 0;var xr=Tn;Rn.aes256gcm=function(e,t,n){return(0,xr.gcm)(e,t,n)};Rn.aes256cbc=function(e,t,n){return(0,xr.cbc)(e,t)};var Or={},Ir={},Rr={};Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.sigma=void 0,Rr.rotl=function(e,t){return e<<t|e>>>32-t},Rr.createCipher=function(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:o,rounds:s}=(0,Pr.checkOpts)({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return(0,Tr.number)(i),(0,Tr.number)(s),(0,Tr.bool)(o),(0,Tr.bool)(n),(t,a,c,l,d=0)=>{(0,Tr.bytes)(t),(0,Tr.bytes)(a),(0,Tr.bytes)(c);const u=c.length;if(void 0===l&&(l=new Uint8Array(u)),(0,Tr.bytes)(l),(0,Tr.number)(d),d<0||d>=Hr)throw new Error("arx: counter overflow");if(l.length<u)throw new Error(`arx: output (${l.length}) is shorter than data (${u})`);const h=[];let f,p,g=t.length;if(32===g)h.push(f=(0,Pr.copyBytes)(t)),p=Br;else{if(16!==g||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(t),f.set(t,16),p=Kr,h.push(f)}jr(a)||h.push(a=(0,Pr.copyBytes)(a));const m=(0,Pr.u32)(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,m,(0,Pr.u32)(a.subarray(0,16)),m),a=a.subarray(16)}const y=16-i;if(y!==a.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(12!==y){const e=new Uint8Array(12);e.set(a,o?0:12-a.length),a=e,h.push(a)}const v=(0,Pr.u32)(a);return function(e,t,n,r,i,o,s,a){const c=i.length,l=new Uint8Array($r),d=(0,Pr.u32)(l),u=jr(i)&&jr(o),h=u?(0,Pr.u32)(i):Fr,f=u?(0,Pr.u32)(o):Fr;for(let p=0;p<c;s++){if(e(t,n,r,d,s,a),s>=Hr)throw new Error("arx: counter overflow");const g=Math.min($r,c-p);if(u&&g===$r){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,n=0;n<Ur;n++)t=e+n,f[t]=h[t]^d[n];p+=$r}else{for(let e,t=0;t<g;t++)e=p+t,o[e]=i[e]^l[t];p+=g}}}(e,p,m,v,c,l,d,s),(0,Pr.clean)(...h),l}};const Tr=E,Pr=b,Nr=e=>Uint8Array.from(e.split("").map((e=>e.charCodeAt(0)))),Lr=Nr("expand 16-byte k"),Dr=Nr("expand 32-byte k"),Kr=(0,Pr.u32)(Lr),Br=(0,Pr.u32)(Dr);function jr(e){return e.byteOffset%4==0}Rr.sigma=Br.slice();const $r=64,Ur=16,Hr=2**32-1,Fr=new Uint32Array;var zr={};Object.defineProperty(zr,"__esModule",{value:!0}),zr.poly1305=void 0,zr.wrapConstructorWithKey=Yr;const qr=E,Wr=b,Vr=(e,t)=>255&e[t++]|(255&e[t++])<<8;class Gr{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=(0,Wr.toBytes)(e),(0,qr.bytes)(e,32);const t=Vr(e,0),n=Vr(e,2),r=Vr(e,4),i=Vr(e,6),o=Vr(e,8),s=Vr(e,10),a=Vr(e,12),c=Vr(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|i<<9),this.r[4]=255&(i>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|s<<2),this.r[7]=8065&(s>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=Vr(e,16+2*t)}process(e,t,n=!1){const r=n?0:2048,{h:i,r:o}=this,s=o[0],a=o[1],c=o[2],l=o[3],d=o[4],u=o[5],h=o[6],f=o[7],p=o[8],g=o[9],m=Vr(e,t+0),y=Vr(e,t+2),v=Vr(e,t+4),b=Vr(e,t+6),E=Vr(e,t+8),w=Vr(e,t+10),S=Vr(e,t+12),_=Vr(e,t+14);let C=i[0]+(8191&m),k=i[1]+(8191&(m>>>13|y<<3)),A=i[2]+(8191&(y>>>10|v<<6)),M=i[3]+(8191&(v>>>7|b<<9)),x=i[4]+(8191&(b>>>4|E<<12)),O=i[5]+(E>>>1&8191),I=i[6]+(8191&(E>>>14|w<<2)),R=i[7]+(8191&(w>>>11|S<<5)),T=i[8]+(8191&(S>>>8|_<<8)),P=i[9]+(_>>>5|r),N=0,L=N+C*s+k*(5*g)+A*(5*p)+M*(5*f)+x*(5*h);N=L>>>13,L&=8191,L+=O*(5*u)+I*(5*d)+R*(5*l)+T*(5*c)+P*(5*a),N+=L>>>13,L&=8191;let D=N+C*a+k*s+A*(5*g)+M*(5*p)+x*(5*f);N=D>>>13,D&=8191,D+=O*(5*h)+I*(5*u)+R*(5*d)+T*(5*l)+P*(5*c),N+=D>>>13,D&=8191;let K=N+C*c+k*a+A*s+M*(5*g)+x*(5*p);N=K>>>13,K&=8191,K+=O*(5*f)+I*(5*h)+R*(5*u)+T*(5*d)+P*(5*l),N+=K>>>13,K&=8191;let B=N+C*l+k*c+A*a+M*s+x*(5*g);N=B>>>13,B&=8191,B+=O*(5*p)+I*(5*f)+R*(5*h)+T*(5*u)+P*(5*d),N+=B>>>13,B&=8191;let j=N+C*d+k*l+A*c+M*a+x*s;N=j>>>13,j&=8191,j+=O*(5*g)+I*(5*p)+R*(5*f)+T*(5*h)+P*(5*u),N+=j>>>13,j&=8191;let $=N+C*u+k*d+A*l+M*c+x*a;N=$>>>13,$&=8191,$+=O*s+I*(5*g)+R*(5*p)+T*(5*f)+P*(5*h),N+=$>>>13,$&=8191;let U=N+C*h+k*u+A*d+M*l+x*c;N=U>>>13,U&=8191,U+=O*a+I*s+R*(5*g)+T*(5*p)+P*(5*f),N+=U>>>13,U&=8191;let H=N+C*f+k*h+A*u+M*d+x*l;N=H>>>13,H&=8191,H+=O*c+I*a+R*s+T*(5*g)+P*(5*p),N+=H>>>13,H&=8191;let F=N+C*p+k*f+A*h+M*u+x*d;N=F>>>13,F&=8191,F+=O*l+I*c+R*a+T*s+P*(5*g),N+=F>>>13,F&=8191;let z=N+C*g+k*p+A*f+M*h+x*u;N=z>>>13,z&=8191,z+=O*d+I*l+R*c+T*a+P*s,N+=z>>>13,z&=8191,N=(N<<2)+N|0,N=N+L|0,L=8191&N,N>>>=13,D+=N,i[0]=L,i[1]=D,i[2]=K,i[3]=B,i[4]=j,i[5]=$,i[6]=U,i[7]=H,i[8]=F,i[9]=z}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=r,r=e[t]>>>13,e[t]&=8191;e[0]+=5*r,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let t=1;t<10;t++)n[t]=e[t]+r,r=n[t]>>>13,n[t]&=8191;n[9]-=8192;let i=(1^r)-1;for(let e=0;e<10;e++)n[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|n[t];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+t[0];e[0]=65535&o;for(let n=1;n<8;n++)o=(e[n]+t[n]|0)+(o>>>16)|0,e[n]=65535&o;(0,Wr.clean)(n)}update(e){(0,qr.exists)(this);const{buffer:t,blockLen:n}=this,r=(e=(0,Wr.toBytes)(e)).length;for(let i=0;i<r;){const o=Math.min(n-this.pos,r-i);if(o!==n)t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0);else for(;n<=r-i;i+=n)this.process(e,i)}return this}destroy(){(0,Wr.clean)(this.h,this.r,this.buffer,this.pad)}digestInto(e){(0,qr.exists)(this),(0,qr.output)(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=n[t]>>>0,e[i++]=n[t]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function Yr(e){const t=(t,n)=>e(n).update((0,Wr.toBytes)(t)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}zr.poly1305=Yr((e=>new Gr(e))),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.xchacha20poly1305=e.chacha20poly1305=e._poly1305_aead=e.chacha12=e.chacha8=e.xchacha20=e.chacha20=e.chacha20orig=void 0,e.hchacha=s;const t=Rr,n=E,r=zr,i=b;function o(e,n,r,i,o,s=20){let a=e[0],c=e[1],l=e[2],d=e[3],u=n[0],h=n[1],f=n[2],p=n[3],g=n[4],m=n[5],y=n[6],v=n[7],b=o,E=r[0],w=r[1],S=r[2],_=a,C=c,k=l,A=d,M=u,x=h,O=f,I=p,R=g,T=m,P=y,N=v,L=b,D=E,K=w,B=S;for(let e=0;e<s;e+=2)_=_+M|0,L=(0,t.rotl)(L^_,16),R=R+L|0,M=(0,t.rotl)(M^R,12),_=_+M|0,L=(0,t.rotl)(L^_,8),R=R+L|0,M=(0,t.rotl)(M^R,7),C=C+x|0,D=(0,t.rotl)(D^C,16),T=T+D|0,x=(0,t.rotl)(x^T,12),C=C+x|0,D=(0,t.rotl)(D^C,8),T=T+D|0,x=(0,t.rotl)(x^T,7),k=k+O|0,K=(0,t.rotl)(K^k,16),P=P+K|0,O=(0,t.rotl)(O^P,12),k=k+O|0,K=(0,t.rotl)(K^k,8),P=P+K|0,O=(0,t.rotl)(O^P,7),A=A+I|0,B=(0,t.rotl)(B^A,16),N=N+B|0,I=(0,t.rotl)(I^N,12),A=A+I|0,B=(0,t.rotl)(B^A,8),N=N+B|0,I=(0,t.rotl)(I^N,7),_=_+x|0,B=(0,t.rotl)(B^_,16),P=P+B|0,x=(0,t.rotl)(x^P,12),_=_+x|0,B=(0,t.rotl)(B^_,8),P=P+B|0,x=(0,t.rotl)(x^P,7),C=C+O|0,L=(0,t.rotl)(L^C,16),N=N+L|0,O=(0,t.rotl)(O^N,12),C=C+O|0,L=(0,t.rotl)(L^C,8),N=N+L|0,O=(0,t.rotl)(O^N,7),k=k+I|0,D=(0,t.rotl)(D^k,16),R=R+D|0,I=(0,t.rotl)(I^R,12),k=k+I|0,D=(0,t.rotl)(D^k,8),R=R+D|0,I=(0,t.rotl)(I^R,7),A=A+M|0,K=(0,t.rotl)(K^A,16),T=T+K|0,M=(0,t.rotl)(M^T,12),A=A+M|0,K=(0,t.rotl)(K^A,8),T=T+K|0,M=(0,t.rotl)(M^T,7);let j=0;i[j++]=a+_|0,i[j++]=c+C|0,i[j++]=l+k|0,i[j++]=d+A|0,i[j++]=u+M|0,i[j++]=h+x|0,i[j++]=f+O|0,i[j++]=p+I|0,i[j++]=g+R|0,i[j++]=m+T|0,i[j++]=y+P|0,i[j++]=v+N|0,i[j++]=b+L|0,i[j++]=E+D|0,i[j++]=w+K|0,i[j++]=S+B|0}function s(e,n,r,i){let o=e[0],s=e[1],a=e[2],c=e[3],l=n[0],d=n[1],u=n[2],h=n[3],f=n[4],p=n[5],g=n[6],m=n[7],y=r[0],v=r[1],b=r[2],E=r[3];for(let e=0;e<20;e+=2)o=o+l|0,y=(0,t.rotl)(y^o,16),f=f+y|0,l=(0,t.rotl)(l^f,12),o=o+l|0,y=(0,t.rotl)(y^o,8),f=f+y|0,l=(0,t.rotl)(l^f,7),s=s+d|0,v=(0,t.rotl)(v^s,16),p=p+v|0,d=(0,t.rotl)(d^p,12),s=s+d|0,v=(0,t.rotl)(v^s,8),p=p+v|0,d=(0,t.rotl)(d^p,7),a=a+u|0,b=(0,t.rotl)(b^a,16),g=g+b|0,u=(0,t.rotl)(u^g,12),a=a+u|0,b=(0,t.rotl)(b^a,8),g=g+b|0,u=(0,t.rotl)(u^g,7),c=c+h|0,E=(0,t.rotl)(E^c,16),m=m+E|0,h=(0,t.rotl)(h^m,12),c=c+h|0,E=(0,t.rotl)(E^c,8),m=m+E|0,h=(0,t.rotl)(h^m,7),o=o+d|0,E=(0,t.rotl)(E^o,16),g=g+E|0,d=(0,t.rotl)(d^g,12),o=o+d|0,E=(0,t.rotl)(E^o,8),g=g+E|0,d=(0,t.rotl)(d^g,7),s=s+u|0,y=(0,t.rotl)(y^s,16),m=m+y|0,u=(0,t.rotl)(u^m,12),s=s+u|0,y=(0,t.rotl)(y^s,8),m=m+y|0,u=(0,t.rotl)(u^m,7),a=a+h|0,v=(0,t.rotl)(v^a,16),f=f+v|0,h=(0,t.rotl)(h^f,12),a=a+h|0,v=(0,t.rotl)(v^a,8),f=f+v|0,h=(0,t.rotl)(h^f,7),c=c+l|0,b=(0,t.rotl)(b^c,16),p=p+b|0,l=(0,t.rotl)(l^p,12),c=c+l|0,b=(0,t.rotl)(b^c,8),p=p+b|0,l=(0,t.rotl)(l^p,7);let w=0;i[w++]=o,i[w++]=s,i[w++]=a,i[w++]=c,i[w++]=y,i[w++]=v,i[w++]=b,i[w++]=E}e.chacha20orig=(0,t.createCipher)(o,{counterRight:!1,counterLength:8,allowShortKeys:!0}),e.chacha20=(0,t.createCipher)(o,{counterRight:!1,counterLength:4,allowShortKeys:!1}),e.xchacha20=(0,t.createCipher)(o,{counterRight:!1,counterLength:8,extendNonceFn:s,allowShortKeys:!1}),e.chacha8=(0,t.createCipher)(o,{counterRight:!1,counterLength:4,rounds:8}),e.chacha12=(0,t.createCipher)(o,{counterRight:!1,counterLength:4,rounds:12});const a=new Uint8Array(16),c=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(a.subarray(n))},l=new Uint8Array(32);function d(e,t,n,o,s){const a=e(t,n,l),d=r.poly1305.create(a);s&&c(d,s),c(d,o);const u=new Uint8Array(16),h=(0,i.createView)(u);(0,i.setBigUint64)(h,0,BigInt(s?s.length:0),!0),(0,i.setBigUint64)(h,8,BigInt(o.length),!0),d.update(u);const f=d.digest();return(0,i.clean)(a,u),f}e._poly1305_aead=e=>(t,r,o)=>{const s=16;return(0,n.bytes)(t,32),(0,n.bytes)(r),{encrypt(a,c){const l=a.length,u=l+s;c?(0,n.bytes)(c,u):c=new Uint8Array(u),e(t,r,a,c,1);const h=d(e,t,r,c.subarray(0,-16),o);return c.set(h,l),(0,i.clean)(h),c},decrypt(a,c){const l=a.length,u=l-s;if(l<s)throw new Error("encrypted data must be at least 16 bytes");c?(0,n.bytes)(c,u):c=new Uint8Array(u);const h=a.subarray(0,-16),f=a.subarray(-16),p=d(e,t,r,h,o);if(!(0,i.equalBytes)(f,p))throw new Error("invalid tag");return e(t,r,h,c,1),(0,i.clean)(p),c}}},e.chacha20poly1305=(0,i.wrapCipher)({blockSize:64,nonceLength:12,tagLength:16},(0,e._poly1305_aead)(e.chacha20)),e.xchacha20poly1305=(0,i.wrapCipher)({blockSize:64,nonceLength:24,tagLength:16},(0,e._poly1305_aead)(e.xchacha20))}(Ir),Object.defineProperty(Or,"__esModule",{value:!0}),Or.xchacha20=void 0;var Jr=Ir;Or.xchacha20=function(e,t,n){return(0,Jr.xchacha20poly1305)(e,t,n)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.aesDecrypt=e.aesEncrypt=e.symDecrypt=e.symEncrypt=void 0;var t=b,n=L,r=Rn,i=Or,o=O,s=I;e.symEncrypt=function(e,t,n){return a(c,e,t,n)};function a(e,t,n,a){var c=(0,o.symmetricAlgorithm)();if("aes-256-gcm"===c)return e(r.aes256gcm,t,n,(0,o.symmetricNonceLength)(),s.AEAD_TAG_LENGTH,a);if("xchacha20"===c)return e(i.xchacha20,t,n,s.XCHACHA20_NONCE_LENGTH,s.AEAD_TAG_LENGTH,a);if("aes-256-cbc"===c)return e(r.aes256cbc,t,n,16,0);throw new Error("Not implemented")}function c(e,r,i,o,s,a){var c=(0,n.randomBytes)(o),l=e(r,c,a).encrypt(i);if(0===s)return(0,t.concatBytes)(c,l);var d=l.length-s,u=l.subarray(0,d),h=l.subarray(d);return(0,t.concatBytes)(c,h,u)}function l(e,n,r,i,o,s){var a=r.subarray(0,i),c=e(n,Uint8Array.from(a),s),l=r.subarray(i);if(0===o)return c.decrypt(l);var d=l.subarray(0,o),u=l.subarray(o);return c.decrypt((0,t.concatBytes)(u,d))}e.symDecrypt=function(e,t,n){return a(l,e,t,n)},e.aesEncrypt=e.symEncrypt,e.aesDecrypt=e.symDecrypt}(In),function(e){var t=f&&f.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=f&&f.__exportStar||function(e,n){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),n(N,e),n(wn,e),n(En,e),n(In,e)}(P);var Zr={};Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.PublicKey=void 0;var Xr=b,Qr=P,ei=function(){function e(e){this.data=(0,Qr.convertPublicKeyFormat)(e,!0)}return e.fromHex=function(t){return new e((0,Qr.hexToPublicKey)(t))},Object.defineProperty(e.prototype,"uncompressed",{get:function(){return Buffer.from((0,Qr.convertPublicKeyFormat)(this.data,!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"compressed",{get:function(){return Buffer.from(this.data)},enumerable:!1,configurable:!0}),e.prototype.toHex=function(e){return void 0===e&&(e=!0),(0,Xr.bytesToHex)(e?this.data:this.uncompressed)},e.prototype.decapsulate=function(e,t){void 0===t&&(t=!1);var n=t?this.data:this.uncompressed,r=e.multiply(this,t);return(0,Qr.getSharedKey)(n,r)},e.prototype.equals=function(e){return(0,Xr.equalBytes)(this.data,e.data)},e}();Zr.PublicKey=ei,Object.defineProperty(T,"__esModule",{value:!0}),T.PrivateKey=void 0;var ti=b,ni=P,ri=Zr,ii=function(){function e(e){if(void 0===e)this.data=(0,ni.getValidSecret)();else{if(!(0,ni.isValidPrivateKey)(e))throw new Error("Invalid private key");this.data=e}this.publicKey=new ri.PublicKey((0,ni.getPublicKey)(this.data))}return e.fromHex=function(t){return new e((0,ni.decodeHex)(t))},Object.defineProperty(e.prototype,"secret",{get:function(){return Buffer.from(this.data)},enumerable:!1,configurable:!0}),e.prototype.toHex=function(){return(0,ti.bytesToHex)(this.data)},e.prototype.encapsulate=function(e,t){void 0===t&&(t=!1);var n=t?this.publicKey.compressed:this.publicKey.uncompressed,r=this.multiply(e,t);return(0,ni.getSharedKey)(n,r)},e.prototype.multiply=function(e,t){return void 0===t&&(t=!1),(0,ni.getSharedPoint)(this.data,e.compressed,t)},e.prototype.equals=function(e){return(0,ti.equalBytes)(this.data,e.data)},e}();T.PrivateKey=ii,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PublicKey=e.PrivateKey=void 0;var t=T;Object.defineProperty(e,"PrivateKey",{enumerable:!0,get:function(){return t.PrivateKey}});var n=Zr;Object.defineProperty(e,"PublicKey",{enumerable:!0,get:function(){return n.PublicKey}})}(R),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.utils=e.PublicKey=e.PrivateKey=e.ECIES_CONFIG=void 0,e.encrypt=function(e,o){var s=new r.PrivateKey,a=e instanceof Uint8Array?new r.PublicKey(e):r.PublicKey.fromHex(e),c=s.encapsulate(a,(0,n.isHkdfKeyCompressed)()),l=(0,n.isEphemeralKeyCompressed)()?s.publicKey.compressed:s.publicKey.uncompressed,d=(0,i.symEncrypt)(c,o);return Buffer.from((0,t.concatBytes)(l,d))},e.decrypt=function(e,t){var o=e instanceof Uint8Array?new r.PrivateKey(e):r.PrivateKey.fromHex(e),s=(0,n.ephemeralKeySize)(),a=new r.PublicKey(t.subarray(0,s)),c=t.subarray(s),l=a.decapsulate(o,(0,n.isHkdfKeyCompressed)());return Buffer.from((0,i.symDecrypt)(l,c))};var t=b,n=O,r=R,i=P;var o=O;Object.defineProperty(e,"ECIES_CONFIG",{enumerable:!0,get:function(){return o.ECIES_CONFIG}});var s=R;Object.defineProperty(e,"PrivateKey",{enumerable:!0,get:function(){return s.PrivateKey}}),Object.defineProperty(e,"PublicKey",{enumerable:!0,get:function(){return s.PublicKey}}),e.utils={aesEncrypt:i.aesEncrypt,aesDecrypt:i.aesDecrypt,symEncrypt:i.symEncrypt,symDecrypt:i.symDecrypt,decodeHex:i.decodeHex,getValidSecret:i.getValidSecret,remove0x:i.remove0x}}(v);const oi=t("KeyExchange:Layer"),si=t("SocketService:Layer"),ai=t("Ecies:Layer"),ci=t("RemoteCommunication:Layer");oi.color="##95c44e",si.color="#f638d7",ai.color="#465b9c",ci.color="#47a2be";const li={KeyExchange:oi,SocketService:si,Ecies:ai,RemoteCommunication:ci};let di,ui=[],hi=[];const fi=(t,n)=>e(void 0,void 0,void 0,(function*(){di=n,hi.push(t),function(t){return e(this,void 0,void 0,(function*(){if(!di||!t)return;!function(){const e=hi;hi=ui,ui=e}();const e=di.endsWith("/")?`${di}evt`:`${di}/evt`,n=Object.assign({},t);if(delete n.params,t.params)for(const[e,r]of Object.entries(t.params))n[e]=r;const r=JSON.stringify(n);li.RemoteCommunication(`[sendBufferedEvents] Sending ${ui.length} analytics events to ${e}`);try{const t=yield y(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:r}),n=yield t.text();li.RemoteCommunication(`[sendBufferedEvents] Response: ${n}`),ui.length=0}catch(e){}}))}(t).catch((()=>{}))}));class pi{constructor(e){this.enabled=!0,(null==e?void 0:e.debug)&&t.enable("Ecies:Layer"),this.ecies=(null==e?void 0:e.privateKey)?v.PrivateKey.fromHex(e.privateKey):new v.PrivateKey,li.Ecies("[ECIES constructor()] initialized secret: ",this.ecies.toHex()),li.Ecies("[ECIES constructor()] initialized public: ",this.ecies.publicKey.toHex()),li.Ecies("[ECIES constructor()] init with",this)}generateECIES(){this.ecies=new v.PrivateKey}getPublicKey(){return this.ecies.publicKey.toHex()}encrypt(e,t){let n=e;if(this.enabled)try{li.Ecies("[ECIES: encrypt()] using otherPublicKey",t);const i=r.from(e),o=v.encrypt(t,i);n=r.from(o).toString("base64")}catch(n){throw li.Ecies("[ECIES: encrypt()] error encrypt:",n),li.Ecies("[ECIES: encrypt()] private: ",this.ecies.toHex()),li.Ecies("[ECIES: encrypt()] data: ",e),li.Ecies("[ECIES: encrypt()] otherkey: ",t),n}return n}decrypt(e){let t=e;if(this.enabled)try{li.Ecies("[ECIES: decrypt()] using privateKey",this.ecies.toHex());const n=r.from(e.toString(),"base64");t=v.decrypt(this.ecies.toHex(),n).toString()}catch(t){throw li.Ecies("[ECIES: decrypt()] error decrypt",t),li.Ecies("[ECIES: decrypt()] private: ",this.ecies.toHex()),li.Ecies("[ECIES: decrypt()] encryptedData: ",e),t}return t}getKeyInfo(){return{private:this.ecies.toHex(),public:this.ecies.publicKey.toHex()}}toString(){li.Ecies("[ECIES: toString()]",this.getKeyInfo())}}var gi={name:"@metamask/sdk-communication-layer",version:"0.30.2",description:"",homepage:"https://github.com/MetaMask/metamask-sdk#readme",bugs:{url:"https://github.com/MetaMask/metamask-sdk/issues"},repository:{type:"git",url:"https://github.com/MetaMask/metamask-sdk.git",directory:"packages/sdk-communication-layer"},main:"dist/node/cjs/metamask-sdk-communication-layer.js",unpkg:"dist/browser/umd/metamask-sdk-communication-layer.js",module:"dist/node/es/metamask-sdk-communication-layer.js",browser:"dist/browser/es/metamask-sdk-communication-layer.js","react-native":"dist/react-native/es/metamask-sdk-communication-layer.js",types:"dist/types/src/index.d.ts",files:["/dist"],scripts:{"build:types":"tsc --project tsconfig.build.json --emitDeclarationOnly --outDir dist/types","build:clean":"yarn clean && yarn build",build:"yarn build:types && rollup -c --bundleConfigAsCjs","build:dev":"yarn build:types && NODE_ENV=dev rollup -c --bundleConfigAsCjs","build:post-tsc":"echo 'N/A'","build:pre-tsc":"echo 'N/A'",size:"size-limit",clean:"rimraf ./dist",lint:"yarn lint:eslint && yarn lint:misc --check","lint:changelog":"../../scripts/validate-changelog.sh @metamask/sdk-communication-layer","lint:eslint":"eslint . --cache --ext js,ts","lint:fix":"yarn lint:eslint --fix && yarn lint:misc --write","lint:misc":"prettier '**/*.json' '**/*.md' '!CHANGELOG.md' --ignore-path ../../.gitignore","publish:preview":"yarn npm publish --tag preview",prepack:"../../scripts/prepack.sh",reset:"yarn clean && rimraf ./node_modules/",test:'jest --testPathIgnorePatterns "/e2e/"',"test:e2e":'jest --testPathPattern "/e2e/"',"test:coverage":"jest --coverage","test:ci":'jest --coverage --passWithNoTests --setupFilesAfterEnv ./jest-preload.js --testPathIgnorePatterns "/e2e/"',"test:dev":"jest",watch:"rollup -c --bundleConfigAsCjs -w"},dependencies:{bufferutil:"^4.0.8","date-fns":"^2.29.3",debug:"^4.3.4","utf-8-validate":"^5.0.2",uuid:"^8.3.2"},devDependencies:{"@jest/globals":"^29.3.1","@lavamoat/allow-scripts":"^2.3.1","@metamask/auto-changelog":"3.1.0","@metamask/eslint-config":"^6.0.0","@metamask/eslint-config-nodejs":"^6.0.0","@metamask/eslint-config-typescript":"^6.0.0","@rollup/plugin-commonjs":"^25.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-replace":"^6.0.1","@rollup/plugin-terser":"^0.4.4","@size-limit/preset-big-lib":"^11.0.2","@types/jest":"^29.2.4","@types/node":"^20.1.3","@types/uuid":"^9.0.0","@typescript-eslint/eslint-plugin":"^4.26.0","@typescript-eslint/parser":"^4.26.0","cross-fetch":"^4.0.0",eciesjs:"^0.4.11",eslint:"^7.30.0","eslint-config-prettier":"^8.3.0","eslint-plugin-import":"^2.23.4","eslint-plugin-jest":"^24.4.0","eslint-plugin-jsdoc":"^36.1.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^3.4.0",eventemitter2:"^6.4.9",jest:"^29.3.1",prettier:"^2.3.0",rimraf:"^3.0.2",rollup:"^4.26.0","rollup-plugin-jscc":"^2.0.0","rollup-plugin-natives":"^0.7.5","rollup-plugin-node-builtins":"^2.1.2","rollup-plugin-node-globals":"^1.4.0","rollup-plugin-peer-deps-external":"^2.2.4","rollup-plugin-polyfill-node":"^0.13.0","rollup-plugin-sizes":"^1.0.6","rollup-plugin-typescript2":"^0.31.2","rollup-plugin-visualizer":"^5.12.0","size-limit":"^11.1.6","socket.io-client":"^4.5.1","stream-browserify":"^3.0.0","ts-jest":"^29.0.3","ts-node":"^10.9.1",typescript:"^5.6.3"},peerDependencies:{"cross-fetch":"^4.0.0",eciesjs:"*",eventemitter2:"^6.4.9","readable-stream":"^3.6.2","socket.io-client":"^4.5.1"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},lavamoat:{allowScripts:{"@lavamoat/preinstall-always-fail":!1,canvas:!0,"eciesjs>secp256k1":!1,"socket.io-client>engine.io-client>ws>bufferutil":!1,"socket.io-client>engine.io-client>ws>utf-8-validate":!1,bufferutil:!1,"utf-8-validate":!1}}};const mi="https://metamask-sdk.api.cx.metamask.io/",yi=["websocket"],vi=6048e5,bi=3e3,Ei={METAMASK_GETPROVIDERSTATE:"metamask_getProviderState",ETH_REQUESTACCOUNTS:"eth_requestAccounts"};function wi(e){const{context:t}=e;li.RemoteCommunication(`[RemoteCommunication: clean()] context=${t}`),e.channelConfig=void 0,e.ready=!1,e.originatorConnectStarted=!1}var Si,_i,Ci,ki,Ai,Mi,xi;(xi=Si||(Si={})).DISCONNECTED="disconnected",xi.WAITING="waiting",xi.TIMEOUT="timeout",xi.LINKED="linked",xi.PAUSED="paused",xi.TERMINATED="terminated",function(e){e.KEY_INFO="key_info",e.SERVICE_STATUS="service_status",e.PROVIDER_UPDATE="provider_update",e.RPC_UPDATE="rpc_update",e.KEYS_EXCHANGED="keys_exchanged",e.JOIN_CHANNEL="join_channel",e.PUBLIC_KEY="public_key",e.CHANNEL_CREATED="channel_created",e.CLIENTS_CONNECTED="clients_connected",e.CLIENTS_DISCONNECTED="clients_disconnected",e.CLIENTS_WAITING="clients_waiting",e.CLIENTS_READY="clients_ready",e.REJECTED="rejected",e.WALLET_INIT="wallet_init",e.CHANNEL_PERSISTENCE="channel_persistence",e.CONFIG="config",e.MESSAGE_ACK="ack",e.SOCKET_DISCONNECTED="socket_disconnected",e.SOCKET_RECONNECT="socket_reconnect",e.OTP="otp",e.SDK_RPC_CALL="sdk_rpc_call",e.AUTHORIZED="authorized",e.CONNECTION_STATUS="connection_status",e.MESSAGE="message",e.TERMINATE="terminate"}(_i||(_i={})),(Ci||(Ci={})).KEY_EXCHANGE="key_exchange",function(e){e.KEY_HANDSHAKE_START="key_handshake_start",e.KEY_HANDSHAKE_CHECK="key_handshake_check",e.KEY_HANDSHAKE_SYN="key_handshake_SYN",e.KEY_HANDSHAKE_SYNACK="key_handshake_SYNACK",e.KEY_HANDSHAKE_ACK="key_handshake_ACK",e.KEY_HANDSHAKE_WALLET="key_handshake_wallet",e.KEY_HANDSHAKE_NONE="none"}(ki||(ki={}));class Oi extends s{constructor({communicationLayer:e,otherPublicKey:t,context:n,ecies:r,logging:i}){super(),this.keysExchanged=!1,this.step=ki.KEY_HANDSHAKE_NONE,this.debug=!1,this.context=n,this.communicationLayer=e,(null==r?void 0:r.privateKey)&&t&&(li.KeyExchange(`[KeyExchange: constructor()] otherPubKey=${t} set keysExchanged to true!`,r),this.keysExchanged=!0),this.myECIES=new pi(Object.assign(Object.assign({},r),{debug:null==i?void 0:i.eciesLayer})),this.communicationLayer.state.eciesInstance=this.myECIES,this.myPublicKey=this.myECIES.getPublicKey(),this.debug=!0===(null==i?void 0:i.keyExchangeLayer),t&&this.setOtherPublicKey(t),this.communicationLayer.on(Ci.KEY_EXCHANGE,this.onKeyExchangeMessage.bind(this))}onKeyExchangeMessage(e){const{relayPersistence:t}=this.communicationLayer.remote.state;if(li.KeyExchange(`[KeyExchange: onKeyExchangeMessage()] context=${this.context} keysExchanged=${this.keysExchanged} relayPersistence=${t}`,e),t)return void li.KeyExchange("[KeyExchange: onKeyExchangeMessage()] Ignoring key exchange message because relay persistence is activated");const{message:n}=e;this.keysExchanged&&li.KeyExchange(`[KeyExchange: onKeyExchangeMessage()] context=${this.context} received handshake while already exchanged. step=${this.step} otherPubKey=${this.otherPublicKey}`),this.emit(_i.KEY_INFO,n.type),n.type===ki.KEY_HANDSHAKE_SYN?(this.checkStep([ki.KEY_HANDSHAKE_NONE,ki.KEY_HANDSHAKE_ACK]),li.KeyExchange("[KeyExchange: onKeyExchangeMessage()] KEY_HANDSHAKE_SYN",n),n.pubkey&&this.setOtherPublicKey(n.pubkey),this.communicationLayer.sendMessage({type:ki.KEY_HANDSHAKE_SYNACK,pubkey:this.myPublicKey}).catch((e=>{li.KeyExchange("[KeyExchange: onKeyExchangeMessage()] Error sending KEY_HANDSHAKE_SYNACK",e)})),this.setStep(ki.KEY_HANDSHAKE_ACK)):n.type===ki.KEY_HANDSHAKE_SYNACK?(this.checkStep([ki.KEY_HANDSHAKE_SYNACK,ki.KEY_HANDSHAKE_ACK,ki.KEY_HANDSHAKE_NONE]),li.KeyExchange("[KeyExchange: onKeyExchangeMessage()] KEY_HANDSHAKE_SYNACK"),n.pubkey&&this.setOtherPublicKey(n.pubkey),this.communicationLayer.sendMessage({type:ki.KEY_HANDSHAKE_ACK}).catch((e=>{li.KeyExchange("[KeyExchange: onKeyExchangeMessage()] Error sending KEY_HANDSHAKE_ACK",e)})),this.keysExchanged=!0,this.setStep(ki.KEY_HANDSHAKE_ACK),this.emit(_i.KEYS_EXCHANGED)):n.type===ki.KEY_HANDSHAKE_ACK&&(li.KeyExchange("[KeyExchange: onKeyExchangeMessage()] KEY_HANDSHAKE_ACK set keysExchanged to true!"),this.checkStep([ki.KEY_HANDSHAKE_ACK,ki.KEY_HANDSHAKE_NONE]),this.keysExchanged=!0,this.setStep(ki.KEY_HANDSHAKE_ACK),this.emit(_i.KEYS_EXCHANGED))}resetKeys(e){this.clean(),this.myECIES=new pi(e)}clean(){li.KeyExchange(`[KeyExchange: clean()] context=${this.context} reset handshake state`),this.setStep(ki.KEY_HANDSHAKE_NONE),this.emit(_i.KEY_INFO,this.step),this.keysExchanged=!1}start({isOriginator:e,force:t}){const{relayPersistence:n,protocolVersion:r}=this.communicationLayer.remote.state,i=r>=2;n?li.KeyExchange("[KeyExchange: start()] Ignoring key exchange message because relay persistence is activated"):(li.KeyExchange(`[KeyExchange: start()] context=${this.context} protocolVersion=${r} isOriginator=${e} step=${this.step} force=${t} relayPersistence=${n} keysExchanged=${this.keysExchanged}`),e?!(this.keysExchanged||this.step!==ki.KEY_HANDSHAKE_NONE&&this.step!==ki.KEY_HANDSHAKE_SYNACK)||t?(li.KeyExchange(`[KeyExchange: start()] context=${this.context} -- start key exchange (force=${t}) -- step=${this.step}`,this.step),this.clean(),this.setStep(ki.KEY_HANDSHAKE_SYNACK),this.communicationLayer.sendMessage({type:ki.KEY_HANDSHAKE_SYN,pubkey:this.myPublicKey,v:2}).catch((e=>{li.KeyExchange("[KeyExchange: start()] Error sending KEY_HANDSHAKE_SYN",e)}))):li.KeyExchange(`[KeyExchange: start()] context=${this.context} -- key exchange already ${this.keysExchanged?"done":"in progress"} -- aborted.`,this.step):this.keysExchanged&&!0!==t?li.KeyExchange("[KeyExchange: start()] don't send KEY_HANDSHAKE_START -- exchange already done."):i?this.communicationLayer.sendMessage({type:ki.KEY_HANDSHAKE_SYNACK,pubkey:this.myPublicKey,v:2}).catch((e=>{li.KeyExchange("[KeyExchange: start()] Error sending KEY_HANDSHAKE_SYNACK",e)})):(this.communicationLayer.sendMessage({type:ki.KEY_HANDSHAKE_START}).catch((e=>{li.KeyExchange("[KeyExchange: start()] Error sending KEY_HANDSHAKE_START",e)})),this.clean()))}setStep(e){this.step=e,this.emit(_i.KEY_INFO,e)}checkStep(e){e.length>0&&e.indexOf(this.step.toString())}setRelayPersistence({localKey:e,otherKey:t}){this.otherPublicKey=t,this.myECIES=new pi({privateKey:e,debug:this.debug}),this.keysExchanged=!0}setKeysExchanged(e){this.keysExchanged=e}areKeysExchanged(){return this.keysExchanged}getMyPublicKey(){return this.myPublicKey}getOtherPublicKey(){return this.otherPublicKey}setOtherPublicKey(e){li.KeyExchange("[KeyExchange: setOtherPubKey()]",e),this.otherPublicKey=e}encryptMessage(e){if(!this.otherPublicKey)throw new Error("encryptMessage: Keys not exchanged - missing otherPubKey");return this.myECIES.encrypt(e,this.otherPublicKey)}decryptMessage(e){if(!this.otherPublicKey)throw new Error("decryptMessage: Keys not exchanged - missing otherPubKey");return this.myECIES.decrypt(e)}getKeyInfo(){return{ecies:Object.assign(Object.assign({},this.myECIES.getKeyInfo()),{otherPubKey:this.otherPublicKey}),step:this.step,keysExchanged:this.areKeysExchanged()}}toString(){const e={keyInfo:this.getKeyInfo(),keysExchanged:this.keysExchanged,step:this.step};return JSON.stringify(e)}}!function(e){e.TERMINATE="terminate",e.ANSWER="answer",e.OFFER="offer",e.CANDIDATE="candidate",e.JSONRPC="jsonrpc",e.WALLET_INFO="wallet_info",e.WALLET_INIT="wallet_init",e.ORIGINATOR_INFO="originator_info",e.PAUSE="pause",e.OTP="otp",e.AUTHORIZED="authorized",e.PING="ping",e.READY="ready"}(Ai||(Ai={})),function(e){e.REQUEST="sdk_connect_request_started",e.REQUEST_MOBILE="sdk_connect_request_started_mobile",e.RECONNECT="sdk_reconnect_request_started",e.CONNECTED="sdk_connection_established",e.CONNECTED_MOBILE="sdk_connection_established_mobile",e.AUTHORIZED="sdk_connection_authorized",e.REJECTED="sdk_connection_rejected",e.TERMINATED="sdk_connection_terminated",e.DISCONNECTED="sdk_disconnected",e.SDK_USE_EXTENSION="sdk_use_extension",e.SDK_RPC_REQUEST="sdk_rpc_request",e.SDK_RPC_REQUEST_RECEIVED="sdk_rpc_request_received",e.SDK_RPC_REQUEST_DONE="sdk_rpc_request_done",e.SDK_EXTENSION_UTILIZED="sdk_extension_utilized",e.SDK_USE_INAPP_BROWSER="sdk_use_inapp_browser"}(Mi||(Mi={}));const Ii=(t,n,r)=>e(void 0,void 0,void 0,(function*(){var e,i,o,s,a,c;const{remote:l,state:d}=t,{channelId:u,isOriginator:h}=d;if("error_terminated"===n)return li.SocketService(`handleJoinChannelResults: Channel ${u} terminated`),void t.emit(_i.TERMINATE);if(!r)return void li.SocketService(`handleJoinChannelResults: No result for channel ${u}`);const{persistence:f,walletKey:p,rejected:g}=r;if(li.SocketService(`handleJoinChannelResults: Channel ${u} persistence=${f} walletKey=${p} rejected=${g}`),g)return li.SocketService(`handleJoinChannelResults: Channel ${u} rejected`),yield t.remote.disconnect({terminate:!0}),t.remote.emit(_i.REJECTED,{channelId:u}),void t.remote.emitServiceStatusEvent();if(p&&!(null===(e=l.state.channelConfig)||void 0===e?void 0:e.otherKey)){t.getKeyExchange().setOtherPublicKey(p),null===(i=t.state.keyExchange)||void 0===i||i.setKeysExchanged(!0),l.state.ready=!0,l.state.authorized=!0,l.emit(_i.AUTHORIZED);const{communicationLayer:e,storageManager:n}=l.state,r=Object.assign(Object.assign({},l.state.channelConfig),{channelId:null!==(o=l.state.channelId)&&void 0!==o?o:"",validUntil:Date.now()+vi,localKey:null==e?void 0:e.getKeyInfo().ecies.private,otherKey:p});t.sendMessage({type:ki.KEY_HANDSHAKE_ACK}).catch((e=>{})),null===(s=t.state.socket)||void 0===s||s.emit(Ai.PING,{id:u,clientType:h?"dapp":"wallet",context:"on_channel_reconnect",message:""}),yield null==n?void 0:n.persistChannelConfig(r),l.emitServiceStatusEvent(),l.setConnectionStatus(Si.LINKED)}f&&(t.emit(_i.CHANNEL_PERSISTENCE),null===(a=t.state.keyExchange)||void 0===a||a.setKeysExchanged(!0),l.state.ready=!0,l.state.authorized=!0,l.emit(_i.AUTHORIZED),fi(Object.assign(Object.assign({id:null!=u?u:"",event:h?Mi.CONNECTED:Mi.CONNECTED_MOBILE},t.remote.state.originatorInfo),{sdkVersion:t.remote.state.sdkVersion,commLayer:t.state.communicationLayerPreference,commLayerVersion:gi.version,walletVersion:null===(c=t.remote.state.walletInfo)||void 0===c?void 0:c.version}),d.communicationServerUrl).catch((e=>{})))})),Ri=e=>new Promise((t=>{setTimeout(t,e)})),Ti=(t,n,...r)=>e(void 0,[t,n,...r],void 0,(function*(e,t,n=200){let r;const i=Date.now();let o=!1;for(;!o;){if(o=Date.now()-i>3e5,r=t[e],void 0!==r.elapsedTime)return r;yield Ri(n)}throw new Error(`RPC ${e} timed out`)})),Pi=t=>e(void 0,void 0,void 0,(function*(){const{state:n}=t,{socket:r,channelId:i,context:o,isOriginator:s,isReconnecting:a}=n;if(a)return li.SocketService("[SocketService: reconnectSocket()] Reconnection already in progress, skipping",t),!1;if(!r)return li.SocketService("[SocketService: reconnectSocket()] socket is not defined",t),!1;if(!i)return!1;const{connected:c}=r;n.isReconnecting=!0,n.reconnectionAttempts=0,li.SocketService(`[SocketService: reconnectSocket()] connected=${c} trying to reconnect after socketio disconnection`,t);try{for(;3>n.reconnectionAttempts;){if(li.SocketService(`[SocketService: reconnectSocket()] Attempt ${n.reconnectionAttempts+1} of 3`,t),yield Ri(200),r.connected)return li.SocketService("Socket already connected --- ping to retrieve messages"),r.emit(Ai.PING,{id:i,clientType:s?"dapp":"wallet",context:"on_channel_config",message:""}),!0;n.resumed=!0,r.connect(),t.emit(_i.SOCKET_RECONNECT);try{if(yield new Promise(((n,a)=>{r.emit(_i.JOIN_CHANNEL,{channelId:i,context:`${o}connect_again`,clientType:s?"dapp":"wallet"},((r,i)=>e(void 0,void 0,void 0,(function*(){try{yield Ii(t,r,i),n()}catch(e){a(e)}}))))})),yield Ri(100),r.connected)return li.SocketService(`Reconnection successful on attempt ${n.reconnectionAttempts+1}`),!0}catch(e){li.SocketService(`Error during reconnection attempt ${n.reconnectionAttempts+1}:`,e)}n.reconnectionAttempts+=1,3>n.reconnectionAttempts&&(yield Ri(200))}return li.SocketService("Failed to reconnect after 3 attempts"),!1}finally{n.isReconnecting=!1,n.reconnectionAttempts=0}}));function Ni(t,n){return e(this,void 0,void 0,(function*(){var e;const r=null===(e=t.state.keyExchange)||void 0===e?void 0:e.encryptMessage(JSON.stringify(n)),i={id:t.state.channelId,context:t.state.context,clientType:t.state.isOriginator?"dapp":"wallet",message:r,plaintext:t.state.hasPlaintext?JSON.stringify(n):void 0};return li.SocketService(`[SocketService: encryptAndSendMessage()] context=${t.state.context}`,i),n.type===Ai.TERMINATE&&(t.state.manualDisconnect=!0),new Promise(((e,n)=>{var r;null===(r=t.state.socket)||void 0===r||r.emit(_i.MESSAGE,i,((t,r)=>{var i;t&&(li.SocketService(`[SocketService: encryptAndSendMessage()] error=${t}`),n(t)),li.SocketService("[encryptAndSendMessage] response",r),e(null!==(i=null==r?void 0:r.success)&&void 0!==i&&i)}))}))}))}var Li;!function(e){e.RPC_CHECK="rpcCheck",e.SKIPPED_RPC="skippedRpc"}(Li||(Li={}));const Di=["eth_sendTransaction","eth_signTypedData","eth_signTransaction","personal_sign","wallet_requestPermissions","wallet_switchEthereumChain","eth_signTypedData_v3","eth_signTypedData_v4","metamask_connectSign","metamask_connectWith","metamask_batch"].map((e=>e.toLowerCase()));const Ki=[{event:_i.CLIENTS_CONNECTED,handler:function(t,n){return r=>e(this,void 0,void 0,(function*(){var e,r,i,o,s,a,c,l,d,u,h;const f=null!==(r=null===(e=t.remote.state.channelConfig)||void 0===e?void 0:e.relayPersistence)&&void 0!==r&&r;if(li.SocketService(`[SocketService: handleClientsConnected()] context=${t.state.context} on 'clients_connected-${n}' relayPersistence=${f} resumed=${t.state.resumed}  clientsPaused=${t.state.clientsPaused} keysExchanged=${null===(i=t.state.keyExchange)||void 0===i?void 0:i.areKeysExchanged()} isOriginator=${t.state.isOriginator}`),t.emit(_i.CLIENTS_CONNECTED,{isOriginator:t.state.isOriginator,keysExchanged:null===(o=t.state.keyExchange)||void 0===o?void 0:o.areKeysExchanged(),context:t.state.context}),t.state.resumed)t.state.isOriginator||(li.SocketService(`[SocketService: handleClientsConnected()] context=${t.state.context} 'clients_connected' / keysExchanged=${null===(s=t.state.keyExchange)||void 0===s?void 0:s.areKeysExchanged()} -- backward compatibility`),null===(a=t.state.keyExchange)||void 0===a||a.start({isOriginator:null!==(c=t.state.isOriginator)&&void 0!==c&&c})),t.state.resumed=!1;else if(t.state.clientsPaused)li.SocketService("[SocketService: handleClientsConnected()] 'clients_connected' skip sending originatorInfo on pause");else if(!t.state.isOriginator){const e=!f;li.SocketService(`[SocketService: handleClientsConnected()] context=${t.state.context} on 'clients_connected' / keysExchanged=${null===(l=t.state.keyExchange)||void 0===l?void 0:l.areKeysExchanged()} -- force=${e} -- backward compatibility`),li.SocketService(`[SocketService: handleClientsConnected()] context=${t.state.context} on 'clients_connected' / keysExchanged=${null===(d=t.state.keyExchange)||void 0===d?void 0:d.areKeysExchanged()} -- force=${e} -- backward compatibility`),null===(u=t.state.keyExchange)||void 0===u||u.start({isOriginator:null!==(h=t.state.isOriginator)&&void 0!==h&&h,force:e})}t.state.clientsConnected=!0,t.state.clientsPaused=!1}))}},{event:_i.CHANNEL_CREATED,handler:function(e,t){return n=>{li.SocketService(`[SocketService: handleChannelCreated()] context=${e.state.context} on 'channel_created-${t}'`,n),e.emit(_i.CHANNEL_CREATED,n)}}},{event:_i.CLIENTS_DISCONNECTED,handler:function(e,t){return()=>{var n;e.state.clientsConnected=!1,li.SocketService(`[SocketService: handlesClientsDisconnected()] context=${e.state.context} on 'clients_disconnected-${t}'`),e.remote.state.relayPersistence?li.SocketService(`[SocketService: handlesClientsDisconnected()] context=${e.state.context} on 'clients_disconnected-${t}' - relayPersistence enabled, skipping key exchange cleanup.`):(e.state.isOriginator&&!e.state.clientsPaused&&(null===(n=e.state.keyExchange)||void 0===n||n.clean()),e.emit(_i.CLIENTS_DISCONNECTED,t))}}},{event:_i.CONFIG,handler:function(t,n){return r=>e(this,void 0,void 0,(function*(){var e,i,o;li.SocketService(`[SocketService: handleChannelConfig()] update relayPersistence on 'config-${n}'`,r);const{persistence:s,walletKey:a}=r;t.state.isOriginator&&t.remote.state.channelConfig?(r.walletKey&&!t.remote.state.channelConfig.otherKey&&(li.SocketService(`Setting wallet key ${a}`),t.remote.state.channelConfig.otherKey=a,t.getKeyExchange().setOtherPublicKey(r.walletKey),null===(e=t.state.keyExchange)||void 0===e||e.setKeysExchanged(!0),yield t.remote.sendMessage({type:ki.KEY_HANDSHAKE_ACK}),yield t.remote.sendMessage({type:Ai.PING}),yield null===(i=t.remote.state.storageManager)||void 0===i?void 0:i.persistChannelConfig(t.remote.state.channelConfig)),!0!==s||t.remote.state.channelConfig.relayPersistence||(li.SocketService(`Setting relay persistence ${s}`),t.remote.state.channelConfig.relayPersistence=s,t.remote.state.relayPersistence=!0,t.remote.emit(_i.CHANNEL_PERSISTENCE),t.remote.state.authorized=!0,t.remote.state.ready=!0,t.remote.emit(_i.AUTHORIZED),yield null===(o=t.remote.state.storageManager)||void 0===o?void 0:o.persistChannelConfig(t.remote.state.channelConfig))):t.state.isOriginator||r.persistence&&(t.remote.state.relayPersistence=!0,t.remote.emit(_i.CHANNEL_PERSISTENCE))}))}},{event:_i.MESSAGE,handler:function(e,t){return n=>{var r,i,o,s,a,c,l,d,u,h,f,p,g,m,y,v,b,E;const{ackId:w,message:S,error:_}=n,C=null!==(r=e.remote.state.relayPersistence)&&void 0!==r&&r;if(li.SocketService(`[SocketService handleMessage()]  relayPersistence=${C}  context=${e.state.context} on 'message' ${t} keysExchanged=${null===(i=e.state.keyExchange)||void 0===i?void 0:i.areKeysExchanged()}`,n),_)throw li.SocketService(`\n      [SocketService handleMessage()] context=${e.state.context}::on 'message' error=${_}`),new Error(_);const k="string"==typeof S;if(!k&&(null==S?void 0:S.type)===ki.KEY_HANDSHAKE_START){if(C)return;return li.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' received HANDSHAKE_START isOriginator=${e.state.isOriginator}`,S),void(null===(o=e.state.keyExchange)||void 0===o||o.start({isOriginator:null!==(s=e.state.isOriginator)&&void 0!==s&&s,force:!0}))}if(!k&&(null===(a=null==S?void 0:S.type)||void 0===a?void 0:a.startsWith("key_handshake"))){if(C)return;return li.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' emit KEY_EXCHANGE`,S),void e.emit(Ci.KEY_EXCHANGE,{message:S,context:e.state.context})}if(k&&!(null===(c=e.state.keyExchange)||void 0===c?void 0:c.areKeysExchanged())){let t=!1;try{li.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' trying to decrypt message`),null===(l=e.state.keyExchange)||void 0===l||l.decryptMessage(S),t=!0}catch(t){li.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' error`,t)}if(!t)return e.state.isOriginator?null===(u=e.state.keyExchange)||void 0===u||u.start({isOriginator:null!==(h=e.state.isOriginator)&&void 0!==h&&h}):e.sendMessage({type:ki.KEY_HANDSHAKE_START}).catch((e=>{})),void li.SocketService(`Message ignored because invalid key exchange status. step=${null===(f=e.state.keyExchange)||void 0===f?void 0:f.getKeyInfo().step}`,null===(p=e.state.keyExchange)||void 0===p?void 0:p.getKeyInfo(),S);li.SocketService("Invalid key exchange status detected --- updating it."),null===(d=e.state.keyExchange)||void 0===d||d.setKeysExchanged(!0)}else if(!k&&(null==S?void 0:S.type))return void e.emit(_i.MESSAGE,S);if(!k)return void e.emit(_i.MESSAGE,S);const A=null===(g=e.state.keyExchange)||void 0===g?void 0:g.decryptMessage(S),M=JSON.parse(null!=A?A:"{}");if(w&&(null==w?void 0:w.length)>0&&(li.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' ackid=${w} channelId=${t}`),null===(m=e.state.socket)||void 0===m||m.emit(_i.MESSAGE_ACK,{ackId:w,channelId:t,clientType:e.state.isOriginator?"dapp":"wallet"})),e.state.clientsPaused=(null==M?void 0:M.type)===Ai.PAUSE,e.state.isOriginator&&M.data){const t=M.data,n=e.state.rpcMethodTracker[t.id];if(n){const r=Date.now()-n.timestamp;li.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' received answer for id=${t.id} method=${n.method} responseTime=${r}`,M),e.remote.state.analytics&&Di.includes(n.method.toLowerCase())&&fi(Object.assign(Object.assign({id:null!==(y=e.remote.state.channelId)&&void 0!==y?y:"",event:Mi.SDK_RPC_REQUEST_DONE,sdkVersion:e.remote.state.sdkVersion,commLayerVersion:gi.version},e.remote.state.originatorInfo),{walletVersion:null===(v=e.remote.state.walletInfo)||void 0===v?void 0:v.version,params:{method:n.method,from:"mobile"}}),e.remote.state.communicationServerUrl).catch((e=>{}));const i=Object.assign(Object.assign({},n),{result:t.result,error:t.error?{code:null===(b=t.error)||void 0===b?void 0:b.code,message:null===(E=t.error)||void 0===E?void 0:E.message}:void 0,elapsedTime:r});e.state.rpcMethodTracker[t.id]=i,e.emit(_i.RPC_UPDATE,i)}}e.emit(_i.MESSAGE,{message:M})}}},{event:_i.REJECTED,handler:function(t,n){return r=>e(this,void 0,void 0,(function*(){var e;t.state.isOriginator&&!t.remote.state.ready?(li.SocketService(`[SocketService: handleChannelRejected()] context=${t.state.context} channelId=${n} isOriginator=${t.state.isOriginator} ready=${t.remote.state.ready}`,t.remote.state.originatorInfo),fi(Object.assign(Object.assign({id:n,event:Mi.REJECTED},t.remote.state.originatorInfo),{sdkVersion:t.remote.state.sdkVersion,commLayer:t.state.communicationLayerPreference,commLayerVersion:gi.version,walletVersion:null===(e=t.remote.state.walletInfo)||void 0===e?void 0:e.version}),t.remote.state.communicationServerUrl).catch((e=>{})),yield t.remote.disconnect({terminate:!0}),t.remote.emit(_i.REJECTED,{channelId:n}),t.remote.setConnectionStatus(Si.DISCONNECTED)):li.SocketService(`[SocketService: handleChannelRejected()] SKIP -- channelId=${n} isOriginator=${t.state.isOriginator} ready=${t.remote.state.ready}`)}))}},{event:"clients_waiting_to_join",handler:function(e,t){return n=>{li.SocketService(`[SocketService: handleClientsWaitingToJoin()] context=${e.state.context} on 'clients_waiting_to_join-${t}'`,n),e.emit(_i.CLIENTS_WAITING,n)}}}],Bi=[{event:_i.KEY_INFO,handler:function(e){return t=>{li.SocketService("[SocketService: handleKeyInfo()] on 'KEY_INFO'",t),e.emit(_i.KEY_INFO,t)}}},{event:_i.KEYS_EXCHANGED,handler:function(e){return()=>{var t,n,r;li.SocketService(`[SocketService: handleKeysExchanged()] on 'keys_exchanged' keyschanged=${null===(t=e.state.keyExchange)||void 0===t?void 0:t.areKeysExchanged()}`);const{channelConfig:i}=e.remote.state;if(i){const t=e.getKeyExchange().getKeyInfo().ecies;i.localKey=t.private,i.otherKey=t.otherPubKey,e.remote.state.channelConfig=i,null===(n=e.remote.state.storageManager)||void 0===n||n.persistChannelConfig(i).catch((e=>{}))}e.emit(_i.KEYS_EXCHANGED,{keysExchanged:null===(r=e.state.keyExchange)||void 0===r?void 0:r.areKeysExchanged(),isOriginator:e.state.isOriginator});const o={keyInfo:e.getKeyInfo()};e.emit(_i.SERVICE_STATUS,o)}}}];function ji(e,t){li.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} setting socket listeners for channel ${t}...`);const{socket:n}=e.state,{keyExchange:r}=e.state;n&&e.state.isOriginator&&(e.state.debug&&(null==n||n.io.on("error",(t=>{li.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} socket event=error`,t)})),null==n||n.io.on("reconnect",(t=>{li.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} socket event=reconnect`,t),Pi(e).catch((e=>{}))})),null==n||n.io.on("reconnect_error",(t=>{li.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} socket event=reconnect_error`,t)})),null==n||n.io.on("reconnect_failed",(()=>{li.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} socket event=reconnect_failed`)}))),null==n||n.on("disconnect",(t=>(li.SocketService(`[SocketService: setupChannelListener()] on 'disconnect' -- MetaMaskSDK socket disconnected '${t}' begin recovery...`),function(e){return t=>{li.SocketService(`[SocketService: handleDisconnect()] on 'disconnect' manualDisconnect=${e.state.manualDisconnect}`,t),e.state.manualDisconnect||(e.emit(_i.SOCKET_DISCONNECTED),Pi(e).catch((e=>{})))}}(e)(t))))),Ki.forEach((({event:r,handler:i})=>{null==n||n.on(`${r}-${t}`,i(e,t))})),Bi.forEach((({event:t,handler:n})=>{null==r||r.on(t,n(e))})),e.state.setupChannelListeners=!0}class $i extends s{constructor(e){super(),this.state={clientsConnected:!1,clientsPaused:!1,manualDisconnect:!1,lastRpcId:void 0,rpcMethodTracker:{},hasPlaintext:!1,communicationServerUrl:"",focusListenerAdded:!1,removeFocusListener:void 0,isReconnecting:!1,reconnectionAttempts:0},this.options=e;const{reconnect:n,communicationLayerPreference:r,communicationServerUrl:i,context:o,remote:s,logging:a}=e;this.state.resumed=n,this.state.context=o,this.state.isOriginator=s.state.isOriginator,this.state.communicationLayerPreference=r,this.state.debug=!0===(null==a?void 0:a.serviceLayer),this.remote=s,!0===(null==a?void 0:a.serviceLayer)&&t.enable("SocketService:Layer"),this.state.communicationServerUrl=i,this.state.hasPlaintext=this.state.communicationServerUrl!==mi&&!0===(null==a?void 0:a.plaintext),li.SocketService(`[SocketService: constructor()] Socket IO url: ${this.state.communicationServerUrl}`),this.initSocket()}initSocket(){var e;const{otherPublicKey:t,ecies:n,logging:r}=this.options,i={autoConnect:!1,transports:yi,withCredentials:!0},o=this.state.communicationServerUrl;li.SocketService(`[SocketService: initSocket()] Socket IO url: ${o}`),this.state.socket=l(o,i),function(e){if("undefined"!=typeof window&&"undefined"!=typeof document&&(li.SocketService(`[SocketService: setupSocketFocusListener()] hasFocus=${document.hasFocus()}`,e),!e.state.focusListenerAdded)){const t=()=>{li.SocketService("Document has focus --- reconnecting socket"),Pi(e).catch((e=>{}))};window.addEventListener("focus",t),e.state.focusListenerAdded=!0,e.state.removeFocusListener=()=>{window.removeEventListener("focus",t),e.state.focusListenerAdded=!1}}}(this);const s={communicationLayer:this,otherPublicKey:t,sendPublicKey:!1,context:null!==(e=this.state.context)&&void 0!==e?e:"",ecies:n,logging:r};this.state.keyExchange=new Oi(s)}resetKeys(){return li.SocketService("[SocketService: resetKeys()] Resetting keys."),void(null===(e=this.state.keyExchange)||void 0===e||e.resetKeys());var e}createChannel(){return e(this,void 0,void 0,(function*(){return function(t){return e(this,void 0,void 0,(function*(){var n,r,i;if(li.SocketService(`[SocketService: createChannel()] context=${t.state.context}`),t.state.socket||t.initSocket(),null===(n=t.state.socket)||void 0===n?void 0:n.connected)throw new Error("socket already connected");null===(r=t.state.socket)||void 0===r||r.connect(),t.state.manualDisconnect=!1,t.state.isOriginator=!0;const o=c();t.state.channelId=o,ji(t,o),yield new Promise(((n,r)=>{var i;null===(i=t.state.socket)||void 0===i||i.emit(_i.JOIN_CHANNEL,{channelId:o,context:`${t.state.context}createChannel`,clientType:"dapp"},((i,o)=>e(this,void 0,void 0,(function*(){try{yield Ii(t,i,o),n()}catch(e){r(e)}}))))}));const s=null===(i=t.state.keyExchange)||void 0===i?void 0:i.getKeyInfo();return{channelId:o,pubKey:(null==s?void 0:s.ecies.public)||"",privKey:(null==s?void 0:s.ecies.private)||""}}))}(this)}))}connectToChannel({channelId:t,withKeyExchange:n=!1,authorized:r}){return function(t){return e(this,arguments,void 0,(function*({options:t,instance:n}){const{channelId:r,authorized:i,withKeyExchange:o}=t,{state:s,remote:a}=n,{isOriginator:c=!1,socket:l,keyExchange:d}=s,{channelConfig:u}=a.state;if(null==l?void 0:l.connected)throw new Error("socket already connected");if(c&&(null==u?void 0:u.relayPersistence)){const{localKey:e,otherKey:t}=u;e&&t&&(null==d||d.setRelayPersistence({localKey:e,otherKey:t}))}return Object.assign(s,{manualDisconnect:!1,withKeyExchange:o,isOriginator:c,channelId:r}),null==l||l.connect(),ji(n,r),!c&&i&&(null==d||d.setKeysExchanged(!0),Object.assign(a.state,{ready:!0,authorized:!0})),new Promise((t=>{var o;const a=null===(o=null==d?void 0:d.getKeyInfo())||void 0===o?void 0:o.ecies.public;null==l||l.emit(_i.JOIN_CHANNEL,{channelId:r,context:`${s.context}_connectToChannel`,clientType:c?"dapp":"wallet",publicKey:i&&!c?a:void 0},((r,i)=>e(this,void 0,void 0,(function*(){yield Ii(n,r,i),t()}))))}))}))}({options:{channelId:t,withKeyExchange:n,authorized:r},instance:this})}getKeyInfo(){return this.state.keyExchange.getKeyInfo()}keyCheck(){var e,t;null===(t=(e=this).state.socket)||void 0===t||t.emit(_i.MESSAGE,{id:e.state.channelId,context:e.state.context,message:{type:ki.KEY_HANDSHAKE_CHECK,pubkey:e.getKeyInfo().ecies.otherPubKey}})}getKeyExchange(){return this.state.keyExchange}sendMessage(t){return e(this,void 0,void 0,(function*(){return function(t,n){return e(this,void 0,void 0,(function*(){var r,i,o;if(!t.state.channelId)throw li.SocketService("handleSendMessage: no channelId - Create a channel first"),new Error("Create a channel first");if(li.SocketService(`[SocketService: handleSendMessage()] context=${t.state.context} areKeysExchanged=${null===(r=t.state.keyExchange)||void 0===r?void 0:r.areKeysExchanged()}`,n),null===(i=null==n?void 0:n.type)||void 0===i?void 0:i.startsWith("key_handshake"))return function(e,t){var n;li.SocketService(`[SocketService: handleKeyHandshake()] context=${e.state.context}`,t),null===(n=e.state.socket)||void 0===n||n.emit(_i.MESSAGE,{id:e.state.channelId,context:e.state.context,clientType:e.state.isOriginator?"dapp":"wallet",message:t})}(t,n),!0;!function(e,t){var n;if(!(null===(n=e.state.keyExchange)||void 0===n?void 0:n.areKeysExchanged())&&!e.remote.state.relayPersistence)throw li.SocketService(`[SocketService: validateKeyExchange()] context=${e.state.context} ERROR keys not exchanged`,t),new Error("Keys not exchanged BBB")}(t,n),function(e,t){var n;const r=null!==(n=null==t?void 0:t.method)&&void 0!==n?n:"",i=null==t?void 0:t.id;e.state.isOriginator&&i&&(e.state.rpcMethodTracker[i]={id:i,timestamp:Date.now(),method:r},e.emit(_i.RPC_UPDATE,e.state.rpcMethodTracker[i]))}(t,n);const s=yield Ni(t,n);return t.remote.state.analytics&&t.remote.state.isOriginator&&n.method&&Di.includes(n.method.toLowerCase())&&fi({id:null!==(o=t.remote.state.channelId)&&void 0!==o?o:"",event:Mi.SDK_RPC_REQUEST,params:{method:n.method,from:"mobile"}},t.remote.state.communicationServerUrl).catch((e=>{})),function(t,n){return e(this,void 0,void 0,(function*(){var r;const i=null==n?void 0:n.id,o=null!==(r=null==n?void 0:n.method)&&void 0!==r?r:"";if(t.state.isOriginator&&i)try{const r=Ti(i,t.state.rpcMethodTracker,200).then((e=>({type:Li.RPC_CHECK,result:e}))),s=(()=>e(this,void 0,void 0,(function*(){const n=yield(t=>e(void 0,[t],void 0,(function*({rpcId:e,instance:t}){for(;t.state.lastRpcId===e||void 0===t.state.lastRpcId;)yield Ri(200);return t.state.lastRpcId})))({instance:t,rpcId:i}),r=yield Ti(n,t.state.rpcMethodTracker,200);return{type:Li.SKIPPED_RPC,result:r}})))(),a=yield Promise.race([r,s]);if(a.type===Li.RPC_CHECK){const e=a.result;li.SocketService(`[SocketService:handleRpcReplies()] id=${n.id} ${o} ( ${e.elapsedTime} ms)`,e.result)}else{if(a.type!==Li.SKIPPED_RPC)throw new Error(`Error handling RPC replies for ${i}`);{const e=Object.assign(Object.assign({},t.state.rpcMethodTracker[i]),{error:new Error("SDK_CONNECTION_ISSUE")});t.emit(_i.RPC_UPDATE,e);const n={data:Object.assign(Object.assign({},e),{jsonrpc:"2.0"}),name:"metamask-provider"};t.emit(_i.MESSAGE,{message:n})}}}catch(e){throw e}}))}(t,n).catch((e=>{})),s}))}(this,t)}))}ping(){return function(t){return e(this,void 0,void 0,(function*(){var e,n;li.SocketService(`[SocketService: ping()] context=${t.state.context} originator=${t.state.isOriginator} keysExchanged=${null===(e=t.state.keyExchange)||void 0===e?void 0:e.areKeysExchanged()}`),null===(n=t.state.socket)||void 0===n||n.emit(Ai.PING,{id:t.state.channelId,context:"ping",clientType:t.remote.state.isOriginator?"dapp":"wallet",message:""})}))}(this)}pause(){return function(t){return e(this,void 0,void 0,(function*(){var e,n;li.SocketService(`[SocketService: pause()] context=${t.state.context}`),t.state.manualDisconnect=!0,(null===(e=t.state.keyExchange)||void 0===e?void 0:e.areKeysExchanged())&&(yield t.sendMessage({type:Ai.PAUSE})),null===(n=t.state.socket)||void 0===n||n.disconnect()}))}(this)}isConnected(){var e;return null===(e=this.state.socket)||void 0===e?void 0:e.connected}resume(){return function(t){return e(this,void 0,void 0,(function*(){const{state:n,remote:r}=t,{socket:i,channelId:o,context:s,keyExchange:a,isOriginator:c}=n,{isOriginator:l}=r.state;if(li.SocketService(`[SocketService: resume()] channelId=${o} context=${s} connected=${null==i?void 0:i.connected} manualDisconnect=${n.manualDisconnect} resumed=${n.resumed} keysExchanged=${null==a?void 0:a.areKeysExchanged()}`),!o)throw li.SocketService("[SocketService: resume()] channelId is not defined"),new Error("ChannelId is not defined");(null==i?void 0:i.connected)?(li.SocketService("[SocketService: resume()] already connected."),i.emit(Ai.PING,{id:o,clientType:l?"dapp":"wallet",context:"on_channel_config",message:""}),r.hasRelayPersistence()||(null==a?void 0:a.areKeysExchanged())||(c?yield t.sendMessage({type:Ai.READY}):null==a||a.start({isOriginator:!1}))):(null==i||i.connect(),li.SocketService(`[SocketService: resume()] after connecting socket --\x3e connected=${null==i?void 0:i.connected}`),null==i||i.emit(_i.JOIN_CHANNEL,{channelId:o,context:`${s}_resume`,clientType:l?"dapp":"wallet"},((n,r)=>e(this,void 0,void 0,(function*(){try{yield Ii(t,n,r)}catch(e){}}))))),n.manualDisconnect=!1,n.resumed=!0}))}(this)}getRPCMethodTracker(){return this.state.rpcMethodTracker}disconnect(e){return function(e,t){var n,r,i,o,s;li.SocketService(`[SocketService: disconnect()] context=${e.state.context}`,t),(null==t?void 0:t.terminate)&&(null===(r=(n=e.state).removeFocusListener)||void 0===r||r.call(n),e.state.channelId=t.channelId,null===(i=e.state.socket)||void 0===i||i.removeAllListeners(),null===(o=e.state.keyExchange)||void 0===o||o.clean(),e.remote.state.ready=!1,e.state.socket=void 0,e.state.rpcMethodTracker={}),e.state.manualDisconnect=!0,null===(s=e.state.socket)||void 0===s||s.disconnect()}(this,e)}}var Ui,Hi,Fi;function zi(t){return()=>e(this,void 0,void 0,(function*(){var n,r,i;const{state:o}=t;if(o.authorized)return;yield(()=>e(this,void 0,void 0,(function*(){for(;!o.walletInfo;)yield Ri(500)})))();const s="7.3".localeCompare((null===(n=o.walletInfo)||void 0===n?void 0:n.version)||"");if(li.RemoteCommunication(`[RemoteCommunication: handleAuthorizedEvent()] HACK 'authorized' version=${null===(r=o.walletInfo)||void 0===r?void 0:r.version} compareValue=${s}`),1!==s)return;const a=o.platformType===Hi.MobileWeb||o.platformType===Hi.ReactNative||o.platformType===Hi.MetaMaskMobileWebview;li.RemoteCommunication(`[RemoteCommunication: handleAuthorizedEvent()] HACK 'authorized' platform=${o.platformType} secure=${a} channel=${o.channelId} walletVersion=${null===(i=o.walletInfo)||void 0===i?void 0:i.version}`),a&&(o.authorized=!0,t.emit(_i.AUTHORIZED))}))}function qi(e){return t=>{const{state:n}=e;li.RemoteCommunication(`[RemoteCommunication: handleChannelCreatedEvent()] context=${n.context} on 'channel_created' channelId=${t}`),e.emit(_i.CHANNEL_CREATED,t)}}function Wi(e,t){return()=>{var n,r,i,o;const{state:s}=e;li.RemoteCommunication(`[RemoteCommunication: handleClientsConnectedEvent()] on 'clients_connected' channel=${s.channelId} keysExchanged=${null===(r=null===(n=s.communicationLayer)||void 0===n?void 0:n.getKeyInfo())||void 0===r?void 0:r.keysExchanged}`),s.analytics&&fi(Object.assign(Object.assign({id:null!==(i=s.channelId)&&void 0!==i?i:"",event:s.reconnection?Mi.RECONNECT:s.isOriginator?Mi.REQUEST:Mi.REQUEST_MOBILE},s.originatorInfo),{commLayer:t,sdkVersion:s.sdkVersion,walletVersion:null===(o=s.walletInfo)||void 0===o?void 0:o.version,commLayerVersion:gi.version}),s.communicationServerUrl).catch((e=>{})),s.clientsConnected=!0,s.originatorInfoSent=!1,e.emit(_i.CLIENTS_CONNECTED)}}function Vi(e){return t=>{const{state:n}=e;li.RemoteCommunication(`[RemoteCommunication: handleClientsDisconnectedEvent()] context=${n.context} on 'clients_disconnected' channelId=${t}`),n.relayPersistence||(n.clientsConnected=!1,n.ready=!1,n.authorized=!1),e.emit(_i.CLIENTS_DISCONNECTED,n.channelId),e.setConnectionStatus(Si.DISCONNECTED)}}function Gi(e){return t=>{var n;const{state:r}=e;if(li.RemoteCommunication(`[RemoteCommunication: handleClientsWaitingEvent()] context=${r.context} on 'clients_waiting' numberUsers=${t} ready=${r.ready} autoStarted=${r.originatorConnectStarted}`),e.setConnectionStatus(Si.WAITING),e.emit(_i.CLIENTS_WAITING,t),r.originatorConnectStarted){li.RemoteCommunication(`[RemoteCommunication: handleClientsWaitingEvent()] on 'clients_waiting' watch autoStarted=${r.originatorConnectStarted} timeout`,r.autoConnectOptions);const t=(null===(n=r.autoConnectOptions)||void 0===n?void 0:n.timeout)||3e3,i=setTimeout((()=>{li.RemoteCommunication(`[RemoteCommunication: handleClientsWaitingEvent()] setTimeout(${t}) terminate channelConfig`,r.autoConnectOptions),r.originatorConnectStarted=!1,r.ready||e.setConnectionStatus(Si.TIMEOUT),clearTimeout(i)}),t)}}}function Yi(e,t){return n=>{var r,i,o,s,a,c,l,d;const{state:u}=e;if(li.RemoteCommunication(`[RemoteCommunication: handleKeysExchangedEvent()] context=${u.context} on commLayer.'keys_exchanged' channel=${u.channelId}`,n),null===(i=null===(r=u.communicationLayer)||void 0===r?void 0:r.getKeyInfo())||void 0===i?void 0:i.keysExchanged){const t=Object.assign(Object.assign({},u.channelConfig),{channelId:null!==(o=u.channelId)&&void 0!==o?o:"",validUntil:(null===(s=u.channelConfig)||void 0===s?void 0:s.validUntil)||vi,localKey:u.communicationLayer.getKeyInfo().ecies.private,otherKey:u.communicationLayer.getKeyInfo().ecies.otherPubKey});null===(a=u.storageManager)||void 0===a||a.persistChannelConfig(t).catch((e=>{})),e.setConnectionStatus(Si.LINKED)}!function(e,t){var n,r,i,o,s,a,c,l;const{state:d}=e;li.RemoteCommunication(`[RemoteCommunication: setLastActiveDate()] channel=${d.channelId}`,t);const u=Object.assign(Object.assign({},d.channelConfig),{channelId:null!==(n=d.channelId)&&void 0!==n?n:"",validUntil:null!==(i=null===(r=d.channelConfig)||void 0===r?void 0:r.validUntil)&&void 0!==i?i:0,relayPersistence:d.relayPersistence,localKey:null===(s=null===(o=d.communicationLayer)||void 0===o?void 0:o.state.keyExchange)||void 0===s?void 0:s.getKeyInfo().ecies.private,otherKey:null===(c=null===(a=d.communicationLayer)||void 0===a?void 0:a.state.keyExchange)||void 0===c?void 0:c.getKeyInfo().ecies.otherPubKey,lastActive:t.getTime()});null===(l=d.storageManager)||void 0===l||l.persistChannelConfig(u)}(e,new Date),u.analytics&&u.channelId&&fi(Object.assign(Object.assign({id:u.channelId,event:n.isOriginator?Mi.CONNECTED:Mi.CONNECTED_MOBILE},u.originatorInfo),{sdkVersion:u.sdkVersion,commLayer:t,commLayerVersion:gi.version,walletVersion:null===(c=u.walletInfo)||void 0===c?void 0:c.version}),u.communicationServerUrl).catch((e=>{})),u.isOriginator=n.isOriginator,n.isOriginator||(null===(l=u.communicationLayer)||void 0===l||l.sendMessage({type:Ai.READY}),u.ready=!0,u.paused=!1),n.isOriginator&&!u.originatorInfoSent&&(null===(d=u.communicationLayer)||void 0===d||d.sendMessage({type:Ai.ORIGINATOR_INFO,originatorInfo:u.originatorInfo,originator:u.originatorInfo}),u.originatorInfoSent=!0)}}function Ji(t){return n=>{let r=n;n.message&&(r=r.message),function(t,n){const{state:r}=n;if(li.RemoteCommunication(`[RemoteCommunication: onCommunicationLayerMessage()] context=${r.context} on 'message' typeof=${typeof t}`,t),n.state.ready=!0,r.isOriginator||t.type!==Ai.ORIGINATOR_INFO)if(r.isOriginator&&t.type===Ai.WALLET_INFO)!function(e,t){const{state:n}=e;n.walletInfo=t.walletInfo,n.paused=!1}(n,t);else{if(r.isOriginator&&t.type===Ai.WALLET_INIT)(function(t,n){return e(this,void 0,void 0,(function*(){var e,r,i;const{state:o}=t;if(o.isOriginator){const o=n.data||{};if("object"==typeof o&&"accounts"in o&&"chainId"in o&&"walletKey"in o)try{const{channelConfig:n}=t.state;if(li.RemoteCommunication("WALLET_INIT: channelConfig",JSON.stringify(n,null,2)),n){const s=o.accounts,a=o.chainId,c=o.walletKey;let l,d=!1;"deeplinkProtocol"in o&&(d=Boolean(o.deeplinkProtocol),t.state.deeplinkProtocolAvailable=d),"walletVersion"in o&&(l=o.walletVersion),yield null===(e=t.state.storageManager)||void 0===e?void 0:e.persistChannelConfig(Object.assign(Object.assign({},n),{otherKey:c,walletVersion:l,deeplinkProtocolAvailable:d,relayPersistence:!0})),yield null===(r=t.state.storageManager)||void 0===r?void 0:r.persistAccounts(s),yield null===(i=t.state.storageManager)||void 0===i?void 0:i.persistChainId(a)}t.emit(_i.WALLET_INIT,{accounts:o.accounts,chainId:o.chainId})}catch(e){}}}))})(n,t).catch((e=>{li.RemoteCommunication(`[RemoteCommunication: onCommunicationLayerMessage()] error=${e}`)}));else if(t.type===Ai.TERMINATE)(function(t){return e(this,void 0,void 0,(function*(){const{state:e}=t;e.isOriginator&&(yield to({options:{terminate:!0,sendMessage:!1},instance:t}),t.emit(_i.TERMINATE))}))})(n).catch((e=>{li.RemoteCommunication(`[RemoteCommunication: onCommunicationLayerMessage()] error=${e}`)}));else if(t.type===Ai.PAUSE)!function(e){const{state:t}=e;t.paused=!0,e.setConnectionStatus(Si.PAUSED)}(n);else if(t.type===Ai.READY&&r.isOriginator)!function(e){const{state:t}=e;e.setConnectionStatus(Si.LINKED);const n=t.paused;t.paused=!1,e.emit(_i.CLIENTS_READY,{isOriginator:t.isOriginator,walletInfo:t.walletInfo}),n&&(t.authorized=!0,e.emit(_i.AUTHORIZED))}(n);else{if(t.type===Ai.OTP&&r.isOriginator)return void function(e,t){var n;const{state:r}=e;e.emit(_i.OTP,t.otpAnswer),1==="6.6".localeCompare((null===(n=r.walletInfo)||void 0===n?void 0:n.version)||"")&&e.emit(_i.SDK_RPC_CALL,{method:Ei.ETH_REQUESTACCOUNTS,params:[]})}(n,t);t.type===Ai.AUTHORIZED&&r.isOriginator&&function(e){const{state:t}=e;t.authorized=!0,e.emit(_i.AUTHORIZED)}(n)}n.emit(_i.MESSAGE,t)}else!function(e,t){var n;const{state:r}=e;null===(n=r.communicationLayer)||void 0===n||n.sendMessage({type:Ai.WALLET_INFO,walletInfo:r.walletInfo}),r.originatorInfo=t.originatorInfo||t.originator,e.emit(_i.CLIENTS_READY,{isOriginator:r.isOriginator,originatorInfo:r.originatorInfo}),r.paused=!1}(n,t)}(r,t)}}function Zi(e){return()=>{const{state:t}=e;li.RemoteCommunication("[RemoteCommunication: handleSocketReconnectEvent()] on 'socket_reconnect' -- reset key exchange status / set ready to false"),t.ready=!1,t.authorized=!1,wi(t),e.emitServiceStatusEvent({context:"socket_reconnect"})}}function Xi(e){return()=>{const{state:t}=e;li.RemoteCommunication("[RemoteCommunication: handleSocketDisconnectedEvent()] on 'socket_Disconnected' set ready to false"),t.ready=!1}}function Qi(t){return()=>e(this,void 0,void 0,(function*(){var e,n,r,i,o,s,a;const{state:c}=t;li.RemoteCommunication(`[RemoteCommunication: handleFullPersistenceEvent()] context=${c.context}`),t.state.ready=!0,t.state.clientsConnected=!0,t.state.authorized=!0,t.state.relayPersistence=!0,null===(e=t.state.communicationLayer)||void 0===e||e.getKeyExchange().setKeysExchanged(!0),t.emit(_i.KEYS_EXCHANGED,{keysExchanged:!0,isOriginator:!0}),t.emit(_i.AUTHORIZED),t.emit(_i.CLIENTS_READY),t.emit(_i.CHANNEL_PERSISTENCE);try{c.channelConfig=Object.assign(Object.assign({},c.channelConfig),{localKey:null===(n=c.communicationLayer)||void 0===n?void 0:n.getKeyExchange().getKeyInfo().ecies.private,otherKey:null===(r=c.communicationLayer)||void 0===r?void 0:r.getKeyExchange().getOtherPublicKey(),channelId:null!==(i=c.channelId)&&void 0!==i?i:"",validUntil:null!==(s=null===(o=c.channelConfig)||void 0===o?void 0:o.validUntil)&&void 0!==s?s:vi,relayPersistence:!0}),yield null===(a=c.storageManager)||void 0===a?void 0:a.persistChannelConfig(c.channelConfig)}catch(e){}}))}function eo({communicationLayerPreference:e,otherPublicKey:t,reconnect:n,ecies:r,communicationServerUrl:i=mi,instance:o}){var s,a,c,l,d,u,h,f,p,g,m;const{state:y}=o;if(li.RemoteCommunication("[initCommunicationLayer()] ",JSON.stringify(y,null,2)),e!==Ui.SOCKET)throw new Error("Invalid communication protocol");y.communicationLayer=new $i({communicationLayerPreference:e,otherPublicKey:t,reconnect:n,transports:y.transports,communicationServerUrl:i,context:y.context,ecies:r,logging:y.logging,remote:o});let v="undefined"!=typeof document&&document.URL||"",b="undefined"!=typeof document&&document.title||"";(null===(s=y.dappMetadata)||void 0===s?void 0:s.url)&&(v=y.dappMetadata.url),(null===(a=y.dappMetadata)||void 0===a?void 0:a.name)&&(b=y.dappMetadata.name);const E=null!==(u=null!==(l=null===(c=y.dappMetadata)||void 0===c?void 0:c.name)&&void 0!==l?l:null===(d=y.dappMetadata)||void 0===d?void 0:d.url)&&void 0!==u?u:"N/A",w="undefined"!=typeof window&&void 0!==window.location&&null!==(h=window.location.hostname)&&void 0!==h?h:E,S={url:v,title:b,source:null===(f=y.dappMetadata)||void 0===f?void 0:f.source,dappId:w,icon:(null===(p=y.dappMetadata)||void 0===p?void 0:p.iconUrl)||(null===(g=y.dappMetadata)||void 0===g?void 0:g.base64Icon),platform:y.platformType,apiVersion:gi.version,connector:null===(m=y.dappMetadata)||void 0===m?void 0:m.connector};y.originatorInfo=S;const _={[_i.AUTHORIZED]:zi(o),[_i.MESSAGE]:Ji(o),[_i.CHANNEL_PERSISTENCE]:Qi(o),[_i.CLIENTS_CONNECTED]:Wi(o,e),[_i.KEYS_EXCHANGED]:Yi(o,e),[_i.SOCKET_DISCONNECTED]:Xi(o),[_i.SOCKET_RECONNECT]:Zi(o),[_i.CLIENTS_DISCONNECTED]:Vi(o),[_i.KEY_INFO]:()=>{},[_i.CHANNEL_CREATED]:qi(o),[_i.CLIENTS_WAITING]:Gi(o),[_i.RPC_UPDATE]:e=>{o.emit(_i.RPC_UPDATE,e)}};for(const[t,n]of Object.entries(_))try{y.communicationLayer.on(t,n)}catch(e){}}function to(t){return e(this,arguments,void 0,(function*({options:e,instance:t}){const{state:n}=t;return li.RemoteCommunication(`[RemoteCommunication: disconnect()] channel=${n.channelId}`,e),new Promise(((r,i)=>{var o,s,a,l,d,u;(null==e?void 0:e.terminate)?(t.state.ready&&fi({id:null!==(o=t.state.channelId)&&void 0!==o?o:"",event:Mi.TERMINATED},t.state.communicationServerUrl).catch((e=>{})),n.ready=!1,n.paused=!1,null===(s=n.storageManager)||void 0===s||s.terminate(null!==(a=n.channelId)&&void 0!==a?a:""),t.state.terminated=!0,e.sendMessage?(null===(l=n.communicationLayer)||void 0===l?void 0:l.getKeyInfo().keysExchanged)&&t.state.communicationLayer&&Ni(t.state.communicationLayer,{type:Ai.TERMINATE}).then((()=>{r(!0)})).catch((e=>{i(e)})):r(!0),n.authorized=!1,n.relayPersistence=!1,n.channelId=c(),e.channelId=n.channelId,n.channelConfig=void 0,n.originatorConnectStarted=!1,null===(d=n.communicationLayer)||void 0===d||d.disconnect(e),t.setConnectionStatus(Si.TERMINATED)):(null===(u=n.communicationLayer)||void 0===u||u.disconnect(e),t.setConnectionStatus(Si.DISCONNECTED),r(!0))}))}))}(Ui||(Ui={})).SOCKET="socket",function(e){e.NonBrowser="nodejs",e.MetaMaskMobileWebview="in-app-browser",e.DesktopWeb="web-desktop",e.MobileWeb="web-mobile",e.ReactNative="react-native"}(Hi||(Hi={}));class no extends s{constructor(e){super(),this.state={ready:!1,authorized:!1,isOriginator:!1,terminated:!1,protocolVersion:1,paused:!1,deeplinkProtocolAvailable:!1,platformType:"metamask-mobile",analytics:!1,reconnection:!1,originatorInfoSent:!1,communicationServerUrl:mi,context:"",persist:!1,clientsConnected:!1,sessionDuration:vi,originatorConnectStarted:!1,debug:!1,_connectionStatus:Si.DISCONNECTED},this._options=e;const{platformType:n,communicationLayerPreference:r,otherPublicKey:i,reconnect:o,walletInfo:s,dappMetadata:a,protocolVersion:c,transports:l,context:d,relayPersistence:u,ecies:h,analytics:f=!1,storage:p,sdkVersion:g,communicationServerUrl:m=mi,logging:y,autoConnect:v={timeout:bi}}=e;this.state.otherPublicKey=i,this.state.dappMetadata=a,this.state.walletInfo=s,this.state.transports=l,this.state.platformType=n,this.state.analytics=f,this.state.protocolVersion=null!=c?c:1,this.state.isOriginator=!i,this.state.relayPersistence=u,this.state.communicationServerUrl=m,this.state.context=d,this.state.terminated=!1,this.state.sdkVersion=g,this.setMaxListeners(50),this.setConnectionStatus(Si.DISCONNECTED),(null==p?void 0:p.duration)&&(this.state.sessionDuration=vi),this.state.storageOptions=p,this.state.autoConnectOptions=v,this.state.debug=!0===(null==y?void 0:y.remoteLayer),!0===(null==y?void 0:y.remoteLayer)&&t.enable("RemoteCommunication:Layer"),!0===(null==y?void 0:y.serviceLayer)&&t.enable("SocketService:Layer"),!0===(null==y?void 0:y.eciesLayer)&&t.enable("ECIES:Layer"),!0===(null==y?void 0:y.keyExchangeLayer)&&t.enable("KeyExchange:Layer"),this.state.logging=y,(null==p?void 0:p.storageManager)&&(this.state.storageManager=p.storageManager),li.RemoteCommunication(`[RemoteCommunication: constructor()] protocolVersion=${c} relayPersistence=${u} isOriginator=${this.state.isOriginator} communicationLayerPreference=${r} otherPublicKey=${i} reconnect=${o}`),this.state.isOriginator||eo({communicationLayerPreference:r,otherPublicKey:i,reconnect:o,ecies:h,communicationServerUrl:m,instance:this}),this.emitServiceStatusEvent({context:"constructor"})}initFromDappStorage(){return e(this,void 0,void 0,(function*(){var e;if(this.state.storageManager){const t=yield this.state.storageManager.getPersistedChannelConfig({});t&&(this.state.channelConfig=t,this.state.channelId=t.channelId,this.state.deeplinkProtocolAvailable=null!==(e=t.deeplinkProtocolAvailable)&&void 0!==e&&e,t.relayPersistence&&(this.state.authorized=!0,this.state.ready=!0,this.setConnectionStatus(Si.LINKED),yield this.connectToChannel({channelId:t.channelId})))}eo({communicationLayerPreference:Ui.SOCKET,otherPublicKey:this.state.otherPublicKey,reconnect:this._options.reconnect,ecies:this._options.ecies,communicationServerUrl:this.state.communicationServerUrl,instance:this})}))}originatorSessionConnect(){return e(this,void 0,void 0,(function*(){return yield function(t){return e(this,void 0,void 0,(function*(){var e;const{state:n}=t;if(!n.storageManager)return void li.RemoteCommunication("[RemoteCommunication: originatorSessionConnect()] no storage manager defined - skip");const r=yield n.storageManager.getPersistedChannelConfig({});if(li.RemoteCommunication(`[RemoteCommunication: originatorSessionConnect()] autoStarted=${n.originatorConnectStarted} channelConfig`,r),null===(e=n.communicationLayer)||void 0===e?void 0:e.isConnected())return li.RemoteCommunication("[RemoteCommunication: originatorSessionConnect()] socket already connected - skip"),r;if(r){if(r.validUntil>Date.now())return n.channelConfig=r,n.originatorConnectStarted=!0,n.channelId=null==r?void 0:r.channelId,n.reconnection=!0,r;li.RemoteCommunication("[RemoteCommunication: autoConnect()] Session has expired")}n.originatorConnectStarted=!1}))}(this)}))}generateChannelIdConnect(){return e(this,void 0,void 0,(function*(){return function(t){return e(this,void 0,void 0,(function*(){var e,n,r,i,o,s;if(!t.communicationLayer)throw new Error("communication layer not initialized");if(t.ready)throw new Error("Channel already connected");if(t.channelId&&(null===(e=t.communicationLayer)||void 0===e?void 0:e.isConnected()))return t.channelConfig=Object.assign(Object.assign({},t.channelConfig),{channelId:t.channelId,validUntil:Date.now()+t.sessionDuration}),null===(n=t.storageManager)||void 0===n||n.persistChannelConfig(t.channelConfig),{channelId:t.channelId,privKey:null===(i=null===(r=t.communicationLayer)||void 0===r?void 0:r.getKeyInfo())||void 0===i?void 0:i.ecies.private,pubKey:null===(s=null===(o=t.communicationLayer)||void 0===o?void 0:o.getKeyInfo())||void 0===s?void 0:s.ecies.public};li.RemoteCommunication("[RemoteCommunication: generateChannelId()]");const a=yield t.communicationLayer.createChannel();li.RemoteCommunication("[RemoteCommunication: generateChannelId()] channel created",a);const c=Object.assign(Object.assign({},t.channelConfig),{channelId:a.channelId,localKey:a.privKey,validUntil:Date.now()+t.sessionDuration});return t.channelId=a.channelId,t.channelConfig=c,{channelId:t.channelId,pubKey:a.pubKey,privKey:a.privKey}}))}(this.state)}))}clean(){return wi(this.state)}connectToChannel({channelId:t,withKeyExchange:n,authorized:r}){return function(t){return e(this,arguments,void 0,(function*({channelId:e,withKeyExchange:t,authorized:n,state:r}){var i,o,s;if(!a(e))throw li.RemoteCommunication(`[RemoteCommunication: connectToChannel()] context=${r.context} invalid channel channelId=${e}`),new Error(`Invalid channel ${e}`);if(li.RemoteCommunication(`[RemoteCommunication: connectToChannel()] context=${r.context} channelId=${e} withKeyExchange=${t}`),null===(i=r.communicationLayer)||void 0===i?void 0:i.isConnected())return void li.RemoteCommunication(`[RemoteCommunication: connectToChannel()] context=${r.context} already connected - interrupt connection.`);r.channelId=e,yield null===(o=r.communicationLayer)||void 0===o?void 0:o.connectToChannel({channelId:e,authorized:n,withKeyExchange:t});const c=Object.assign(Object.assign({},r.channelConfig),{channelId:e,validUntil:Date.now()+r.sessionDuration});r.channelConfig=c,null===(s=r.storageManager)||void 0===s||s.persistChannelConfig(c)}))}({channelId:t,authorized:r,withKeyExchange:n,state:this.state})}sendMessage(t){return function(t,n){return e(this,void 0,void 0,(function*(){var r,i;const{state:o}=t;li.RemoteCommunication(`[RemoteCommunication: sendMessage()] context=${o.context} paused=${o.paused} ready=${o.ready} relayPersistence=${o.relayPersistence} authorized=${o.authorized} socket=${null===(r=o.communicationLayer)||void 0===r?void 0:r.isConnected()} clientsConnected=${o.clientsConnected} status=${o._connectionStatus}`,n),o.relayPersistence||o.ready&&(null===(i=o.communicationLayer)||void 0===i?void 0:i.isConnected())&&o.clientsConnected||(li.RemoteCommunication(`[RemoteCommunication: sendMessage()] context=${o.context}  SKIP message waiting for MM mobile readiness.`),yield new Promise((e=>{t.once(_i.CLIENTS_READY,e)})),li.RemoteCommunication(`[RemoteCommunication: sendMessage()] context=${o.context}  AFTER SKIP / READY -- sending pending message`));try{const r=yield function(t,n){return e(this,void 0,void 0,(function*(){return new Promise((e=>{var r;const{state:i}=t;li.RemoteCommunication(`[RemoteCommunication: handleAuthorization()] context=${i.context} ready=${i.ready} authorized=${i.authorized} method=${n.method}`),!i.isOriginator||i.authorized||i.relayPersistence?null===(r=i.communicationLayer)||void 0===r||r.sendMessage(n).then((t=>{e(t)})).catch((t=>{e(!1)})):t.once(_i.AUTHORIZED,(()=>{var t;li.RemoteCommunication(`[RemoteCommunication: handleAuthorization()] context=${i.context}  AFTER SKIP / AUTHORIZED -- sending pending message`),null===(t=i.communicationLayer)||void 0===t||t.sendMessage(n).then((t=>{e(t)})).catch((t=>{e(!1)}))}))}))}))}(t,n);return r}catch(e){throw e}}))}(this,t)}testStorage(){return e(this,void 0,void 0,(function*(){return function(t){return e(this,void 0,void 0,(function*(){var e;const n=yield null===(e=t.storageManager)||void 0===e?void 0:e.getPersistedChannelConfig();li.RemoteCommunication("[RemoteCommunication: testStorage()] res",n)}))}(this.state)}))}hasDeeplinkProtocol(){return this.state.deeplinkProtocolAvailable}getChannelConfig(){return this.state.channelConfig}isReady(){return this.state.ready}isConnected(){var e;return null===(e=this.state.communicationLayer)||void 0===e?void 0:e.isConnected()}isAuthorized(){return this.state.authorized}isPaused(){return this.state.paused}getCommunicationLayer(){return this.state.communicationLayer}ping(){return e(this,void 0,void 0,(function*(){var e;li.RemoteCommunication(`[RemoteCommunication: ping()] channel=${this.state.channelId}`),yield null===(e=this.state.communicationLayer)||void 0===e?void 0:e.ping()}))}testLogger(){li.RemoteCommunication(`testLogger() channel=${this.state.channelId}`),li.SocketService(`testLogger() channel=${this.state.channelId}`),li.Ecies(`testLogger() channel=${this.state.channelId}`),li.KeyExchange(`testLogger() channel=${this.state.channelId}`)}keyCheck(){var e;li.RemoteCommunication(`[RemoteCommunication: keyCheck()] channel=${this.state.channelId}`),null===(e=this.state.communicationLayer)||void 0===e||e.keyCheck()}setConnectionStatus(e){this.state._connectionStatus!==e&&(this.state._connectionStatus=e,this.emit(_i.CONNECTION_STATUS,e),this.emitServiceStatusEvent({context:"setConnectionStatus"}))}emitServiceStatusEvent(e={}){this.emit(_i.SERVICE_STATUS,this.getServiceStatus())}getConnectionStatus(){return this.state._connectionStatus}getServiceStatus(){return{originatorInfo:this.state.originatorInfo,keyInfo:this.getKeyInfo(),connectionStatus:this.state._connectionStatus,channelConfig:this.state.channelConfig,channelId:this.state.channelId}}getKeyInfo(){var e;return null===(e=this.state.communicationLayer)||void 0===e?void 0:e.getKeyInfo()}resetKeys(){var e;null===(e=this.state.communicationLayer)||void 0===e||e.resetKeys()}setOtherPublicKey(e){var t;const n=null===(t=this.state.communicationLayer)||void 0===t?void 0:t.getKeyExchange();if(!n)throw new Error("KeyExchange is not initialized.");n.getOtherPublicKey()!==e&&n.setOtherPublicKey(e)}pause(){return e(this,void 0,void 0,(function*(){var e;li.RemoteCommunication(`[RemoteCommunication: pause()] channel=${this.state.channelId}`),yield null===(e=this.state.communicationLayer)||void 0===e?void 0:e.pause(),this.setConnectionStatus(Si.PAUSED)}))}getVersion(){return gi.version}hasRelayPersistence(){var e;return null!==(e=this.state.relayPersistence)&&void 0!==e&&e}resume(){return e(this,void 0,void 0,(function*(){return function(t){return e(this,void 0,void 0,(function*(){var e;const{state:n}=t;li.RemoteCommunication(`[RemoteCommunication: resume()] channel=${n.channelId}`),yield null===(e=n.communicationLayer)||void 0===e?void 0:e.resume(),t.setConnectionStatus(Si.LINKED)}))}(this)}))}encrypt(e){var t,n,r;const i=null===(t=this.state.communicationLayer)||void 0===t?void 0:t.getKeyExchange(),o=null==i?void 0:i.getOtherPublicKey();if(!o)throw new Error("KeyExchange not completed");return null===(r=null===(n=this.state.communicationLayer)||void 0===n?void 0:n.state.eciesInstance)||void 0===r?void 0:r.encrypt(e,o)}decrypt(e){var t,n,r;if(!(null===(t=this.state.communicationLayer)||void 0===t?void 0:t.state.eciesInstance))throw new Error("ECIES instance is not initialized");return null===(r=null===(n=this.state.communicationLayer)||void 0===n?void 0:n.state.eciesInstance)||void 0===r?void 0:r.decrypt(e)}getChannelId(){return this.state.channelId}getRPCMethodTracker(){var e;return null===(e=this.state.communicationLayer)||void 0===e?void 0:e.getRPCMethodTracker()}reject({channelId:t}){return function(t){return e(this,arguments,void 0,(function*({channelId:e,state:t}){var n,r,i;if(!a(e))throw li.RemoteCommunication(`[RemoteCommunication: connectToChannel()] context=${t.context} invalid channel channelId=${e}`),new Error(`Invalid channel ${e}`);if(t.isOriginator)return void li.RemoteCommunication(`[RemoteCommunication: reject()] context=${t.context} isOriginator=${t.isOriginator} channelId=${e}`);const{socket:o}=null!==(r=null===(n=t.communicationLayer)||void 0===n?void 0:n.state)&&void 0!==r?r:{};(null==o?void 0:o.connected)||(li.RemoteCommunication(`[RemoteCommunication: reject()] context=${t.context} socket already connected`),null==o||o.connect()),fi(Object.assign(Object.assign({id:e,event:Mi.REJECTED},t.originatorInfo),{sdkVersion:t.sdkVersion,commLayerVersion:gi.version,walletVersion:null===(i=t.walletInfo)||void 0===i?void 0:i.version}),t.communicationServerUrl).catch((e=>{})),yield new Promise(((n,r)=>{null==o||o.emit(_i.REJECTED,{channelId:e},((e,i)=>{li.RemoteCommunication(`[RemoteCommunication: reject()] context=${t.context} socket=${null==o?void 0:o.id}`,{error:e,response:i}),e?r(e):n(i)}))}))}))}({channelId:t,state:this.state})}disconnect(t){return e(this,void 0,void 0,(function*(){return to({options:t,instance:this})}))}}!function(e){e.RENEW="renew",e.LINK="link"}(Fi||(Fi={}));var ro="ERC721",io="ERC1155",oo={errors:{disconnected:()=>"MetaMask: Disconnected from chain. Attempting to connect.",permanentlyDisconnected:()=>"MetaMask: Disconnected from MetaMask background. Page reload required.",sendSiteMetadata:()=>"MetaMask: Failed to send site metadata. This is an internal error, please report this bug.",unsupportedSync:e=>`MetaMask: The MetaMask Ethereum provider does not support synchronous methods like ${e} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidNetworkParams:()=>"MetaMask: Received invalid network parameters. Please report this bug.",invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:e=>`'args.logger' must include required method '${e}'.`},info:{connected:e=>`MetaMask: Connected to chain with ID "${e}".`},warnings:{chainIdDeprecation:"MetaMask: 'ethereum.chainId' is deprecated and may be removed in the future. Please use the 'eth_chainId' RPC method instead.\nFor more information, see: https://github.com/MetaMask/metamask-improvement-proposals/discussions/23",networkVersionDeprecation:"MetaMask: 'ethereum.networkVersion' is deprecated and may be removed in the future. Please use the 'net_version' RPC method instead.\nFor more information, see: https://github.com/MetaMask/metamask-improvement-proposals/discussions/23",selectedAddressDeprecation:"MetaMask: 'ethereum.selectedAddress' is deprecated and may be removed in the future. Please use the 'eth_accounts' RPC method instead.\nFor more information, see: https://github.com/MetaMask/metamask-improvement-proposals/discussions/23",enableDeprecation:"MetaMask: 'ethereum.enable()' is deprecated and may be removed in the future. Please use the 'eth_requestAccounts' RPC method instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1102",sendDeprecation:"MetaMask: 'ethereum.send(...)' is deprecated and may be removed in the future. Please use 'ethereum.sendAsync(...)' or 'ethereum.request(...)' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193",events:{close:"MetaMask: The event 'close' is deprecated and may be removed in the future. Please use 'disconnect' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#disconnect",data:"MetaMask: The event 'data' is deprecated and will be removed in the future. Use 'message' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#message",networkChanged:"MetaMask: The event 'networkChanged' is deprecated and may be removed in the future. Use 'chainChanged' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#chainchanged",notification:"MetaMask: The event 'notification' is deprecated and may be removed in the future. Use 'message' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#message"},rpc:{ethDecryptDeprecation:"MetaMask: The RPC method 'eth_decrypt' is deprecated and may be removed in the future.\nFor more information, see: https://medium.com/metamask/metamask-api-method-deprecation-2b0564a84686",ethGetEncryptionPublicKeyDeprecation:"MetaMask: The RPC method 'eth_getEncryptionPublicKey' is deprecated and may be removed in the future.\nFor more information, see: https://medium.com/metamask/metamask-api-method-deprecation-2b0564a84686",walletWatchAssetNFTExperimental:"MetaMask: The RPC method 'wallet_watchAsset' is experimental for ERC721/ERC1155 assets and may change in the future.\nFor more information, see: https://github.com/MetaMask/metamask-improvement-proposals/blob/main/MIPs/mip-1.md and https://github.com/MetaMask/metamask-improvement-proposals/blob/main/PROCESS-GUIDE.md#proposal-lifecycle"},experimentalMethods:"MetaMask: 'ethereum._metamask' exposes non-standard, experimental methods. They may be removed or changed without warning."}};function so(e){const t={ethDecryptDeprecation:!1,ethGetEncryptionPublicKeyDeprecation:!1,walletWatchAssetNFTExperimental:!1};return(n,r,i)=>{t.ethDecryptDeprecation||"eth_decrypt"!==n.method?t.ethGetEncryptionPublicKeyDeprecation||"eth_getEncryptionPublicKey"!==n.method?!t.walletWatchAssetNFTExperimental&&"wallet_watchAsset"===n.method&&[ro,io].includes(n.params?.type||"")&&(e.warn(oo.warnings.rpc.walletWatchAssetNFTExperimental),t.walletWatchAssetNFTExperimental=!0):(e.warn(oo.warnings.rpc.ethGetEncryptionPublicKeyDeprecation),t.ethGetEncryptionPublicKeyDeprecation=!0):(e.warn(oo.warnings.rpc.ethDecryptDeprecation),t.ethDecryptDeprecation=!0),i()}}var ao=4294967295,co=Math.floor(Math.random()*ao);function lo(){return(e,t,n,r)=>{const i=e.id,o=co=(co+1)%ao;e.id=o,t.id=o,n((n=>{e.id=i,t.id=i,n()}))}}var uo=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},ho=(e,t,n)=>(uo(e,t,"read from private field"),n?n.call(e):t.get(e)),fo=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},po=(e,t,n,r)=>(uo(e,t,"write to private field"),t.set(e,n),n),go=(e,t,n)=>(uo(e,t,"access private method"),n),mo={invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},yo={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};function vo(e){return Boolean(e)&&"object"==typeof e&&!Array.isArray(e)}var bo=(e,t)=>Object.hasOwnProperty.call(e,t);var Eo={exports:{}};!function(e){class t extends TypeError{constructor(e,t){let n;const{message:r,explanation:i,...o}=e,{path:s}=e,a=0===s.length?r:`At path: ${s.join(".")} -- ${r}`;super(i??a),null!=i&&(this.cause=a),Object.assign(this,o),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}function n(e){return r(e)&&"function"==typeof e[Symbol.iterator]}function r(e){return"object"==typeof e&&null!=e}function i(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function o(e){return"symbol"==typeof e?e.toString():"string"==typeof e?JSON.stringify(e):`${e}`}function s(e){const{done:t,value:n}=e.next();return t?void 0:n}function a(e,t,n,r){if(!0===e)return;!1===e?e={}:"string"==typeof e&&(e={message:e});const{path:i,branch:s}=t,{type:a}=n,{refinement:c,message:l=`Expected a value of type \`${a}\`${c?` with refinement \`${c}\``:""}, but received: \`${o(r)}\``}=e;return{value:r,type:a,refinement:c,key:i[i.length-1],path:i,branch:s,...e,message:l}}function*c(e,t,r,i){n(e)||(e=[e]);for(const n of e){const e=a(n,t,r,i);e&&(yield e)}}function*l(e,t,n={}){const{path:i=[],branch:o=[e],coerce:s=!1,mask:a=!1}=n,c={path:i,branch:o};if(s&&(e=t.coercer(e,c),a&&"type"!==t.type&&r(t.schema)&&r(e)&&!Array.isArray(e)))for(const n in e)void 0===t.schema[n]&&delete e[n];let d="valid";for(const r of t.validator(e,c))r.explanation=n.message,d="not_valid",yield[r,void 0];for(let[u,h,f]of t.entries(e,c)){const t=l(h,f,{path:void 0===u?i:[...i,u],branch:void 0===u?o:[...o,h],coerce:s,mask:a,message:n.message});for(const n of t)n[0]?(d=null!=n[0].refinement?"not_refined":"not_valid",yield[n[0],void 0]):s&&(h=n[1],void 0===u?e=h:e instanceof Map?e.set(u,h):e instanceof Set?e.add(h):r(e)&&(void 0!==h||u in e)&&(e[u]=h))}if("not_valid"!==d)for(const r of t.refiner(e,c))r.explanation=n.message,d="not_refined",yield[r,void 0];"valid"===d&&(yield[void 0,e])}class d{constructor(e){const{type:t,schema:n,validator:r,refiner:i,coercer:o=(e=>e),entries:s=function*(){}}=e;this.type=t,this.schema=n,this.entries=s,this.coercer=o,this.validator=r?(e,t)=>c(r(e,t),t,this,e):()=>[],this.refiner=i?(e,t)=>c(i(e,t),t,this,e):()=>[]}assert(e,t){return u(e,this,t)}create(e,t){return h(e,this,t)}is(e){return p(e,this)}mask(e,t){return f(e,this,t)}validate(e,t={}){return g(e,this,t)}}function u(e,t,n){const r=g(e,t,{message:n});if(r[0])throw r[0]}function h(e,t,n){const r=g(e,t,{coerce:!0,message:n});if(r[0])throw r[0];return r[1]}function f(e,t,n){const r=g(e,t,{coerce:!0,mask:!0,message:n});if(r[0])throw r[0];return r[1]}function p(e,t){return!g(e,t)[0]}function g(e,n,r={}){const i=l(e,n,r),o=s(i);if(o[0]){const e=new t(o[0],(function*(){for(const e of i)e[0]&&(yield e[0])}));return[e,void 0]}return[void 0,o[1]]}function m(...e){const t="type"===e[0].type,n=e.map((e=>e.schema)),r=Object.assign({},...n);return t?V(r):$(r)}function y(e,t){return new d({type:e,schema:null,validator:t})}function v(e,t){return new d({...e,refiner:(t,n)=>void 0===t||e.refiner(t,n),validator:(n,r)=>void 0===n||(t(n,r),e.validator(n,r))})}function b(e){return new d({type:"dynamic",schema:null,*entries(t,n){const r=e(t,n);yield*r.entries(t,n)},validator:(t,n)=>e(t,n).validator(t,n),coercer:(t,n)=>e(t,n).coercer(t,n),refiner:(t,n)=>e(t,n).refiner(t,n)})}function E(e){let t;return new d({type:"lazy",schema:null,*entries(n,r){t??(t=e()),yield*t.entries(n,r)},validator:(n,r)=>(t??(t=e()),t.validator(n,r)),coercer:(n,r)=>(t??(t=e()),t.coercer(n,r)),refiner:(n,r)=>(t??(t=e()),t.refiner(n,r))})}function w(e,t){const{schema:n}=e,r={...n};for(const e of t)delete r[e];return"type"===e.type?V(r):$(r)}function S(e){const t=e instanceof d?{...e.schema}:{...e};for(const e in t)t[e]=U(t[e]);return $(t)}function _(e,t){const{schema:n}=e,r={};for(const e of t)r[e]=n[e];return $(r)}function C(e,t){return console.warn("superstruct@0.11 - The `struct` helper has been renamed to `define`."),y(e,t)}function k(){return y("any",(()=>!0))}function A(e){return new d({type:"array",schema:e,*entries(t){if(e&&Array.isArray(t))for(const[n,r]of t.entries())yield[n,r,e]},coercer:e=>Array.isArray(e)?e.slice():e,validator:e=>Array.isArray(e)||`Expected an array value, but received: ${o(e)}`})}function M(){return y("bigint",(e=>"bigint"==typeof e))}function x(){return y("boolean",(e=>"boolean"==typeof e))}function O(){return y("date",(e=>e instanceof Date&&!isNaN(e.getTime())||`Expected a valid \`Date\` object, but received: ${o(e)}`))}function I(e){const t={},n=e.map((e=>o(e))).join();for(const n of e)t[n]=n;return new d({type:"enums",schema:t,validator:t=>e.includes(t)||`Expected one of \`${n}\`, but received: ${o(t)}`})}function R(){return y("func",(e=>"function"==typeof e||`Expected a function, but received: ${o(e)}`))}function T(e){return y("instance",(t=>t instanceof e||`Expected a \`${e.name}\` instance, but received: ${o(t)}`))}function P(){return y("integer",(e=>"number"==typeof e&&!isNaN(e)&&Number.isInteger(e)||`Expected an integer, but received: ${o(e)}`))}function N(e){return new d({type:"intersection",schema:null,*entries(t,n){for(const r of e)yield*r.entries(t,n)},*validator(t,n){for(const r of e)yield*r.validator(t,n)},*refiner(t,n){for(const r of e)yield*r.refiner(t,n)}})}function L(e){const t=o(e),n=typeof e;return new d({type:"literal",schema:"string"===n||"number"===n||"boolean"===n?e:null,validator:n=>n===e||`Expected the literal \`${t}\`, but received: ${o(n)}`})}function D(e,t){return new d({type:"map",schema:null,*entries(n){if(e&&t&&n instanceof Map)for(const[r,i]of n.entries())yield[r,r,e],yield[r,i,t]},coercer:e=>e instanceof Map?new Map(e):e,validator:e=>e instanceof Map||`Expected a \`Map\` object, but received: ${o(e)}`})}function K(){return y("never",(()=>!1))}function B(e){return new d({...e,validator:(t,n)=>null===t||e.validator(t,n),refiner:(t,n)=>null===t||e.refiner(t,n)})}function j(){return y("number",(e=>"number"==typeof e&&!isNaN(e)||`Expected a number, but received: ${o(e)}`))}function $(e){const t=e?Object.keys(e):[],n=K();return new d({type:"object",schema:e||null,*entries(i){if(e&&r(i)){const r=new Set(Object.keys(i));for(const n of t)r.delete(n),yield[n,i[n],e[n]];for(const e of r)yield[e,i[e],n]}},validator:e=>r(e)||`Expected an object, but received: ${o(e)}`,coercer:e=>r(e)?{...e}:e})}function U(e){return new d({...e,validator:(t,n)=>void 0===t||e.validator(t,n),refiner:(t,n)=>void 0===t||e.refiner(t,n)})}function H(e,t){return new d({type:"record",schema:null,*entries(n){if(r(n))for(const r in n){const i=n[r];yield[r,r,e],yield[r,i,t]}},validator:e=>r(e)||`Expected an object, but received: ${o(e)}`})}function F(){return y("regexp",(e=>e instanceof RegExp))}function z(e){return new d({type:"set",schema:null,*entries(t){if(e&&t instanceof Set)for(const n of t)yield[n,n,e]},coercer:e=>e instanceof Set?new Set(e):e,validator:e=>e instanceof Set||`Expected a \`Set\` object, but received: ${o(e)}`})}function q(){return y("string",(e=>"string"==typeof e||`Expected a string, but received: ${o(e)}`))}function W(e){const t=K();return new d({type:"tuple",schema:null,*entries(n){if(Array.isArray(n)){const r=Math.max(e.length,n.length);for(let i=0;i<r;i++)yield[i,n[i],e[i]||t]}},validator:e=>Array.isArray(e)||`Expected an array, but received: ${o(e)}`})}function V(e){const t=Object.keys(e);return new d({type:"type",schema:e,*entries(n){if(r(n))for(const r of t)yield[r,n[r],e[r]]},validator:e=>r(e)||`Expected an object, but received: ${o(e)}`,coercer:e=>r(e)?{...e}:e})}function G(e){const t=e.map((e=>e.type)).join(" | ");return new d({type:"union",schema:null,coercer(t){for(const n of e){const[e,r]=n.validate(t,{coerce:!0});if(!e)return r}return t},validator(n,r){const i=[];for(const t of e){const[...e]=l(n,t,r),[o]=e;if(!o[0])return[];for(const[t]of e)t&&i.push(t)}return[`Expected the value to satisfy a union of \`${t}\`, but received: ${o(n)}`,...i]}})}function Y(){return y("unknown",(()=>!0))}function J(e,t,n){return new d({...e,coercer:(r,i)=>p(r,t)?e.coercer(n(r,i),i):e.coercer(r,i)})}function Z(e,t,n={}){return J(e,Y(),(e=>{const r="function"==typeof t?t():t;if(void 0===e)return r;if(!n.strict&&i(e)&&i(r)){const t={...e};let n=!1;for(const e in r)void 0===t[e]&&(t[e]=r[e],n=!0);if(n)return t}return e}))}function X(e){return J(e,q(),(e=>e.trim()))}function Q(e){return se(e,"empty",(t=>{const n=ee(t);return 0===n||`Expected an empty ${e.type} but received one with a size of \`${n}\``}))}function ee(e){return e instanceof Map||e instanceof Set?e.size:e.length}function te(e,t,n={}){const{exclusive:r}=n;return se(e,"max",(n=>r?n<t:n<=t||`Expected a ${e.type} less than ${r?"":"or equal to "}${t} but received \`${n}\``))}function ne(e,t,n={}){const{exclusive:r}=n;return se(e,"min",(n=>r?n>t:n>=t||`Expected a ${e.type} greater than ${r?"":"or equal to "}${t} but received \`${n}\``))}function re(e){return se(e,"nonempty",(t=>ee(t)>0||`Expected a nonempty ${e.type} but received an empty one`))}function ie(e,t){return se(e,"pattern",(n=>t.test(n)||`Expected a ${e.type} matching \`/${t.source}/\` but received "${n}"`))}function oe(e,t,n=t){const r=`Expected a ${e.type}`,i=t===n?`of \`${t}\``:`between \`${t}\` and \`${n}\``;return se(e,"size",(e=>{if("number"==typeof e||e instanceof Date)return t<=e&&e<=n||`${r} ${i} but received \`${e}\``;if(e instanceof Map||e instanceof Set){const{size:o}=e;return t<=o&&o<=n||`${r} with a size ${i} but received one with a size of \`${o}\``}{const{length:o}=e;return t<=o&&o<=n||`${r} with a length ${i} but received one with a length of \`${o}\``}}))}function se(e,t,n){return new d({...e,*refiner(r,i){yield*e.refiner(r,i);const o=c(n(r,i),i,e,r);for(const e of o)yield{...e,refinement:t}}})}e.Struct=d,e.StructError=t,e.any=k,e.array=A,e.assert=u,e.assign=m,e.bigint=M,e.boolean=x,e.coerce=J,e.create=h,e.date=O,e.defaulted=Z,e.define=y,e.deprecated=v,e.dynamic=b,e.empty=Q,e.enums=I,e.func=R,e.instance=T,e.integer=P,e.intersection=N,e.is=p,e.lazy=E,e.literal=L,e.map=D,e.mask=f,e.max=te,e.min=ne,e.never=K,e.nonempty=re,e.nullable=B,e.number=j,e.object=$,e.omit=w,e.optional=U,e.partial=S,e.pattern=ie,e.pick=_,e.record=H,e.refine=se,e.regexp=F,e.set=z,e.size=oe,e.string=q,e.struct=C,e.trimmed=X,e.tuple=W,e.type=V,e.union=G,e.unknown=Y,e.validate=g}(Eo.exports);var wo=Eo.exports;function So(e){return function(e){return function(e){return"object"==typeof e&&null!==e&&"message"in e}(e)&&"string"==typeof e.message?e.message:null==e?"":String(e)}(e).replace(/\.$/u,"")}function _o(e,t){return n=e,Boolean("string"==typeof n?.prototype?.constructor?.name)?new e({message:t}):e({message:t});var n}var Co=class extends Error{constructor(e){super(e.message),this.code="ERR_ASSERTION"}};var ko=Object.freeze({__proto__:null,default:{}}),Ao=e=>wo.object(e);function Mo({path:e,branch:t}){const n=e[e.length-1];return bo(t[t.length-2],n)}function xo(e){return new wo.Struct({...e,type:`optional ${e.type}`,validator:(t,n)=>!Mo(n)||e.validator(t,n),refiner:(t,n)=>!Mo(n)||e.refiner(t,n)})}var Oo=wo.union([wo.literal(null),wo.boolean(),wo.define("finite number",(e=>wo.is(e,wo.number())&&Number.isFinite(e))),wo.string(),wo.array(wo.lazy((()=>Oo))),wo.record(wo.string(),wo.lazy((()=>Oo)))]),Io=wo.coerce(Oo,wo.any(),(e=>(function(e,t,n="Assertion failed",r=Co){try{wo.assert(e,t)}catch(e){throw _o(r,`${n}: ${So(e)}.`)}}(e,Oo),JSON.parse(JSON.stringify(e,((e,t)=>{if("__proto__"!==e&&"constructor"!==e)return t}))))));function Ro(e){try{return function(e){wo.create(e,Io)}(e),!0}catch{return!1}}var To=wo.literal("2.0"),Po=wo.nullable(wo.union([wo.number(),wo.string()])),No=Ao({code:wo.integer(),message:wo.string(),data:xo(Io),stack:xo(wo.string())}),Lo=wo.union([wo.record(wo.string(),Io),wo.array(Io)]),Do=Ao({id:Po,jsonrpc:To,method:wo.string(),params:xo(Lo)}),Ko=Ao({jsonrpc:To,method:wo.string(),params:xo(Lo)});function Bo(e){return wo.is(e,Do)}wo.object({id:Po,jsonrpc:To,result:wo.optional(wo.unknown()),error:wo.optional(No)});var jo=Ao({id:Po,jsonrpc:To,result:Io}),$o=Ao({id:Po,jsonrpc:To,error:No});function Uo(e){return wo.is(e,No)}wo.union([jo,$o]);var Ho=mo.internal,Fo="Unspecified error message. This is a bug, please report it.",zo={code:Ho,message:Wo(Ho)},qo="Unspecified server error.";function Wo(e,t=Fo){if(function(e){return Number.isInteger(e)}(e)){const t=e.toString();if(bo(yo,t))return yo[t].message;if(function(e){return e>=-32099&&e<=-32e3}(e))return qo}return t}function Vo(e,{fallbackError:t=zo,shouldIncludeStack:n=!0}={}){if(!Uo(t))throw new Error("Must provide fallback error with integer number code and string message.");const r=function(e,t){if(e&&"object"==typeof e&&"serialize"in e&&"function"==typeof e.serialize)return e.serialize();if(Uo(e))return e;const n=Go(e),r={...t,data:{cause:n}};return r}(e,t);return n||delete r.stack,r}function Go(e){return Array.isArray(e)?e.map((e=>Ro(e)?e:vo(e)?Yo(e):null)):vo(e)?Yo(e):Ro(e)?e:null}function Yo(e){return Object.getOwnPropertyNames(e).reduce(((t,n)=>{const r=e[n];return Ro(r)&&(t[n]=r),t}),{})}var Jo=ns;ns.default=ns,ns.stable=ss,ns.stableStringify=ss;var Zo="[...]",Xo="[Circular]",Qo=[],es=[];function ts(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function ns(e,t,n,r){var i;void 0===r&&(r=ts()),is(e,"",0,[],void 0,0,r);try{i=0===es.length?JSON.stringify(e,t,n):JSON.stringify(e,cs(t),n)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==Qo.length;){var o=Qo.pop();4===o.length?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return i}function rs(e,t,n,r){var i=Object.getOwnPropertyDescriptor(r,n);void 0!==i.get?i.configurable?(Object.defineProperty(r,n,{value:e}),Qo.push([r,n,t,i])):es.push([t,n,e]):(r[n]=e,Qo.push([r,n,t]))}function is(e,t,n,r,i,o,s){var a;if(o+=1,"object"==typeof e&&null!==e){for(a=0;a<r.length;a++)if(r[a]===e)return void rs(Xo,e,t,i);if(void 0!==s.depthLimit&&o>s.depthLimit)return void rs(Zo,e,t,i);if(void 0!==s.edgesLimit&&n+1>s.edgesLimit)return void rs(Zo,e,t,i);if(r.push(e),Array.isArray(e))for(a=0;a<e.length;a++)is(e[a],a,a,r,e,o,s);else{var c=Object.keys(e);for(a=0;a<c.length;a++){var l=c[a];is(e[l],l,a,r,e,o,s)}}r.pop()}}function os(e,t){return e<t?-1:e>t?1:0}function ss(e,t,n,r){void 0===r&&(r=ts());var i,o=as(e,"",0,[],void 0,0,r)||e;try{i=0===es.length?JSON.stringify(o,t,n):JSON.stringify(o,cs(t),n)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==Qo.length;){var s=Qo.pop();4===s.length?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return i}function as(e,t,n,r,i,o,s){var a;if(o+=1,"object"==typeof e&&null!==e){for(a=0;a<r.length;a++)if(r[a]===e)return void rs(Xo,e,t,i);try{if("function"==typeof e.toJSON)return}catch(e){return}if(void 0!==s.depthLimit&&o>s.depthLimit)return void rs(Zo,e,t,i);if(void 0!==s.edgesLimit&&n+1>s.edgesLimit)return void rs(Zo,e,t,i);if(r.push(e),Array.isArray(e))for(a=0;a<e.length;a++)as(e[a],a,a,r,e,o,s);else{var c={},l=Object.keys(e).sort(os);for(a=0;a<l.length;a++){var d=l[a];as(e[d],d,a,r,e,o,s),c[d]=e[d]}if(void 0===i)return c;Qo.push([i,t,e]),i[t]=c}r.pop()}}function cs(e){return e=void 0!==e?e:function(e,t){return t},function(t,n){if(es.length>0)for(var r=0;r<es.length;r++){var i=es[r];if(i[1]===t&&i[0]===n){n=i[2],es.splice(r,1);break}}return e.call(this,t,n)}}var ls=p(Jo),ds=class extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw new Error('"message" must be a non-empty string.');super(t),this.code=e,void 0!==n&&(this.data=n)}serialize(){const e={code:this.code,message:this.message};return void 0!==this.data&&(e.data=this.data,function(e){if("object"!=typeof e||null===e)return!1;try{let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}catch(e){return!1}}(this.data)&&(e.data.cause=Go(this.data.cause))),this.stack&&(e.stack=this.stack),e}toString(){return ls(this.serialize(),us,2)}};function us(e,t){if("[Circular]"!==t)return t}var hs=e=>fs(mo.invalidRequest,e);function fs(e,t){const[n,r]=function(e){if(e){if("string"==typeof e)return[e];if("object"==typeof e&&!Array.isArray(e)){const{message:t,data:n}=e;if(t&&"string"!=typeof t)throw new Error("Must specify string message.");return[t??void 0,n]}}return[]}(t);return new ds(e,n??Wo(e),r)}var ps={};Object.defineProperty(ps,"__esModule",{value:!0});const gs=d;function ms(e,t,n){try{Reflect.apply(e,t,n)}catch(e){setTimeout((()=>{throw e}))}}let ys=class extends gs.EventEmitter{emit(e,...t){let n="error"===e;const r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){let e;if(t.length>0&&([e]=t),e instanceof Error)throw e;const n=new Error("Unhandled error."+(e?` (${e.message})`:""));throw n.context=e,n}const i=r[e];if(void 0===i)return!1;if("function"==typeof i)ms(i,this,t);else{const e=i.length,n=function(e){const t=e.length,n=new Array(t);for(let r=0;r<t;r+=1)n[r]=e[r];return n}(i);for(let r=0;r<e;r+=1)ms(n[r],this,t)}return!0}};var vs,bs,Es,ws,Ss,_s,Cs,ks,As,Ms,xs,Os,Is,Rs,Ts,Ps,Ns,Ls,Ds,Ks=ps.default=ys,Bs=class e extends Ks{constructor({notificationHandler:e}={}){super(),fo(this,ws),fo(this,_s),fo(this,ks),fo(this,vs,!1),fo(this,bs,void 0),fo(this,Es,void 0),po(this,bs,[]),po(this,Es,e)}destroy(){ho(this,bs).forEach((e=>{"destroy"in e&&"function"==typeof e.destroy&&e.destroy()})),po(this,bs,[]),po(this,vs,!0)}push(e){go(this,ws,Ss).call(this),ho(this,bs).push(e)}handle(e,t){if(go(this,ws,Ss).call(this),t&&"function"!=typeof t)throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?t?go(this,_s,Cs).call(this,e,t):go(this,_s,Cs).call(this,e):t?go(this,ks,As).call(this,e,t):this._promiseHandle(e)}asMiddleware(){return go(this,ws,Ss).call(this),async(t,n,r,i)=>{var o,s;try{const[a,c,l]=await go(o=e,Os,Is).call(o,t,n,ho(this,bs));return c?(await go(s=e,Ps,Ns).call(s,l),i(a)):r((async t=>{var n;try{await go(n=e,Ps,Ns).call(n,l)}catch(e){return t(e)}return t()}))}catch(e){return i(e)}}}async _promiseHandle(e){return new Promise(((t,n)=>{go(this,ks,As).call(this,e,((e,r)=>{e&&void 0===r?n(e):t(r)})).catch(n)}))}};vs=new WeakMap,bs=new WeakMap,Es=new WeakMap,ws=new WeakSet,Ss=function(){if(ho(this,vs))throw new Error("This engine is destroyed and can no longer be used.")},_s=new WeakSet,Cs=async function(e,t){try{if(0===e.length){const e=[{id:null,jsonrpc:"2.0",error:new ds(mo.invalidRequest,"Request batch must contain plain objects. Received an empty array")}];return t?t(null,e):e}const n=(await Promise.all(e.map(this._promiseHandle.bind(this)))).filter((e=>void 0!==e));return t?t(null,n):n}catch(e){if(t)return t(e);throw e}},ks=new WeakSet,As=async function(e,t){var n,r;if(!e||Array.isArray(e)||"object"!=typeof e){const n=new ds(mo.invalidRequest,"Requests must be plain objects. Received: "+typeof e,{request:e});return t(n,{id:null,jsonrpc:"2.0",error:n})}if("string"!=typeof e.method){const n=new ds(mo.invalidRequest,"Must specify a string method. Received: "+typeof e.method,{request:e});return ho(this,Es)&&!Bo(e)?t(null):t(n,{id:e.id??null,jsonrpc:"2.0",error:n})}if(ho(this,Es)&&(r=e,wo.is(r,Ko))&&!Bo(e)){try{await ho(this,Es).call(this,e)}catch(e){return t(e)}return t(null)}let i=null;const o={...e},s={id:o.id,jsonrpc:o.jsonrpc};try{await go(n=Bs,Ms,xs).call(n,o,s,ho(this,bs))}catch(e){i=e}return i&&(delete s.result,s.error||(s.error=Vo(i))),t(i,s)},Ms=new WeakSet,xs=async function(e,t,n){var r,i,o;const[s,a,c]=await go(r=Bs,Os,Is).call(r,e,t,n);if(go(i=Bs,Ls,Ds).call(i,e,t,a),await go(o=Bs,Ps,Ns).call(o,c),s)throw s},Os=new WeakSet,Is=async function(e,t,n){var r;const i=[];let o=null,s=!1;for(const a of n)if([o,s]=await go(r=Bs,Rs,Ts).call(r,e,t,a,i),s)break;return[o,s,i.reverse()]},Rs=new WeakSet,Ts=async function(e,t,n,r){return new Promise((i=>{const o=e=>{const n=e||t.error;n&&(t.error=Vo(n)),i([n,!0])},s=n=>{t.error?o(t.error):(n&&("function"!=typeof n&&o(new ds(mo.internal,`JsonRpcEngine: "next" return handlers must be functions. Received "${typeof n}" for request:\n${$s(e)}`,{request:e})),r.push(n)),i([null,!1]))};try{n(e,t,s,o)}catch(e){o(e)}}))},Ps=new WeakSet,Ns=async function(e){for(const t of e)await new Promise(((e,n)=>{t((t=>t?n(t):e()))}))},Ls=new WeakSet,Ds=function(e,t,n){if(!bo(t,"result")&&!bo(t,"error"))throw new ds(mo.internal,`JsonRpcEngine: Response has no error or result for request:\n${$s(e)}`,{request:e});if(!n)throw new ds(mo.internal,`JsonRpcEngine: Nothing ended request:\n${$s(e)}`,{request:e})},fo(Bs,Ms),fo(Bs,Os),fo(Bs,Rs),fo(Bs,Ps),fo(Bs,Ls);var js=Bs;function $s(e){return JSON.stringify(e,null,2)}var Us=Object.freeze(["eth_subscription"]),Hs=(e=console)=>{return[lo(),(t=e,(e,n,r)=>{"string"==typeof e.method&&e.method||(n.error=hs({message:"The request 'method' must be a non-empty string.",data:e})),r((e=>{const{error:r}=n;return r?(t.error(`MetaMask - RPC Error: ${r.message}`,r),e()):e()}))}),so(e)];var t};var Fs=(e,t,n=!0)=>(r,i)=>{r||i.error?t(r||i.error):!n||Array.isArray(i)?e(i):e(i.result)},zs=e=>Boolean(e)&&"string"==typeof e&&e.startsWith("0x"),qs=()=>{};async function Ws(e,t){try{const t=await async function(){return{name:Vs(window),icon:await Gs(window)}}();e.handle({jsonrpc:"2.0",id:1,method:"metamask_sendDomainMetadata",params:t},qs)}catch(e){t.error({message:oo.errors.sendSiteMetadata(),originalError:e})}}function Vs(e){const{document:t}=e,n=t.querySelector('head > meta[property="og:site_name"]');if(n)return n.content;const r=t.querySelector('head > meta[name="title"]');return r?r.content:t.title&&t.title.length>0?t.title:window.location.hostname}async function Gs(e){const{document:t}=e,n=t.querySelectorAll('head > link[rel~="icon"]');for(const e of Array.from(n))if(e&&await Ys(e.href))return e.href;return null}async function Ys(e){return new Promise(((t,n)=>{try{const n=document.createElement("img");n.onload=()=>t(!0),n.onerror=()=>t(!1),n.src=e}catch(e){n(e)}}))}var Js=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},Zs=(e,t,n)=>(Js(e,t,"read from private field"),n?n.call(e):t.get(e)),Xs=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},Qs=(e,t,n,r)=>(Js(e,t,"write to private field"),t.set(e,n),n);function ea(e,t,n){try{Reflect.apply(e,t,n)}catch(e){setTimeout((()=>{throw e}))}}class ta extends u{emit(e,...t){let n="error"===e;const r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){let e;if(t.length>0&&([e]=t),e instanceof Error)throw e;const n=new Error("Unhandled error."+(e?` (${e.message})`:""));throw n.context=e,n}const i=r[e];if(void 0===i)return!1;if("function"==typeof i)ea(i,this,t);else{const e=i.length,n=function(e){const t=e.length,n=new Array(t);for(let r=0;r<t;r+=1)n[r]=e[r];return n}(i);for(let r=0;r<e;r+=1)ea(n[r],this,t)}return!0}}var na,ra,ia=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,o;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,o[i]))return!1;for(i=r;0!=i--;){var s=o[i];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n},oa=p(ia),sa=class e extends ta{constructor({logger:t=console,maxEventListeners:n=100,rpcMiddleware:r=[]}={}){super(),Xs(this,na,void 0),Xs(this,ra,void 0),this._log=t,this.setMaxListeners(n),this._state={...e._defaultState},Qs(this,ra,null),Qs(this,na,null),this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleConnect=this._handleConnect.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this.request=this.request.bind(this);const i=new js;r.forEach((e=>i.push(e))),this._rpcEngine=i}get chainId(){return Zs(this,na)}get selectedAddress(){return Zs(this,ra)}isConnected(){return this._state.isConnected}async request(e){if(!e||"object"!=typeof e||Array.isArray(e))throw hs({message:oo.errors.invalidRequestArgs(),data:e});const{method:t,params:n}=e;if("string"!=typeof t||0===t.length)throw hs({message:oo.errors.invalidRequestMethod(),data:e});if(void 0!==n&&!Array.isArray(n)&&("object"!=typeof n||null===n))throw hs({message:oo.errors.invalidRequestParams(),data:e});const r=null==n?{method:t}:{method:t,params:n};return new Promise(((e,t)=>{this._rpcRequest(r,Fs(e,t))}))}_initializeState(e){if(this._state.initialized)throw new Error("Provider already initialized.");if(e){const{accounts:t,chainId:n,isUnlocked:r,networkVersion:i}=e;this._handleConnect(n),this._handleChainChanged({chainId:n,networkVersion:i}),this._handleUnlockStateChanged({accounts:t,isUnlocked:r}),this._handleAccountsChanged(t)}this._state.initialized=!0,this.emit("_initialized")}_rpcRequest(e,t){let n=t;return Array.isArray(e)||(e.jsonrpc||(e.jsonrpc="2.0"),"eth_accounts"!==e.method&&"eth_requestAccounts"!==e.method||(n=(n,r)=>{this._handleAccountsChanged(r.result??[],"eth_accounts"===e.method),t(n,r)})),this._rpcEngine.handle(e,n)}_handleConnect(e){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:e}),this._log.debug(oo.info.connected(e)))}_handleDisconnect(e,t){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e){let n;this._state.isConnected=!1,e?(n=new ds(1013,t??oo.errors.disconnected()),this._log.debug(n)):(n=new ds(1011,t??oo.errors.permanentlyDisconnected()),this._log.error(n),Qs(this,na,null),this._state.accounts=null,Qs(this,ra,null),this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}_handleChainChanged({chainId:e}={}){zs(e)?(this._handleConnect(e),e!==Zs(this,na)&&(Qs(this,na,e),this._state.initialized&&this.emit("chainChanged",Zs(this,na)))):this._log.error(oo.errors.invalidNetworkParams(),{chainId:e})}_handleAccountsChanged(e,t=!1){let n=e;Array.isArray(e)||(this._log.error("MetaMask: Received invalid accounts parameter. Please report this bug.",e),n=[]);for(const t of e)if("string"!=typeof t){this._log.error("MetaMask: Received non-string account. Please report this bug.",e),n=[];break}if(!oa(this._state.accounts,n)&&(t&&null!==this._state.accounts&&this._log.error("MetaMask: 'eth_accounts' unexpectedly updated accounts. Please report this bug.",n),this._state.accounts=n,Zs(this,ra)!==n[0]&&Qs(this,ra,n[0]||null),this._state.initialized)){const e=[...n];this.emit("accountsChanged",e)}}_handleUnlockStateChanged({accounts:e,isUnlocked:t}={}){"boolean"==typeof t?t!==this._state.isUnlocked&&(this._state.isUnlocked=t,this._handleAccountsChanged(e??[])):this._log.error("MetaMask: Received invalid isUnlocked parameter. Please report this bug.")}};na=new WeakMap,ra=new WeakMap,sa._defaultState={accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1};var aa,ca,la=sa,da={exports:{}},ua=d.EventEmitter,ha=g(ko);function fa(){if(ca)return aa;function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function r(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}ca=1;var s=n.Buffer,a=ha.inspect,c=a&&a.custom||"inspect";return aa=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return i(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,n,r,i=s.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=i,r=a,s.prototype.copy.call(t,n,r),a+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0===(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0===(e-=o)){o===i.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(o));break}++r}return this.length-=r,t}},{key:c,value:function(e,n){return a(this,t(t({},n),{},{depth:0,customInspect:!1}))}}]),e}(),aa}function pa(e,t){ma(e,t),ga(e)}function ga(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function ma(e,t){e.emit("error",t)}var ya={destroy:function(e,t){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(ma,this,e)):process.nextTick(ma,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted?process.nextTick(ga,n):(n._writableState.errorEmitted=!0,process.nextTick(pa,n,e)):process.nextTick(pa,n,e):t?(process.nextTick(ga,n),t(e)):process.nextTick(ga,n)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}},va={};var ba={};function Ea(e,t,n){n||(n=Error);var r=function(e){var n,r;function i(n,r,i){return e.call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,r,i))||this}return r=e,(n=i).prototype=Object.create(r.prototype),n.prototype.constructor=n,n.__proto__=r,i}(n);r.prototype.name=n.name,r.prototype.code=e,ba[e]=r}function wa(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}Ea("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),Ea("ERR_INVALID_ARG_TYPE",(function(e,t,n){var r,i,o;if("string"==typeof t&&(i="not ",t.substr(0,i.length)===i)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(r," ").concat(wa(t,"type"));else{var s=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(s," ").concat(r," ").concat(wa(t,"type"))}return o+=". Received type ".concat(typeof n)}),TypeError),Ea("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),Ea("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),Ea("ERR_STREAM_PREMATURE_CLOSE","Premature close"),Ea("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),Ea("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),Ea("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),Ea("ERR_STREAM_WRITE_AFTER_END","write after end"),Ea("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),Ea("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),Ea("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),va.codes=ba;var Sa=va.codes.ERR_INVALID_OPT_VALUE;var _a={getHighWaterMark:function(e,t,n,r){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new Sa(r?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}},Ca={exports:{}};"function"==typeof Object.create?Ca.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Ca.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var ka,Aa,Ma,xa,Oa=Ca.exports,Ia=function(e,t){if(Ra("noDeprecation"))return e;var n=!1;return function(){if(!n){if(Ra("throwDeprecation"))throw new Error(t);Ra("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}};function Ra(e){try{if(!f.localStorage)return!1}catch(e){return!1}var t=f.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}function Ta(){if(Aa)return ka;function e(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}var t;Aa=1,ka=_,_.WritableState=S;var r={deprecate:Ia},i=ua,o=n.Buffer,s=(void 0!==f?f:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var a,c=ya,l=_a.getHighWaterMark,d=va.codes,u=d.ERR_INVALID_ARG_TYPE,h=d.ERR_METHOD_NOT_IMPLEMENTED,p=d.ERR_MULTIPLE_CALLBACK,g=d.ERR_STREAM_CANNOT_PIPE,m=d.ERR_STREAM_DESTROYED,y=d.ERR_STREAM_NULL_VALUES,v=d.ERR_STREAM_WRITE_AFTER_END,b=d.ERR_UNKNOWN_ENCODING,E=c.errorOrDestroy;function w(){}function S(n,r,i){t=t||Pa(),n=n||{},"boolean"!=typeof i&&(i=r instanceof t),this.objectMode=!!n.objectMode,i&&(this.objectMode=this.objectMode||!!n.writableObjectMode),this.highWaterMark=l(this,n,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===n.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=n.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if("function"!=typeof i)throw new p;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(process.nextTick(i,r),process.nextTick(O,e,t),e._writableState.errorEmitted=!0,E(e,r)):(i(r),e._writableState.errorEmitted=!0,E(e,r),O(e,t))}(e,n,r,t,i);else{var o=M(n)||e.destroyed;o||n.corked||n.bufferProcessing||!n.bufferedRequest||A(e,n),r?process.nextTick(k,e,n,o,i):k(e,n,o,i)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==n.emitClose,this.autoDestroy=!!n.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}function _(e){var n=this instanceof(t=t||Pa());if(!n&&!a.call(_,this))return new _(e);this._writableState=new S(e,this,n),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),i.call(this)}function C(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new m("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function k(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),O(e,t)}function A(t,n){n.bufferProcessing=!0;var r=n.bufferedRequest;if(t._writev&&r&&r.next){var i=n.bufferedRequestCount,o=new Array(i),s=n.corkedRequestsFree;s.entry=r;for(var a=0,c=!0;r;)o[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;o.allBuffers=c,C(t,n,!0,n.length,o,"",s.finish),n.pendingcb++,n.lastBufferedRequest=null,s.next?(n.corkedRequestsFree=s.next,s.next=null):n.corkedRequestsFree=new e(n),n.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,d=r.encoding,u=r.callback;if(C(t,n,!1,n.objectMode?1:l.length,l,d,u),r=r.next,n.bufferedRequestCount--,n.writing)break}null===r&&(n.lastBufferedRequest=null)}n.bufferedRequest=r,n.bufferProcessing=!1}function M(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function x(e,t){e._final((function(n){t.pendingcb--,n&&E(e,n),t.prefinished=!0,e.emit("prefinish"),O(e,t)}))}function O(e,t){var n=M(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,process.nextTick(x,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}return Oa(_,i),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:r.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(_,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===_&&(e&&e._writableState instanceof S)}})):a=function(e){return e instanceof this},_.prototype.pipe=function(){E(this,new g)},_.prototype.write=function(e,t,n){var r,i=this._writableState,a=!1,c=!i.objectMode&&(r=e,o.isBuffer(r)||r instanceof s);return c&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(n=t,t=null),c?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=w),i.ending?function(e,t){var n=new v;E(e,n),process.nextTick(t,n)}(this,n):(c||function(e,t,n,r){var i;return null===n?i=new y:"string"==typeof n||t.objectMode||(i=new u("chunk",["string","Buffer"],n)),!i||(E(e,i),process.nextTick(r,i),!1)}(this,i,e,n))&&(i.pendingcb++,a=function(e,t,n,r,i,s){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,n));return t}(t,r,i);r!==a&&(n=!0,i="buffer",r=a)}var c=t.objectMode?1:r.length;t.length+=c;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var d=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:s,next:null},d?d.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else C(e,t,!1,c,r,i,s);return l}(this,i,c,e,t,n)),a},_.prototype.cork=function(){this._writableState.corked++},_.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},_.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new b(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(_.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(_.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),_.prototype._write=function(e,t,n){n(new h("_write()"))},_.prototype._writev=null,_.prototype.end=function(e,t,n){var r=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,O(e,t),n&&(t.finished?process.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n),this},Object.defineProperty(_.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(_.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),_.prototype.destroy=c.destroy,_.prototype._undestroy=c.undestroy,_.prototype._destroy=function(e,t){t(e)},ka}function Pa(){if(xa)return Ma;xa=1;var e=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};Ma=s;var t=Ya(),n=Ta();Oa(s,t);for(var r=e(n.prototype),i=0;i<r.length;i++){var o=r[i];s.prototype[o]||(s.prototype[o]=n.prototype[o])}function s(e){if(!(this instanceof s))return new s(e);t.call(this,e),n.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",a)))}function a(){this._writableState.ended||process.nextTick(c,this)}function c(e){e.end()}return Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),Ma}var Na,La,Da={},Ka={exports:{}};function Ba(){if(La)return Da;La=1;var e=(Na||(Na=1,function(e,t){var r=n,i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}}(Ka,Ka.exports)),Ka.exports).Buffer,t=e.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(n){var r;switch(this.encoding=function(n){var r=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(n);if("string"!=typeof r&&(e.isEncoding===t||!t(n)))throw new Error("Unknown encoding: "+n);return r||n}(n),this.encoding){case"utf16le":this.text=s,this.end=a,r=4;break;case"utf8":this.fillLast=o,r=4;break;case"base64":this.text=c,this.end=l,r=3;break;default:return this.write=d,void(this.end=u)}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(r)}function i(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function s(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function a(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function u(e){return e&&e.length?this.write(e):""}return Da.StringDecoder=r,r.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},r.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},r.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var o=i(t[r]);if(o>=0)return o>0&&(e.lastNeed=o-1),o;if(--r<n||-2===o)return 0;if(o=i(t[r]),o>=0)return o>0&&(e.lastNeed=o-2),o;if(--r<n||-2===o)return 0;if(o=i(t[r]),o>=0)return o>0&&(2===o?o=0:e.lastNeed=o-3),o;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},r.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length},Da}var ja=va.codes.ERR_STREAM_PREMATURE_CLOSE;function $a(){}var Ua,Ha,Fa,za,qa,Wa,Va=function e(t,n,r){if("function"==typeof n)return e(t,null,n);n||(n={}),r=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(r||$a);var i=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,s=function(){t.writable||c()},a=t._writableState&&t._writableState.finished,c=function(){o=!1,a=!0,i||r.call(t)},l=t._readableState&&t._readableState.endEmitted,d=function(){i=!1,l=!0,o||r.call(t)},u=function(e){r.call(t,e)},h=function(){var e;return i&&!l?(t._readableState&&t._readableState.ended||(e=new ja),r.call(t,e)):o&&!a?(t._writableState&&t._writableState.ended||(e=new ja),r.call(t,e)):void 0},f=function(){t.req.on("finish",c)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",s),t.on("close",s)):(t.on("complete",c),t.on("abort",h),t.req?f():t.on("request",f)),t.on("end",d),t.on("finish",c),!1!==n.error&&t.on("error",u),t.on("close",h),function(){t.removeListener("complete",c),t.removeListener("abort",h),t.removeListener("request",f),t.req&&t.req.removeListener("finish",c),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",c),t.removeListener("end",d),t.removeListener("error",u),t.removeListener("close",h)}};function Ga(){if(Ha)return Ua;var e;function t(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ha=1;var n=Va,r=Symbol("lastResolve"),i=Symbol("lastReject"),o=Symbol("error"),s=Symbol("ended"),a=Symbol("lastPromise"),c=Symbol("handlePromise"),l=Symbol("stream");function d(e,t){return{value:e,done:t}}function u(e){var t=e[r];if(null!==t){var n=e[l].read();null!==n&&(e[a]=null,e[r]=null,e[i]=null,t(d(n,!1)))}}function h(e){process.nextTick(u,e)}var f=Object.getPrototypeOf((function(){})),p=Object.setPrototypeOf((t(e={get stream(){return this[l]},next:function(){var e=this,t=this[o];if(null!==t)return Promise.reject(t);if(this[s])return Promise.resolve(d(void 0,!0));if(this[l].destroyed)return new Promise((function(t,n){process.nextTick((function(){e[o]?n(e[o]):t(d(void 0,!0))}))}));var n,r=this[a];if(r)n=new Promise(function(e,t){return function(n,r){e.then((function(){t[s]?n(d(void 0,!0)):t[c](n,r)}),r)}}(r,this));else{var i=this[l].read();if(null!==i)return Promise.resolve(d(i,!1));n=new Promise(this[c])}return this[a]=n,n}},Symbol.asyncIterator,(function(){return this})),t(e,"return",(function(){var e=this;return new Promise((function(t,n){e[l].destroy(null,(function(e){e?n(e):t(d(void 0,!0))}))}))})),e),f);return Ua=function(e){var u,f=Object.create(p,(t(u={},l,{value:e,writable:!0}),t(u,r,{value:null,writable:!0}),t(u,i,{value:null,writable:!0}),t(u,o,{value:null,writable:!0}),t(u,s,{value:e._readableState.endEmitted,writable:!0}),t(u,c,{value:function(e,t){var n=f[l].read();n?(f[a]=null,f[r]=null,f[i]=null,e(d(n,!1))):(f[r]=e,f[i]=t)},writable:!0}),u));return f[a]=null,n(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=f[i];return null!==t&&(f[a]=null,f[r]=null,f[i]=null,t(e)),void(f[o]=e)}var n=f[r];null!==n&&(f[a]=null,f[r]=null,f[i]=null,n(d(void 0,!0))),f[s]=!0})),e.on("readable",h.bind(null,f)),f}}function Ya(){if(Wa)return qa;var e;Wa=1,qa=C,C.ReadableState=_,d.EventEmitter;var t=function(e,t){return e.listeners(t).length},r=ua,i=n.Buffer,o=(void 0!==f?f:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var s,a=ha;s=a&&a.debuglog?a.debuglog("stream"):function(){};var c,l,u,h=fa(),p=ya,g=_a.getHighWaterMark,m=va.codes,y=m.ERR_INVALID_ARG_TYPE,v=m.ERR_STREAM_PUSH_AFTER_EOF,b=m.ERR_METHOD_NOT_IMPLEMENTED,E=m.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;Oa(C,r);var w=p.errorOrDestroy,S=["error","close","destroy","pause","resume"];function _(t,n,r){e=e||Pa(),t=t||{},"boolean"!=typeof r&&(r=n instanceof e),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=g(this,t,"readableHighWaterMark",r),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(c||(c=Ba().StringDecoder),this.decoder=new c(t.encoding),this.encoding=t.encoding)}function C(t){if(e=e||Pa(),!(this instanceof C))return new C(t);var n=this instanceof e;this._readableState=new _(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),r.call(this)}function k(e,t,n,r,a){s("readableAddChunk",t);var c,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(s("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?O(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,I(e)))}(e,l);else if(a||(c=function(e,t){var n;r=t,i.isBuffer(r)||r instanceof o||"string"==typeof t||void 0===t||e.objectMode||(n=new y("chunk",["string","Buffer","Uint8Array"],t));var r;return n}(l,t)),c)w(e,c);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===i.prototype||(t=function(e){return i.from(e)}(t)),r)l.endEmitted?w(e,new E):A(e,l,t,!0);else if(l.ended)w(e,new v);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!n?(t=l.decoder.write(t),l.objectMode||0!==t.length?A(e,l,t,!1):R(e,l)):A(e,l,t,!1)}else r||(l.reading=!1,R(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function A(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&O(e)),R(e,t)}Object.defineProperty(C.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),C.prototype.destroy=p.destroy,C.prototype._undestroy=p.undestroy,C.prototype._destroy=function(e,t){t(e)},C.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=i.from(e,t),t=""),n=!0),k(this,e,t,!1,n)},C.prototype.unshift=function(e){return k(this,e,null,!0,!1)},C.prototype.isPaused=function(){return!1===this._readableState.flowing},C.prototype.setEncoding=function(e){c||(c=Ba().StringDecoder);var t=new c(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,r="";null!==n;)r+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var M=1073741824;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=M?e=M:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function O(e){var t=e._readableState;s("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(s("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(I,e))}function I(e){var t=e._readableState;s("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,D(e)}function R(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(T,e,t))}function T(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(s("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function P(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function N(e){s("readable nexttick read 0"),e.read(0)}function L(e,t){s("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),D(e),t.flowing&&!t.reading&&e.read(0)}function D(e){var t=e._readableState;for(s("flow",t.flowing);t.flowing&&null!==e.read(););}function K(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function B(e){var t=e._readableState;s("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(j,t,e))}function j(e,t){if(s("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function $(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}return C.prototype.read=function(e){s("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return s("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?B(this):O(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&B(this),null;var r,i=t.needReadable;return s("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&s("length less than watermark",i=!0),t.ended||t.reading?s("reading or ended",i=!1):i&&(s("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(n,t))),null===(r=e>0?K(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&B(this)),null!==r&&this.emit("data",r),r},C.prototype._read=function(e){w(this,new b("_read()"))},C.prototype.pipe=function(e,n){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,s("pipe count=%d opts=%j",i.pipesCount,n);var o=(!n||!1!==n.end)&&e!==process.stdout&&e!==process.stderr?c:g;function a(t,n){s("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,s("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),e.removeListener("drain",l),e.removeListener("error",h),e.removeListener("unpipe",a),r.removeListener("end",c),r.removeListener("end",g),r.removeListener("data",u),d=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function c(){s("onend"),e.end()}i.endEmitted?process.nextTick(o):r.once("end",o),e.on("unpipe",a);var l=function(e){return function(){var n=e._readableState;s("pipeOnDrain",n.awaitDrain),n.awaitDrain&&n.awaitDrain--,0===n.awaitDrain&&t(e,"data")&&(n.flowing=!0,D(e))}}(r);e.on("drain",l);var d=!1;function u(t){s("ondata");var n=e.write(t);s("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==$(i.pipes,e))&&!d&&(s("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function h(n){s("onerror",n),g(),e.removeListener("error",h),0===t(e,"error")&&w(e,n)}function f(){e.removeListener("finish",p),g()}function p(){s("onfinish"),e.removeListener("close",f),g()}function g(){s("unpipe"),r.unpipe(e)}return r.on("data",u),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",f),e.once("finish",p),e.emit("pipe",r),i.flowing||(s("pipe resume"),r.resume()),e},C.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=$(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},C.prototype.on=function(e,t){var n=r.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,s("on readable",i.length,i.reading),i.length?O(this):i.reading||process.nextTick(N,this))),n},C.prototype.addListener=C.prototype.on,C.prototype.removeListener=function(e,t){var n=r.prototype.removeListener.call(this,e,t);return"readable"===e&&process.nextTick(P,this),n},C.prototype.removeAllListeners=function(e){var t=r.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||process.nextTick(P,this),t},C.prototype.resume=function(){var e=this._readableState;return e.flowing||(s("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(L,e,t))}(this,e)),e.paused=!1,this},C.prototype.pause=function(){return s("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(s("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},C.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(s("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(s("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<S.length;o++)e.on(S[o],this.emit.bind(this,S[o]));return this._read=function(t){s("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(C.prototype[Symbol.asyncIterator]=function(){return void 0===l&&(l=Ga()),l(this)}),Object.defineProperty(C.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(C.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(C.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),C._fromList=K,Object.defineProperty(C.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(C.from=function(e,t){return void 0===u&&(u=za?Fa:(za=1,Fa=function(){throw new Error("Readable.from is not available in the browser")})),u(C,e,t)}),qa}var Ja=ic,Za=va.codes,Xa=Za.ERR_METHOD_NOT_IMPLEMENTED,Qa=Za.ERR_MULTIPLE_CALLBACK,ec=Za.ERR_TRANSFORM_ALREADY_TRANSFORMING,tc=Za.ERR_TRANSFORM_WITH_LENGTH_0,nc=Pa();function rc(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new Qa);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function ic(e){if(!(this instanceof ic))return new ic(e);nc.call(this,e),this._transformState={afterTransform:rc.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",oc)}function oc(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?sc(this,null,null):this._flush((function(t,n){sc(e,t,n)}))}function sc(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new tc;if(e._transformState.transforming)throw new ec;return e.push(null)}Oa(ic,nc),ic.prototype.push=function(e,t){return this._transformState.needTransform=!1,nc.prototype.push.call(this,e,t)},ic.prototype._transform=function(e,t,n){n(new Xa("_transform()"))},ic.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},ic.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},ic.prototype._destroy=function(e,t){nc.prototype._destroy.call(this,e,(function(e){t(e)}))};var ac,cc=dc,lc=Ja;function dc(e){if(!(this instanceof dc))return new dc(e);lc.call(this,e)}Oa(dc,lc),dc.prototype._transform=function(e,t,n){n(null,e)};var uc=va.codes,hc=uc.ERR_MISSING_ARGS,fc=uc.ERR_STREAM_DESTROYED;function pc(e){if(e)throw e}function gc(e){e()}function mc(e,t){return e.pipe(t)}var yc=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=function(e){return e.length?"function"!=typeof e[e.length-1]?pc:e.pop():pc}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new hc("streams");var o=t.map((function(e,n){var s=n<t.length-1;return function(e,t,n,r){r=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(r);var i=!1;e.on("close",(function(){i=!0})),void 0===ac&&(ac=Va),ac(e,{readable:t,writable:n},(function(e){if(e)return r(e);i=!0,r()}));var o=!1;return function(t){if(!i&&!o)return o=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void r(t||new fc("pipe"))}}(e,s,n>0,(function(e){r||(r=e),e&&o.forEach(gc),s||(o.forEach(gc),i(r))}))}));return t.reduce(mc)};!function(e,t){(t=da.exports=Ya()).Stream=t,t.Readable=t,t.Writable=Ta(),t.Duplex=Pa(),t.Transform=Ja,t.PassThrough=cc,t.finished=Va,t.pipeline=yc}(0,da.exports);var vc=da.exports;function bc(e={}){const t={},n=new vc.Duplex({objectMode:!0,read:()=>{},write:function(n,o,s){let a=null;try{!n.id?function(n){e?.retryOnMessage&&n.method===e.retryOnMessage&&Object.values(t).forEach((({req:e,retryCount:n=0})=>{if(!e.id)return;if(n>=3)throw new Error(`StreamMiddleware - Retry limit exceeded for request id "${e.id}"`);const r=t[e.id];r&&(r.retryCount=n+1),i(e)}));r.emit("notification",n)}(n):function(e){const{id:n}=e;if(null===n)return;const r=t[n];if(!r)return void console.warn(`StreamMiddleware - Unknown response id "${n}"`);delete t[n],Object.assign(r.res,e),setTimeout(r.end)}(n)}catch(e){a=e}s(a)}}),r=new Ks;return{events:r,middleware:(e,n,r,o)=>{t[e.id]={req:e,res:n,next:r,end:o},i(e)},stream:n};function i(e){n.push(e)}}var Ec={},wc={exports:{}},Sc=function e(t,n){if(t&&n)return e(t)(n);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){r[e]=t[e]})),r;function r(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var r=t.apply(this,e),i=e[e.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach((function(e){r[e]=i[e]})),r}};var _c=Sc;function Cc(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function kc(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}wc.exports=_c(Cc),wc.exports.strict=_c(kc),Cc.proto=Cc((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return Cc(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return kc(this)},configurable:!0})}));var Ac=wc.exports,Mc={};Object.defineProperty(Mc,"__esModule",{value:!0}),Mc.Substream=void 0;const xc=vc;class Oc extends xc.Duplex{constructor({parent:e,name:t}){super({objectMode:!0}),this._parent=e,this._name=t}_read(){}_write(e,t,n){this._parent.push({name:this._name,data:e}),n()}}Mc.Substream=Oc;var Ic=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.ObjectMultiplex=void 0;const Rc=vc,Tc=Ic(Ac),Pc=Mc,Nc=Symbol("IGNORE_SUBSTREAM");let Lc=class extends Rc.Duplex{constructor(e={}){super(Object.assign(Object.assign({},e),{objectMode:!0})),this._substreams={}}createStream(e){if(this.destroyed)throw new Error(`ObjectMultiplex - parent stream for name "${e}" already destroyed`);if(this._readableState.ended||this._writableState.ended)throw new Error(`ObjectMultiplex - parent stream for name "${e}" already ended`);if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new Pc.Substream({parent:this,name:e});return this._substreams[e]=t,function(e,t){const n=(0,Tc.default)(t);(0,Rc.finished)(e,{readable:!1},n),(0,Rc.finished)(e,{writable:!1},n)}(this,(e=>t.destroy(e||void 0))),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=Nc}_read(){}_write(e,t,n){const{name:r,data:i}=e;if(!r)return console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),n();const o=this._substreams[r];return o?(o!==Nc&&o.push(i),n()):(console.warn(`ObjectMultiplex - orphaned data for stream "${r}"`),n())}};Ec.ObjectMultiplex=Lc;var Dc=p(Ec.ObjectMultiplex);const Kc=e=>null!==e&&"object"==typeof e&&"function"==typeof e.pipe;Kc.writable=e=>Kc(e)&&!1!==e.writable&&"function"==typeof e._write&&"object"==typeof e._writableState,Kc.readable=e=>Kc(e)&&!1!==e.readable&&"function"==typeof e._read&&"object"==typeof e._readableState,Kc.duplex=e=>Kc.writable(e)&&Kc.readable(e),Kc.transform=e=>Kc.duplex(e)&&"function"==typeof e._transform;var Bc,jc=Kc,$c=class extends la{constructor(e,{jsonRpcStreamName:t,logger:n=console,maxEventListeners:r=100,rpcMiddleware:i=[]}){if(super({logger:n,maxEventListeners:r,rpcMiddleware:i}),!jc.duplex(e))throw new Error(oo.errors.invalidDuplexStream());this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this);const o=new Dc;vc.pipeline(e,o,e,this._handleStreamDisconnect.bind(this,"MetaMask")),this._jsonRpcConnection=bc({retryOnMessage:"METAMASK_EXTENSION_CONNECT_CAN_RETRY"}),vc.pipeline(this._jsonRpcConnection.stream,o.createStream(t),this._jsonRpcConnection.stream,this._handleStreamDisconnect.bind(this,"MetaMask RpcProvider")),this._rpcEngine.push(this._jsonRpcConnection.middleware),this._jsonRpcConnection.events.on("notification",(t=>{const{method:n,params:r}=t;"metamask_accountsChanged"===n?this._handleAccountsChanged(r):"metamask_unlockStateChanged"===n?this._handleUnlockStateChanged(r):"metamask_chainChanged"===n?this._handleChainChanged(r):Us.includes(n)?this.emit("message",{type:n,data:r}):"METAMASK_STREAM_FAILURE"===n&&e.destroy(new Error(oo.errors.permanentlyDisconnected()))}))}async _initializeStateAsync(){let e;try{e=await this.request({method:"metamask_getProviderState"})}catch(e){this._log.error("MetaMask: Failed to get initial state. Please report this bug.",e)}this._initializeState(e)}_handleStreamDisconnect(e,t){let n=`MetaMask: Lost connection to "${e}".`;t?.stack&&(n+=`\n${t.stack}`),this._log.warn(n),this.listenerCount("error")>0&&this.emit("error",n),this._handleDisconnect(!1,t?t.message:void 0)}_handleChainChanged({chainId:e,networkVersion:t}={}){zs(e)&&(e=>Boolean(e)&&"string"==typeof e)(t)?"loading"===t?this._handleDisconnect(!0):super._handleChainChanged({chainId:e}):this._log.error(oo.errors.invalidNetworkParams(),{chainId:e,networkVersion:t})}},Uc=class extends $c{constructor(e,{jsonRpcStreamName:t="metamask-provider",logger:n=console,maxEventListeners:r=100,shouldSendMetadata:i}={}){if(super(e,{jsonRpcStreamName:t,logger:n,maxEventListeners:r,rpcMiddleware:Hs(n)}),this._sentWarnings={chainId:!1,networkVersion:!1,selectedAddress:!1,enable:!1,experimentalMethods:!1,send:!1,events:{close:!1,data:!1,networkChanged:!1,notification:!1}},Xs(this,Bc,void 0),this._initializeStateAsync(),Qs(this,Bc,null),this.isMetaMask=!0,this._sendSync=this._sendSync.bind(this),this.enable=this.enable.bind(this),this.send=this.send.bind(this),this.sendAsync=this.sendAsync.bind(this),this._warnOfDeprecation=this._warnOfDeprecation.bind(this),this._metamask=this._getExperimentalApi(),this._jsonRpcConnection.events.on("notification",(e=>{const{method:t}=e;Us.includes(t)&&(this.emit("data",e),this.emit("notification",e.params.result))})),i)if("complete"===document.readyState)Ws(this._rpcEngine,this._log);else{const e=()=>{Ws(this._rpcEngine,this._log),window.removeEventListener("DOMContentLoaded",e)};window.addEventListener("DOMContentLoaded",e)}}get chainId(){return this._sentWarnings.chainId||(this._log.warn(oo.warnings.chainIdDeprecation),this._sentWarnings.chainId=!0),super.chainId}get networkVersion(){return this._sentWarnings.networkVersion||(this._log.warn(oo.warnings.networkVersionDeprecation),this._sentWarnings.networkVersion=!0),Zs(this,Bc)}get selectedAddress(){return this._sentWarnings.selectedAddress||(this._log.warn(oo.warnings.selectedAddressDeprecation),this._sentWarnings.selectedAddress=!0),super.selectedAddress}sendAsync(e,t){this._rpcRequest(e,t)}addListener(e,t){return this._warnOfDeprecation(e),super.addListener(e,t)}on(e,t){return this._warnOfDeprecation(e),super.on(e,t)}once(e,t){return this._warnOfDeprecation(e),super.once(e,t)}prependListener(e,t){return this._warnOfDeprecation(e),super.prependListener(e,t)}prependOnceListener(e,t){return this._warnOfDeprecation(e),super.prependOnceListener(e,t)}_handleDisconnect(e,t){super._handleDisconnect(e,t),Zs(this,Bc)&&!e&&Qs(this,Bc,null)}_warnOfDeprecation(e){!1===this._sentWarnings?.events[e]&&(this._log.warn(oo.warnings.events[e]),this._sentWarnings.events[e]=!0)}async enable(){return this._sentWarnings.enable||(this._log.warn(oo.warnings.enableDeprecation),this._sentWarnings.enable=!0),new Promise(((e,t)=>{try{this._rpcRequest({method:"eth_requestAccounts",params:[]},Fs(e,t))}catch(e){t(e)}}))}send(e,t){return this._sentWarnings.send||(this._log.warn(oo.warnings.sendDeprecation),this._sentWarnings.send=!0),"string"!=typeof e||t&&!Array.isArray(t)?e&&"object"==typeof e&&"function"==typeof t?this._rpcRequest(e,t):this._sendSync(e):new Promise(((n,r)=>{try{this._rpcRequest({method:e,params:t},Fs(n,r,!1))}catch(e){r(e)}}))}_sendSync(e){let t;switch(e.method){case"eth_accounts":t=this.selectedAddress?[this.selectedAddress]:[];break;case"eth_coinbase":t=this.selectedAddress??null;break;case"eth_uninstallFilter":this._rpcRequest(e,qs),t=!0;break;case"net_version":t=Zs(this,Bc)??null;break;default:throw new Error(oo.errors.unsupportedSync(e.method))}return{id:e.id,jsonrpc:e.jsonrpc,result:t}}_getExperimentalApi(){return new Proxy({isUnlocked:async()=>(this._state.initialized||await new Promise((e=>{this.on("_initialized",(()=>e()))})),this._state.isUnlocked),requestBatch:async e=>{if(!Array.isArray(e))throw hs({message:"Batch requests must be made with an array of request objects.",data:e});return new Promise(((t,n)=>{this._rpcRequest(e,Fs(t,n))}))}},{get:(e,t,...n)=>(this._sentWarnings.experimentalMethods||(this._log.warn(oo.warnings.experimentalMethods),this._sentWarnings.experimentalMethods=!0),Reflect.get(e,t,...n))})}_handleChainChanged({chainId:e,networkVersion:t}={}){super._handleChainChanged({chainId:e,networkVersion:t}),this._state.isConnected&&t!==Zs(this,Bc)&&(Qs(this,Bc,t),this._state.initialized&&this.emit("networkChanged",Zs(this,Bc)))}};Bc=new WeakMap;const Hc=t("MM_SDK");Hc.color="#FFAC1C";var Fc={},zc={};Object.defineProperty(zc,"__esModule",{value:!0}),zc.EthereumProviderError=zc.EthereumRpcError=void 0;const qc=Jo;class Wc extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw new Error('"message" must be a nonempty string.');super(t),this.code=e,void 0!==n&&(this.data=n)}serialize(){const e={code:this.code,message:this.message};return void 0!==this.data&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return qc.default(this.serialize(),Vc,2)}}zc.EthereumRpcError=Wc;function Vc(e,t){if("[Circular]"!==t)return t}zc.EthereumProviderError=class extends Wc{constructor(e,t,n){if(!function(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,n)}};var Gc={},Yc={};Object.defineProperty(Yc,"__esModule",{value:!0}),Yc.errorValues=Yc.errorCodes=void 0,Yc.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}},Yc.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.serializeError=e.isValidCode=e.getMessageFromCode=e.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const t=Yc,n=zc,r=t.errorCodes.rpc.internal,i="Unspecified error message. This is a bug, please report it.",o={code:r,message:s(r)};function s(n,r=i){if(Number.isInteger(n)){const r=n.toString();if(d(t.errorValues,r))return t.errorValues[r].message;if(c(n))return e.JSON_RPC_SERVER_ERROR_MESSAGE}return r}function a(e){if(!Number.isInteger(e))return!1;const n=e.toString();return!!t.errorValues[n]||!!c(e)}function c(e){return e>=-32099&&e<=-32e3}function l(e){return e&&"object"==typeof e&&!Array.isArray(e)?Object.assign({},e):e}function d(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.",e.getMessageFromCode=s,e.isValidCode=a,e.serializeError=function(e,{fallbackError:t=o,shouldIncludeStack:r=!1}={}){var i,c;if(!t||!Number.isInteger(t.code)||"string"!=typeof t.message)throw new Error("Must provide fallback error with integer number code and string message.");if(e instanceof n.EthereumRpcError)return e.serialize();const u={};if(e&&"object"==typeof e&&!Array.isArray(e)&&d(e,"code")&&a(e.code)){const t=e;u.code=t.code,t.message&&"string"==typeof t.message?(u.message=t.message,d(t,"data")&&(u.data=t.data)):(u.message=s(u.code),u.data={originalError:l(e)})}else{u.code=t.code;const n=null===(i=e)||void 0===i?void 0:i.message;u.message=n&&"string"==typeof n?n:t.message,u.data={originalError:l(e)}}const h=null===(c=e)||void 0===c?void 0:c.stack;return r&&e&&h&&"string"==typeof h&&(u.stack=h),u}}(Gc);var Jc={};Object.defineProperty(Jc,"__esModule",{value:!0}),Jc.ethErrors=void 0;const Zc=zc,Xc=Gc,Qc=Yc;function el(e,t){const[n,r]=nl(t);return new Zc.EthereumRpcError(e,n||Xc.getMessageFromCode(e),r)}function tl(e,t){const[n,r]=nl(t);return new Zc.EthereumProviderError(e,n||Xc.getMessageFromCode(e),r)}function nl(e){if(e){if("string"==typeof e)return[e];if("object"==typeof e&&!Array.isArray(e)){const{message:t,data:n}=e;if(t&&"string"!=typeof t)throw new Error("Must specify string message.");return[t||void 0,n]}}return[]}Jc.ethErrors={rpc:{parse:e=>el(Qc.errorCodes.rpc.parse,e),invalidRequest:e=>el(Qc.errorCodes.rpc.invalidRequest,e),invalidParams:e=>el(Qc.errorCodes.rpc.invalidParams,e),methodNotFound:e=>el(Qc.errorCodes.rpc.methodNotFound,e),internal:e=>el(Qc.errorCodes.rpc.internal,e),server:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:t}=e;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return el(t,e)},invalidInput:e=>el(Qc.errorCodes.rpc.invalidInput,e),resourceNotFound:e=>el(Qc.errorCodes.rpc.resourceNotFound,e),resourceUnavailable:e=>el(Qc.errorCodes.rpc.resourceUnavailable,e),transactionRejected:e=>el(Qc.errorCodes.rpc.transactionRejected,e),methodNotSupported:e=>el(Qc.errorCodes.rpc.methodNotSupported,e),limitExceeded:e=>el(Qc.errorCodes.rpc.limitExceeded,e)},provider:{userRejectedRequest:e=>tl(Qc.errorCodes.provider.userRejectedRequest,e),unauthorized:e=>tl(Qc.errorCodes.provider.unauthorized,e),unsupportedMethod:e=>tl(Qc.errorCodes.provider.unsupportedMethod,e),disconnected:e=>tl(Qc.errorCodes.provider.disconnected,e),chainDisconnected:e=>tl(Qc.errorCodes.provider.chainDisconnected,e),custom:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:t,message:n,data:r}=e;if(!n||"string"!=typeof n)throw new Error('"message" must be a nonempty string');return new Zc.EthereumProviderError(t,n,r)}}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getMessageFromCode=e.serializeError=e.EthereumProviderError=e.EthereumRpcError=e.ethErrors=e.errorCodes=void 0;const t=zc;Object.defineProperty(e,"EthereumRpcError",{enumerable:!0,get:function(){return t.EthereumRpcError}}),Object.defineProperty(e,"EthereumProviderError",{enumerable:!0,get:function(){return t.EthereumProviderError}});const n=Gc;Object.defineProperty(e,"serializeError",{enumerable:!0,get:function(){return n.serializeError}}),Object.defineProperty(e,"getMessageFromCode",{enumerable:!0,get:function(){return n.getMessageFromCode}});const r=Jc;Object.defineProperty(e,"ethErrors",{enumerable:!0,get:function(){return r.ethErrors}});const i=Yc;Object.defineProperty(e,"errorCodes",{enumerable:!0,get:function(){return i.errorCodes}})}(Fc);const rl={METAMASK_GETPROVIDERSTATE:"metamask_getProviderState",METAMASK_CONNECTSIGN:"metamask_connectSign",METAMASK_CONNECTWITH:"metamask_connectWith",METAMASK_OPEN:"metamask_open",METAMASK_BATCH:"metamask_batch",PERSONAL_SIGN:"personal_sign",WALLET_REQUESTPERMISSIONS:"wallet_requestPermissions",WALLET_REVOKEPERMISSIONS:"wallet_revokePermissions",WALLET_GETPERMISSIONS:"wallet_getPermissions",WALLET_WATCHASSET:"wallet_watchAsset",WALLET_ADDETHEREUMCHAIN:"wallet_addEthereumChain",WALLET_SWITCHETHETHEREUMCHAIN:"wallet_switchEthereumChain",ETH_REQUESTACCOUNTS:"eth_requestAccounts",ETH_ACCOUNTS:"eth_accounts",ETH_CHAINID:"eth_chainId",ETH_SENDTRANSACTION:"eth_sendTransaction",ETH_SIGNTYPEDDATA:"eth_signTypedData",ETH_SIGNTYPEDDATA_V3:"eth_signTypedData_v3",ETH_SIGNTYPEDDATA_V4:"eth_signTypedData_v4",ETH_SIGNTRANSACTION:"eth_signTransaction",ETH_SIGN:"eth_sign",PERSONAL_EC_RECOVER:"personal_ecRecover"},il={[rl.ETH_REQUESTACCOUNTS]:!0,[rl.ETH_SENDTRANSACTION]:!0,[rl.ETH_SIGNTRANSACTION]:!0,[rl.ETH_SIGN]:!0,[rl.PERSONAL_SIGN]:!0,[rl.ETH_ACCOUNTS]:!1,[rl.ETH_CHAINID]:!1,[rl.PERSONAL_SIGN]:!0,[rl.ETH_SIGNTYPEDDATA]:!0,[rl.ETH_SIGNTYPEDDATA_V3]:!0,[rl.ETH_SIGNTYPEDDATA_V4]:!0,[rl.WALLET_REQUESTPERMISSIONS]:!0,[rl.WALLET_GETPERMISSIONS]:!0,[rl.WALLET_WATCHASSET]:!0,[rl.WALLET_ADDETHEREUMCHAIN]:!0,[rl.WALLET_SWITCHETHETHEREUMCHAIN]:!0,[rl.METAMASK_CONNECTSIGN]:!0,[rl.METAMASK_CONNECTWITH]:!0,[rl.PERSONAL_EC_RECOVER]:!0,[rl.METAMASK_BATCH]:!0,[rl.METAMASK_OPEN]:!0},ol=Object.keys(il).map((e=>e.toLowerCase())),sl=["eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sign"].map((e=>e.toLowerCase())),al=".sdk-comm",cl="providerType",ll=".MMSDK_cached_address",dl=".MMSDK_cached_chainId",ul={CHAIN_CHANGED:"chainChanged",ACCOUNTS_CHANGED:"accountsChanged",DISCONNECT:"disconnect",CONNECT:"connect",CONNECTED:"connected"};class hl{constructor({enabled:e}={enabled:!1}){this.enabled=!1,this.enabled=e}persistChannelConfig(t,n){return e(this,void 0,void 0,(function*(){const e=JSON.stringify(t);Hc(`[StorageManagerAS: persistChannelConfig()] context=${n} enabled=${this.enabled}`,t),yield h.setItem(al,e)}))}persistAccounts(t,n){return e(this,void 0,void 0,(function*(){Hc(`[StorageManagerAS: persistAccounts()] context=${n} enabled=${this.enabled}`,t);try{const e=JSON.stringify(t);yield h.setItem(ll,e)}catch(e){console.error("[StorageManagerAS: persistAccounts()] Error persisting accounts",e)}}))}getCachedAccounts(){return e(this,void 0,void 0,(function*(){let e;try{return e=yield h.getItem(ll),e?JSON.parse(e):[]}catch(e){return console.error("[StorageManagerAS: getCachedAccounts()] Error getting cached accounts",e),[]}}))}getCachedChainId(){var t;return e(this,void 0,void 0,(function*(){try{const e=null!==(t=yield h.getItem(dl))&&void 0!==t?t:void 0;return-1!==(null==e?void 0:e.indexOf("0x"))?e:void 0}catch(e){return void console.error("[StorageManagerAS: getCachedChainId()] Error getting cached chainId",e)}}))}persistChainId(t,n){return e(this,void 0,void 0,(function*(){Hc(`[StorageManagerAS: persistChainId()] context=${n} enabled=${this.enabled}`,t);try{yield h.setItem(dl,t)}catch(e){console.error("[StorageManagerAS: persistChainId()] Error persisting chainId",e)}}))}getPersistedChannelConfig(t){return e(this,void 0,void 0,(function*(){let e;const{context:n}=t||{};try{if(Hc(`[StorageManagerAS: getPersistedChannelConfig()] context=${n} enabled=${this.enabled}`),e=yield h.getItem(al),!e)return;const t=JSON.parse(e);return Hc(`[StorageManagerAS: getPersistedChannelConfig()] context=${n}  channelConfig`,t),t}catch(e){return void console.error("[StorageManagerAS: getPersistedChannelConfig()] Can't find existing channel config",e)}}))}terminate(){return e(this,void 0,void 0,(function*(){Hc(`[StorageManagerAS: terminate()] enabled=${this.enabled}`),yield h.removeItem(al),yield h.removeItem(dl),yield h.removeItem(ll)}))}}const fl=e=>new hl(e);class pl extends Uc{constructor({connectionStream:e,shouldSendMetadata:t,autoRequestAccounts:n=!1}){super(e,{logger:console,maxEventListeners:100,shouldSendMetadata:t}),this.state={accounts:null,autoRequestAccounts:!1,providerStateRequested:!1,chainId:"",networkVersion:""},Hc(`[SDKProvider: constructor()] autoRequestAccounts=${n}`),this.state.autoRequestAccounts=n}forceInitializeState(){return e(this,void 0,void 0,(function*(){return Hc(`[SDKProvider: forceInitializeState()] autoRequestAccounts=${this.state.autoRequestAccounts}`),this._initializeStateAsync()}))}_setConnected(){Hc("[SDKProvider: _setConnected()] Setting connected state"),this._state.isConnected=!0}getState(){return this._state}getSDKProviderState(){return this.state}getSelectedAddress(){var e;const{accounts:t}=this._state;return t&&0!==t.length?(null===(e=t[0])||void 0===e?void 0:e.toLowerCase())||"":(Hc("[SDKProvider: getSelectedAddress] No accounts found"),null)}getChainId(){return this.state.chainId}getNetworkVersion(){return this.state.networkVersion}setSDKProviderState(e){this.state=Object.assign(Object.assign({},this.state),e)}handleAccountsChanged(e,t){return this._handleAccountsChanged(e,t)}handleDisconnect({terminate:e=!1}){!function({terminate:e=!1,instance:t}){const{state:n}=t;Hc(`[SDKProvider: handleDisconnect()] cleaning up provider state terminate=${e}`,t),e&&(t._state.accounts=null,t._state.isUnlocked=!1,t._state.isPermanentlyDisconnected=!0,t._state.initialized=!1),t._handleAccountsChanged([]),t._state.isConnected=!1,t.emit("disconnect",Fc.ethErrors.provider.disconnected()),n.providerStateRequested=!1}({terminate:e,instance:this})}_initializeStateAsync(){return e(this,void 0,void 0,(function*(){return function(t){var n,r;return e(this,void 0,void 0,(function*(){void 0===t.state&&(t.state={accounts:null,autoRequestAccounts:!1,providerStateRequested:!1,chainId:""});const{state:e}=t;let i;if(e.providerStateRequested)Hc("[SDKProvider: initializeStateAsync()] initialization already in progress");else{let o;e.providerStateRequested=!0;let s=null,a=!1,c=!1;const l=fl({enabled:!0});if(l){const e=yield l.getPersistedChannelConfig({});a=null!==(n=null==e?void 0:e.relayPersistence)&&void 0!==n&&n,o=yield l.getCachedChainId();const t=yield l.getCachedAccounts();t.length>0&&(s=t[0])}if(Hc(`[SDKProvider: initializeStateAsync()] relayPersistence=${a}`,{relayPersistence:a,cachedChainId:o,cachedSelectedAddress:s}),a)if(o&&s)i={accounts:[s],chainId:o,isUnlocked:!1},c=!0;else try{i=yield t.request({method:"metamask_getProviderState"})}catch(n){return t._log.error("MetaMask: Failed to get initial state. Please report this bug.",n),void(e.providerStateRequested=!1)}if(0===(null===(r=null==i?void 0:i.accounts)||void 0===r?void 0:r.length))if(t.getSelectedAddress())i.accounts=[t.getSelectedAddress()];else{Hc("[SDKProvider: initializeStateAsync()] Fetch accounts remotely.");const e=yield t.request({method:"eth_requestAccounts",params:[]});i.accounts=e}t._initializeState(i),e.providerStateRequested=!1,c&&(t._state.isConnected=!0,t.emit("connect",{chainId:null==i?void 0:i.chainId}))}}))}(this)}))}_initializeState(e){return Hc("[SDKProvider: _initializeState()]",e),function(e,t,n){return Hc("[SDKProvider: initializeState()] set state._initialized to false"),e._state.initialized=!1,t(n)}(this,super._initializeState.bind(this),e)}_handleChainChanged({chainId:e,networkVersion:t}={}){this.state.chainId=e,this.state.networkVersion=t,function({instance:e,chainId:t,networkVersion:n,superHandleChainChanged:r}){Hc(`[SDKProvider: handleChainChanged()] chainId=${t} networkVersion=${n}`);let i=n;n||(Hc("[SDKProvider: handleChainChanged()] forced network version to prevent provider error"),i="1"),e._state.isConnected=!0,e.emit("connect",{chainId:t}),r({chainId:t,networkVersion:i})}({instance:this,chainId:e,networkVersion:t,superHandleChainChanged:super._handleChainChanged.bind(this)})}}const gl={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console&&console[e]&&console[e].apply(console,t)}};class ml{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||gl,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,r){return r&&!this.debug?null:("string"==typeof e[0]&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new ml(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new ml(this.logger,e)}}var yl=new ml;class vl{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach((e=>{this.observers[e]||(this.observers[e]=new Map);const n=this.observers[e].get(t)||0;this.observers[e].set(t,n+1)})),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.observers[e]){Array.from(this.observers[e].entries()).forEach((e=>{let[t,r]=e;for(let e=0;e<r;e++)t(...n)}))}if(this.observers["*"]){Array.from(this.observers["*"].entries()).forEach((t=>{let[r,i]=t;for(let t=0;t<i;t++)r.apply(r,[e,...n])}))}}}function bl(){let e,t;const n=new Promise(((n,r)=>{e=n,t=r}));return n.resolve=e,n.reject=t,n}function El(e){return null==e?"":""+e}const wl=/###/g;function Sl(e,t,n){function r(e){return e&&e.indexOf("###")>-1?e.replace(wl,"."):e}function i(){return!e||"string"==typeof e}const o="string"!=typeof t?t:t.split(".");let s=0;for(;s<o.length-1;){if(i())return{};const t=r(o[s]);!e[t]&&n&&(e[t]=new n),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++s}return i()?{}:{obj:e,k:r(o[s])}}function _l(e,t,n){const{obj:r,k:i}=Sl(e,t,Object);if(void 0!==r||1===t.length)return void(r[i]=n);let o=t[t.length-1],s=t.slice(0,t.length-1),a=Sl(e,s,Object);for(;void 0===a.obj&&s.length;)o=`${s[s.length-1]}.${o}`,s=s.slice(0,s.length-1),a=Sl(e,s,Object),a&&a.obj&&void 0!==a.obj[`${a.k}.${o}`]&&(a.obj=void 0);a.obj[`${a.k}.${o}`]=n}function Cl(e,t){const{obj:n,k:r}=Sl(e,t);if(n)return n[r]}function kl(e,t,n){for(const r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?"string"==typeof e[r]||e[r]instanceof String||"string"==typeof t[r]||t[r]instanceof String?n&&(e[r]=t[r]):kl(e[r],t[r],n):e[r]=t[r]);return e}function Al(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var Ml={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function xl(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(e=>Ml[e])):e}const Ol=[" ",",","?","!",";"],Il=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}(20);function Rl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return e[t];const r=t.split(n);let i=e;for(let e=0;e<r.length;){if(!i||"object"!=typeof i)return;let t,o="";for(let s=e;s<r.length;++s)if(s!==e&&(o+=n),o+=r[s],t=i[o],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&s<r.length-1)continue;e+=s-e+1;break}i=t}return i}function Tl(e){return e&&e.indexOf("_")>0?e.replace("_","-"):e}class Pl extends vl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,o=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let s;e.indexOf(".")>-1?s=e.split("."):(s=[e,t],n&&(Array.isArray(n)?s.push(...n):"string"==typeof n&&i?s.push(...n.split(i)):s.push(n)));const a=Cl(this.data,s);return!a&&!t&&!n&&e.indexOf(".")>-1&&(e=s[0],t=s[1],n=s.slice(2).join(".")),a||!o||"string"!=typeof n?a:Rl(this.data&&this.data[e]&&this.data[e][t],n,i)}addResource(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const o=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator;let s=[e,t];n&&(s=s.concat(o?n.split(o):n)),e.indexOf(".")>-1&&(s=e.split("."),r=t,t=s[1]),this.addNamespaces(t),_l(this.data,s,r),i.silent||this.emit("added",e,t,n,r)}addResources(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const r in n)("string"==typeof n[r]||Array.isArray(n[r]))&&this.addResource(e,t,r,n[r],{silent:!0});r.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),r=n,n=t,t=s[1]),this.addNamespaces(t);let a=Cl(this.data,s)||{};o.skipCopy||(n=JSON.parse(JSON.stringify(n))),r?kl(a,n,i):a={...a,...n},_l(this.data,s,a),o.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((e=>t[e]&&Object.keys(t[e]).length>0))}toJSON(){return this.data}}var Nl={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,r,i){return e.forEach((e=>{this.processors[e]&&(t=this.processors[e].process(t,n,r,i))})),t}};const Ll={};class Dl extends vl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),function(e,t,n){e.forEach((e=>{t[e]&&(n[e]=t[e])}))}(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=yl.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const n=this.resolve(e,t);return n&&void 0!==n.res}extractFromKey(e,t){let n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");const r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const o=n&&e.indexOf(n)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||function(e,t,n){t=t||"",n=n||"";const r=Ol.filter((e=>t.indexOf(e)<0&&n.indexOf(e)<0));if(0===r.length)return!0;const i=Il.getRegExp(`(${r.map((e=>"?"===e?"\\?":e)).join("|")})`);let o=!i.test(e);if(!o){const t=e.indexOf(n);t>0&&!i.test(e.substring(0,t))&&(o=!0)}return o}(e,n,r));if(o&&!s){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:i};const o=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(o[0])>-1)&&(i=o.shift()),e=o.join(r)}return"string"==typeof i&&(i=[i]),{key:e,namespaces:i}}translate(e,t,n){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const r=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:o,namespaces:s}=this.extractFromKey(e[e.length-1],t),a=s[s.length-1],c=t.lng||this.language,l=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&"cimode"===c.toLowerCase()){if(l){const e=t.nsSeparator||this.options.nsSeparator;return r?{res:`${a}${e}${o}`,usedKey:o,exactUsedKey:o,usedLng:c,usedNS:a,usedParams:this.getUsedParamsDetails(t)}:`${a}${e}${o}`}return r?{res:o,usedKey:o,exactUsedKey:o,usedLng:c,usedNS:a,usedParams:this.getUsedParamsDetails(t)}:o}const d=this.resolve(e,t);let u=d&&d.res;const h=d&&d.usedKey||o,f=d&&d.exactUsedKey||o,p=Object.prototype.toString.apply(u),g=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,m=!this.i18nFormat||this.i18nFormat.handleAsObject;if(m&&u&&("string"!=typeof u&&"boolean"!=typeof u&&"number"!=typeof u)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(p)<0&&("string"!=typeof g||!Array.isArray(u))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(h,u,{...t,ns:s}):`key '${o} (${this.language})' returned an object instead of string.`;return r?(d.res=e,d.usedParams=this.getUsedParamsDetails(t),d):e}if(i){const e=Array.isArray(u),n=e?[]:{},r=e?f:h;for(const e in u)if(Object.prototype.hasOwnProperty.call(u,e)){const o=`${r}${i}${e}`;n[e]=this.translate(o,{...t,joinArrays:!1,ns:s}),n[e]===o&&(n[e]=u[e])}u=n}}else if(m&&"string"==typeof g&&Array.isArray(u))u=u.join(g),u&&(u=this.extendTranslation(u,e,t,n));else{let r=!1,s=!1;const l=void 0!==t.count&&"string"!=typeof t.count,h=Dl.hasDefaultValue(t),f=l?this.pluralResolver.getSuffix(c,t.count,t):"",p=t.ordinal&&l?this.pluralResolver.getSuffix(c,t.count,{ordinal:!1}):"",g=l&&!t.ordinal&&0===t.count&&this.pluralResolver.shouldUseIntlApi(),m=g&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${f}`]||t[`defaultValue${p}`]||t.defaultValue;!this.isValidLookup(u)&&h&&(r=!0,u=m),this.isValidLookup(u)||(s=!0,u=o);const y=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&s?void 0:u,v=h&&m!==u&&this.options.updateMissing;if(s||r||v){if(this.logger.log(v?"updateKey":"missingKey",c,a,o,v?m:u),i){const e=this.resolve(o,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const n=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&n&&n[0])for(let t=0;t<n.length;t++)e.push(n[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const r=(e,n,r)=>{const i=h&&r!==u?r:y;this.options.missingKeyHandler?this.options.missingKeyHandler(e,a,n,i,v,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(e,a,n,i,v,t),this.emit("missingKey",e,a,n,u)};this.options.saveMissing&&(this.options.saveMissingPlurals&&l?e.forEach((e=>{const n=this.pluralResolver.getSuffixes(e,t);g&&t[`defaultValue${this.options.pluralSeparator}zero`]&&n.indexOf(`${this.options.pluralSeparator}zero`)<0&&n.push(`${this.options.pluralSeparator}zero`),n.forEach((n=>{r([e],o+n,t[`defaultValue${n}`]||m)}))})):r(e,o,m))}u=this.extendTranslation(u,e,t,d,n),s&&u===o&&this.options.appendNamespaceToMissingKey&&(u=`${a}:${o}`),(s||r)&&this.options.parseMissingKeyHandler&&(u="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${a}:${o}`:o,r?u:void 0):this.options.parseMissingKeyHandler(u))}return r?(d.res=u,d.usedParams=this.getUsedParamsDetails(t),d):u}extendTranslation(e,t,n,r,i){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const s="string"==typeof e&&(n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let a;if(s){const t=e.match(this.interpolator.nestingRegexp);a=t&&t.length}let c=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,n.lng||this.language,n),s){const t=e.match(this.interpolator.nestingRegexp);a<(t&&t.length)&&(n.nest=!1)}!n.lng&&"v1"!==this.options.compatibilityAPI&&r&&r.res&&(n.lng=r.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return i&&i[0]===r[0]&&!n.context?(o.logger.warn(`It seems you are nesting recursively key: ${r[0]} in key: ${t[0]}`),null):o.translate(...r,t)}),n)),n.interpolation&&this.interpolator.reset()}const s=n.postProcess||this.options.postProcess,a="string"==typeof s?[s]:s;return null!=e&&a&&a.length&&!1!==n.applyPostProcessor&&(e=Nl.handle(a,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e){let t,n,r,i,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((e=>{if(this.isValidLookup(t))return;const a=this.extractFromKey(e,s),c=a.key;n=c;let l=a.namespaces;this.options.fallbackNS&&(l=l.concat(this.options.fallbackNS));const d=void 0!==s.count&&"string"!=typeof s.count,u=d&&!s.ordinal&&0===s.count&&this.pluralResolver.shouldUseIntlApi(),h=void 0!==s.context&&("string"==typeof s.context||"number"==typeof s.context)&&""!==s.context,f=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);l.forEach((e=>{this.isValidLookup(t)||(o=e,!Ll[`${f[0]}-${e}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(o)&&(Ll[`${f[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${f.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((n=>{if(this.isValidLookup(t))return;i=n;const o=[c];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(o,c,n,e,s);else{let e;d&&(e=this.pluralResolver.getSuffix(n,s.count,s));const t=`${this.options.pluralSeparator}zero`,r=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(o.push(c+e),s.ordinal&&0===e.indexOf(r)&&o.push(c+e.replace(r,this.options.pluralSeparator)),u&&o.push(c+t)),h){const n=`${c}${this.options.contextSeparator}${s.context}`;o.push(n),d&&(o.push(n+e),s.ordinal&&0===e.indexOf(r)&&o.push(n+e.replace(r,this.options.pluralSeparator)),u&&o.push(n+t))}}let a;for(;a=o.pop();)this.isValidLookup(t)||(r=a,t=this.getResource(n,e,a,s))})))}))})),{res:t,usedKey:n,exactUsedKey:r,usedLng:i,usedNS:o}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,r):this.resourceStore.getResource(e,t,n,r)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&"string"!=typeof e.replace;let r=n?e.replace:e;if(n&&void 0!==e.count&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!n){r={...r};for(const e of t)delete r[e]}return r}static hasDefaultValue(e){const t="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}function Kl(e){return e.charAt(0).toUpperCase()+e.slice(1)}class Bl{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=yl.create("languageUtils")}getScriptPartFromCode(e){if(!(e=Tl(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=Tl(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if("string"==typeof e&&e.indexOf("-")>-1){const t=["hans","hant","latn","cyrl","cans","mong","arab"];let n=e.split("-");return this.options.lowerCaseLng?n=n.map((e=>e.toLowerCase())):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=Kl(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=Kl(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=Kl(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach((e=>{if(t)return;const n=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(n)||(t=n)})),!t&&this.options.supportedLngs&&e.forEach((e=>{if(t)return;const n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find((e=>e===n?e:e.indexOf("-")<0&&n.indexOf("-")<0?void 0:e.indexOf("-")>0&&n.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1?e:void 0))})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){const n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],i=e=>{e&&(this.isSupportedCode(e)?r.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return"string"==typeof e&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):"string"==typeof e&&i(this.formatLanguageCode(e)),n.forEach((e=>{r.indexOf(e)<0&&i(this.formatLanguageCode(e))})),r}}let jl=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],$l={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}};const Ul=["v1","v2","v3"],Hl=["v4"],Fl={zero:0,one:1,two:2,few:3,many:4,other:5};class zl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=yl.create("pluralResolver"),this.options.compatibilityJSON&&!Hl.includes(this.options.compatibilityJSON)||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=function(){const e={};return jl.forEach((t=>{t.lngs.forEach((n=>{e[n]={numbers:t.nr,plurals:$l[t.fc]}}))})),e}()}addRule(e,t){this.rules[e]=t}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(Tl("dev"===e?"en":e),{type:t.ordinal?"ordinal":"cardinal"})}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}getPluralFormsOfKey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map((e=>`${t}${e}`))}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.getRule(e,t);return n?this.shouldUseIntlApi()?n.resolvedOptions().pluralCategories.sort(((e,t)=>Fl[e]-Fl[t])).map((e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`)):n.numbers.map((n=>this.getSuffix(e,n,t))):[]}getSuffix(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=this.getRule(e,n);return r?this.shouldUseIntlApi()?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:this.getSuffixRetroCompatible(r,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const n=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let r=e.numbers[n];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===r?r="plural":1===r&&(r=""));const i=()=>this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString();return"v1"===this.options.compatibilityJSON?1===r?"":"number"==typeof r?`_plural_${r.toString()}`:i():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?i():this.options.prepend&&n.toString()?this.options.prepend+n.toString():n.toString()}shouldUseIntlApi(){return!Ul.includes(this.options.compatibilityJSON)}}function ql(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=function(e,t,n){const r=Cl(e,n);return void 0!==r?r:Cl(t,n)}(e,t,n);return!o&&i&&"string"==typeof n&&(o=Rl(e,n,r),void 0===o&&(o=Rl(t,n,r))),o}class Wl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=yl.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(e=>e),this.init(e)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:n,useRawValueToEscape:r,prefix:i,prefixEscaped:o,suffix:s,suffixEscaped:a,formatSeparator:c,unescapeSuffix:l,unescapePrefix:d,nestingPrefix:u,nestingPrefixEscaped:h,nestingSuffix:f,nestingSuffixEscaped:p,nestingOptionsSeparator:g,maxReplaces:m,alwaysFormat:y}=e.interpolation;this.escape=void 0!==t?t:xl,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==r&&r,this.prefix=i?Al(i):o||"{{",this.suffix=s?Al(s):a||"}}",this.formatSeparator=c||",",this.unescapePrefix=l?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":l||"",this.nestingPrefix=u?Al(u):h||Al("$t("),this.nestingSuffix=f?Al(f):p||Al(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=m||1e3,this.alwaysFormat=void 0!==y&&y,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e&&e.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,n,r){let i,o,s;const a=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function c(e){return e.replace(/\$/g,"$$$$")}const l=e=>{if(e.indexOf(this.formatSeparator)<0){const i=ql(t,a,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(i,void 0,n,{...r,...t,interpolationkey:e}):i}const i=e.split(this.formatSeparator),o=i.shift().trim(),s=i.join(this.formatSeparator).trim();return this.format(ql(t,a,o,this.options.keySeparator,this.options.ignoreJSONStructure),s,n,{...r,...t,interpolationkey:o})};this.resetRegExp();const d=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,u=r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>c(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?c(this.escape(e)):c(e)}].forEach((t=>{for(s=0;i=t.regex.exec(e);){const n=i[1].trim();if(o=l(n),void 0===o)if("function"==typeof d){const t=d(e,i,r);o="string"==typeof t?t:""}else if(r&&Object.prototype.hasOwnProperty.call(r,n))o="";else{if(u){o=i[0];continue}this.logger.warn(`missed to pass in variable ${n} for interpolating ${e}`),o=""}else"string"==typeof o||this.useRawValueToEscape||(o=El(o));const a=t.safeValue(o);if(e=e.replace(i[0],a),u?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=i[0].length):t.regex.lastIndex=0,s++,s>=this.maxReplaces)break}})),e}nest(e,t){let n,r,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function s(e,t){const n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;const r=e.split(new RegExp(`${n}[ ]*{`));let o=`{${r[1]}`;e=r[0],o=this.interpolate(o,i);const s=o.match(/'/g),a=o.match(/"/g);(s&&s.length%2==0&&!a||a.length%2!=0)&&(o=o.replace(/'/g,'"'));try{i=JSON.parse(o),t&&(i={...t,...i})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${n}${o}`}return i.defaultValue&&i.defaultValue.indexOf(this.prefix)>-1&&delete i.defaultValue,e}for(;n=this.nestingRegexp.exec(e);){let a=[];i={...o},i=i.replace&&"string"!=typeof i.replace?i.replace:i,i.applyPostProcessor=!1,delete i.defaultValue;let c=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){const e=n[1].split(this.formatSeparator).map((e=>e.trim()));n[1]=e.shift(),a=e,c=!0}if(r=t(s.call(this,n[1].trim(),i),i),r&&n[0]===e&&"string"!=typeof r)return r;"string"!=typeof r&&(r=El(r)),r||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),r=""),c&&(r=a.reduce(((e,t)=>this.format(e,t,o.lng,{...o,interpolationkey:n[1].trim()})),r.trim())),e=e.replace(n[0],r),this.regexp.lastIndex=0}return e}}function Vl(e){const t={};return function(n,r,i){const o=r+JSON.stringify(i);let s=t[o];return s||(s=e(Tl(r),i),t[o]=s),s(n)}}class Gl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=yl.create("formatter"),this.options=e,this.formats={number:Vl(((e,t)=>{const n=new Intl.NumberFormat(e,{...t});return e=>n.format(e)})),currency:Vl(((e,t)=>{const n=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>n.format(e)})),datetime:Vl(((e,t)=>{const n=new Intl.DateTimeFormat(e,{...t});return e=>n.format(e)})),relativetime:Vl(((e,t)=>{const n=new Intl.RelativeTimeFormat(e,{...t});return e=>n.format(e,t.range||"day")})),list:Vl(((e,t)=>{const n=new Intl.ListFormat(e,{...t});return e=>n.format(e)}))},this.init(e)}init(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Vl(t)}format(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=t.split(this.formatSeparator).reduce(((e,t)=>{const{formatName:i,formatOptions:o}=function(e){let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const r=e.split("(");t=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);"currency"===t&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):"relativetime"===t&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach((e=>{if(e){const[t,...r]=e.split(":"),i=r.join(":").trim().replace(/^'+|'+$/g,""),o=t.trim();n[o]||(n[o]=i),"false"===i&&(n[o]=!1),"true"===i&&(n[o]=!0),isNaN(i)||(n[o]=parseInt(i,10))}}))}return{formatName:t,formatOptions:n}}(t);if(this.formats[i]){let t=e;try{const s=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},a=s.locale||s.lng||r.locale||r.lng||n;t=this.formats[i](e,a,{...o,...r,...s})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${i}`),e}),e);return i}}class Yl extends vl{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=r,this.logger=yl.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(n,r.backend,r)}queueLoad(e,t,n,r){const i={},o={},s={},a={};return e.forEach((e=>{let r=!0;t.forEach((t=>{const s=`${e}|${t}`;!n.reload&&this.store.hasResourceBundle(e,t)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===o[s]&&(o[s]=!0):(this.state[s]=1,r=!1,void 0===o[s]&&(o[s]=!0),void 0===i[s]&&(i[s]=!0),void 0===a[t]&&(a[t]=!0)))})),r||(s[e]=!0)})),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(a)}}loaded(e,t,n){const r=e.split("|"),i=r[0],o=r[1];t&&this.emit("failedLoading",i,o,t),n&&this.store.addResourceBundle(i,o,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2;const s={};this.queue.forEach((n=>{!function(e,t,n,r){const{obj:i,k:o}=Sl(e,t,Object);i[o]=i[o]||[],i[o].push(n)}(n.loaded,[i],o),function(e,t){void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)}(n,e),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach((e=>{s[e]||(s[e]={});const t=n.loaded[e];t.length&&t.forEach((t=>{void 0===s[e][t]&&(s[e][t]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((e=>!e.done))}read(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:r,wait:i,callback:o});this.readingCalls++;const s=(s,a)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}s&&a&&r<this.maxRetries?setTimeout((()=>{this.read.call(this,e,t,n,r+1,2*i,o)}),i):o(s,a)},a=this.backend[n].bind(this.backend);if(2!==a.length)return a(e,t,s);try{const n=a(e,t);n&&"function"==typeof n.then?n.then((e=>s(null,e))).catch(s):s(null,n)}catch(e){s(e)}}prepareLoading(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);const i=this.queueLoad(e,t,n,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach((e=>{this.loadOne(e)}))}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split("|"),r=n[0],i=n[1];this.read(r,i,"read",void 0,void 0,((n,o)=>{n&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,n),!n&&o&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,o),this.loaded(e,n,o)}))}saveMissing(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn(`did not save key "${n}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(null!=n&&""!==n){if(this.backend&&this.backend.create){const a={...o,isUpdate:i},c=this.backend.create.bind(this.backend);if(c.length<6)try{let i;i=5===c.length?c(e,t,n,r,a):c(e,t,n,r),i&&"function"==typeof i.then?i.then((e=>s(null,e))).catch(s):s(null,i)}catch(e){s(e)}else c(e,t,n,r,s,a)}e&&e[0]&&this.store.addResource(e[0],t,n,r)}}}function Jl(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){let t={};if("object"==typeof e[1]&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const n=e[3]||e[2];Object.keys(n).forEach((e=>{t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function Zl(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function Xl(){}class Ql extends vl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;var n;if(super(),this.options=Zl(e),this.services={},this.logger=yl,this.modules={external:[]},n=this,Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach((e=>{"function"==typeof n[e]&&(n[e]=n[e].bind(n))})),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout((()=>{this.init(e,t)}),0)}}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(n=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=Jl();function i(e){return e?"function"==typeof e?new e:e:null}if(this.options={...r,...this.options,...Zl(t)},"v1"!==this.options.compatibilityAPI&&(this.options.interpolation={...r.interpolation,...this.options.interpolation}),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){let t;this.modules.logger?yl.init(i(this.modules.logger),this.options):yl.init(null,this.options),this.modules.formatter?t=this.modules.formatter:"undefined"!=typeof Intl&&(t=Gl);const n=new Bl(this.options);this.store=new Pl(this.options.resources,this.options);const o=this.services;o.logger=yl,o.resourceStore=this.store,o.languageUtils=n,o.pluralResolver=new zl(n,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!t||this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format||(o.formatter=i(t),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new Wl(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new Yl(i(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit(t,...r)})),this.modules.languageDetector&&(o.languageDetector=i(this.modules.languageDetector),o.languageDetector.init&&o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=i(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new Dl(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit(t,...r)})),this.modules.external.forEach((e=>{e.init&&e.init(this)}))}if(this.format=this.options.interpolation.format,n||(n=Xl),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((t=>{this[t]=function(){return e.store[t](...arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((t=>{this[t]=function(){return e.store[t](...arguments),e}}));const o=bl(),s=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(t),n(e,t)};if(this.languages&&"v1"!==this.options.compatibilityAPI&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initImmediate?s():setTimeout(s,0),o}loadResources(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xl;const n="string"==typeof e?e:this.language;if("function"==typeof e&&(t=e),!this.options.resources||this.options.partialBundledLanguages){if(n&&"cimode"===n.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return t();const e=[],r=t=>{if(!t)return;if("cimode"===t)return;this.services.languageUtils.toResolveHierarchy(t).forEach((t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)}))};if(n)r(n);else{this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((e=>r(e)))}this.options.preload&&this.options.preload.forEach((e=>r(e))),this.services.backendConnector.load(e,this.options.ns,(e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),t(e)}))}else t(null)}reloadResources(e,t,n){const r=bl();return e||(e=this.languages),t||(t=this.options.ns),n||(n=Xl),this.services.backendConnector.reload(e,t,(e=>{r.resolve(),n(e)})),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&Nl.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,t){var n=this;this.isLanguageChangingTo=e;const r=bl();this.emit("languageChanging",e);const i=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},o=(e,o)=>{o?(i(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,r.resolve((function(){return n.t(...arguments)})),t&&t(e,(function(){return n.t(...arguments)}))},s=t=>{e||t||!this.services.languageDetector||(t=[]);const n="string"==typeof t?t:this.services.languageUtils.getBestMatchFromCodes(t);n&&(this.language||i(n),this.translator.language||this.translator.changeLanguage(n),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(n)),this.loadResources(n,(e=>{o(e,n)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e):s(this.services.languageDetector.detect()),r}getFixedT(e,t,n){var r=this;const i=function(e,t){let o;if("object"!=typeof t){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];o=r.options.overloadTranslationOptionHandler([e,t].concat(a))}else o={...t};o.lng=o.lng||i.lng,o.lngs=o.lngs||i.lngs,o.ns=o.ns||i.ns,o.keyPrefix=o.keyPrefix||n||i.keyPrefix;const l=r.options.keySeparator||".";let d;return d=o.keyPrefix&&Array.isArray(e)?e.map((e=>`${o.keyPrefix}${l}${e}`)):o.keyPrefix?`${o.keyPrefix}${l}${e}`:e,r.t(d,o)};return"string"==typeof e?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=n,i}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=t.lng||this.resolvedLanguage||this.languages[0],r=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;const o=(e,t)=>{const n=this.services.backendConnector.state[`${e}|${t}`];return-1===n||2===n};if(t.precheck){const e=t.precheck(this,o);if(void 0!==e)return e}return!!this.hasResourceBundle(n,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!o(n,e)||r&&!o(i,e)))}loadNamespaces(e,t){const n=bl();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)})),this.loadResources((e=>{n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){const n=bl();"string"==typeof e&&(e=[e]);const r=this.options.preload||[],i=e.filter((e=>r.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e)));return i.length?(this.options.preload=r.concat(i),this.loadResources((e=>{n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=this.services&&this.services.languageUtils||new Bl(Jl());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new Ql(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xl;const n=e.forkResourceStore;n&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new Ql(r);void 0===e.debug&&void 0===e.prefix||(i.logger=i.logger.clone(e));return["store","services","language"].forEach((e=>{i[e]=this[e]})),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},n&&(i.store=new Pl(this.store.data,r),i.services.resourceStore=i.store),i.translator=new Dl(i.services,r),i.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit(e,...n)})),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ed=Ql.createInstance();ed.createInstance=Ql.createInstance;const td=ed.createInstance;ed.dir,ed.init,ed.loadResources,ed.reloadResources,ed.use,ed.changeLanguage,ed.getFixedT,ed.t,ed.exists,ed.setDefaultNamespace,ed.hasLoadedNamespace,ed.loadNamespaces,ed.loadLanguages;var nd,rd={name:"@metamask/sdk",version:"0.30.3",description:"",homepage:"https://github.com/MetaMask/metamask-sdk#readme",bugs:{url:"https://github.com/MetaMask/metamask-sdk/issues"},repository:{type:"git",url:"https://github.com/MetaMask/metamask-sdk",directory:"packages/sdk"},exports:{".":{node:{import:"./dist/node/es/metamask-sdk.js",require:"./dist/node/cjs/metamask-sdk.js"},browser:"./dist/browser/es/metamask-sdk.js","react-native":"./dist/react-native/es/metamask-sdk.js",default:"./dist/browser/es/metamask-sdk.js"}},main:"dist/node/cjs/metamask-sdk.js",module:"dist/browser/es/metamask-sdk.js",browser:"dist/browser/es/metamask-sdk.js",unpkg:"dist/browser/umd/metamask-sdk.js","react-native":"dist/react-native/es/metamask-sdk.js",types:"dist/types/src/index.d.ts",sideEffects:!1,files:["/dist"],scripts:{"build:types":"tsc --project tsconfig.build.json --emitDeclarationOnly --outDir dist/types",build:"yarn build:types && rollup -c --bundleConfigAsCjs","build:clean":"yarn clean && yarn build","build:dev":"yarn build:types && NODE_ENV=dev rollup -c --bundleConfigAsCjs","build:post-tsc":"echo 'N/A'","build:pre-tsc":"echo 'N/A'",clean:"rimraf ./dist",size:"node bundle-size && size-limit",lint:"yarn lint:eslint && yarn lint:misc --check","lint:changelog":"../../scripts/validate-changelog.sh @metamask/sdk","lint:eslint":"eslint . --cache --ext js,ts","lint:fix":"yarn lint:eslint --fix && yarn lint:misc --write","lint:misc":"prettier '**/*.json' '**/*.md' '!CHANGELOG.md' --ignore-path ../../.gitignore",prepack:"../../scripts/prepack.sh","publish:preview":"yarn npm publish --tag preview",reset:"yarn clean && rimraf ./node_modules/",test:'jest --testPathIgnorePatterns "/e2e/"',"test:coverage":'jest --coverage --testPathIgnorePatterns "/e2e/"',"test:e2e":'jest --testPathPattern "/e2e/"',"test:ci":'jest --coverage --passWithNoTests --setupFilesAfterEnv ./jest-preload.js --testPathIgnorePatterns "/e2e/"',"test:dev":'jest -c ./jest.config.ts --detectOpenHandles  --testPathIgnorePatterns "/e2e/"',watch:"rollup -c -w"},dependencies:{"@metamask/onboarding":"^1.0.1","@metamask/providers":"16.1.0","@metamask/sdk-communication-layer":"workspace:*","@metamask/sdk-install-modal-web":"workspace:*",bowser:"^2.9.0","cross-fetch":"^4.0.0",debug:"^4.3.4",eciesjs:"^0.4.11","eth-rpc-errors":"^4.0.3",eventemitter2:"^6.4.9",i18next:"23.11.5","i18next-browser-languagedetector":"7.1.0","obj-multiplex":"^1.0.0",pump:"^3.0.0","qrcode-terminal-nooctal":"^0.12.1","react-native-webview":"^11.26.0","readable-stream":"^3.6.2","socket.io-client":"^4.5.1",util:"^0.12.4",uuid:"^8.3.2"},devDependencies:{"@jest/globals":"^29.3.1","@lavamoat/allow-scripts":"^2.3.1","@metamask/auto-changelog":"3.1.0","@metamask/eslint-config":"^6.0.0","@metamask/eslint-config-nodejs":"^6.0.0","@metamask/eslint-config-typescript":"^6.0.0","@react-native-async-storage/async-storage":"^1.19.6","@rollup/plugin-alias":"^5.1.1","@rollup/plugin-commonjs":"^25.0.7","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-replace":"^6.0.1","@rollup/plugin-terser":"^0.4.1","@size-limit/preset-big-lib":"^11.0.2","@types/dom-screen-wake-lock":"^1.0.2","@types/node":"^20.1.3","@types/pump":"^1.1.1","@types/qrcode-terminal":"^0.12.0","@types/uuid":"^10.0.0","@typescript-eslint/eslint-plugin":"^4.26.0","@typescript-eslint/parser":"^4.26.0","browserify-zlib":"^0.2.0",buffer:"^6.0.3","crypto-browserify":"^3.12.0",eslint:"^7.30.0","eslint-config-prettier":"^8.3.0","eslint-plugin-import":"^2.23.4","eslint-plugin-jest":"^24.4.0","eslint-plugin-jsdoc":"^36.1.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^3.4.0","https-browserify":"^1.0.0",jest:"^29.3.1","jest-environment-jsdom":"^29.3.1",prettier:"^2.3.0",process:"^0.11.10",react:"^18.2.0","react-dom":"18.2.0",rimraf:"^4.4.0",rollup:"^4.26.0","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-jscc":"^2.0.0","rollup-plugin-natives":"^0.7.5","rollup-plugin-node-builtins":"^2.1.2","rollup-plugin-node-globals":"^1.4.0","rollup-plugin-polyfill-node":"^0.13.0","rollup-plugin-sizes":"^1.0.6","rollup-plugin-typescript2":"^0.31.2","rollup-plugin-visualizer":"^5.12.0","size-limit":"^11.0.2","stream-browserify":"^3.0.0","stream-http":"^3.2.0","ts-jest":"^29.0.3","ts-node":"^10.9.1",tslib:"latest",typescript:"^4.3.2",url:"^0.11.0",webpack:"^5.0.0"},peerDependencies:{react:"^18.2.0","react-dom":"^18.2.0"},peerDependenciesMeta:{react:{optional:!0},"react-dom":{optional:!0}},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},lavamoat:{allowScripts:{"eciesjs>secp256k1":!1,"socket.io-client>engine.io-client>ws>bufferutil":!1,"socket.io-client>engine.io-client>ws>utf-8-validate":!1,"@metamask/sdk-communication-layer>bufferutil":!1,"@metamask/sdk-communication-layer>eciesjs>secp256k1":!1,"@metamask/sdk-communication-layer>utf-8-validate":!1}}};!function(e){e.INPAGE="metamask-inpage",e.CONTENT_SCRIPT="metamask-contentscript",e.PROVIDER="metamask-provider"}(nd||(nd={}));const id="direct",od="https://metamask.app.link/connect",sd="metamask://connect",ad={NAME:"MetaMask",RDNS:"io.metamask"},cd=/(?:^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}$)|(?:^0{8}-0{4}-0{4}-0{4}-0{12}$)/u;const ld={Initialized:"initialized",DisplayURI:"display_uri",ProviderUpdate:"provider_update",ConnectWithResponse:"connectWithResponse",ConnectionStatus:"connection_status",ServiceStatus:"service_status"};var dd;!function(e){e.TERMINATE="terminate",e.EXTENSION="extension",e.INITIALIZED="initialized"}(dd||(dd={}));const ud="undefined"!=typeof window&&window.localStorage;function hd({instance:t,msg:n}){return e(this,void 0,void 0,(function*(){if(t._initialized||(Hc("[MetaMaskSDK: connectAndSign()] provider not ready -- wait for init()"),yield t.init()),Hc(`[MetaMaskSDK: connectAndSign()] activeProvider=${t.activeProvider}`),!t.activeProvider)throw new Error("SDK state invalid -- undefined provider");const e=/^0x([0-9A-Fa-f]{2})*$/u.test(n)?n:function(e){let t;if("undefined"!=typeof Buffer)t=Buffer.from(e,"utf8").toString("hex");else if("undefined"!=typeof TextEncoder){const n=(new TextEncoder).encode(e);t=Array.from(n).map((e=>e.toString(16).padStart(2,"0"))).join("")}else{if("object"!=typeof global||!("Buffer"in global))throw new Error("Unable to convert string to hex: No available method.");t=global.Buffer.from(e,"utf8").toString("hex")}return`0x${t}`}(n);return t.activeProvider.request({method:rl.METAMASK_CONNECTWITH,params:[{method:rl.PERSONAL_SIGN,params:[e]}]})}))}function fd(t){var n,r;return e(this,void 0,void 0,(function*(){Hc("[MetaMaskSDK: connectWithExtensionProvider()] ",t),t.sdkProvider=t.activeProvider,t.activeProvider=window.extension,window.ethereum=window.extension;try{const e=yield null===(n=window.extension)||void 0===n?void 0:n.request({method:"eth_requestAccounts"});Hc(`[MetaMaskSDK: connectWithExtensionProvider()] accounts=${e}`)}catch(e){return void console.warn("[MetaMaskSDK: connectWithExtensionProvider()] can't request accounts error",e)}localStorage.setItem(cl,"extension"),t.extensionActive=!0,t.emit(ld.ProviderUpdate,dd.EXTENSION),t.options.enableAnalytics&&(null===(r=t.analytics)||void 0===r||r.send({event:Mi.SDK_USE_EXTENSION}))}))}function pd(e){return pd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pd(e)}function gd(e){var t=function(e,t){if("object"!==pd(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!==pd(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===pd(t)?t:String(t)}function md(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,gd(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var yd=[],vd=yd.forEach,bd=yd.slice;var Ed=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,wd=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};n&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+60*n*1e3)),r&&(i.domain=r),document.cookie=function(e,t,n){var r=n||{};r.path=r.path||"/";var i=encodeURIComponent(t),o="".concat(e,"=").concat(i);if(r.maxAge>0){var s=r.maxAge-0;if(Number.isNaN(s))throw new Error("maxAge should be a Number");o+="; Max-Age=".concat(Math.floor(s))}if(r.domain){if(!Ed.test(r.domain))throw new TypeError("option domain is invalid");o+="; Domain=".concat(r.domain)}if(r.path){if(!Ed.test(r.path))throw new TypeError("option path is invalid");o+="; Path=".concat(r.path)}if(r.expires){if("function"!=typeof r.expires.toUTCString)throw new TypeError("option expires is invalid");o+="; Expires=".concat(r.expires.toUTCString())}if(r.httpOnly&&(o+="; HttpOnly"),r.secure&&(o+="; Secure"),r.sameSite)switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o}(e,encodeURIComponent(t),i)},Sd=function(e){for(var t="".concat(e,"="),n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},_d={name:"cookie",lookup:function(e){var t;if(e.lookupCookie&&"undefined"!=typeof document){var n=Sd(e.lookupCookie);n&&(t=n)}return t},cacheUserLanguage:function(e,t){t.lookupCookie&&"undefined"!=typeof document&&wd(t.lookupCookie,e,t.cookieMinutes,t.cookieDomain,t.cookieOptions)}},Cd={name:"querystring",lookup:function(e){var t;if("undefined"!=typeof window){var n=window.location.search;!window.location.search&&window.location.hash&&window.location.hash.indexOf("?")>-1&&(n=window.location.hash.substring(window.location.hash.indexOf("?")));for(var r=n.substring(1).split("&"),i=0;i<r.length;i++){var o=r[i].indexOf("=");if(o>0)r[i].substring(0,o)===e.lookupQuerystring&&(t=r[i].substring(o+1))}}return t}},kd=null,Ad=function(){if(null!==kd)return kd;try{kd="undefined"!==window&&null!==window.localStorage;var e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){kd=!1}return kd},Md={name:"localStorage",lookup:function(e){var t;if(e.lookupLocalStorage&&Ad()){var n=window.localStorage.getItem(e.lookupLocalStorage);n&&(t=n)}return t},cacheUserLanguage:function(e,t){t.lookupLocalStorage&&Ad()&&window.localStorage.setItem(t.lookupLocalStorage,e)}},xd=null,Od=function(){if(null!==xd)return xd;try{xd="undefined"!==window&&null!==window.sessionStorage;var e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){xd=!1}return xd},Id={name:"sessionStorage",lookup:function(e){var t;if(e.lookupSessionStorage&&Od()){var n=window.sessionStorage.getItem(e.lookupSessionStorage);n&&(t=n)}return t},cacheUserLanguage:function(e,t){t.lookupSessionStorage&&Od()&&window.sessionStorage.setItem(t.lookupSessionStorage,e)}},Rd={name:"navigator",lookup:function(e){var t=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var n=0;n<navigator.languages.length;n++)t.push(navigator.languages[n]);navigator.userLanguage&&t.push(navigator.userLanguage),navigator.language&&t.push(navigator.language)}return t.length>0?t:void 0}},Td={name:"htmlTag",lookup:function(e){var t,n=e.htmlTag||("undefined"!=typeof document?document.documentElement:null);return n&&"function"==typeof n.getAttribute&&(t=n.getAttribute("lang")),t}},Pd={name:"path",lookup:function(e){var t;if("undefined"!=typeof window){var n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(n instanceof Array)if("number"==typeof e.lookupFromPathIndex){if("string"!=typeof n[e.lookupFromPathIndex])return;t=n[e.lookupFromPathIndex].replace("/","")}else t=n[0].replace("/","")}return t}},Nd={name:"subdomain",lookup:function(e){var t="number"==typeof e.lookupFromSubdomainIndex?e.lookupFromSubdomainIndex+1:1,n="undefined"!=typeof window&&window.location&&window.location.hostname&&window.location.hostname.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(n)return n[t]}};var Ld=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="languageDetector",this.detectors={},this.init(t,n)}return md(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e||{languageUtils:{}},this.options=function(e){return vd.call(bd.call(arguments,1),(function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])})),e}(t,this.options||{},{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:function(e){return e}}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=function(e){return e.replace("-","_")}),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(_d),this.addDetector(Cd),this.addDetector(Md),this.addDetector(Id),this.addDetector(Rd),this.addDetector(Td),this.addDetector(Pd),this.addDetector(Nd)}},{key:"addDetector",value:function(e){this.detectors[e.name]=e}},{key:"detect",value:function(e){var t=this;e||(e=this.options.order);var n=[];return e.forEach((function(e){if(t.detectors[e]){var r=t.detectors[e].lookup(t.options);r&&"string"==typeof r&&(r=[r]),r&&(n=n.concat(r))}})),n=n.map((function(e){return t.options.convertDetectedLanguage(e)})),this.services.languageUtils.getBestMatchFromCodes?n:n.length>0?n[0]:null}},{key:"cacheUserLanguage",value:function(e,t){var n=this;t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach((function(t){n.detectors[t]&&n.detectors[t].cacheUserLanguage(e,n.options)})))}}]),e}();Ld.type="languageDetector";var Dd={DESKTOP:"Desktop",MOBILE:"Mobile",META_MASK_MOBILE_APP:"MetaMask mobile app",SCAN_TO_CONNECT:"Scan to connect and sign with",CONNECT_WITH_EXTENSION:"Connect With MetaMask Extension",INSTALL_MODAL:{TRUSTED_BY_USERS:"Trusted by over 30 million users to buy, store, send and swap crypto securely",LEADING_CRYPTO_WALLET:"The leading crypto wallet & gateway to blockchain apps built on Ethereum Mainnet, Polygon, Optimism, and many other networks",CONTROL_DIGITAL_INTERACTIONS:"Puts you in control of your digital interactions by making power of cryptography more accessible",INSTALL_META_MASK_EXTENSION:"Install MetaMask Extension"},PENDING_MODAL:{OPEN_META_MASK_SELECT_CODE:"Please open the MetaMask wallet app and select the code on the screen OR disconnect",OPEN_META_MASK_CONTINUE:"Open the MetaMask app to continue with your session.",NUMBER_AFTER_OPEN_NOTICE:"If a number doesn't appear after opening MetaMask, please click disconnect and re-scan the QRCode.",DISCONNECT:"Disconnect"},SELECT_MODAL:{CRYPTO_TAKE_CONTROL_TEXT:"Take control of your crypto and explore the blockchain with the wallet trusted by over 30 million people worldwide"},META_MASK_MODAL:{ADDRESS_COPIED:"Address copied to clipboard!",DISCONNECT:"Disconnect",ACTIVE_NETWORK:"Active Network"}},Kd={DESKTOP:"Escritorio",MOBILE:"Móvil",META_MASK_MOBILE_APP:"Aplicación móvil de MetaMask",SCAN_TO_CONNECT:"Escanear para conectar y firmar con",CONNECT_WITH_EXTENSION:"Conectar con la Extensión de MetaMask",INSTALL_MODAL:{TRUSTED_BY_USERS:"Confiado por más de 30 millones de usuarios para comprar, almacenar, enviar e intercambiar cripto de manera segura",LEADING_CRYPTO_WALLET:"La principal billetera de criptomonedas y pasarela hacia aplicaciones blockchain construidas en Ethereum Mainnet, Polygon, Optimism y muchas otras redes",CONTROL_DIGITAL_INTERACTIONS:"Te da el control de tus interacciones digitales al hacer que el poder de la criptografía sea más accesible",INSTALL_META_MASK_EXTENSION:"Instalar la Extensión de MetaMask"},PENDING_MODAL:{OPEN_META_MASK_SELECT_CODE:"Por favor, abre la aplicación de billetera MetaMask y selecciona el código en la pantalla O desconecta",OPEN_META_MASK_CONTINUE:"Abre la aplicación de MetaMask para continuar con tu sesión.",NUMBER_AFTER_OPEN_NOTICE:"Si no aparece un número después de abrir MetaMask, por favor haz clic en desconectar y vuelve a escanear el código QR.",DISCONNECT:"Desconectar"},SELECT_MODAL:{CRYPTO_TAKE_CONTROL_TEXT:"Toma el control de tu cripto y explora la blockchain con la billetera en la que confían más de 30 millones de personas en todo el mundo"},META_MASK_MODAL:{ADDRESS_COPIED:"¡Dirección copiada al portapapeles!",DISCONNECT:"Desconectar",ACTIVE_NETWORK:"Red activa"}},Bd={DESKTOP:"Bureau",MOBILE:"Mobile",META_MASK_MOBILE_APP:"Application mobile MetaMask",SCAN_TO_CONNECT:"Scannez pour vous connecter et signer avec",CONNECT_WITH_EXTENSION:"Connectez-vous avec l'extension MetaMask",INSTALL_MODAL:{TRUSTED_BY_USERS:"Fait confiance à plus de 30 millions d'utilisateurs pour acheter, stocker, envoyer et échanger des crypto en toute sécurité",LEADING_CRYPTO_WALLET:"Le portefeuille crypto leader et la passerelle vers des applications blockchain basées sur Ethereum Mainnet, Polygon, Optimism, et de nombreux autres réseaux",CONTROL_DIGITAL_INTERACTIONS:"Vous donne le contrôle de vos interactions numériques en rendant la puissance de la cryptographie plus accessible",INSTALL_META_MASK_EXTENSION:"Installez l'extension MetaMask"},PENDING_MODAL:{OPEN_META_MASK_SELECT_CODE:"Veuillez ouvrir l'application MetaMask et sélectionnez le code à l'écran OU déconnectez-vous",OPEN_META_MASK_CONTINUE:"Ouvrez l'application MetaMask pour continuer votre session.",NUMBER_AFTER_OPEN_NOTICE:"Si un numéro n'apparaît pas après avoir ouvert MetaMask, veuillez cliquer sur déconnecter et rescanner le QRCode.",DISCONNECT:"Déconnecter"},SELECT_MODAL:{CRYPTO_TAKE_CONTROL_TEXT:"Prenez le contrôle de votre crypto et explorez la blockchain avec le portefeuille fait confiance par plus de 30 millions de personnes à travers le monde"},META_MASK_MODAL:{ADDRESS_COPIED:"Adresse copiée dans le presse-papiers!",DISCONNECT:"Déconnecter",ACTIVE_NETWORK:"Réseau actif"}},jd={DESKTOP:"שולחן עבודה",MOBILE:"נייד",META_MASK_MOBILE_APP:"אפליקציית מטא מאסק לנייד",SCAN_TO_CONNECT:"סרוק כדי להתחבר ולחתום עם",CONNECT_WITH_EXTENSION:"התחבר עם התוסף של מטא מאסק",INSTALL_MODAL:{TRUSTED_BY_USERS:"מהימנים על ידי למעלה מ-30 מיליון משתמשים לקנות, לאחסן, לשלוח ולהחליף מטבע קריפטוגרפי בבטחה",LEADING_CRYPTO_WALLET:"ארנק הקריפטו המוביל והשער ליישומי בלוקצ'יין המתוכנתים על אתריום, פוליגון, ורשתות רבות נוספות",CONTROL_DIGITAL_INTERACTIONS:"מכניס אותך לשליטה על האינטראקציות הדיגיטליות שלך על ידי הפיכת כוח הקריפטוגרפיה לנגיש יותר",INSTALL_META_MASK_EXTENSION:"התקן את ההרחבה של מטא מאסק"},PENDING_MODAL:{OPEN_META_MASK_SELECT_CODE:"אנא פתח את אפליקציית ארנק מטא מאסק ובחר את הקוד שמופיע על המסך או התנתק",OPEN_META_MASK_CONTINUE:"פתח את האפליקציה של מטא מאסק כדי להמשיך בפעולה שלך.",NUMBER_AFTER_OPEN_NOTICE:"אם מספר אינו מופיע לאחר פתיחת מטא מאסק, אנא לחץ על התנתקות וסרוק מחדש את ה-QRCode.",DISCONNECT:"התנתק"},SELECT_MODAL:{CRYPTO_TAKE_CONTROL_TEXT:"קח שליטה על הקריפטו שלך וחקור את הבלוקצ'יין עם הארנק האמין שבשימוש על ידי למעלה מ-30 מיליון אנשים ברחבי העולם"},META_MASK_MODAL:{ADDRESS_COPIED:"הכתובת הועתקה ללוח!",DISCONNECT:"התנתק",ACTIVE_NETWORK:"רשת פעילה"}},$d={DESKTOP:"Desktop",MOBILE:"Mobile",META_MASK_MOBILE_APP:"App mobile MetaMask",SCAN_TO_CONNECT:"Scansiona per connetterti e firmare con",CONNECT_WITH_EXTENSION:"Connettiti con l'estensione MetaMask",INSTALL_MODAL:{TRUSTED_BY_USERS:"Ritenuto affidabile da oltre 30 milioni di utenti per acquistare, conservare, inviare e scambiare cripto in modo sicuro",LEADING_CRYPTO_WALLET:"Il principale portafoglio cripto e gateway per applicazioni blockchain funzionanti su Ethereum Mainnet, Polygon, Optimism e molte altre reti",CONTROL_DIGITAL_INTERACTIONS:"Ti da il controllo delle tue interazioni digitali rendendo piu' accessibile il potere della crittografia",INSTALL_META_MASK_EXTENSION:"Installa l'estensione MetaMask"},PENDING_MODAL:{OPEN_META_MASK_SELECT_CODE:"Si prega di aprire l'app mobile MetaMask Wallet e selezionare il codice sullo schermo OPPURE scollegarsi",OPEN_META_MASK_CONTINUE:"Apri l'app mobile MetaMask per continuare con la tua sessione.",NUMBER_AFTER_OPEN_NOTICE:"Se, dopo aver aperto MetaMask, non appare alcun numero, si prega di fare clic su disconnetti e ris canzionare il QRCode.",DISCONNECT:"Disconnetti"},SELECT_MODAL:{CRYPTO_TAKE_CONTROL_TEXT:"Prendi il controllo delle tue cripto e esplora la blockchain con il portafoglio ritenuto affidabile da oltre 30 milioni di persone in tutto il mondo"},META_MASK_MODAL:{ADDRESS_COPIED:"Indirizzo copiato negli appunti!",DISCONNECT:"Disconnetti",ACTIVE_NETWORK:"Rete attiva"}},Ud={DESKTOP:"Desktop",MOBILE:"Móvel",META_MASK_MOBILE_APP:"Aplicativo móvel MetaMask",SCAN_TO_CONNECT:"Escanear para conectar e assinar com",CONNECT_WITH_EXTENSION:"Conectar com a extensão MetaMask",INSTALL_MODAL:{TRUSTED_BY_USERS:"Confiado por mais de 30 milhões de usuários para comprar, armazenar, enviar e trocar cripto com segurança",LEADING_CRYPTO_WALLET:"A principal carteira de cripto & portal para aplicativos blockchain construídos em Ethereum Mainnet, Polygon, Optimism, e muitas outras redes",CONTROL_DIGITAL_INTERACTIONS:"Coloca você no controle de suas interações digitais, tornando o poder da criptografia mais acessível",INSTALL_META_MASK_EXTENSION:"Instalar a extensão MetaMask"},PENDING_MODAL:{OPEN_META_MASK_SELECT_CODE:"Por favor, abra o aplicativo MetaMask e selecione o código na tela OU desconecte",OPEN_META_MASK_CONTINUE:"Abra o aplicativo MetaMask para continuar sua sessão.",NUMBER_AFTER_OPEN_NOTICE:"Se um número não aparecer após abrir o MetaMask, por favor clique em desconectar e re-escaneie o QRCode.",DISCONNECT:"Desconectar"},SELECT_MODAL:{CRYPTO_TAKE_CONTROL_TEXT:"Assuma o controle de sua cripto e explore a blockchain com a carteira confiada por mais de 30 milhões de pessoas em todo o mundo"},META_MASK_MODAL:{ADDRESS_COPIED:"Endereço copiado para a área de transferência!",DISCONNECT:"Desconectar",ACTIVE_NETWORK:"Rede ativa"}},Hd={DESKTOP:"Masaüstü",MOBILE:"Mobil",META_MASK_MOBILE_APP:"MetaMask mobil uygulama",SCAN_TO_CONNECT:"Bağlanmak ve imzalamak için tarayın",CONNECT_WITH_EXTENSION:"MetaMask Eklentisi ile Bağlan",INSTALL_MODAL:{TRUSTED_BY_USERS:"Kriptoyu güvenle satın almak, saklamak, göndermek ve değiştirmek için 30 milyondan fazla kullanıcı tarafından güvenilir",LEADING_CRYPTO_WALLET:"Ethereum Ana Ağı, Polygon, Optimism ve birçok diğer ağda kurulu blockchain uygulamalarına erişim sağlayan öncü kripto cüzdanı",CONTROL_DIGITAL_INTERACTIONS:"Kriptografinin gücünü daha erişilebilir kılarak dijital etkileşimlerinizin kontrolünü size verir",INSTALL_META_MASK_EXTENSION:"MetaMask Eklentisini Yükleyin"},PENDING_MODAL:{OPEN_META_MASK_SELECT_CODE:"Lütfen MetaMask cüzdan uygulamasını açın ve ekrandaki kodu seçin YA DA bağlantıyı kesin",OPEN_META_MASK_CONTINUE:"Oturumunuzla devam etmek için MetaMask uygulamasını açın.",NUMBER_AFTER_OPEN_NOTICE:"MetaMask'ı açtıktan sonra bir numara görünmezse, lütfen bağlantıyı kesin ve QR Kodunu tekrar tarayın.",DISCONNECT:"Bağlantıyı Kes"},SELECT_MODAL:{CRYPTO_TAKE_CONTROL_TEXT:"Kriptonuzu kontrol edin ve dünya genelinde 30 milyondan fazla kişi tarafından güvenilen cüzdanla blockchain'i keşfedin"},META_MASK_MODAL:{ADDRESS_COPIED:"Adres panoya kopyalandı!",DISCONNECT:"Bağlantıyı Kes",ACTIVE_NETWORK:"Aktif Ağ"}};function Fd(e){let t;if("undefined"!=typeof Buffer)t=Buffer.from(e,"utf8").toString("base64");else if("function"==typeof btoa)t=btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/gu,((e,t)=>String.fromCharCode(parseInt(t,16)))));else{if("object"!=typeof global||!("Buffer"in global))throw new Error("Unable to base64 encode: No available method.");t=global.Buffer.from(e,"utf8").toString("base64")}return t}class zd{constructor({shouldSetOnWindow:e,connectionStream:t,shouldSendMetadata:n=!1,shouldShimWeb3:r,sdkInstance:i}){const o=new pl({connectionStream:t,shouldSendMetadata:n,shouldSetOnWindow:e,shouldShimWeb3:r,autoRequestAccounts:!1}),s=new Proxy(o,{deleteProperty:()=>!0});if(this.provider=s,this.sdkInstance=i,e&&"undefined"!=typeof window)try{a=o,window.ethereum=a,window.dispatchEvent(new Event("ethereum#initialized"))}catch(e){Hc("[Ethereum] Unable to set global provider - window.ethereum may be read-only",e)}var a;if(r&&"undefined"!=typeof window)try{!function(e,t=console){let n=!1,r=!1;if(!window.web3){const i="__isMetaMaskShim__";let o={currentProvider:e};Object.defineProperty(o,i,{value:!0,enumerable:!0,configurable:!1,writable:!1}),o=new Proxy(o,{get:(o,s,...a)=>("currentProvider"!==s||n?"currentProvider"===s||s===i||r||(r=!0,t.error("MetaMask no longer injects web3. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3"),e.request({method:"metamask_logWeb3ShimUsage"}).catch((e=>{t.debug("MetaMask: Failed to log web3 shim usage.",e)}))):(n=!0,t.warn("You are accessing the MetaMask window.web3.currentProvider shim. This property is deprecated; use window.ethereum instead. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3")),Reflect.get(o,s,...a)),set:(...e)=>(t.warn("You are accessing the MetaMask window.web3 shim. This object is deprecated; use window.ethereum instead. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3"),Reflect.set(...e))}),Object.defineProperty(window,"web3",{value:o,enumerable:!1,configurable:!0,writable:!0})}}(this.provider)}catch(e){Hc("[Ethereum] Unable to shim web3 - window.web3 may be read-only",e)}this.provider.on("display_uri",(e=>{this.sdkInstance.emit(ld.DisplayURI,e)})),this.provider.on("_initialized",(()=>{const e={chainId:this.provider.getChainId(),isConnected:this.provider.isConnected(),isMetaMask:this.provider.isMetaMask,selectedAddress:this.provider.getSelectedAddress(),networkVersion:this.provider.getNetworkVersion()};this.sdkInstance.emit(ld.Initialized,e),Hc("[Ethereum: constructor()] provider initialized",e)}))}static init(e){var t;return Hc("[Ethereum: init()] Initializing Ethereum service"),this.instance=new zd(e),null===(t=this.instance)||void 0===t?void 0:t.provider}static destroy(){}static getInstance(){var e;if(!(null===(e=this.instance)||void 0===e?void 0:e.provider))throw new Error("Ethereum instance not intiialized - call Ethereum.factory first.");return this.instance}static getProvider(){var e;if(!(null===(e=this.instance)||void 0===e?void 0:e.provider))throw new Error("Ethereum instance not intiialized - call Ethereum.factory first.");return this.instance.provider}}function qd(t,n,i,o){var s,a,c,l,d,u,h,f,p,g,m,y,v,b,E,w,S,_,C,k;return e(this,void 0,void 0,(function*(){const e=null===(s=t.state.remote)||void 0===s?void 0:s.isReady(),i=null===(a=t.state.remote)||void 0===a?void 0:a.isConnected(),A=null===(c=t.state.remote)||void 0===c?void 0:c.isPaused(),M=zd.getProvider(),x=null===(l=t.state.remote)||void 0===l?void 0:l.getChannelId(),O=null===(d=t.state.remote)||void 0===d?void 0:d.isAuthorized(),{deeplinkProtocol:I}=t.state,{method:R,data:T,triggeredInstaller:P}=(e=>{var t,n,i,o;let s;r.isBuffer(e)?(s=e.toJSON(),s._isBuffer=!0):s=e;const a=null===(t=null==s?void 0:s.data)||void 0===t?void 0:t.method;let c=!1;return"object"==typeof(null===(n=null==s?void 0:s.data)||void 0===n?void 0:n.params)&&!0===(null===(o=null===(i=null==s?void 0:s.data)||void 0===i?void 0:i.params)||void 0===o?void 0:o.__triggeredInstaller)&&(c=!0,s.data.params=s.data.params.wrappedParams),{method:a,data:s,triggeredInstaller:c}})(n);if(Hc(`[RCPMS: write()] method='${R}' isRemoteReady=${e} channelId=${x} isSocketConnected=${i} isRemotePaused=${A} providerConnected=${M.isConnected()}`,n),!x)return R!==rl.METAMASK_GETPROVIDERSTATE&&Hc(`[RCPMS: write()] ${R} --\x3e channelId is undefined`),o(new Error("disconnected"));Hc(`[RCPMS: write()] remote.isPaused()=${null===(u=t.state.remote)||void 0===u?void 0:u.isPaused()} authorized=${O} ready=${e} socketConnected=${i}`,n);const N=null===(h=t.state.platformManager)||void 0===h?void 0:h.isSecure(),L=null!==(p=null===(f=t.state.platformManager)||void 0===f?void 0:f.isMobileWeb())&&void 0!==p&&p,D=null!==(m=null===(g=t.state.remote)||void 0===g?void 0:g.hasDeeplinkProtocol())&&void 0!==m&&m&&L&&O;try{if(D&&!P||null===(y=t.state.remote)||void 0===y||y.sendMessage(null==T?void 0:T.data).then((()=>{Hc(`[RCPMS: _write()] ${R} sent successfully`)})).catch((e=>{Hc("[RCPMS: _write()] error sending message",e)})),!N)return Hc(`[RCPMS: _write()] unsecure platform for method ${R} -- return callback`),o();if(P)return Hc("[RCPMS: _write()] prevent deeplink -- installation completed separately."),o();const e=null!==(E=null===(b=null===(v=t.state.remote)||void 0===v?void 0:v.getKeyInfo())||void 0===b?void 0:b.ecies.public)&&void 0!==E?E:"";let n=encodeURI(`channelId=${x}&pubkey=${e}&comm=socket&t=d&v=2`);if(D){const e=JSON.stringify(null==T?void 0:T.data),r=null===(w=t.state.remote)||void 0===w?void 0:w.encrypt(e);if(!r)return Hc("[RCPMS: _write()] error encrypting message"),o(new Error("RemoteCommunicationPostMessageStream - disconnected"));n+=`&scheme=${I}&rpc=${Fd(r)}`}if(!(null===(S=t.state.platformManager)||void 0===S?void 0:S.isMetaMaskInstalled()))return Hc("[RCPMS: _write()] prevent deeplink until installation is completed."),o();il[R]?(Hc(`[RCPMS: _write()] redirect link for '${R}' socketConnected=${i} connect?${n}`),null===(_=t.state.platformManager)||void 0===_||_.openDeeplink(`${od}?${n}`,`${sd}?${n}`,"_self")):(null===(C=t.state.remote)||void 0===C?void 0:C.isPaused())?(Hc(`[RCPMS: _write()] MM is PAUSED! deeplink with connect! targetMethod=${R}`),null===(k=t.state.platformManager)||void 0===k||k.openDeeplink(`${od}?redirect=true&${n}`,`${sd}?redirect=true&${n}`,"_self")):Hc(`[RCPMS: _write()] method ${R} doesn't need redirect.`)}catch(e){return Hc("[RCPMS: _write()] error sending message",e),o(new Error("RemoteCommunicationPostMessageStream - disconnected"))}return o()}))}class Wd extends vc.Duplex{constructor({name:e,remote:t,deeplinkProtocol:n,platformManager:r}){super({objectMode:!0}),this.state={_name:null,remote:null,deeplinkProtocol:!1,platformManager:null},this.state._name=e,this.state.remote=t,this.state.deeplinkProtocol=n,this.state.platformManager=r,this._onMessage=this._onMessage.bind(this),this.state.remote.on(_i.MESSAGE,this._onMessage)}_write(t,n,r){return e(this,void 0,void 0,(function*(){return qd(this,t,0,r)}))}_read(){}_onMessage(e){return function(e,t){try{if(Hc("[RCPMS: onMessage()] message",t),!t||"object"!=typeof t)return;if("object"!=typeof(null==t?void 0:t.data))return;if(!(null==t?void 0:t.name))return void Hc("[RCPMS: onMessage()] ignore message without name",t);if((null==t?void 0:t.name)!==nd.PROVIDER)return void Hc(`[RCPMS: onMessage()] ignore message with wrong name message=${t}`);if(r.isBuffer(t)){const n=r.from(t);e.push(n)}else e.push(t)}catch(e){Hc(`[RCPMS: onMessage()] ignore message error err=${e}`)}}(this,e)}start(){}}var Vd={exports:{}};Vd.exports=f.fetch,Vd.exports.default=f.fetch,Vd.exports.fetch=f.fetch,Vd.exports.Headers=f.Headers,Vd.exports.Request=f.Request,Vd.exports.Response=f.Response;var Gd=p(Vd.exports);let Yd=1;const Jd=e=>new Promise((t=>{setTimeout((()=>{t(!0)}),e)})),Zd=({checkInstallationOnAllCalls:t=!1,communicationLayerPreference:n,injectProvider:r,shouldShimWeb3:i,platformManager:o,installer:s,sdk:a,remoteConnection:c,debug:l})=>e(void 0,void 0,void 0,(function*(){var d,u;const h=(({name:e,remoteConnection:t})=>{if(!t||!(null==t?void 0:t.getConnector()))throw new Error("Missing remote connection parameter");return new Wd({name:e,remote:null==t?void 0:t.getConnector(),deeplinkProtocol:null==t?void 0:t.state.deeplinkProtocol,platformManager:null==t?void 0:t.getPlatformManager()})})({name:nd.INPAGE,target:nd.CONTENT_SCRIPT,platformManager:o,communicationLayerPreference:n,remoteConnection:c}),f=o.getPlatformType(),p=a.options.dappMetadata,g=`Sdk/Javascript SdkVersion/${rd.version} Platform/${f} dApp/${null!==(d=p.url)&&void 0!==d?d:p.name} dAppTitle/${p.name}`;let m=null,y=null;const v=null===(u=a.options.storage)||void 0===u?void 0:u.storageManager;if(v){try{const e=yield v.getCachedAccounts();e.length>0&&(m=e[0])}catch(e){console.error(`[initializeMobileProvider] failed to get cached addresses: ${e}`)}try{const e=yield v.getCachedChainId();e&&(y=e)}catch(e){console.error(`[initializeMobileProvider] failed to parse cached chainId: ${e}`)}}Hc(`[initializeMobileProvider] cachedAccountAddress: ${m}, cachedChainId: ${y}`);const b=!(!r||f===Hi.NonBrowser||f===Hi.ReactNative),E=zd.init({shouldSetOnWindow:b,connectionStream:h,shouldShimWeb3:i,sdkInstance:a});let w=!1;const S=e=>{w=e},_=()=>w,C=(n,r,i,l)=>e(void 0,void 0,void 0,(function*(){var d,u,h,f,p,b,E,C,k;const A=zd.getProvider();if(w){A.emit("display_uri",(null==c?void 0:c.state.qrcodeLink)||""),null==c||c.showActiveModal();let e=_();for(;e;){const t=_(),n=null==c?void 0:c.isAuthorized();e=t&&!n,Hc(`[initializeMobileProvider: sendRequest()] waiting for initialization to complete - initializing: ${t} authorized: ${n}`),yield Jd(1e3)}return Hc("[initializeMobileProvider: sendRequest()] initial method completed -- prevent installation and call provider"),i(...r)}const M=o.isMetaMaskInstalled(),x=null==c?void 0:c.isConnected();let O=null,I=null,R=null;if(O=null!==(d=A.getSelectedAddress())&&void 0!==d?d:m,R=A.getChainId()||y,O&&v&&O!==m&&v.persistAccounts([O]).catch((e=>{console.error(`[initializeMobileProvider] failed to persist account: ${e}`)})),R&&(y=R,v&&v.persistChainId(R).catch((e=>{console.error(`[initializeMobileProvider] failed to persist chainId: ${e}`)}))),Hc("[initializeMobileProvider: sendRequest()]",{selectedAddress:O,chainId:R}),l&&Hc(`[initializeMobileProvider: sendRequest()] method=${n} ongoing=${w} selectedAddress=${O} isInstalled=${M} checkInstallationOnAllCalls=${t} socketConnected=${x}`),O&&n.toLowerCase()===rl.ETH_ACCOUNTS.toLowerCase())return[O];if(R&&n.toLowerCase()===rl.ETH_CHAINID.toLowerCase())return R;const T=[rl.ETH_REQUESTACCOUNTS,rl.WALLET_REQUESTPERMISSIONS,rl.METAMASK_CONNECTSIGN,rl.METAMASK_CONNECTWITH],P=!il[n],N=null===(u=a.options.readonlyRPCMap)||void 0===u?void 0:u[R];if(N&&P)try{const t=null===(h=null==r?void 0:r[0])||void 0===h?void 0:h.params,i=yield(({rpcEndpoint:t,method:n,sdkInfo:r,params:i})=>e(void 0,void 0,void 0,(function*(){const e=JSON.stringify({jsonrpc:"2.0",method:n,params:i,id:(Yd+=1,Yd)}),o={Accept:"application/json","Content-Type":"application/json"};let s;t.includes("infura")&&(o["Metamask-Sdk-Info"]=r);try{s=yield Gd(t,{method:"POST",headers:o,body:e})}catch(e){throw e instanceof Error?new Error(`Failed to fetch from RPC: ${e.message}`):new Error(`Failed to fetch from RPC: ${e}`)}if(!s.ok)throw new Error(`Server responded with a status of ${s.status}`);return(yield s.json()).result})))({rpcEndpoint:N,sdkInfo:g,method:n,params:t||[]});return l&&Hc(`initializeProvider::ReadOnlyRPCResponse ${i}`),i}catch(e){console.warn(`[initializeMobileProvider: sendRequest()] method=${n} readOnlyRPCRequest failed:`,e)}if((!M||M&&!x)&&n!==rl.METAMASK_GETPROVIDERSTATE){const l=(null===(f=null==r?void 0:r[0])||void 0===f?void 0:f.params)||[];if(-1!==T.indexOf(n)||t){S(!0);const t=n===rl.METAMASK_CONNECTWITH,o=`${Date.now()}`;try{yield s.start({wait:!1,connectWith:t?{method:n,id:o,params:l}:void 0}),yield new Promise(((e,t)=>{(null==c?void 0:c.isAuthorized())&&(Hc("[initializeMobileProvider: sendRequest()] already authorized"),e(!0)),null==c||c.getConnector().once(_i.AUTHORIZED,(()=>{e(!0)})),a.once(_i.PROVIDER_UPDATE,(e=>{Hc(`[initializeMobileProvider: sendRequest()] PROVIDER_UPDATE --- remote provider request interupted type=${e}`),e===dd.EXTENSION?t(_i.PROVIDER_UPDATE):t(new Error("Connection Terminated"))}))}))}catch(t){if(dd.EXTENSION===t){if(Hc(`[initializeMobileProvider: sendRequest()] extension provider detect: re-create ${n} on the active provider`),n.toLowerCase()===rl.METAMASK_CONNECTSIGN.toLowerCase()){const e=yield null===(p=a.getProvider())||void 0===p?void 0:p.request({method:rl.ETH_REQUESTACCOUNTS,params:[]});if(!e.length)throw new Error("SDK state invalid -- undefined accounts");const t=yield null===(b=a.getProvider())||void 0===b?void 0:b.request({method:rl.PERSONAL_SIGN,params:[l[0],e[0]]});return a.emit(ld.ConnectWithResponse,t),t}if(n.toLowerCase()===rl.METAMASK_CONNECTWITH.toLowerCase()){const[t]=l,n=yield(({method:t,sdk:n,params:r})=>e(void 0,void 0,void 0,(function*(){var e,i,o,s;if(!n.isExtensionActive())throw new Error("SDK state invalid -- extension is not active");Hc("[MetaMaskProvider: extensionConnectWithOverwrite()] Overwriting request method",t,r);const a=yield null===(e=n.getProvider())||void 0===e?void 0:e.request({method:rl.ETH_REQUESTACCOUNTS,params:[]});if(!a.length)throw new Error("SDK state invalid -- undefined accounts");if((null==t?void 0:t.toLowerCase())===rl.PERSONAL_SIGN.toLowerCase()){const e={method:t,params:[r[0],a[0]]};return yield null===(i=n.getProvider())||void 0===i?void 0:i.request(e)}if((null==t?void 0:t.toLowerCase())===rl.ETH_SENDTRANSACTION.toLowerCase()){const e={method:t,params:[Object.assign(Object.assign({},r[0]),{from:a[0]})]};return yield null===(o=n.getProvider())||void 0===o?void 0:o.request(e)}return sl.includes(t.toLowerCase())?(console.warn(`MetaMaskSDK connectWith method=${t} -- not handled by the extension -- call separately`),a):yield null===(s=n.getProvider())||void 0===s?void 0:s.request({method:t,params:r})})))({method:t.method,sdk:a,params:t.params});return a.emit(ld.ConnectWithResponse,n),n}return Hc(`[initializeMobileProvider: sendRequest()] sending '${n}' on active provider`,l),yield null===(E=a.getProvider())||void 0===E?void 0:E.request({method:n,params:l})}if(t===_i.REJECTED)throw null==c||c.closeModal(),null===(C=a.getProvider())||void 0===C||C.handleDisconnect({terminate:!1}),Object.assign(new Error("User rejected connection"),{code:4001});throw Hc(`[initializeMobileProvider: sendRequest()] failed to start installer: ${t}`),t}finally{S(!1)}if(n===rl.ETH_REQUESTACCOUNTS)return I=yield new Promise((e=>{const t=setInterval((()=>{const{accounts:n}=A.getState();n&&(clearInterval(t),e(n))}),100)})),Hc(`[initializeMobileProvider: sendRequest()] selectedAddress: ${O} --- SKIP rpc call`),I;if(n===rl.METAMASK_CONNECTWITH)try{let e=0;const t=5,n=({resolve:n,reject:r})=>{e+=1;const i=null==c?void 0:c.getConnector().getRPCMethodTracker(),s=null==i?void 0:i[o];return Hc(`TRACKER: update method ${o}`,s),(null==s?void 0:s.result)?(Hc("[initializeMobileProvider: sendRequest()] found result",s.result),a.emit(ld.ConnectWithResponse,s.result),void n(s.result)):(null==s?void 0:s.error)?(Hc("[initializeMobileProvider: sendRequest()] found error",s.error),void r(s.error)):e>=t?(Hc("[initializeMobileProvider: sendRequest()] max message count reached without result"),void r(new Error("Max message count reached without result"))):void Hc("[initializeMobileProvider: sendRequest()] not found yet, need to wait for next update")};let r,i;const s=yield new Promise(((e,t)=>{const s=null==c?void 0:c.getConnector().getRPCMethodTracker();Hc(`TRACKER: method ${o}`,s),(null==s?void 0:s[o].result)?(Hc("[initializeMobileProvider: sendRequest()] found result",null==s?void 0:s[o].result),e(null==s?void 0:s[o].result)):(null==s?void 0:s[o].error)&&(Hc("[initializeMobileProvider: sendRequest()] found error",null==s?void 0:s[o].error),t(null==s?void 0:s[o].error)),i=()=>n({resolve:e,reject:t}),r=null==c?void 0:c.getConnector().on(_i.RPC_UPDATE,i)}));return i&&(null==r||r.off(_i.RPC_UPDATE,i)),Hc("TRACKER: result",s),s}catch(e){throw Hc("[initializeMobileProvider: sendRequest()] error:",e),e}r[0]&&"object"==typeof r[0]&&(r[0].params={__triggeredInstaller:!0,wrappedParams:r[0].params});return i(...r)}if(o.isSecure()&&il[n])return i(...r);if(a.isExtensionActive())return Hc(`[initializeMobileProvider: sendRequest()] EXTENSION active - redirect request '${n}' to it`,r,l),yield null===(k=a.getProvider())||void 0===k?void 0:k.request({method:n,params:l});throw Hc(`[initializeMobileProvider: sendRequest()] method=${n} --- skip --- not connected/installed`),new Error("MetaMask is not connected/installed, please call eth_requestAccounts to connect first.")}try{const e=yield i(...r);if(Hc(`[initializeMobileProvider: sendRequest()] method=${n} rpcResponse`,e),n===rl.WALLET_REQUESTPERMISSIONS){const t=e.reduce(((e,t)=>{var n;if("eth_accounts"===t.parentCapability){const r=null===(n=t.caveats.find((e=>"restrictReturnedAccounts"===e.type)))||void 0===n?void 0:n.value;r&&e.push(...r)}return e}),[]);Hc("[initializeMobileProvider: sendRequest()] accountsToPersist:",t),t.length>0&&(A.handleAccountsChanged(t,!1),null==v||v.persistAccounts(t))}return e}catch(e){throw console.error("[initializeMobileProvider: sendRequest()] error:",e),e}})),{request:k}=E;E.request=(...t)=>e(void 0,void 0,void 0,(function*(){return C(null==t?void 0:t[0].method,t,k,l)}));const{send:A}=E;return E.send=(...t)=>e(void 0,void 0,void 0,(function*(){return C(null==t?void 0:t[0],t,A,l)})),Hc("[initializeMobileProvider: sendRequest()] metamaskStream.start()"),h.start(),E}));function Xd(t){var n,r,i,o;return e(this,void 0,void 0,(function*(){const{options:e}=t,s={communicationLayerPreference:null!==(n=e.communicationLayerPreference)&&void 0!==n?n:Ui.SOCKET,platformManager:t.platformManager,sdk:t,checkInstallationOnAllCalls:e.checkInstallationOnAllCalls,injectProvider:null===(r=e.injectProvider)||void 0===r||r,shouldShimWeb3:null===(i=e.shouldShimWeb3)||void 0===i||i,extensionOnly:null===(o=e.extensionOnly)||void 0===o||o,installer:t.installer,remoteConnection:t.remoteConnection,debug:t.debug},a=yield Zd(s);t.activeProvider=a,function(e){var t,n,r,i;null===(n=null===(t=e.remoteConnection)||void 0===t?void 0:t.getConnector())||void 0===n||n.on(ld.ConnectionStatus,(t=>{e.emit(ld.ConnectionStatus,t)})),null===(i=null===(r=e.remoteConnection)||void 0===r?void 0:r.getConnector())||void 0===i||i.on(ld.ServiceStatus,(t=>{e.emit(ld.ServiceStatus,t)}))}(t)}))}const Qd="sdk";class eu{constructor({serverUrl:e,enabled:t,originatorInfo:n}){this.serverURL=mi,this.serverURL=e,this.originatorInfo=n,this.enabled=null==t||t}send({event:e,params:t}){if(!this.enabled)return;const n=Object.assign(Object.assign({id:Qd,event:e,sdkVersion:rd.version},this.originatorInfo),{params:t});Hc(`[Analytics: send()] event: ${e}`,n),fi(n,this.serverURL).catch((e=>{Hc(`[Analytics: send()] error: ${e}`)}))}}const tu=()=>{if("undefined"==typeof document)return;let e;const t=document.getElementsByTagName("link");for(let n=0;n<t.length;n++)"icon"!==t[n].getAttribute("rel")&&"shortcut icon"!==t[n].getAttribute("rel")||(e=t[n].getAttribute("href"));return e},nu=163400;function ru(e){var t,n,r;const{dappMetadata:i}=e,o=function({url:e,name:t}){var n;const r=e+t,i=Fd(r);if(!localStorage)return"";let o=null!==(n=localStorage.getItem(i))&&void 0!==n?n:"";if(!o){o=c();try{localStorage.setItem(i,o)}catch(e){return""}}return o}({url:null!==(t=null==i?void 0:i.url)&&void 0!==t?t:"no_url",name:null!==(n=null==i?void 0:i.name)&&void 0!==n?n:"no_name"}),s=null===(r=e.platformManager)||void 0===r?void 0:r.getPlatformType(),a=s===Hi.DesktopWeb,l=s===Hi.MetaMaskMobileWebview;let d="N/A";return a?d="extension":l&&(d="mobile"),{id:o,from:d}}const iu=({provider:t,sdkInstance:n})=>{if("state"in t)throw new Error("INVALID EXTENSION PROVIDER");return new Proxy(t,{get:(r,i)=>"request"===i?function(t){var i,o;return e(this,void 0,void 0,(function*(){Hc("[wrapExtensionProvider()] Overwriting request method",t);const{method:s,params:a}=t,c=ol.includes(s.toLowerCase()),{id:l,from:d}=ru(n);if(c&&(null===(i=n.analytics)||void 0===i||i.send({event:Mi.SDK_RPC_REQUEST,params:{method:s,from:d,id:l}})),s===rl.METAMASK_BATCH&&Array.isArray(a))return(({target:t,args:n,trackEvent:r,sdkInstance:i})=>e(void 0,void 0,void 0,(function*(){var e,o;if("metamask_batch"!==n.method)throw new Error("Invalid usage");const s=[],a=null!==(e=null==n?void 0:n.params)&&void 0!==e?e:[];for(const e of a){const n=yield null==t?void 0:t.request({method:e.method,params:e.params});s.push(n)}const{id:c,from:l}=ru(i);return r&&(null===(o=i.analytics)||void 0===o||o.send({event:Mi.SDK_RPC_REQUEST_DONE,params:{method:n.method,from:l,id:c}})),s})))({target:r,args:t,trackEvent:c,sdkInstance:n});if(s.toLowerCase()===rl.METAMASK_CONNECTSIGN.toLowerCase()&&Array.isArray(a))return(({target:t,params:n})=>e(void 0,void 0,void 0,(function*(){const e=yield t.request({method:rl.ETH_REQUESTACCOUNTS,params:[]});if(!e.length)throw new Error("SDK state invalid -- undefined accounts");return yield t.request({method:rl.PERSONAL_SIGN,params:[n[0],e[0]]})})))({target:r,params:a});if(s.toLowerCase()===rl.METAMASK_CONNECTWITH.toLowerCase()&&Array.isArray(a))return(({target:t,params:n})=>e(void 0,void 0,void 0,(function*(){const[e]=n,r=e.method,i=e.params,o=yield t.request({method:rl.ETH_REQUESTACCOUNTS,params:[]});if(!o.length)throw new Error("SDK state invalid -- undefined accounts");return(null==r?void 0:r.toLowerCase())===rl.PERSONAL_SIGN.toLowerCase()?yield t.request({method:r,params:[i[0],o[0]]}):(null==r?void 0:r.toLowerCase())===rl.ETH_SENDTRANSACTION.toLowerCase()?yield t.request({method:r,params:[Object.assign(Object.assign({},i[0]),{from:o[0]})]}):sl.includes(r.toLowerCase())?(console.warn(`MetaMaskSDK connectWith method=${r} -- not handled by the extension -- call separately`),o):yield t.request({method:r,params:i})})))({target:r,params:a});let u;try{return u=yield r.request(t),u}finally{c&&(null===(o=n.analytics)||void 0===o||o.send({event:Mi.SDK_RPC_REQUEST_DONE,params:{method:s,from:d,id:l}}))}}))}:"getChainId"===i?function(){return t.chainId}:"getNetworkVersion"===i?function(){return t.networkVersion}:"getSelectedAddress"===i?function(){return t.selectedAddress}:"isConnected"===i?function(){return t._state.isConnected}:r[i]})};var ou;function su({mustBeMetaMask:t,sdkInstance:n}){return e(this,void 0,void 0,(function*(){if("undefined"==typeof window)throw new Error("window not available");try{const e=yield new Promise(((e,t)=>{const n=setTimeout((()=>{t(new Error("eip6963RequestProvider timed out"))}),500);window.addEventListener(ou.Announce,(t=>{const r=t,{detail:{info:i,provider:o}={}}=r,{name:s,rdns:a,uuid:c}=null!=i?i:{};cd.test(c)&&s.startsWith(ad.NAME)&&a===ad.RDNS&&(clearTimeout(n),e(o))})),window.dispatchEvent(new Event(ou.Request))}));return iu({provider:e,sdkInstance:n})}catch(e){if(!t&&window.ethereum)return iu({provider:window.ethereum,sdkInstance:n});throw new Error("Provider not found")}}))}!function(e){e.Announce="eip6963:announceProvider",e.Request="eip6963:requestProvider"}(ou||(ou={}));const au=t=>e(void 0,void 0,void 0,(function*(){const{options:e}=t,{infuraAPIKey:n}=e;if(!n)return;const r={"0x1":`https://mainnet.infura.io/v3/${n}`,"0x5":`https://goerli.infura.io/v3/${n}`,"0xaa36a7":`https://sepolia.infura.io/v3/${n}`,"0xe708":`https://linea-mainnet.infura.io/v3/${n}`,"0xe704":`https://linea-goerli.infura.io/v3/${n}`,"0x89":`https://polygon-mainnet.infura.io/v3/${n}`,"0x13881":`https://polygon-mumbai.infura.io/v3/${n}`,"0x45":`https://optimism-mainnet.infura.io/v3/${n}`,"0x1a4":`https://optimism-goerli.infura.io/v3/${n}`,"0xa4b1":`https://arbitrum-mainnet.infura.io/v3/${n}`,"0x66eed":`https://arbitrum-goerli.infura.io/v3/${n}`,"0x2a15c308d":`https://palm-mainnet.infura.io/v3/${n}`,"0x2a15c3083":`https://palm-testnet.infura.io/v3/${n}`,"0xa86a":`https://avalanche-mainnet.infura.io/v3/${n}`,"0xa869":`https://avalanche-fuji.infura.io/v3/${n}`,"0x4e454152":`https://aurora-mainnet.infura.io/v3/${n}`,"0x4e454153":`https://aurora-testnet.infura.io/v3/${n}`,"0x534e5f4d41494e":`https://starknet-mainnet.infura.io/v3/${n}`,"0x534e5f474f45524c49":`https://starknet-goerli.infura.io/v3/${n}`,"0x534e5f474f45524c4932":`https://starknet-goerli2.infura.io/v3/${n}`,"0xa4ec":`https://celo-mainnet.infura.io/v3/${n}`,"0xaef3":`https://celo-alfajores.infura.io/v3/${n}`};t.options.readonlyRPCMap?t.options.readonlyRPCMap=Object.assign(Object.assign({},t.options.readonlyRPCMap),r):t.options.readonlyRPCMap=r}));var cu={exports:{}};cu.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}({17:function(e,t,n){t.__esModule=!0,t.default=void 0;var r=n(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var n=t.match(e);return n&&n.length>0&&n[1]||""},e.getSecondMatch=function(e,t){var n=t.match(e);return n&&n.length>1&&n[2]||""},e.matchAndReturnConst=function(e,t,n){if(e.test(t))return n},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,n,r){void 0===r&&(r=!1);var i=e.getVersionPrecision(t),o=e.getVersionPrecision(n),s=Math.max(i,o),a=0,c=e.map([t,n],(function(t){var n=s-e.getVersionPrecision(t),r=t+new Array(n+1).join(".0");return e.map(r.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(r&&(a=s-Math.min(i,o)),s-=1;s>=a;){if(c[0][s]>c[1][s])return 1;if(c[0][s]===c[1][s]){if(s===a)return 0;s-=1}else if(c[0][s]<c[1][s])return-1}},e.map=function(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)r.push(t(e[n]));return r},e.find=function(e,t){var n,r;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(n=0,r=e.length;n<r;n+=1){var i=e[n];if(t(i,n))return i}},e.assign=function(e){for(var t,n,r=e,i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(o));var a=function(){var e=o[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){r[t]=e[t]}))};for(t=0,n=o.length;t<n;t+=1)a();return e},e.getBrowserAlias=function(e){return r.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return r.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,n){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(91))&&r.__esModule?r:{default:r},o=n(18);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){}var t,n,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(n=null)&&s(t.prototype,n),r&&s(t,r),e}();t.default=a,e.exports=t.default},91:function(e,t,n){t.__esModule=!0,t.default=void 0;var r=c(n(92)),i=c(n(93)),o=c(n(94)),s=c(n(95)),a=c(n(17));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(r.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,n={},r=0,i={},o=0;if(Object.keys(e).forEach((function(t){var s=e[t];"string"==typeof s?(i[t]=s,o+=1):"object"==typeof s&&(n[t]=s,r+=1)})),r>0){var s=Object.keys(n),c=a.default.find(s,(function(e){return t.isOS(e)}));if(c){var l=this.satisfies(n[c]);if(void 0!==l)return l}var d=a.default.find(s,(function(e){return t.isPlatform(e)}));if(d){var u=this.satisfies(n[d]);if(void 0!==u)return u}}if(o>0){var h=Object.keys(i),f=a.default.find(h,(function(e){return t.isBrowser(e,!0)}));if(void 0!==f)return this.compareVersion(i[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var n=this.getBrowserName().toLowerCase(),r=e.toLowerCase(),i=a.default.getBrowserTypeByAlias(r);return t&&i&&(r=i.toLowerCase()),r===n},t.compareVersion=function(e){var t=[0],n=e,r=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(n=e.substr(1),"="===e[1]?(r=!0,n=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?n=e.substr(1):"~"===e[0]&&(r=!0,n=e.substr(1)),t.indexOf(a.default.compareVersions(i,n,r))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=l,e.exports=t.default},92:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},n=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},n=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},n=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},n=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},n=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},n=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},n=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},n=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},n=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},n=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},n=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},n=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},n=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},n=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},n=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return n&&(t.version=n),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},n=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},n=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},n=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},n=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},n=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},n=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},n=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},n=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},n=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},n=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},n=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},n=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t={name:"Android Browser"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=s,e.exports=t.default},93:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:o.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),n=i.default.getWindowsVersionName(t);return{name:o.OS_MAP.Windows,version:t,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:o.OS_MAP.iOS},n=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return n&&(t.version=n),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),n=i.default.getMacOSVersionName(t),r={name:o.OS_MAP.MacOS,version:t};return n&&(r.versionName=n),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),n=i.default.getAndroidVersionName(t),r={name:o.OS_MAP.Android,version:t};return n&&(r.versionName=n),r}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),n={name:o.OS_MAP.WebOS};return t&&t.length&&(n.version=t),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:o.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.PlayStation4,version:t}}}];t.default=s,e.exports=t.default},94:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",n={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(n.model=t),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),n=e.test(/like (ipod|iphone)/i);return t&&!n},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];t.default=s,e.exports=t.default},95:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:o.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:o.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:o.ENGINE_MAP.Trident},n=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:o.ENGINE_MAP.Presto},n=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=e.test(/gecko/i),n=e.test(/like gecko/i);return t&&!n},describe:function(e){var t={name:o.ENGINE_MAP.Gecko},n=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:o.ENGINE_MAP.WebKit},n=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}}];t.default=s,e.exports=t.default}});var lu=cu.exports,du=p(lu);class uu{constructor({useDeepLink:e,preferredOpenLink:t,debug:n=!1}){this.state={platformType:void 0,useDeeplink:!1,preferredOpenLink:void 0,debug:!1},this.state.platformType=this.getPlatformType(),this.state.useDeeplink=e,this.state.preferredOpenLink=t,this.state.debug=n}openDeeplink(e,t,n){return function(e,t,n,r){const{state:i}=e;Hc(`[PlatfformManager: openDeeplink()] universalLink --\x3e ${t}`),Hc(`[PlatfformManager: openDeeplink()] deepLink --\x3e ${n}`);try{if(i.preferredOpenLink)return void i.preferredOpenLink(i.useDeeplink?n:t,r);if(Hc(`[PlatfformManager: openDeeplink()] open link now useDeepLink=${i.useDeeplink} link=${i.useDeeplink?n:t}`),i.useDeeplink)"undefined"!=typeof window&&(window.location.href=n);else if("undefined"!=typeof document){const e=document.createElement("a");e.href=t,e.target="_self",e.rel="noreferrer noopener",e.click()}}catch(e){console.log("[PlatfformManager: openDeeplink()] can't open link",e)}}(this,e,t,n)}isReactNative(){var e;return this.isNotBrowser()&&"undefined"!=typeof window&&(null===window||void 0===window?void 0:window.navigator)&&"ReactNative"===(null===(e=window.navigator)||void 0===e?void 0:e.product)}isMetaMaskInstalled(){return function(){const e=zd.getProvider()||(null===window||void 0===window?void 0:window.ethereum);return Hc(`[PlatfformManager: isMetaMaskInstalled()] isMetaMask=${null==e?void 0:e.isMetaMask} isConnected=${null==e?void 0:e.isConnected()}`),(null==e?void 0:e.isMetaMask)&&(null==e?void 0:e.isConnected())}()}isDesktopWeb(){return this.isBrowser()&&!this.isMobileWeb()}isMobile(){var e,t;const n=du.parse(window.navigator.userAgent);return"mobile"===(null===(e=null==n?void 0:n.platform)||void 0===e?void 0:e.type)||"tablet"===(null===(t=null==n?void 0:n.platform)||void 0===t?void 0:t.type)}isSecure(){return this.isReactNative()||this.isMobileWeb()}isMetaMaskMobileWebView(){return"undefined"!=typeof window&&(Boolean(window.ReactNativeWebView)&&Boolean(navigator.userAgent.endsWith("MetaMaskMobile")))}isMobileWeb(){return this.state.platformType===Hi.MobileWeb}isNotBrowser(){var e;return"undefined"==typeof window||!(null===window||void 0===window?void 0:window.navigator)||"undefined"!=typeof global&&"ReactNative"===(null===(e=null===global||void 0===global?void 0:global.navigator)||void 0===e?void 0:e.product)||"ReactNative"===(null===navigator||void 0===navigator?void 0:navigator.product)}isNodeJS(){return this.isNotBrowser()&&!this.isReactNative()}isBrowser(){return!this.isNotBrowser()}isUseDeepLink(){return this.state.useDeeplink}getPlatformType(){return function(e){const{state:t}=e;return t.platformType?t.platformType:e.isReactNative()?Hi.ReactNative:e.isNotBrowser()?Hi.NonBrowser:e.isMetaMaskMobileWebView()?Hi.MetaMaskMobileWebview:e.isMobile()?Hi.MobileWeb:Hi.DesktopWeb}(this)}}const hu=t=>e(void 0,void 0,void 0,(function*(){const{options:e}=t,{readonlyRPCMap:n}=e;if(n)try{Hc("[MetaMaskSDK: setupReadOnlyRPCProviders()] Setting up Readonly RPC Providers",n),t.setReadOnlyRPCCalls(!0)}catch(e){throw new Error("Invalid Infura Settings")}}));var fu,pu=(fu=lu)&&"object"==typeof fu&&"default"in fu?fu.default:fu;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function gu(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(o,s)}a((r=r.apply(e,[])).next())}))}function mu(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var yu="INSTALLED",vu="NOT_INSTALLED",bu="REGISTERED",Eu="REGISTERING",wu="RELOADING",Su={CHROME:"https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn",FIREFOX:"https://addons.mozilla.org/firefox/addon/ether-metamask/",DEFAULT:"https://metamask.io"},_u="REGISTRATION_IN_PROGRESS",Cu="FORWARDER_ID",ku=function(){function e(t){var n=void 0===t?{}:t,r=n.forwarderOrigin,i=void 0===r?"https://fwd.metamask.io":r,o=n.forwarderMode,s=void 0===o?e.FORWARDER_MODE.INJECT:o;this.forwarderOrigin=i,this.forwarderMode=s,this.state=e.isMetaMaskInstalled()?yu:vu;var a=e._detectBrowser();this.downloadUrl=a?Su[a]:Su.DEFAULT,this._onMessage=this._onMessage.bind(this),this._onMessageFromForwarder=this._onMessageFromForwarder.bind(this),this._openForwarder=this._openForwarder.bind(this),this._openDownloadPage=this._openDownloadPage.bind(this),this.startOnboarding=this.startOnboarding.bind(this),this.stopOnboarding=this.stopOnboarding.bind(this),window.addEventListener("message",this._onMessage),s===e.FORWARDER_MODE.INJECT&&"true"===sessionStorage.getItem(_u)&&e._injectForwarder(this.forwarderOrigin)}return e.prototype._onMessage=function(e){if(e.origin===this.forwarderOrigin)return"metamask:reload"===e.data.type?this._onMessageFromForwarder(e):void console.debug("Unknown message from '"+e.origin+"' with data "+JSON.stringify(e.data))},e.prototype._onMessageUnknownStateError=function(e){throw new Error("Unknown state: '"+e+"'")},e.prototype._onMessageFromForwarder=function(t){return gu(this,0,void 0,(function(){return mu(this,(function(n){switch(n.label){case 0:switch(this.state){case wu:return[3,1];case vu:return[3,2];case yu:return[3,3];case Eu:return[3,5];case bu:return[3,6]}return[3,7];case 1:return console.debug("Ignoring message while reloading"),[3,8];case 2:return console.debug("Reloading now to register with MetaMask"),this.state=wu,location.reload(),[3,8];case 3:return console.debug("Registering with MetaMask"),this.state=Eu,[4,e._register()];case 4:return n.sent(),this.state=bu,t.source.postMessage({type:"metamask:registrationCompleted"},t.origin),this.stopOnboarding(),[3,8];case 5:return console.debug("Already registering - ignoring reload message"),[3,8];case 6:return console.debug("Already registered - ignoring reload message"),[3,8];case 7:this._onMessageUnknownStateError(this.state),n.label=8;case 8:return[2]}}))}))},e.prototype.startOnboarding=function(){sessionStorage.setItem(_u,"true"),this._openDownloadPage(),this._openForwarder()},e.prototype.stopOnboarding=function(){"true"===sessionStorage.getItem(_u)&&(this.forwarderMode===e.FORWARDER_MODE.INJECT&&(console.debug("Removing forwarder"),e._removeForwarder()),sessionStorage.setItem(_u,"false"))},e.prototype._openForwarder=function(){this.forwarderMode===e.FORWARDER_MODE.OPEN_TAB?window.open(this.forwarderOrigin,"_blank"):e._injectForwarder(this.forwarderOrigin)},e.prototype._openDownloadPage=function(){window.open(this.downloadUrl,"_blank")},e.isMetaMaskInstalled=function(){return Boolean(window.ethereum&&window.ethereum.isMetaMask)},e._register=function(){return window.ethereum.request({method:"wallet_registerOnboarding"})},e._injectForwarder=function(e){var t=document.body,n=document.createElement("iframe");n.setAttribute("height","0"),n.setAttribute("width","0"),n.setAttribute("style","display: none;"),n.setAttribute("src",e),n.setAttribute("id",Cu),t.insertBefore(n,t.children[0])},e._removeForwarder=function(){var e;null===(e=document.getElementById(Cu))||void 0===e||e.remove()},e._detectBrowser=function(){var e=pu.parse(window.navigator.userAgent);return"Firefox"===e.browser.name?"FIREFOX":["Chrome","Chromium"].includes(e.browser.name||"")?"CHROME":null},e.FORWARDER_MODE={INJECT:"INJECT",OPEN_TAB:"OPEN_TAB"},e}(),Au=p(ku);function Mu(t,{wait:n=!1}){return e(this,void 0,void 0,(function*(){return Hc(`[MetamaskInstaller: startInstaller()] wait=${n}`),n&&(yield Jd(1e3)),yield t.checkInstallation()}))}class xu{constructor({remote:e,preferDesktop:t,platformManager:n,debug:r=!1}){this.state={isInstalling:!1,hasInstalled:!1,resendRequest:null,preferDesktop:!1,platformManager:null,remote:null,debug:!1,connectWith:void 0},this.state.remote=e,this.state.preferDesktop=t,this.state.platformManager=n,this.state.debug=r}startDesktopOnboarding(){return function(){return e(this,void 0,void 0,(function*(){Hc("[MetamaskInstaller: startDesktopOnboarding() starting desktop onboarding"),delete window.ethereum,(new Au).startOnboarding()}))}()}redirectToProperInstall(){return e(this,void 0,void 0,(function*(){return function(t){var n,r;return e(this,void 0,void 0,(function*(){const{state:e}=t,i=null===(n=e.platformManager)||void 0===n?void 0:n.getPlatformType();if(Hc(`[MetamaskInstaller: redirectToProperInstall()] platform=${i}`),i===Hi.MetaMaskMobileWebview)return!1;e.isInstalling=!0;try{yield null===(r=e.remote)||void 0===r?void 0:r.startConnection({connectWith:e.connectWith}),e.isInstalling=!1,e.hasInstalled=!0}catch(t){throw e.isInstalling=!1,t}return!0}))}(this)}))}checkInstallation(){return e(this,void 0,void 0,(function*(){return function(t){var n;return e(this,void 0,void 0,(function*(){const{state:e}=t,r=null===(n=e.platformManager)||void 0===n?void 0:n.isMetaMaskInstalled();return Hc(`[MetamaskInstaller: checkInstallation()] isInstalled=${r}`),!!r||(yield t.redirectToProperInstall())}))}(this)}))}start({wait:t=!1,connectWith:n}){return e(this,void 0,void 0,(function*(){this.state.connectWith=n,Hc(`[MetaMaskInstaller: start()] wait=${t}`,n),yield Mu(this,{wait:t})}))}}const Ou=({link:e})=>(Hc(`[UI: InstallModal-nonweb()] INSTALL MODAL link=${e}`),{unmount:()=>{}}),Iu=()=>(Hc("[UI: pendingModal-nodejs: PendingModal()] Please open the MetaMask wallet app and confirm the connection. Thank you!"),{unmount:()=>!1,updateOTPValue:e=>{""!==e&&Hc(`[UI: pendingModal-nodejs: PendingModal()] Choose the following value on your metamask mobile wallet: ${e}`)},mount:()=>!1});function Ru(e,t){var n,r,i,o;e.connector||(Hc("[RemoteConnection: initializeConnector()] initialize connector"),e.connector=new no({platformType:t.platformManager.getPlatformType(),communicationLayerPreference:t.communicationLayerPreference,transports:t.transports,dappMetadata:Object.assign(Object.assign({},t.dappMetadata),{source:t._source}),analytics:t.enableAnalytics,communicationServerUrl:t.communicationServerUrl,sdkVersion:rd.version,context:"dapp",ecies:t.ecies,storage:t.storage,logging:t.logging}),t.timer&&(Hc("[RemoteConnection: initializeConnector()] reset background timer",t.timer),null===(r=null===(n=t.timer)||void 0===n?void 0:n.stopBackgroundTimer)||void 0===r||r.call(n),null===(o=null===(i=t.timer)||void 0===i?void 0:i.runBackgroundTimer)||void 0===o||o.call(i,(()=>!1),1e4)))}function Tu(e){e.listeners.forEach((({event:t,handler:n})=>{var r;null===(r=e.connector)||void 0===r||r.off(t,n)})),e.listeners=[]}function Pu(t,n,r){return e(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{if(!t.connector)return void o(new Error("No connector available"));Hc("[RemoteConnection: connectWithModalInstaller()]",{state:t,options:n,linkParams:r});const s=`${t.useDeeplink?sd:od}?${r}`;!function(e,t,n){var r,i,o,s;e.installModal=null===(i=(r=t.modals).install)||void 0===i?void 0:i.call(r,{i18nInstance:t.sdk.i18nInstance,link:n,preferDesktop:e.preferDesktop,installer:t.getMetaMaskInstaller(),terminate:()=>{Hc("[RemoteConnection: showInstallModal() => terminate()] terminate connection"),t.sdk.terminate().catch((e=>{console.warn("[MMSDK] failed to terminate connection",e)}))},debug:e.developerMode,connectWithExtension:()=>{var e;return null===(e=t.connectWithExtensionProvider)||void 0===e||e.call(t),!1}}),null===(s=null===(o=e.installModal)||void 0===o?void 0:o.mount)||void 0===s||s.call(o,n)}(t,n,s),n.sdk.once(_i.PROVIDER_UPDATE,(t=>e(this,void 0,void 0,(function*(){if(Hc("[RemoteConnection: connectWithModalInstaller()] once provider_update -- resolving startConnection promise"),t!==dd.TERMINATE)o(t);else{o({code:4001,message:"User rejected the request."})}})))),t.connector.once(_i.AUTHORIZED,(()=>{i()})),t.connector.once(_i.REJECTED,(()=>{o(_i.REJECTED)})),t.connector.once(_i.CLIENTS_READY,(()=>e(this,void 0,void 0,(function*(){Hc("[RemoteConnection: connectWithModalInstaller()] once clients_ready -- resolving startConnection promise"),i()}))))}))}))}function Nu(t,n){function r(e,n){var r;null===(r=t.connector)||void 0===r||r.on(e,n),t.listeners.push({event:e,handler:n})}t.connector&&(Tu(t),r(_i.WALLET_INIT,(({accounts:t,chainId:n})=>e(this,void 0,void 0,(function*(){Hc(`[RemoteConnection: setupListeners() => EventType.WALLET_INIT] 'wallet_init' accounts=${t} chainId=${n}`);const e=zd.getProvider();e._setConnected();const r={accounts:t,chainId:n,isUnlocked:!1};e._initializeState(r),e.emit("chainChanged",n),e.emit("accountsChanged",t)})))),r(_i.AUTHORIZED,(()=>e(this,void 0,void 0,(function*(){var e,n,r,i;try{Hc("[RemoteConnection: setupListeners() => EventType.AUTHORIZED] 'authorized' closing modals",t.pendingModal,t.installModal);const o=zd.getProvider();o._setConnected(),null===(n=null===(e=t.pendingModal)||void 0===e?void 0:e.unmount)||void 0===n||n.call(e),null===(i=null===(r=t.installModal)||void 0===r?void 0:r.unmount)||void 0===i||i.call(r,!1),t.otpAnswer=void 0,t.authorized=!0,Hc("[RemoteConnection: setupListeners() => EventType.AUTHORIZED] 'authorized' provider.state",o.getState()),yield o.forceInitializeState()}catch(e){}})))),r(_i.TERMINATE,(()=>{var e,n,r,i,o;null===(n=null===(e=t.pendingModal)||void 0===e?void 0:e.unmount)||void 0===n||n.call(e),null===(i=null===(r=t.installModal)||void 0===r?void 0:r.unmount)||void 0===i||i.call(r,!0),t.pendingModal=void 0,t.installModal=void 0,t.otpAnswer=void 0,null===(o=t.connector)||void 0===o||o.disconnect({terminate:!0}),t.authorized=!1;zd.getProvider().handleDisconnect({terminate:!0}),Tu(t),Hc("[RemoteConnection: setupListeners()] All listeners cleaned up")})))}function Lu(t,n,{initialCheck:r,connectWith:i}={}){var o,s,a,c,l,d,u,h,f,p,g,m,y,v,b,E,w,S,_;return e(this,void 0,void 0,(function*(){try{if(Ru(t,n),!t.connector)throw new Error("no connector defined");Nu(t);const C=zd.getProvider();t.authorized=!1,C.emit("connecting");const k=yield null===(o=t.connector)||void 0===o?void 0:o.originatorSessionConnect();Hc(`[RemoteConnection: startConnection()] after originatorSessionConnect initialCheck=${r}`,k);let A=null!==(s=null==k?void 0:k.channelId)&&void 0!==s?s:"",M=null!==(c=null===(a=t.connector.getKeyInfo())||void 0===a?void 0:a.ecies.public)&&void 0!==c?c:"",x=null!==(d=null===(l=t.connector.getKeyInfo())||void 0===l?void 0:l.ecies.private)&&void 0!==d?d:"";if(r&&!k)return Promise.resolve();if(!k&&!r){const e=yield t.connector.generateChannelIdConnect();A=null!==(u=e.channelId)&&void 0!==u?u:"",M=null!==(h=e.pubKey)&&void 0!==h?h:"",x=null!==(f=e.privKey)&&void 0!==f?f:"";const n=Date.now();null===(p=t.connector.state.storageManager)||void 0===p||p.persistChannelConfig({channelId:A,localKey:x,lastActive:n,validUntil:n+vi})}if(r&&(null==k?void 0:k.channelId))return(null===(g=t.connector)||void 0===g?void 0:g.isConnected())||(Hc(`[RemoteConnection: startConnection()] reconnecting to channel initialCheck=${r}`,k),yield null===(m=t.connector)||void 0===m?void 0:m.connectToChannel({channelId:A})),Promise.resolve();k&&!(null===(y=t.connector)||void 0===y?void 0:y.isConnected())&&(Hc("[RemoteConnection: startConnection()] reconnecting to channel",k),yield null===(v=t.connector)||void 0===v?void 0:v.connectToChannel({channelId:A}));const O=(null===(b=t.platformManager)||void 0===b?void 0:b.isSecure())?"":"&t=q",I=rd.version,{iconUrl:R,name:T,url:P,scheme:N}=n.dappMetadata||{},L=null===(E=t.platformManager)||void 0===E?void 0:E.getPlatformType();let D="N/A";"undefined"!=typeof window&&window.location&&window.location.hostname?D=window.location.hostname:void 0!==T?D=T:void 0!==P&&(D=P);const K={url:null!=P?P:"",title:null!=T?T:"",icon:R,scheme:null!=N?N:"",apiVersion:I,dappId:D||P||"N/A",platform:null!=L?L:"",source:null!==(w=n._source)&&void 0!==w?w:""},B=Fd(JSON.stringify(K));let j=`channelId=${A}&v=2&comm=${null!==(S=t.communicationLayerPreference)&&void 0!==S?S:""}&pubkey=${M}${O}&originatorInfo=${B}`;if(i){j+=`&rpc=${Fd(JSON.stringify(i))}`;const e=t.connector.getRPCMethodTracker();e&&(e[`${i.id}`]=Object.assign(Object.assign({},i),{id:`${i.id}`,timestamp:Date.now()}))}const $=encodeURI(j),U=`${t.useDeeplink?sd:od}?${j}`;return t.qrcodeLink=U,t.developerMode&&Hc(`[RemoteConnection: startConnection()] qrcodeLink=${$}`),C.emit("display_uri",U),(null===(_=t.platformManager)||void 0===_?void 0:_.isSecure())?(yield function(t,n){var r,i;return e(this,void 0,void 0,(function*(){const e=`${od}?${n}`,o=`${sd}?${n}`;null===(i=null===(r=t.platformManager)||void 0===r?void 0:r.openDeeplink)||void 0===i||i.call(r,e,o,"_self")}))}(t,$),new Promise(((e,n)=>{var r,i,o;(null===(r=t.connector)||void 0===r?void 0:r.isAuthorized())?e():(null===(i=t.connector)||void 0===i||i.once(_i.AUTHORIZED,(()=>{e()})),null===(o=t.connector)||void 0===o||o.once(_i.REJECTED,(()=>{n(_i.REJECTED)})))}))):Pu(t,n,$)}catch(e){throw console.error("[startConnection] error",e),e}}))}class Du{constructor(e){var t,n,r;this.state={connector:void 0,qrcodeLink:void 0,analytics:void 0,developerMode:!1,authorized:!1,reconnection:!1,preferDesktop:!1,deeplinkProtocol:!1,listeners:[],communicationLayerPreference:void 0,platformManager:void 0,pendingModal:void 0,installModal:void 0,otpAnswer:void 0},this.options=e;const i=!0===(null===(t=e.logging)||void 0===t?void 0:t.developerMode)||!0===(null===(n=e.logging)||void 0===n?void 0:n.sdk);this.state.developerMode=i,this.state.analytics=e.analytics,this.state.preferDesktop=null!==(r=e.preferDesktop)&&void 0!==r&&r,this.state.useDeeplink=e.sdk.options.useDeeplink,this.state.communicationLayerPreference=e.communicationLayerPreference,this.state.platformManager=e.platformManager,e.modals.install||(e.modals.install=Ou),e.modals.otp||(e.modals.otp=Iu)}startConnection(t){return e(this,void 0,void 0,(function*(){return Lu(this.state,this.options,t)}))}initRemoteCommunication({sdkInstance:t}){var n,r,i;return e(this,void 0,void 0,(function*(){const e=yield null===(r=null===(n=t.options.storage)||void 0===n?void 0:n.storageManager)||void 0===r?void 0:r.getPersistedChannelConfig();if(!this.options.ecies){const t={privateKey:null==e?void 0:e.localKey};this.options.ecies=t}Ru(this.state,this.options),yield null===(i=this.getConnector())||void 0===i?void 0:i.initFromDappStorage(),Nu(this.state,this.options)}))}showActiveModal(){return function(e){var t,n,r,i;e.authorized?Hc("[RemoteConnection: showActiveModal()] already authorized"):e.pendingModal?null===(n=(t=e.pendingModal).mount)||void 0===n||n.call(t):e.installModal&&(null===(i=(r=e.installModal).mount)||void 0===i||i.call(r,e.qrcodeLink||""))}(this.state)}closeModal(){var e,t,n,r;null===(t=null===(e=this.state.pendingModal)||void 0===e?void 0:e.unmount)||void 0===t||t.call(e),null===(r=null===(n=this.state.installModal)||void 0===n?void 0:n.unmount)||void 0===r||r.call(n,!1)}getUniversalLink(){if(!this.state.qrcodeLink)throw new Error("connection not started. run startConnection() first.");return this.state.qrcodeLink}getChannelConfig(){var e;return null===(e=this.state.connector)||void 0===e?void 0:e.getChannelConfig()}getKeyInfo(){var e;return null===(e=this.state.connector)||void 0===e?void 0:e.getKeyInfo()}getConnector(){if(!this.state.connector)throw new Error("invalid remote connector");return this.state.connector}getPlatformManager(){if(!this.state.platformManager)throw new Error("PlatformManager not available");return this.state.platformManager}isConnected(){var e;return(null===(e=this.state.connector)||void 0===e?void 0:e.isReady())||!1}isAuthorized(){var e;return(null===(e=this.state.connector)||void 0===e?void 0:e.isAuthorized())||!1}isPaused(){var e;return null===(e=this.state.connector)||void 0===e?void 0:e.isPaused()}disconnect(e){var t,n,r;Hc("[RemoteConnection: disconnect()]",e),(null==e?void 0:e.terminate)&&(zd.getProvider().handleDisconnect({terminate:!0}),null===(n=null===(t=this.state.pendingModal)||void 0===t?void 0:t.unmount)||void 0===n||n.call(t),this.state.otpAnswer=void 0),null===(r=this.state.connector)||void 0===r||r.disconnect(e),function(e){Hc("[RemoteConnection: cleanupConnector()] cleaning up connector"),e.connector&&(Tu(e),e.connector.disconnect({terminate:!0}).catch((e=>{Hc("[RemoteConnection: cleanupConnector()] error disconnecting connector",e)})))}(this.state)}}function Ku(n){var r,i,o,s,a,c,l,d,u,h,f;return e(this,void 0,void 0,(function*(){const{options:p}=n;if(p.logging=null!==(r=p.logging)&&void 0!==r?r:{},p.communicationLayerPreference=null!==(i=p.communicationLayerPreference)&&void 0!==i?i:Ui.SOCKET,void 0!==p.enableDebug&&(t.enable("MM_SDK"),console.warn("enableDebug is removed. Please use enableAnalytics instead.")),p.enableAnalytics=null===(o=p.enableAnalytics)||void 0===o||o,p.injectProvider=null===(s=p.injectProvider)||void 0===s||s,p.shouldShimWeb3=null===(a=p.shouldShimWeb3)||void 0===a||a,p.extensionOnly=null===(c=p.extensionOnly)||void 0===c||c,p.useDeeplink=null===(l=p.useDeeplink)||void 0===l||l,p.storage=null!==(d=p.storage)&&void 0!==d?d:{enabled:!0},p.headless){t("[MetaMaskSDK: performSDKInitialization()] headless mode enabled");const e=()=>{},n={install:()=>({mount:e,unmount:e})},r={installer:e};p.modals=n,p.ui=r}const g=!0===(null===(u=p.logging)||void 0===u?void 0:u.developerMode);n.debug=(null===(h=p.logging)||void 0===h?void 0:h.sdk)||g,Hc("[MetaMaskSDK: performSDKInitialization()] options",n.options);const m=Object.assign({},p.logging);g&&(m.sdk=!0,m.eciesLayer=!0,m.keyExchangeLayer=!0,m.remoteLayer=!0,m.serviceLayer=!0,m.plaintext=!0),yield function(t){var n,r,i;return e(this,void 0,void 0,(function*(){const e=null!==(n=t.options.i18nOptions)&&void 0!==n?n:{},o=e.enabled;yield t.i18nInstance.use(Ld).init({debug:null!==(r=e.debug)&&void 0!==r&&r,compatibilityJSON:"v3",fallbackLng:"en",interpolation:{escapeValue:!1},resources:o?{en:{translation:Dd},es:{translation:Kd},it:{translation:$d},fr:{translation:Bd},pt:{translation:Ud},tr:{translation:Hd},he:{translation:jd}}:{en:{translation:Dd}},detection:{order:["localStorage","navigator"],lookupLocalStorage:"MetaMaskSDKLng",caches:["localStorage"]}}),t.availableLanguages=Object.keys(null!==(i=t.i18nInstance.services.resourceStore.data)&&void 0!==i?i:{})}))}(n),yield function(t){var n;return e(this,void 0,void 0,(function*(){const{options:e}=t;t.platformManager=new uu({useDeepLink:null!==(n=e.useDeeplink)&&void 0!==n&&n,preferredOpenLink:e.openDeeplink,debug:t.debug})}))}(n),yield function(t){var n,r,i,o,s,a,c,l,d;return e(this,void 0,void 0,(function*(){const{options:e}=t,u=null===(n=t.platformManager)||void 0===n?void 0:n.getPlatformType();t.analytics=new eu({serverUrl:null!==(r=e.communicationServerUrl)&&void 0!==r?r:mi,enabled:e.enableAnalytics,originatorInfo:{url:null!==(i=e.dappMetadata.url)&&void 0!==i?i:"",title:null!==(o=e.dappMetadata.name)&&void 0!==o?o:"",dappId:"undefined"==typeof window||void 0===window.location?null!==(l=null!==(a=null===(s=e.dappMetadata)||void 0===s?void 0:s.name)&&void 0!==a?a:null===(c=e.dappMetadata)||void 0===c?void 0:c.url)&&void 0!==l?l:"N/A":window.location.hostname,platform:null!=u?u:"",source:null!==(d=e._source)&&void 0!==d?d:""}})}))}(n),yield function(t){var n;return e(this,void 0,void 0,(function*(){const{options:e}=t;!0!==(null===(n=e.storage)||void 0===n?void 0:n.enabled)||e.storage.storageManager||(e.storage.storageManager=fl(e.storage))}))}(n),yield function(t){return e(this,void 0,void 0,(function*(){const{options:e}=t,n=/^(http|https):\/\/[^\s]*$/;if(e.dappMetadata){e.dappMetadata.iconUrl&&!n.test(e.dappMetadata.iconUrl)&&(console.warn("Invalid dappMetadata.iconUrl: URL must start with http:// or https://"),e.dappMetadata.iconUrl=void 0),e.dappMetadata.base64Icon&&e.dappMetadata.base64Icon.length>nu&&(console.warn("Invalid dappMetadata.base64Icon: Base64-encoded icon string length must be less than 163400 characters"),e.dappMetadata.base64Icon=void 0),e.dappMetadata.url&&!n.test(e.dappMetadata.url)&&console.warn("Invalid dappMetadata.url: URL must start with http:// or https://");const t=tu();if(t&&!e.dappMetadata.iconUrl&&!e.dappMetadata.base64Icon){const n=`${window.location.protocol}//${window.location.host}${t}`;e.dappMetadata.iconUrl=n}}t.dappMetadata=e.dappMetadata}))}(n),yield au(n),yield hu(n);const{metamaskBrowserExtension:y,preferExtension:v,shouldReturn:b}=yield function(t){var n,r,i,o;return e(this,void 0,void 0,(function*(){const{options:e}=t;let s,a=!1,c=!1;if("undefined"!=typeof window&&window.ethereum&&!(null===(n=t.platformManager)||void 0===n?void 0:n.isMetaMaskMobileWebView())){a="extension"===localStorage.getItem(cl);try{s=yield su({mustBeMetaMask:!0,sdkInstance:t}),window.extension=s,s.on(ul.CHAIN_CHANGED,(e=>{Hc(`[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE chainChanged chainId=${e}`),Boolean(t.sdkProvider)&&t.getMobileProvider().emit(ul.CHAIN_CHANGED,e)})),s.on(ul.ACCOUNTS_CHANGED,(e=>{Hc(`[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE accountsChanged accounts=${e}`);const n=Boolean(t.sdkProvider),r=Boolean(t.extensionActive);n&&t.getMobileProvider().emit(ul.ACCOUNTS_CHANGED,e),r&&0===(null==e?void 0:e.length)&&t.terminate().catch((e=>{Hc("[MetaMaskSDK: setupExtensionPreferences()] Error terminating",e)}))})),s.on(ul.DISCONNECT,(e=>{Hc(`[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE disconnect error=${e}`),Boolean(t.sdkProvider)&&t.getMobileProvider().emit(ul.DISCONNECT,e)})),s.on(ul.CONNECT,(e=>{Hc(`[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE connect args=${e}`),Boolean(t.sdkProvider)&&t.getMobileProvider().emit(ul.CONNECT,e)})),s.on(ul.CONNECTED,(e=>{Hc("[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE connected",e),Boolean(t.sdkProvider)&&t.getMobileProvider().emit(ul.CONNECTED,e)}))}catch(e){window.extension=void 0}}else(null===(r=t.platformManager)||void 0===r?void 0:r.isMetaMaskMobileWebView())&&(null===(i=t.analytics)||void 0===i||i.send({event:Mi.SDK_USE_INAPP_BROWSER}),t.activeProvider=iu({provider:window.ethereum,sdkInstance:t}),t._initialized=!0,c=!0);return s&&e.extensionOnly&&(Hc("[MetaMaskSDK: setupExtensionPreferences()] EXTENSION ONLY --- prevent sdk initialization"),null===(o=t.analytics)||void 0===o||o.send({event:Mi.SDK_USE_EXTENSION}),t.activeProvider=s,t.extensionActive=!0,t.extension=s,t._initialized=!0,c=!0),{preferExtension:a,shouldReturn:c,metamaskBrowserExtension:s}}))}(n);if(b)Hc("[MetaMaskSDK: performSDKInitialization()] shouldReturn=true --- prevent sdk initialization");else{yield function(t,n){var r,i,o,s,a;return e(this,void 0,void 0,(function*(){const{options:e}=t,c=Object.assign({},e.logging);t.remoteConnection=new Du({i18nInstance:t.i18nInstance,preferDesktop:null!==(r=e.preferDesktop)&&void 0!==r&&r,communicationLayerPreference:null!==(i=e.communicationLayerPreference)&&void 0!==i?i:Ui.SOCKET,analytics:t.analytics,dappMetadata:e.dappMetadata,_source:e._source,enableAnalytics:null===(o=e.enableAnalytics)||void 0===o||o,timer:e.timer,sdk:t,platformManager:t.platformManager,transports:e.transports,communicationServerUrl:e.communicationServerUrl,storage:null!==(s=e.storage)&&void 0!==s?s:{enabled:!0},getMetaMaskInstaller:()=>{if(!t.installer)throw new Error("Invalid SDK status -- installer not initialized");return t.installer},logging:c,connectWithExtensionProvider:void 0===n?void 0:()=>fd(t),modals:Object.assign(Object.assign({},e.modals),{onPendingModalDisconnect:t.terminate.bind(t)})}),yield t.remoteConnection.initRemoteCommunication({sdkInstance:t}),t.installer=new xu({remote:t.remoteConnection,preferDesktop:null!==(a=e.preferDesktop)&&void 0!==a&&a,platformManager:t.platformManager,debug:t.debug})}))}(n,y),yield Xd(n),yield function(t,n){var r,i;return e(this,void 0,void 0,(function*(){const{options:e}=t;n?(Hc("[MetaMaskSDK: handleAutoAndExtensionConnections()] preferExtension is detected -- connect with it."),null===(r=t.analytics)||void 0===r||r.send({event:Mi.SDK_EXTENSION_UTILIZED}),fd(t).catch((e=>{console.warn("Can't connect with MetaMask extension...",e),localStorage.removeItem(cl)}))):e.checkInstallationImmediately&&((null===(i=t.platformManager)||void 0===i?void 0:i.isDesktopWeb())?(Hc("[MetaMaskSDK: handleAutoAndExtensionConnections()] checkInstallationImmediately"),t.connect().catch((e=>{Hc(`[MetaMaskSDK: handleAutoAndExtensionConnections()] checkInstallationImmediately --- IGNORED --- error on autoconnect _err=${e}`)}))):console.warn("[handleAutoAndExtensionConnections()] checkInstallationImmediately --- IGNORED --- only for web desktop")),t._initialized=!0}))}(n,v);try{yield null===(f=n.remoteConnection)||void 0===f?void 0:f.startConnection({initialCheck:!0})}catch(e){console.error("[MetaMaskSDK: setupRemoteConnectionAndInstaller()] Error while checking installation",e)}n.emit(ld.ProviderUpdate,dd.INITIALIZED)}}))}class Bu extends o{constructor(e={storage:{enabled:!0},injectProvider:!0,forceInjectProvider:!1,enableAnalytics:!0,shouldShimWeb3:!0,useDeeplink:!0,extensionOnly:!0,headless:!1,dappMetadata:{name:"",url:"",iconUrl:""},_source:id,i18nOptions:{enabled:!1}}){var n,r,i;super(),this.extensionActive=!1,this._initialized=!1,this.sdkInitPromise=void 0,this.debug=!1,this.readonlyRPCCalls=!1,this.i18nInstance=td(),this.availableLanguages=["en"],t.disable();const o=!0===(null===(n=e.logging)||void 0===n?void 0:n.developerMode);if(((null===(r=e.logging)||void 0===r?void 0:r.sdk)||o)&&t.enable("MM_SDK"),Hc("[MetaMaskSDK: constructor()]: begin."),this.setMaxListeners(50),!(null===(i=e.dappMetadata)||void 0===i?void 0:i.url)){if("undefined"==typeof window||"undefined"==typeof document)throw new Error("You must provide dAppMetadata url");e.dappMetadata=Object.assign(Object.assign({},e.dappMetadata),{url:`${window.location.protocol}//${window.location.host}`})}this.options=e,this.options._source||(e._source=id),this.init().then((()=>{Hc("[MetaMaskSDK: constructor()]: initialized successfully."),"undefined"!=typeof window&&(window.mmsdk=this)})).catch((e=>{console.error("[MetaMaskSDK: constructor()] error during initialization",e)}))}init(){return e(this,void 0,void 0,(function*(){return function(t){var n;return e(this,void 0,void 0,(function*(){if("undefined"!=typeof window&&(null===(n=window.mmsdk)||void 0===n?void 0:n.isInitialized()))return Hc("[MetaMaskSDK: initializeMetaMaskSDK()] already initialized"),Promise.resolve(window.mmsdk);if(t._initialized)return Hc("[MetaMaskSDK: initializeMetaMaskSDK()] already initialized"),t.sdkInitPromise;if(t.sdkInitPromise)return Hc("[MetaMaskSDK: initializeMetaMaskSDK()] already initializing"),t.sdkInitPromise;try{t.sdkInitPromise=Ku(t),yield t.sdkInitPromise}catch(e){throw console.error(e),e}return t.sdkInitPromise}))}(this)}))}isExtensionActive(){return this.extensionActive}checkExtensionAvailability(){var e;return"undefined"!=typeof window&&Boolean(null===(e=window.ethereum)||void 0===e?void 0:e.isMetaMask)}connect(){return e(this,void 0,void 0,(function*(){return function(t){return e(this,void 0,void 0,(function*(){if(t._initialized||(Hc("[MetaMaskSDK: connect()] provider not ready -- wait for init()"),yield t.init()),Hc(`[MetaMaskSDK: connect()] isExtensionActive=${t.isExtensionActive()} activeProvider`,t.activeProvider),!t.activeProvider)throw new Error("SDK state invalid -- undefined provider");const e=t.activeProvider.getSelectedAddress();return e?[e]:t.activeProvider.request({method:rl.ETH_REQUESTACCOUNTS,params:[]})}))}(this)}))}connectAndSign({msg:t}){return e(this,void 0,void 0,(function*(){return hd({instance:this,msg:t})}))}connectWith(t){return e(this,void 0,void 0,(function*(){return function({instance:t,rpc:n}){return e(this,void 0,void 0,(function*(){if(t._initialized||(Hc("[MetaMaskSDK: connectWith()] provider not ready -- wait for init()"),yield t.init()),Hc(`[MetaMaskSDK: connectWith()] method: ${n.method} rpc=${n}`),!t.activeProvider)throw new Error("SDK state invalid -- undefined provider");return t.activeProvider.request({method:rl.METAMASK_CONNECTWITH,params:[n]})}))}({instance:this,rpc:t})}))}resume(){return function(t){var n,r,i;return e(this,void 0,void 0,(function*(){if(!(null===(r=null===(n=t.remoteConnection)||void 0===n?void 0:n.getConnector())||void 0===r?void 0:r.isReady()))return Hc("[MetaMaskSDK: resume()] channel is not ready -- starting connection"),void(null===(i=t.remoteConnection)||void 0===i||i.startConnection());Hc("[MetaMaskSDK: resume()] channel is ready")}))}(this)}disconnect(){return console.warn("MetaMaskSDK.disconnect() is deprecated, use terminate()"),this.terminate()}isAuthorized(){var e;null===(e=this.remoteConnection)||void 0===e||e.isAuthorized()}terminate(){return function(t){var n,r,i;return e(this,void 0,void 0,(function*(){if(!(null===(n=t.platformManager)||void 0===n?void 0:n.isMetaMaskMobileWebView())){if(ud&&(window.localStorage.removeItem(cl),window.localStorage.removeItem(dl),window.localStorage.removeItem(ll)),t.extensionActive){try{yield null===(r=t.activeProvider)||void 0===r?void 0:r.request({method:rl.WALLET_REVOKEPERMISSIONS,params:[{eth_accounts:{}}]})}catch(e){Hc("[MetaMaskSDK: terminate()] error revoking permissions",e)}return t.options.extensionOnly?void Hc("[MetaMaskSDK: terminate()] extensionOnly --- prevent switching providers"):(t.activeProvider=t.sdkProvider,window.ethereum=t.activeProvider,t.extensionActive=!1,void t.emit(ld.ProviderUpdate,dd.TERMINATE))}t.emit(ld.ProviderUpdate,dd.TERMINATE),Hc(`[MetaMaskSDK: terminate()] remoteConnection=${t.remoteConnection}`),null===(i=t.remoteConnection)||void 0===i||i.disconnect({terminate:!0,sendMessage:!0})}}))}(this)}isInitialized(){return this._initialized}setReadOnlyRPCCalls(e){this.readonlyRPCCalls=e}hasReadOnlyRPCCalls(){return this.readonlyRPCCalls}getProvider(){if(this.activeProvider)return this.activeProvider;console.warn("MetaMaskSDK: No active provider found")}getMobileProvider(){if(!this.sdkProvider)throw new Error("SDK state invalid -- undefined mobile provider");return this.sdkProvider}getUniversalLink(){var e;const t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getUniversalLink();if(!t)throw new Error("No Universal Link available, please call eth_requestAccounts first.");return t}getChannelId(){var e,t;return null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getChannelConfig())||void 0===t?void 0:t.channelId}getRPCHistory(){var e,t;return null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t?void 0:t.getRPCMethodTracker()}getVersion(){return rd.version}getWalletStatus(){var e,t;return null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t?void 0:t.getConnectionStatus()}_getChannelConfig(){var e;return null===(e=this.remoteConnection)||void 0===e?void 0:e.getChannelConfig()}_ping(){var e,t;null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t||t.ping()}_keyCheck(){var e,t;null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t||t.keyCheck()}_getServiceStatus(){var e,t;return null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t?void 0:t.getServiceStatus()}_getRemoteConnection(){return this.remoteConnection}_getDappMetadata(){return this.dappMetadata}_getKeyInfo(){var e;return null===(e=this.remoteConnection)||void 0===e?void 0:e.getKeyInfo()}_resetKeys(){var e,t;null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t||t.resetKeys()}_getConnection(){return this.remoteConnection}emit(e,t){return super.emit(e,t)}on(e,t){return super.on(e,t)}}export{Ui as CommunicationLayerPreference,Si as ConnectionStatus,mi as DEFAULT_SERVER_URL,_i as EventType,Ai as MessageType,Bu as MetaMaskSDK,ld as MetaMaskSDKEvent,dd as PROVIDER_UPDATE_TYPE,Hi as PlatformType,pl as SDKProvider,hl as StorageManagerAS,Bu as default};
//# sourceMappingURL=metamask-sdk.js.map
